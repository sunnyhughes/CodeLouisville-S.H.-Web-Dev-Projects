"use strict";const a22_0x218f=["_getVerticalAlignmentValue","_imageService","_setState","_finish","fontFamily","dialog-content-row","_viewportService","currentLayer","Font size","softLight","Left alignment","_clearLayer","add","Cancel","_svgPath2","alignment","_leftAlignOption","temporaryLayer","click","clientWidth","Justify alignment","Set Text Color","_pointerDownX","_textLayer","viewportService","onBeforeRunLayerTask","commit","getDetailedInfo","serif","middle","value","_isItalicOption","Disable","taskWorkerService","pointerDownMove","Font family","_topVerticalAlignOption","_updateStyles","topleft","Resize Text","none","_updateAlignment","_model","_createRange","default","_sc","linearDodgeAdd","_range","createElementNS","exclusion","primaryColor","_topLeftInfo","Text top left position is x=","flipX","1eQNgXx","_directionalMoveElements","register","_justifyAlignOption","Blend Mode","_alignOptions","_getRange","_onStateChange","top","fill","topright","_rectangleOtherPoint","appendChild","_setupActiveTemporaryLayer","createDomRenderProgram","right","style","_bottomVerticalAlignOption","Center alignment","div","includes","21qYyawi","onHistoryUnset","_textInputDialog","type","order","size","range","zoom","_verticalAlignOptions","_sizeInfo","createElement","get","Draw Text","monospace","dialog-buttons-row","1qtOzRS","bottomright"," x ","_onUpdate","_getAlignmentValue","sign","remove","94jjaMcq","verticalAlignment","display","dispose","_updateText","Set Text Blend Mode","render","selectionService","_onHistoryUpdateValue","209113iQpNHO","position","allowUnchecking","name","_textarea","_outlineModel","select","getInfo","keyDown","MoveImageRangeRenderer","onCommit","1.1","replace","dblClick","_getLayer","clientHeight","registerTemporaryLayer","ArrowLeft","overlay","normal","_updateVerticalAlignment","fontWeight","string-combo","_layer","Enable","blendMode","Update Text","bottomleft","multiply","setRange","strokeWidth","Shift Text","bold","124784hOWOpE","_moveImageRangeRenderer","height","offsetX","setAttribute","42813riqSdZ","_svgPath","Top vertical alignment","triggerRequestRender","version","setValueFromHistoryChange","new","isBold","_centerAlignOption","getOutlineSvgPath","stroke","move-handle","_container","round","#middle","setColors","_refreshInfo","bottom","text-tool-input","handleOptionUpdate","devicePixelRatio","sans-serif","_directionalMoveZones","65933pXYYRO","getPointerState","onUpdate","ctrlKey","ArrowRight","onTemporaryLayerRegistered","Middle vertical alignment","addEventListener","_cursorOrigin","justify","key","fontSize","then","classList","path","fantasy","imageService","unregisterTemporaryLayer","var(--luna-focusColor)","setVisible","step","_onRequestRender","block","fire","state","1168350clYftl","altKey","shape","append","secondaryColor","shiftKey","diamond","abs","hasTextLayer","event","triangle","_allowNewState","_cursorOriginalRectangle","Set Text Alignment","rgba","Bottom vertical alignment","serialize","fontStyle","transparent","Set Text Font Family","textContent","italic","Move Text","_fontFamilyOption","_svg","_onOptionsChange","cursive","_updateColors","onHistoryUpdateValue","svg","move"," pixels wide by ","_rightAlignOption","1XJLMxt","metaKey","secondary","left","_middleVerticalAlignOption","1008227RKLYfw","onStateChange","_updateRect","buttons","options","textarea","set","number","_isBoldOption","_fontSizeOption","_cursorCurrent","ArrowDown","pointerDown","currentState","prepend","max","primary","linearBurn","toString","webpackChunkluna","text","ellipse","boolean","_blendModeOption","http://www.w3.org/2000/svg","9325HyhXms","Set Text Font Size"," Bold","23TZgdbF","_elementContainer","Right alignment","Italic","hasImage","bind","dialog-box","input","_isVisible","lighten","width","min","_value","onLayerChange","offsetY","paletteService","onWillDispose","historyService"],a22_0x25c9=function(t,s){return a22_0x218f[t-=369]},a22_0x489634=a22_0x25c9;!function(t,s){const i=a22_0x25c9;for(;;)try{if(735368==-parseInt(i(447))*parseInt(i(604))+-parseInt(i(477))*-parseInt(i(595))+parseInt(i(480))*parseInt(i(642))+parseInt(i(414))*-parseInt(i(552))+parseInt(i(588))*-parseInt(i(637))-parseInt(i(452))+parseInt(i(573))*parseInt(i(389)))break;t.push(t.shift())}catch(s){t.push(t.shift())}}(a22_0x218f),(self.webpackChunkluna=self[a22_0x489634(471)]||[]).push([[8488,504],{3315:(t,s,i)=>{const e=a22_0x489634;i.d(s,{d:()=>c});var h=i(5120),n=i(1003),o=i(1674);let r,a;class c extends h.JT{constructor(t,s,i,e){const h=a22_0x25c9;super(),this[h(378)]=t,this[h(499)]=s,this[h(504)]=i,this[h(540)]=e,this[h(577)]=2,this[h(438)]=document[h(546)](o.q,h(443)),this[h(438)][h(641)](h(370),h(615)),this[h(438)][h(568)][h(605)]="absolute",this[h(643)]=document.createElementNS(o.q,"path"),this._svgPath[h(568)][h(376)]=h(407),this[h(643)][h(568)].fill=h(432),this[h(643)][h(568)][h(634)]="1",this[h(512)]=document[h(546)](o.q,h(403)),this[h(512)][h(568)][h(376)]="var(--luna-focusColor)",this[h(512)][h(568)][h(561)]=h(432),this[h(512)][h(568)][h(634)]="1",this[h(438)][h(417)](this[h(643)],this[h(512)]),this[h(378)][h(466)](this._svg),this[h(554)]({dispose:()=>this[h(378)].removeChild(this[h(438)])})}async[e(601)](){const t=e,s=this[t(540)].range,h=this._viewportService;if(!s)return void(this[t(438)][t(568)][t(597)]=t(538));if(this[t(438)][t(568)].display="block",!this[t(499)][t(505)])return;if(r!==this[t(540)][t(416)]){let s;switch(r=this[t(540)][t(416)],r){case t(420):s=i.e(727)[t(401)](i.bind(i,727));break;case t(473):s=i.e(8459)[t(401)](i[t(485)](i,8459));break;case t(424):s=i.e(4012)[t(401)](i[t(485)](i,4012));break;case"rightTriangle":s=i.e(6243).then(i.bind(i,6243));break;default:s=void 0}a=s?new Promise((async i=>{const e=t;i(new((await s)[e(542)]))})):s}const o=await a,c=Math[t(379)](this._container.clientWidth/2)-this[t(499)][t(490)]/2*h[t(580)]+h.x*h[t(580)],l=Math[t(379)](this[t(378)][t(619)]/2)-this[t(499)][t(639)]/2*h[t(580)]+h.y*h[t(580)],p=(0,n.Oq)(s)*h[t(580)],d=(0,n.rY)(s)*h[t(580)];this._svg.style[t(450)]=c+s[t(450)]*h[t(580)]-2+"px",this[t(438)][t(568)][t(560)]=l+s[t(560)]*h[t(580)]-2+"px",this[t(438)][t(641)]("width",(p+5)[t(470)]()),this[t(438)][t(641)](t(639),(d+5).toString()),this._svgPath[t(641)]("d","M2.5 2.5 h"+p+" v"+d+" h"+-p+" v"+-d),o?.getOutlineSvgPath?(this._svgPath2.style[t(597)]=t(411),this[t(512)][t(641)]("d",o[t(375)](p,d,this._model[t(551)],this._model.flipY))):this[t(512)][t(568)][t(597)]=t(538)}}},9865:(t,s,i)=>{i.d(s,{q:()=>n});var e=i(1815),h=i(5120);class n extends h.JT{constructor(){const t=a22_0x25c9;super(...arguments),this[t(591)]=this[t(554)](new e.v),this[t(391)]=this._onUpdate[t(423)]}}},9904:(t,s,i)=>{const e=a22_0x489634;i.d(s,{FV:()=>r,rP:()=>a,tv:()=>c,Jp:()=>l,X5:()=>p,qv:()=>d});var h=i(1815),n=i(5120),o=i(2939);class r extends n.JT{constructor(t,s,i,e=!0){const n=a22_0x25c9;super(),this[n(607)]=t,this[n(484)]=s,this._value=i,this[n(606)]=e,this[n(576)]=n(474),this._onHistoryUpdateValue=this.register(new h.v),this.onHistoryUpdateValue=this[n(603)].event,this[n(591)]=this[n(554)](new h.v),this[n(391)]=this[n(591)].event}get[e(528)](){return this._value}set value(t){const s=e;this[s(492)]=t,this[s(591)][s(412)](t)}setValueFromHistoryChange(t){const s=e;this[s(492)]=t,this._onHistoryUpdateValue[s(412)](t)}}class a extends n.JT{constructor(t,s,i){const n=e;super(),this.name=t,this[n(456)]=s,this[n(492)]=i,this[n(576)]="string",this[n(603)]=this[n(554)](new h.v),this.onHistoryUpdateValue=this[n(603)].event,this[n(591)]=this[n(554)](new h.v),this[n(391)]=this[n(591)].event}get[e(528)](){return this[e(492)]}set[e(528)](t){const s=e;this._value=t,this[s(591)][s(412)](t)}[e(371)](t){const s=e;this._value=t,this[s(603)][s(412)](t)}}class c extends n.JT{constructor(t,s,i){const n=e;super(),this[n(607)]=t,this.options=s,this[n(492)]=i,this[n(576)]=n(626),this[n(603)]=this[n(554)](new h.v),this[n(442)]=this[n(603)][n(423)],this._onUpdate=this[n(554)](new h.v),this[n(391)]=this[n(591)][n(423)]}get[e(528)](){return this._value}set[e(528)](t){this[e(492)]=t,this._onUpdate.fire(t)}[e(371)](t){const s=e;this[s(492)]=t,this._onHistoryUpdateValue[s(412)](t)}}class l extends a{constructor(){const t=e;super("Blend Mode",[t(623),t(616),"darken",t(632),t(469),"lighten","screen","linearDodgeAdd","overlay","softLight","difference",t(547)],t(623))}}class p extends n.JT{constructor(t,s,i,n){const o=e;super(),this.name=t,this[o(492)]=s,this[o(491)]=i,this[o(467)]=n,this[o(576)]=o(459),this[o(603)]=this[o(554)](new h.v),this[o(442)]=this._onHistoryUpdateValue.event,this[o(591)]=this[o(554)](new h.v),this[o(391)]=this[o(591)].event}get[e(528)](){const t=e;return(0,o.u)(this[t(492)],this[t(467)],this[t(491)])}set[e(528)](t){const s=e;this[s(492)]=t,this._onUpdate[s(412)](t)}[e(371)](t){const s=e;this[s(492)]=t,this[s(603)][s(412)](t)}}class d extends p{constructor(t,s,i,h){const n=e;super(t,s,i,h),this[n(576)]=n(459)}get[e(528)](){const t=e;return(0,o.u)(this[t(492)],this[t(467)],this[t(491)])}set[e(528)](t){const s=e;this._value=Math.floor(t),this[s(591)][s(412)](t)}}},504:(t,s,i)=>{const e=a22_0x489634;i.r(s),i.d(s,{MoveImageRangeRenderer:()=>o});var h=i(5120),n=i(1003);class o extends h.JT{constructor(t,s,i,e,h){const o=a22_0x25c9;super(),this[o(378)]=t,this[o(558)]=s,this[o(425)]=i,this._viewportService=e,this[o(499)]=h,this[o(577)]=2,this[o(553)]=new Map,this[o(388)]=new Map,this[o(488)]=!0,this[o(481)]=document.createElement(o(571));const r=["topleft","topright","bottomleft",o(589),o(560),"bottom","left",o(567)];for(const t of r){const s=document[o(583)](o(571));s[o(402)][o(510)](o(377),t),this[o(481)][o(564)](s),this._directionalMoveElements[o(458)](t,s),this[o(388)][o(458)](t,(0,n.Pq)())}this._container[o(564)](this[o(481)]),this[o(554)]({dispose:()=>{const t=o;this._container.removeChild(this[t(481)])}})}[e(408)](t){const s=e;t!==this[s(488)]&&(this[s(481)][s(568)][s(597)]=t?"":"none",this._isVisible=t)}[e(633)](t){}render(){const t=e,s=this._getRange();if(!s)return;const i=this[t(499)][t(505)];if(!i)return;const h=this._viewportService,n=Math.round(this[t(378)][t(517)]/2)-i[t(490)]/2*h[t(580)],o=Math.round(this[t(378)][t(619)]/2)-i[t(639)]/2*h.zoom,r=n+(h.x+s[t(450)])*h.zoom,a=o+(h.y+s.top)*h.zoom,c=n+(h.x+s[t(567)])*h[t(580)],l=o+(h.y+s[t(383)])*h[t(580)],p=Math[t(379)]((r+c)/2),d=Math[t(379)]((a+l)/2),g=10*window[t(386)],u={left:Math[t(491)](r+g,Math[t(467)](r,p-g)),top:Math[t(491)](a+g,Math[t(467)](a,d-g)),right:Math.max(c-g,Math[t(491)](c,p+g)),bottom:Math[t(467)](l-g,Math[t(491)](l,d+g))},_={left:r-g,top:a-g,right:c+g,bottom:l+g},m=this._directionalMoveZones[t(584)](t(536));m[t(450)]=_[t(450)],m.right=u[t(450)],m[t(560)]=_[t(560)],m[t(383)]=u[t(560)];const f=this[t(553)].get(t(536));f[t(568)][t(450)]=r+"px",f[t(568)][t(560)]=a+"px";const v=this[t(388)][t(584)](t(562));v.left=u[t(567)],v[t(567)]=_[t(567)],v[t(560)]=_[t(560)],v[t(383)]=u[t(560)];const y=this[t(553)][t(584)](t(562));y[t(568)][t(450)]=c+"px",y.style.top=a+"px";const x=this[t(388)][t(584)]("bottomleft");x[t(450)]=_.left,x.right=u[t(450)],x[t(560)]=u[t(383)],x[t(383)]=_[t(383)];const w=this[t(553)][t(584)]("bottomleft");w.style.left=r+"px",w.style[t(560)]=l+"px";const b=this[t(388)][t(584)](t(589));b[t(450)]=u[t(567)],b[t(567)]=_[t(567)],b[t(560)]=u[t(383)],b[t(383)]=_.bottom;const O=this[t(553)][t(584)](t(589));O[t(568)][t(450)]=c+"px",O[t(568)].top=l+"px";const M=this[t(388)].get(t(560));M[t(450)]=u.left,M[t(567)]=u[t(567)],M.top=_[t(560)],M[t(383)]=u.top;const S=this._directionalMoveElements.get(t(560));S[t(568)][t(450)]=p+"px",S[t(568)][t(560)]=a+"px";const C=this[t(388)][t(584)](t(383));C[t(450)]=u[t(450)],C[t(567)]=u.right,C[t(560)]=u.bottom,C.bottom=_[t(383)];const R=this[t(553)].get(t(383));R.style[t(450)]=p+"px",R[t(568)][t(560)]=l+"px";const L=this[t(388)][t(584)](t(450));L[t(450)]=_[t(450)],L.right=u[t(450)],L[t(560)]=u[t(560)],L[t(383)]=u[t(383)];const V=this[t(553)][t(584)](t(450));V[t(568)].left=r+"px",V[t(568)][t(560)]=d+"px";const A=this._directionalMoveZones[t(584)](t(567));A.left=u.right,A[t(567)]=_[t(567)],A[t(560)]=u.top,A.bottom=u[t(383)];const k=this._directionalMoveElements[t(584)]("right");k[t(568)][t(450)]=c+"px",k[t(568)][t(560)]=d+"px"}[e(390)](t){const s=e;if(!this._getRange())return this[s(425)]?s(372):s(444);for(const[i,e]of this[s(388)])if((0,n.RB)(e,t.offsetX,t[s(494)]))return i;const i=this[s(388)][s(584)]("topleft"),h=this[s(388)][s(584)](s(589)),o={left:i[s(450)],top:i[s(560)],right:h[s(567)],bottom:h.bottom};return(0,n.RB)(o,t[s(640)],t[s(494)])?s(444):this[s(425)]?"new":s(444)}}},8488:(t,s,i)=>{const e=a22_0x489634;i.r(s),i.d(s,{default:()=>_});var h=i(1815),n=i(5120),o=i(1003),r=i(3315),a=i(504),c=i(7233),l=i(9904),p=i(8752),d=i(9865),g=i(7896);class u extends n.JT{constructor(t){const s=a22_0x25c9;super(),this._sc=t,this.id=s(472),this[s(413)]="new",this._outlineModel=new m((()=>this[s(521)])),this._blendModeOption=new l.Jp,this[s(437)]=new l.tv(s(533),[s(526),"sans-serif",s(586),s(440),s(404)],s(387)),this._fontSizeOption=new l.qv(s(506),16,1,1e3),this[s(460)]=new l.FV("Bold",!0,!1),this._isItalicOption=new l.FV(s(483),!0,!1),this._leftAlignOption=new l.FV(s(508),!0,!0,!1),this._centerAlignOption=new l.FV(s(570),!0,!1,!1),this[s(446)]=new l.FV(s(482),!0,!1,!1),this[s(555)]=new l.FV(s(518),!0,!1,!1),this[s(534)]=new l.FV(s(644),!0,!0,!1),this[s(451)]=new l.FV(s(395),!0,!1,!1),this[s(569)]=new l.FV(s(429),!0,!1,!1),this[s(557)]=[this._leftAlignOption,this._centerAlignOption,this[s(446)],this._justifyAlignOption],this[s(581)]=[this[s(534)],this._middleVerticalAlignOption,this[s(569)]],this[s(456)]=[this[s(475)],this[s(437)],this[s(461)],this[s(460)],this[s(529)],...this[s(557)],...this[s(581)]],this[s(582)]=new f,this[s(549)]=new v,this.info=[this[s(549)],this[s(582)]],this[s(410)]=this[s(554)](new h.v),this.onRequestRender=this._onRequestRender.event,this[s(559)]=this[s(554)](new h.v),this[s(453)]=this._onStateChange[s(423)],this[s(554)](this[s(543)][s(495)][s(391)]((()=>this._updateColors()))),this.register(this._blendModeOption[s(391)]((t=>this._textLayer?.[s(385)](t,s(629),s(600))))),this[s(554)](this[s(437)][s(391)]((t=>this[s(521)]?.[s(385)](t,s(502),s(433),!0)))),this[s(554)](this._fontSizeOption[s(391)]((t=>this[s(521)]?.[s(385)](t,s(400),s(478),!0)))),this.register(this._isBoldOption[s(391)]((t=>this[s(521)]?.[s(385)](t,s(373),s(t?628:530)+s(479))))),this.register(this[s(529)][s(391)]((t=>this[s(521)]?.[s(385)](t,"isItalic",(t?"Enable":s(530))+" Italic"))));for(const t of this[s(557)])this[s(554)](t[s(391)]((()=>this._updateAlignment(t))));for(const t of this[s(581)])this[s(554)](t[s(391)]((()=>this[s(624)](t))));this[s(554)](this._sc[s(405)][s(493)]((()=>this._finish()))),this[s(554)](this[s(543)].taskService[s(523)]((()=>this[s(501)]()))),this[s(554)]((0,n.OF)((()=>this[s(501)]()))),this[s(554)]((0,n.OF)((()=>this[s(575)]?.dispose()))),this[s(554)](this[s(543)][s(405)][s(394)]((t=>this[s(565)](t)))),this[s(543)][s(405)].currentLayer?.[s(515)]&&this[s(565)](this[s(543)][s(405)][s(505)].temporaryLayer)}[e(565)](t){const s=e;"text"===t[s(576)]&&(this._textLayer=t,this[s(554)](this[s(521)][s(614)]((()=>this[s(509)]()))),this[s(554)](this[s(521)].onHistoryAction((()=>{const t=s;this[t(439)](),this[t(382)]()}))),this.register(this[s(521)][s(574)]((()=>this._clearLayer()))),this._rectangleOtherPoint=[this[s(521)][s(465)][s(579)][s(567)],this[s(521)][s(465)][s(579)][s(383)]],this._moveImageRangeRenderer?.setVisible(!0),this[s(410)].fire())}[e(382)](){const t=e,s=this[t(521)]?(0,o.FJ)(this[t(521)][t(465)][t(579)]):void 0;this[t(582)][t(579)]=s,this[t(549)].range=s}[e(612)](t,s){const i=e;if(this[i(521)]&&!s&&["ArrowUp",i(621),i(463),i(393)][i(572)](t.key)){const s=(0,o.BN)(this._textLayer[i(465)][i(579)]),e=(g.V5?t[i(448)]:t[i(392)])?10:1;switch(t[i(399)]){case"ArrowUp":(0,o.Hd)(s,s[i(450)],s[i(560)]-e);break;case"ArrowDown":(0,o.Hd)(s,s[i(450)],s[i(560)]+e);break;case"ArrowLeft":(0,o.Hd)(s,s[i(450)]-e,s[i(560)]);break;case"ArrowRight":(0,o.Hd)(s,s[i(450)]+e,s[i(560)])}this[i(521)][i(465)].range=s,this._textLayer[i(409)](i(635))}}async[e(464)](t){const s=e,i=this[s(543)][s(405)][s(505)];if(!i)return;const h=!(1&t[s(455)]);this._pointerDownX=t[s(640)],this._pointerDownY=t[s(494)];const n=this[s(543)][s(522)].getSnapSettingCoordsFromEvent(t,!1);if(this[s(397)]=n,this._cursorCurrent=n,this.state!==s(372))return this._cursorOriginalRectangle=(0,o.BN)(this[s(521)]?.[s(465)].range),void(this._cursorOriginalRectangle&&((this[s(413)]===s(560)||this[s(413)]===s(536)||this.state===s(562))&&(this[s(397)][1]=this[s(426)][s(560)]),("bottom"===this[s(413)]||this[s(413)]===s(631)||"bottomright"===this[s(413)])&&(this[s(397)][1]=this._cursorOriginalRectangle.bottom-1),(this[s(413)]===s(450)||this.state===s(536)||this[s(413)]===s(631))&&(this[s(397)][0]=this._cursorOriginalRectangle[s(450)]),("right"===this.state||this[s(413)]===s(562)||this.state===s(589))&&(this._cursorOrigin[0]=this._cursorOriginalRectangle[s(567)]-1)));await this[s(501)](),this._rectangleOtherPoint=n;const r=this[s(541)](this[s(397)],this[s(462)]);this[s(426)]=(0,o.BN)(r),this[s(521)]=new c.o(i,{invertColors:h},{primaryColor:this[s(543)][s(495)][s(468)][s(428)],secondaryColor:this._sc[s(495)][s(449)][s(428)],blendMode:this[s(475)].value,range:r,text:"Lorem ipsum",isBold:this._isBoldOption[s(528)],isItalic:this[s(529)][s(528)],fontSize:this[s(461)][s(528)],fontFamily:this[s(437)][s(528)],alignment:this[s(592)](),verticalAlignment:this._getVerticalAlignmentValue()},this[s(543)][s(497)],this[s(543)][s(602)],this[s(543)][s(531)]),this[s(382)](),await i[s(620)](this[s(521)]),this[s(638)]?.[s(408)](!1),this[s(521)][s(369)]()}[e(532)](t){const s=e;if(void 0===this[s(520)]||void 0===this._pointerDownY||!this._cursorOrigin||!this._rectangleOtherPoint||!this._cursorOriginalRectangle)return;const i=this[s(543)].viewportService.getSnapSettingCoordsFromEvent(t,!1);if(this[s(462)]&&i[0]===this[s(462)][0]&&i[1]===this[s(462)][1])return;if(this._cursorCurrent=i,!this._textLayer)return;const h=this[s(462)][0]-this[s(397)][0],n=this[s(462)][1]-this[s(397)][1];switch(this[s(413)]){case s(372):return this[s(563)]=i,void this[s(454)](t,!0);case s(444):{const t=(0,o.BN)(this[s(426)]);t[s(450)]+=h,t[s(560)]+=n,t[s(567)]+=h,t.bottom+=n,(0,o.FJ)(t),this._textLayer[s(465)].range=t;break}default:{let i;if(!t[s(419)]||this[s(413)]!==s(536)&&"topright"!==this[s(413)]&&this[s(413)]!==s(631)&&"bottomright"!==this[s(413)])i=(0,o.BN)(this[s(426)]),(this[s(413)]===s(560)||"topleft"===this[s(413)]||this[s(413)]===s(562))&&(i[s(560)]+=n,i[s(383)]<=i[s(560)]&&i[s(560)]++,t[s(415)]&&(i[s(383)]-=n)),("bottom"===this[s(413)]||this[s(413)]===s(631)||"bottomright"===this[s(413)])&&(i[s(383)]+=n,i.bottom<=i[s(560)]&&i[s(383)]--,t[s(415)]&&(i[s(560)]-=n)),(this[s(413)]===s(450)||"topleft"===this.state||"bottomleft"===this[s(413)])&&(i[s(450)]+=h,i[s(567)]<=i.left&&i[s(450)]++,t.altKey&&(i[s(567)]-=h)),(this[s(413)]===s(567)||this.state===s(562)||this[s(413)]===s(589))&&(i[s(567)]+=h,i[s(567)]<=i[s(450)]&&i[s(567)]--,t[s(415)]&&(i[s(450)]-=h));else{const e=(0,o.n3)(this[s(426)]);let r;switch(i=(0,o.BN)(this[s(426)]),this.state){case s(536):r=(1/e*-h-n)/2,i[s(450)]-=Math[s(379)](r*e),i[s(560)]-=Math[s(379)](r),t[s(415)]&&(i.right+=Math[s(379)](r*e),i.bottom+=Math[s(379)](r));break;case s(562):r=(h*(1/e)-n)/2,i.right+=Math.round(r*e),i.top-=Math.round(r),t.altKey&&(i[s(450)]-=Math[s(379)](r*e),i[s(383)]+=Math[s(379)](r));break;case"bottomleft":r=(1/e*-h+n)/2,i.left-=Math[s(379)](r*e),i[s(383)]+=Math.round(r),t[s(415)]&&(i[s(567)]+=Math.round(r*e),i[s(560)]-=Math[s(379)](r));break;case s(589):r=(h*(1/e)+n)/2,i[s(567)]+=Math[s(379)](r*e),i[s(383)]+=Math[s(379)](r),t[s(415)]&&(i[s(450)]-=Math.round(r*e),i[s(560)]-=Math.round(r))}}this[s(521)][s(465)][s(579)]=(0,o.FJ)(i);break}}this._refreshInfo(),this[s(521)][s(369)]()}pointerMove(t,s){const i=e;this[i(638)]&&!s&&this[i(500)](this[i(638)][i(390)](t))}[e(617)](t){const s=e;!this[s(575)]&&this[s(521)]&&"move"===this[s(413)]&&(this._textInputDialog=new y(this[s(521)],this[s(437)],this[s(461)],this._isBoldOption,this[s(529)]),this._textInputDialog[s(496)]((()=>this[s(575)]=void 0)))}async pointerUp(t,s){const i=e;if(this[i(413)]===i(372)&&(s||this._cursorCurrent?.[0]===this[i(397)]?.[0]&&this[i(462)]?.[1]===this[i(397)]?.[1]))return this[i(521)]&&this._sc[i(405)][i(505)]?.[i(406)](this._textLayer),this[i(521)]?.[i(598)](),void this[i(509)]();if(this[i(521)]){let t;switch(this[i(413)]){case i(372):t=i(585);break;case i(444):if(s)return;t=i(436);break;case i(536):case i(562):case i(631):case i(589):case i(560):case"left":case"right":case i(383):t=i(537)}this[i(521)][i(409)](t)}this[i(638)]?.[i(408)](!0),this.pointerMove(t,!1)}[e(441)](){const t=e;if(!this[t(521)])return;const s=this[t(543)][t(495)][t(468)],i=this._sc.paletteService.secondary;(0,p.WC)(this._textLayer[t(465)][t(548)],s[t(428)])&&(0,p.WC)(this[t(521)].currentState[t(418)],i.rgba)||(this[t(521)].currentState[t(548)]=s[t(428)],this._textLayer[t(465)].secondaryColor=i[t(428)],this[t(521)][t(409)](t(519),!0),this[t(521)][t(369)]())}async[e(539)](t){const s=e;for(const i of this[s(557)])i!==t&&i[s(371)](!1);this._textLayer?.[s(385)](this[s(592)](),s(513),s(427))}async[e(624)](t){const s=e;for(const i of this[s(581)])i!==t&&i[s(371)](!1);this[s(521)]?.[s(385)](this[s(498)](),s(596),"Set Text Vertical Alignment")}[e(592)](){const t=e;return this[t(514)].value?t(450):this[t(374)][t(528)]?"center":this._rightAlignOption.value?t(567):"justify"}[e(498)](){const t=e;return this._topVerticalAlignOption[t(528)]?t(560):this[t(451)][t(528)]?t(527):t(383)}[e(439)](){const t=e;this[t(521)]&&(this[t(475)][t(371)](this[t(521)][t(465)][t(629)]),this[t(437)][t(371)](this[t(521)][t(465)][t(502)]),this[t(461)].setValueFromHistoryChange(this[t(521)][t(465)][t(400)]),this[t(460)][t(371)](this[t(521)][t(465)][t(373)]),this[t(529)][t(371)](this[t(521)][t(465)].isItalic),this[t(514)][t(371)](this._textLayer.currentState[t(513)]===t(450)),this[t(374)][t(371)]("center"===this[t(521)][t(465)][t(513)]),this._rightAlignOption.setValueFromHistoryChange(this[t(521)][t(465)][t(513)]===t(567)),this._justifyAlignOption[t(371)](this._textLayer.currentState[t(513)]===t(398)),this[t(534)][t(371)](this[t(521)][t(465)][t(596)]===t(560)),this[t(451)][t(371)](this[t(521)].currentState[t(596)]===t(527)),this[t(569)][t(371)](this[t(521)][t(465)][t(596)]===t(383)),(!(0,p.WC)(this._sc[t(495)].primary.rgba,this._textLayer[t(465)].primaryColor)||!(0,p.WC)(this[t(543)][t(495)].secondary.rgba,this[t(521)][t(465)].secondaryColor))&&this[t(543)][t(495)][t(381)](this[t(521)][t(465)].primaryColor,this[t(521)][t(465)][t(418)]))}[e(500)](t){const s=e;this[s(413)]!==t&&(this[s(413)]=t,this[s(559)][s(412)]())}_updateRect(t,s){const i=e;if(!s||!this._cursorOrigin||!this[i(462)])return;let h=this._cursorOrigin[0]-this._cursorCurrent[0],n=this._cursorOrigin[1]-this[i(462)][1];t[i(419)]&&(Math[i(421)](h)>Math[i(421)](n)?h=n*(Math[i(593)](h)!==Math[i(593)](n)?-1:1):n=h*(Math[i(593)](h)!==Math[i(593)](n)?-1:1));const o=t[i(415)]?[this[i(397)][0]+h,this[i(397)][1]+n]:this[i(397)],r=this[i(541)](o,[this[i(397)][0]-h,this[i(397)][1]-n]);this._textLayer&&(this[i(521)][i(465)][i(579)]=r),this[i(410)][i(412)]()}[e(541)](t,s){return(0,o.tH)(t[0],t[1],s[0],s[1])}async[e(501)](){const t=e;await(this[t(521)]?.[t(524)]()),this[t(509)]()}_clearLayer(){const t=e;this[t(521)]=void 0,this[t(638)]?.setVisible(!1),this[t(382)](),this[t(410)][t(412)]()}[e(566)](t){const s=e;return this[s(638)]=new(a[s(613)])(t,(()=>this[s(521)]?.[s(465)][s(579)]),!0,this[s(543)].viewportService,this[s(543)][s(405)]),this[s(638)].setVisible("new"!==this.state),[this[s(638)],new r.d(t,this[s(543)][s(405)],this[s(543)][s(522)],this[s(609)])]}[e(430)](){const t=e;return{state:this.state,hasTextLayer:!!this[t(521)]}}deserialize(t){const s=e;t[s(422)]?this[s(638)]?.[s(408)](!0):this[s(509)](),this[s(500)](t.state),this[s(439)](),this[s(382)]()}}const _=u;class m{constructor(t){this[e(618)]=t}get[e(579)](){const t=e;return this[t(618)]()?.[t(465)][t(579)]}}class f extends d.q{constructor(){const t=e;super(...arguments),this[t(576)]=t(578)}get[e(579)](){return this[e(545)]}set[e(579)](t){const s=e;this[s(545)]=t,this[s(591)][s(412)]()}get visible(){return!!this._range}[e(611)](){const t=e;if(!this[t(545)])return"";const s=(0,o.Oq)(this[t(545)]),i=(0,o.rY)(this._range);return s+t(590)+i}[e(525)](){const t=e;if(!this._range)return"";const s=(0,o.Oq)(this[t(545)]),i=(0,o.rY)(this[t(545)]);return"Text size is "+s+t(445)+i+" pixels tall"}}class v extends d.q{constructor(){const t=e;super(...arguments),this[t(576)]="topleft"}get[e(579)](){return this[e(545)]}set[e(579)](t){const s=e;this[s(545)]=t,this[s(591)][s(412)]()}get visible(){return!!this._range}getInfo(){const t=e;return this[t(545)]?this[t(545)].left+", "+this[t(545)][t(560)]:""}[e(525)](){const t=e;return this[t(545)]?t(550)+this[t(545)][t(450)]+" y="+this[t(545)][t(560)]:""}}class y extends n.JT{constructor(t,s,i,o,r){const a=e;super(),this._layer=t,this[a(437)]=s,this[a(461)]=i,this[a(460)]=o,this[a(529)]=r,this._onWillDispose=this[a(554)](new h.v),this.onWillDispose=this._onWillDispose[a(423)],this[a(554)](this[a(437)].onUpdate((()=>this[a(535)]()))),this[a(554)](this._fontSizeOption[a(391)]((()=>this[a(535)]()))),this[a(554)](this[a(460)][a(391)]((()=>this._updateStyles()))),this[a(554)](this._isItalicOption.onUpdate((()=>this[a(535)]())));const c=document.createElement(a(571));c[a(402)][a(510)]("dialog-click-guard"),c[a(396)]("click",(t=>t.stopPropagation()));const l=document.createElement(a(571));l[a(402)][a(510)](a(503)),this[a(608)]=document[a(583)](a(457));const p=this[a(627)][a(465)][a(472)];this[a(608)][a(528)]=p,this[a(608)][a(402)][a(510)](a(384)),this[a(608)][a(396)]("keydown",(t=>t.stopImmediatePropagation())),this[a(608)][a(396)](a(487),(t=>this[a(599)](this._textarea[a(528)]))),l[a(417)](this._textarea);const d=document[a(583)](a(571));d.classList[a(510)](a(587));const u=document[a(583)]("button");u.textContent="OK",u[a(396)](a(516),(()=>this.dispose()));const _=document[a(583)]("button");_[a(434)]=a(511),_.addEventListener("click",(()=>{const t=a;this[t(599)](p),m[t(594)](),this.dispose()})),g.V5?d.append(_,u):d[a(417)](u,_);const m=document.createElement(a(571));m[a(402)].add(a(486)),m[a(417)](l,d),document.querySelector(a(380))[a(417)](c,m),this[a(608)][a(610)](),this[a(554)]((0,n.OF)((()=>{const t=a;c[t(594)](),m[t(594)]()})))}[e(598)](){const t=e;this._onWillDispose[t(412)](),super.dispose()}_updateStyles(){const t=e;this._textarea[t(568)][t(502)]=this._fontFamilyOption.value,this._textarea[t(568)][t(400)]=this._fontSizeOption[t(528)]+"px",this[t(608)][t(568)][t(625)]=this[t(460)][t(528)]?t(636):"",this[t(608)][t(568)][t(431)]=this[t(529)][t(528)]?t(435):""}_updateText(t){const s=e;this[s(627)]&&this[s(627)][s(465)][s(472)]!==t&&(this._layer[s(465)][s(472)]=t,this[s(627)][s(409)](s(630),!0),this._layer.triggerRequestRender())}}},1674:(t,s,i)=>{const e=a22_0x489634;i.d(s,{q:()=>h});const h=e(476)}}]);