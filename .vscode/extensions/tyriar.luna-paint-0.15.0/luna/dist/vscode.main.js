const a2_0x5cf8=["New","Image exceeded maximum pixel count allowed (","_toolDisposables"," y=","_elementResizeObserver","defaultPosition","_cachedMovingLayer","Add Image","newFromClipboard","_isAnimating","hardwareConcurrency","_cachedVectorLayer","_getWithCache","_onPointerDownMove","139256rYaFNt",".bmp","_clearUntilReleaseTool","layerIndexList","_rectangleElement","line","optionStep","_shiftValue","unregister","_attach","onEntriesChange","linear-gradient(90deg, hsl(","_activeLayersModel","boolean","setActiveImageById","_getSliderBackground",";\n}","snapToPixelGrid","_contextKeyService","True color & alpha channel","input","moveImageDown","imageFile","distance","_getRange","TRIANGLE_FAN",'Unexpected option type "',"destImage","Image","requestLayerTaskOptions","onConfigChanged","isBold","activeLayer","Top right","setTool","layer.mergeLayerDown","bottom","Hexadecimal representation of RGB","dragging","Move Image to Bottom","DEPTH_STENCIL","_viewportOrigin","palette","_isReadonly","registerHistoryEntryFactory","move","fallbackDimensions","_layerListItems","_luna","Saturation","_gl","Close ","Palette","bottomright","pointer-coords","_contentElement","Erase (Keep Selection)","from","setPixel","view-drop-target","Finish Line","redoImage","mouseout","Go to Image Above",".jif","body","Set Paste Image Selection","registerStateHandler",'Response received without request "',"pointB","bindRenderbuffer","_getActiveImage","Resize","Toggle pixel grid when zoomed in","Enter the new name","Must follow ","info","view.zoomIn","Could not find layer to set","startVector","left-items","_listItemElements","undoBlendMode","createReadonlyRgbaColor","zoomOut","footer","pointer-color","+click]","256 colors","_startTime","_onStateChange","createReadonlyHsvColor","_validate","_progress","_addOption","Customize Pointer Color Status Bar Item","_renderer","finishText","_pointerDownY","_contextMenuService","Redo","dblClick","_headerContentElement","_onHistoryUnset","_supportsLayers","_onChangedDimensions","_cloneState","identificationField","space","imageTextureRange","allowUnchecking","onDidChangeDimensions","index","getLayerById","_hexInputElement","exportBlob","Layer"," has already been registered","Edit","isArray","_onDispose","_sliderTabElement","ILunaService","_getIndexFromId","Go to Top Image","NEAREST","createProgram","_checkLayerSupport","prototype","Bottom right","disableWorkers","eraseKeepSelection","image/webp","onRequestTool","shape","fillContiguous","resolve","singleLayer","showError","attach","getData","onImagesChange","disconnect","onPointerUp","string","serviceBrand","_refreshActiveImage","_configEquals","backup",'Task "',"getOwnPropertyDescriptor","Selection top left position is x=","_imageTextureRange","_refreshTitle","ArrowLeft","Duplicate Image","getElementsByTagName","redoHandler","attachShader","_checkSupportsMultipleImages","texParameteri","goToTopLayer","pointerEvents","color-box","untilRelease","acquireTemporaryLayerId","pointerId","setNextLayerId","Enter the width of the image","layer.addNewLayer","MoveImage","encodePng","Duplicate Layer","moveSelection","No current layer","Layers","temporaryLayer","substring","min","event"," pixels tall","deleteRenderbuffer","Cannot find module '","onWheel","crop-to-selection","random","generatePreview","Rectangle","_showViewport","uniformMatrix4fv","bitness","generateLayerPreview","_needsAttributeUpdate","_imageDimensionsUniformLocation","dimensions","onImageChange","_currentCompositeEntry","_viewportService","texture","Clipboard contains non-image data. Unable to access it.","pointerUp","Tools","SharedArrayBuffer","fitLayerToWindow","createEmptyRgbaColor","_moveActiveImageToIndex","buttons","_updateViaSlider","_onSliderChange","padStart","TEXTURE_MIN_FILTER","getDetailedInfo","_windowVisibleContextKey","getLayer","_itemDisposables","view.focusCanvas","_onRedo","type","_statusBarService","_onStretchEnabledChange","ArrowUp","onDidChangeViews","_tempLayerId","parsedChunks","_onWheel","_goToRelativeLayer","triggerHistoryAction","enableVertexAttribArray","[createInstance] First service dependency of ","_redoData","redoRange","applyCommit","Use % for percentage, wxh for shorthand","Unexpected image file ID for single image file","_textureAUniformLocation","return this","_handlePointerUp","moving","setColors","_vertexArrayObject",".js","exclusion","bindBuffer","uniform4f","quality","vscode-menu","isVisible","vscode.toggleMenuBar","_zoomUniformLocation","KEEP","disable","RENDERBUFFER","display","_layersModel","tool.pencil","_updateBottomLayer","Enter","_commands",",1) 0%, rgba(","selectionStart","refreshTheme","isInteger","NOTEQUAL","Go to Layer Above","writeIco","number","initialState","_updateAttributeBuffersForLayer","_updatePreviewIfNeeded","preventDefault","platform","prepend"," (Error)","layer.deleteLayer","_toolRenderPrograms","fire","Resize Canvas","_positionArray","_onPointerUp","onDidEndDrag","_frameBufferTextures","position","-bit","updateWorkbenchState","color-overlay","_activeTemporaryLayers","layer-merge","_undoImage","luna:layerEntryFocused","_uniformValueZoom","COLOR_BUFFER_BIT","findIndex","Toggle small images between actual size and stretching to fit the minimap dimensions"," executed","KeybindingService","_viewsElement","translate(-50%, -50%)","_redoDimensions","bottomStatusBar","tiles","_rightElement","sort","_handleWheel","dragleave","COMPILE_STATUS","onBeforeRunLayerTask","_onAttach","image-list","CLAMP_TO_EDGE","Go to Bottom Layer","eraseSelection","ChunkLoadError","layer/resize","_updateProgress","Quality not selected","secondary","getService","Toggle Top Status Bar View","Flip Vertical","resource","view.actualSize","finishLine","target","loadedImages","wheel","_renderImages","hsv","_layerCountUniformLocation","isAutoSaveEnabled","convertToBlob","history-list","now","_onDidRemoveTopItem","visible","image.customizePointerColorStatusBarItem","separator","Cannot add readonly entry to composite entry","_onStartAnimating","call","_timeout","img","Delete the active image","layer/rotate90Clockwise","image/bmp","activeTool","includes","onDidChangeVisibility","read","_imageFileId","layer/flipHorizontal","moveLayer","Undoing temporary layer step without initial step state event","#version 300 es\nprecision mediump float;\n\nuniform float ","_pointCount","drop-target","keys","_fillCommands","set","byteLength","_getImageCoordsFromEvent","fontSize","offsetWidth","css.toColor: Unsupported css format","image/png","Crop","_data","_eventInViewport","uniform1iv","Alpha (aka opacity)","Could not serialize layers","Toggle Colors Window","view.togglePixelGrid","Draw Line","dragover","onStartAnimating","NYI","toggle","attribute vec4 a_position;uniform mat4 a;uniform vec2 b;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));}","fillGlobal","layer-move-down","stencilFunc","_services","focus"," !== ","dataTransfer","ArrowDown",") {\n    outColor = vec4(0.2, 0.2, 0.2, .2);\n  }\n}","moveLayerToBottom","_setState","_onImagesChange","Merge the active layer down","_instantiationService","pixelCount","Create a new layer","image.flattenLayers","requestAnimationFrame",'No state handler for id "',"Should not be present alongside ","rectangle","_deleteLayerByIndex","Zoom In","negateEnabled","_removeItem","drop","in-viewport","_finish","pow","querySelector","layer","canRunCommand","_colorLocation","New Layer","updateConfig","text","requestNewDimensions","123658uEQItU","mergeLayerDown","ARRAY_BUFFER","_imageListItems","_activeTool","exports","compileShader","history","onUpdateEmitter","_undoData","image.rotate90Clockwise","onUndo","layer/flipVertical","importScripts","duplicateLayer","selection","global","undoRange","duplicate","onShowViewportChange","createRgbaColor","clear","Image is readonly because an edit is in progress","Rotate 90° Counter Clockwise","onStretchEnabledChange","splice","no-text","_handleHistoryAction","_isPaused","metaKey","executeOnSingleLayer","_ignoreStateChangeEvents","a_texcoord","onRedo","The color of the pixel at the pointer (excluding active vectors or moving pixels)","50%","byteOffset","_getFrameBufferTexture","setProperty","_onLayerChange","framebufferRenderbuffer","_createLayer","onSoftDeletedChange","dropEffect","extHostRequestId","_queueProgress","#gui","smoothing","WebGL context loss, please reload the tab","erase","_blendShader","_getCanvasBounds","u_pixelsize","_onDidStartDrag",'Cannot find factory for history entry id "',"overlay","ctrl+m","undoData","_rehydrateExtHostMessage","Crop to Selection","_createButton","right","getRightItems","_viewportElement",".jpeg","vscode.setContext","header","undoHandler","ctrl+shift+i","nameSpan","--luna-statusBar-icon-brightness","pointerMove","UNSIGNED_BYTE","_sliderGradientElement","exportImage","_updateTextureIfNeeded","image.goToBottomImage","toHsl","_redoBlendMode","timeout","onRequestRender","Update Selection","_finishHistoryEntryCtor","edit.undo","Report Issue...","ctrl+g","_activeUntilReleaseToolKey","--luna-editor-backgroundColor","Could not find builtin tool ","webviewRequestId","_doExecuteOnLayer","staticState","render","_undoName","_onEntriesChange","bindTexture","verticalAlignment","_tolerance","sep","_handlePointerMove","imageSmoothingEnabled","allLayers","setPointerCapture","quickPick",'Unknown command id for type "',"vertexAttribPointer",'Cannot run command "',"_canvas","luna:focused","_range","onLayerChange","scrollHeight","_options","dragstart","True color","palette.togglePaletteWindow","_onDidChangeViews","remove","chunk-","_parentLayer","setOption","Restore Image (Hot Exit)","webglcontextlost","runLayerTask","_entryFocusedContextKey","pop","inputBoxNumberOrDimensionsShorthand","_colorToHex","createEmptyHsvColor","Smooth edges","_action","range","_pointCache","_frameBuffer","Nearest neighbor","QuickPickService","Must precede ","setBlendMode","toUpperCase","_updateAttributeBuffers","setActiveImage","_onPointerMove","TRIANGLES","onmessage","_activeItems","_onKeyUp","layer/expandCanvasToSelection","_isWindowAnchor","_width","angle","layer/rotate180","append","_blendMode","runTask","Toggle Menu Bar","map","_config"," > ","fontFamily","_activeLayersModelIndex","images","#version 300 es\nlayout (location = ","_taskService","none","resume","_refreshTheme","tool.line"," static arguments","Help","adjustVector","className","Cut Image","selectionEnd","DEPTH_BUFFER_BIT","undoImage","defineProperty","operationName",") in vec4 a_position;\n\nuniform mat4 ","@IServiceName-decorator can only be used to decorate a parameter","STATIC_DRAW","__decorate","createDomRenderProgram","Cannot call exportBlob for ico files","Copied ","goToLayerAbove","observe","newImage","tool.rectangle","moveImageUp","setName","fireAndWait","image.goToImageBelow","animation","_positionsArray","getAttribute","utf-8","_program","_onVisibilityChange","onTemporaryLayerUnregistered","_viewElement","Mac68K","_entryFactories","test","multiLayer","_pointerDownMoveListener","edit.copy","focusout","Move Selection","height","_onShowViewportChange","Cannot delete the last layer","Merge down","onHistoryAction","renderLayer","#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0, 0, 0, 1);\n}","webgl2","anchor","blendFuncSeparate","image.moveImageDown","Cannot redo readonly entry","tool.moveSelection","DeleteImage","tagName","getRanges","CommandService","layer.moveLayerToBottom"," depends on UNKNOWN service ","for","FRAMEBUFFER","FileService","MinimapService","executeOnAllLayers","mouseleft","dims","Move Image to Top","color-picker-rect","missing","createTexture","_onTemporaryLayerRegistered","redo","_animationFrame","Toggle Images Window","task.worker.worker.js","forEach","_textureBUniformLocation","2BDpfyh","hue","cmd-palette-header","get","exportBlobClone","extensionArea","_info","zoomIn","_renderTileSet","Cannot set the active layer to undefined","_changeHexInput","setActiveImageByIndex","colorMask","ctrl+r","Cannot merge the bottom layer down","_lunaService","image-dimensions","pointermove","_frameBufferUniformLocation","activeToolState","_state","_taskWorkerService","The primary color's hex value in the format rrggbb. When changing, rgb will be expanded to rrggbb.","_mimeType","block","removeChild","Focus Canvas","location","change","_value","_imageSet","_stepState","createCompositeEntry","layer/rotate90CounterClockwise","triggerHistoryUnset","ContextKeyService","cmdctrl+z","onHistoryUnset","STENCIL_BUFFER_BIT","stepState","viewport","goToImageBelow","_screenPixelToCanvasCoord","%) 100%)","luna:hasSelection","889410fmDdAk","_getNonSoftDeletedLayerCount","_isDisposed","alignment","createItem","_toolElements","The color of all merged layers","mousemove","topleft","updateTextureIfNeeded","onLayerChangeEmitter","Toggle Shape Tool","onUpdate","_generatePreview","onDidAddBottomItem","cmd-palette-list","TEXTURE0","Move Pixels","_queueUpdate","Merge Layer Down","$debounce$","_layoutDependentViews","Erase Selection","fitToWindow","blend","currentValue","_updateItem","setVisible","onPointerDown","_extHostRequestHandlers","addImage","_maxValue","687452NfULQH","previewCanvas","swapImagePositions","_onHistoryAction","Zoom","ctrl+0","image.cropToSelection","goToBottomImage","_setSoftDeleted","Cannot set the active image to undefined","title","drawShape","Cannot serialize history entry","statusbar","abs","decodePng","_imageListElement","ctrl+h","registerHistoryEntryHandler","temporaryLayers","minimap.toggleMinimapWindow","dataType","The images window is not supported for this file type","mouseWheelBehavior","imageTexture","toRgba","finishMovePixels","arrayBuffer","_layerOffsetUniformLocation","WorkbenchConfigService","layerReplace","isStretchEnabled","active","_apply","Selection","terminate","_lastPointerEvent","minimap-show-viewport","clientY","deltaY","clearEntries","_isRestoringState","background","Gets the color by averaging the values of surrounding pixels.","Use % for percentage","moveStep","TEXTURE_WRAP_T","_matrixUniformLocation","blendMode","How many bits per pixel should be used for the image?","Module",'" already exists',"complete","tool.toggleMoveTool","default","enter","TEXTURE_WRAP_S","pauseanimations","_requestToolIfNeeded"," pixels wide by ","_getValue","tool.crop","onSliderChange","_layerId","importBlob","Access to clipboard-read was denied","_syncHiddenText","createCompositeEntrySync","blendColorAtRange",'Deserialize tool service failed to set tool "',"_operationName","darken","handleOptionUpdate","_leftItemsElement","Select how the resize will be performed","_initialIndex","_onmessage"," (HSV)","Delete Layer","image.finishActiveAction","startsWith","Paste Image","script","FLOAT","preview","showDecodeProblemStatusBarEntry","hasOwnProperty","activeImageFileId",'" exceeded maximum pixel count allowed (',"defaultTool","onPointerCoordChange","toggleView","readyPromise","onTemporaryLayerRegistered","_channelIndex","bind","removeEventListener","filterCommands","Options for task ","canSerialize","_onDidAddBottomItem","$debounce$result$","invertColors","isPixelGridEnabled","_rebuildImageCache","_updateMatrixUniform","setTimeout","_pointerDownStartTime","_canvasSelection","minimap.toggleShowViewport","MODULE_NOT_FOUND","onPointerDownMove","_createBlendModeSelect","partiallyDecodedImage","onKeyUp","layer.moveLayerUp","toHsv","Delete image","slider-gradient","percent","colorPicker","_imageFileService","finishShape","miniCssF","fill","serialize function does not exist on history entry","targetIndex",";\n\nvoid main() {\n  gl_Position = ","Draw Rectangle","appendChild","openIco","tool.text","u_color","scroll","tempLayerId","_zoom"," - ","clipboard-read","moveImageTo","_imageTexture","Bilinear","tool.zoom","_getBeforeRunLayerTaskEvent","hasImage","5CPeMRb","_progressTimeout","deleteLayer","_imageLayerIdCounter","getAllCommands","_getImageOrActiveIndex","There is no layer below this layer","crop","_setHorizontalLine","_checkCanEdit","containsCoord","deselect","_isSoftDeleted","_matrixLocation","Loading chunk ","pencil","TRIANGLE_STRIP","Composite entry error","_onToolChange"," * a_position;\n}","Top Status Bar","message","getImageData","_createMinimapImageBounds","edit.paste","onVisibilityChange","Minimap","Flatten Layers","Buffer","_setValue","_colorUniformLocation","key","firstChild"," 0%, rgba(","select","dragend","_onConfigChanged","toolsView","onStateSync","Cannot serialize history","_activeAnimatingRenderPrograms","imageFileId","_onTemporaryLayerUnregistered","types","layer-list","_forwardLayerEvents","interactive","layer-new","isReadonly","tool-container","goToBottomLayer","function","createFramebuffer","linear-gradient(90deg, rgba(","error","putImage","_attachedDisposables","reduce","Uint16Array","Move Image Up","tool.fill","values","commit","warn","_forceSelectionAnimation","WinCE","Move the active layer up","padEnd","_isPointerDown","_secondaryColorDiv","requestInputNumber","movePixels","indexList","_isScrollLocked","parentNode","getAttribLocation","register","value","Layer ","useProgram","Zoom Out","cmdctrl+shift+p","_temporaryLayerIdCounter","activeImageSetIndex","workbench.action.quickOpen","offsetTop","Could not find layer ","_container","showView","onProgress","_onStopAnimating","_hiddenText","cutImage","_restoreEntry","Open Image","newLayer","_height","ColorService","flattenLayers","enable","Adjustments","draw","deserialize","_inputService","Resampling not selected","_selectionService","drawCircle","repeat","new","activeElement","code","#bottom","_messageHandler","undoDimensions","pointerup","Automatic publicPath is not supported in this browser","drawText","top","pointerDown","ctrl+alt+pageup",", top: ","Left","_minimapService","ONE_MINUS_SRC_ALPHA","Report an issue or give feedback","1-bit","_updateUniformValueZoom","Top left","offset","Rotate 180","color","redoName","goToTopImage","createElement","_selection","negateChecked","bindVertexArray","deleteProgram","47107GVFVTa","Win16",",1)","commandId","_toolService","layer/resizeCanvas","decodeTga","_imageCanvasRenderProgram","actions","image.resize","mousedown","_alpha","Go to Bottom Image","grabbed","createExtendedEdit","_savedViewport","putRange","protocol","middle","showViewport","hideView","edit","_updateRenderLayerTiles","COLOR_ATTACHMENT0","left","Toggle more color details","_uniformValueBlendModes","Bottom","StatusBarService","currentEntry","currentState","mouseright","Enter save quality between 0 and 100","item","_activeUntilReleaseTool","dispatchEvent","warnings","tool.selection","_clickOrigin","color-picker-container","_onZoomChange","moveLayerTo","side","framebufferTexture2D","_undoDimensions","create","_elementService","_moveLayerDownButton","edit.cut","_workMatrices","Could not restore workbench state (version ","updateAnimation","slider","ctrl+s","_commandService","onChange","_normalizeWheelDelta","tabIndex","onImageDeleted","tool",".png","parentElement","_colorDetailsDisposables","saveAs",".ico","getBoundingClientRect","Fit Layer to Window","Finish Shape","_sliderContainer","layer-move-up","query","onCommit",'Duplicate webview request handler "',"span","image-entry","primaryColor","Undo","_renderLayers","contains","_entries","onLastListenerRemove","devicePixelRatio","_onProgress","getTempLayer","task"," conflicts with ","_onUndo","extName","has","decorate","minimap","--luna-icon-list-active-brightness","clientX","activeTexture","_nullTexture","file","_getUnusedLayerLabelId","Uint8Array","selected","_option","Paste","_reportInterval","text/plain","Show","_mergeLayerDownButton","_createToggle","_calculateScrollVelocity","_progressLast","#version 300 es\nprecision mediump float;\n\nuniform vec4 ","stencilOp","luna.executeCommand","linearBurn","_isPixelGridEnabled","_pixelSizeLocation","Bottom Status Bar","Flip Horizontal","requiresTool","selection.selectAll","image.flipVertical","_focusNonActiveImage","replace","196984xLBWCx","swap","_input","Move the active layer down","Add New Layer","BLEND","Failed to import image from clipboard","toggleAttribute","round","redoDimensions","data-webpack","blur","draggable","validate","Selection size is ","image","_viewService",".tga","_onDblClick","setTopLeft","report-issue","delete","pending","inputBoxNumber","createBuffer","di$dependencies","currentLayer","Select All","reportIssue","some","_positionsNeedsUpdate","enabled","image/jpeg","static","createHslColor","_contributions","onDidRemoveTopItem","requestRender","moveToRange","TEXTURE_2D","restoreState","scaledHeight","end","openImage","keyDown","nextSibling",") 100%)","MacIntel","ctrl+d","Finish Selection","Toggle Show Viewport","_openImages","normal","rename","_createWindowView","pageX","toBlob","Delete layer","_outOfFrameScroll","getCoordsFromEvent","hex","image-move-up","_pointerCoord","_selectionAnimationFrame","Failed to serialize history","rawChunks"," at position ","_isEditInProgress","all","Toggle Minimap Window","active-colors","config","getFineCoordsFromEvent","setMimeType","Draw Shape","117864UKjxJO"," failed.\n(","_loadModule","createTextNode","isReady","clientWidth","deleteShader","rightItems","assign","Layer Name: ","setNextTemporaryLayerId","_showColorDetails","image/x-ico","onFirstListenerAdd","_onPixelGridEnabledChange","serialize","views","Deselect","_forwardEventToTool","Move Layer to Top","adjustments.invert","size","colorData","deleteImage","Window","_disposables","Move Layer Up","colors","ranges","bmp","_viewportPosition","precision mediump float;varying vec2 v_texcoord;uniform int h;uniform int k;uniform vec2 d;uniform vec2 f;uniform vec2 g;uniform int m;uniform vec2 l;uniform int c[7];uniform sampler2D j[7];uniform sampler2D n;uniform vec2 o;vec3 A(vec4 B,vec4 C,vec3 D){float E=B.a*C.a;return(B.a-E)*B.rgb+(C.a-E)*C.rgb+E*D;}vec4 F(vec4 B,vec4 C,int G){if(C.a==0.){return B;}if(B.a==0.){return C;}if(G==28){return C;}vec3 H;if(G==1){H=C.rgb;}else if(G==3){H=vec3(min(B.r,C.r),min(B.g,C.g),min(B.b,C.b));}else if(G==4){H=B.rgb*C.rgb;}else if(G==6){H=max(B.rgb+C.rgb-1.,0.);}else if(G==8){H=vec3(max(B.r,C.r),max(B.g,C.g),max(B.b,C.b));}else if(G==9){H=vec3(1.-(1.-B.r)*(1.-C.r),1.-(1.-B.g)*(1.-C.g),1.-(1.-B.b)*(1.-C.b));}else if(G==11){H=min(B.rgb+C.rgb,vec3(1.));}else if(G==13){H=vec3(B.r<.5?(2.*B.r*C.r):(1.-2.*(1.-B.r)*(1.-C.r)),B.g<.5?(2.*B.g*C.g):(1.-2.*(1.-B.g)*(1.-C.g)),B.b<.5?(2.*B.b*C.b):(1.-2.*(1.-B.b)*(1.-C.b)));}else if(G==14){H=vec3(C.r<.5?(2.*B.r*C.r+B.r*B.r*(1.-2.*C.r)):(sqrt(B.r)*(2.*C.r-1.)+2.*B.r*(1.-C.r)),C.g<.5?(2.*B.g*C.g+B.g*B.g*(1.-2.*C.g)):(sqrt(B.g)*(2.*C.g-1.)+2.*B.g*(1.-C.g)),C.b<.5?(2.*B.b*C.b+B.b*B.b*(1.-2.*C.b)):(sqrt(B.b)*(2.*C.b-1.)+2.*B.b*(1.-C.b)));}else if(G==20){H=abs(B.rgb-C.rgb);}else if(G==21){H=B.rgb+C.rgb-2.*B.rgb*C.rgb;}float I=C.a+B.a*(1.-C.a);return vec4(A(B,C,H)/I,I);}void main(){vec4 B;if(g==f&&d==vec2(0.)){B=texture2D(j[0],v_texcoord);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);if(o.x==1.){K.x=1.-K.x;}if(o.y==1.){K.y=1.-K.y;}B=texture2D(j[0],K);}else{if(k==1){discard;}else{B=vec4(0.,0.,0.,0.);}}}if(m==1){vec4 L=texture2D(n,gl_FragCoord.xy/l);B=F(L,B,c[0]);}for(int M=1;M<7;M++){if(M>=h){break;}if(g==f){vec4 C=texture2D(j[M],v_texcoord);B=F(B,C,c[M]);}else{if(v_texcoord.x>=(d.x)/g.x&&v_texcoord.y>=(d.y)/g.y&&v_texcoord.x<((d.x)+f.x)/g.x&&v_texcoord.y<((d.y)+f.y)/g.y){vec2 J=v_texcoord-vec2(d.x/g.x,d.y/g.y);vec2 K=J*vec2(g.x/f.x,g.y/f.y);vec4 C=texture2D(j[M],K);B=F(B,C,c[M]);}}}gl_FragColor=B;}","layerId","_refreshToolState","color.toggleColorsWindow","bindFramebuffer",'Could not find non-existent window view "',"_flippedAxisUniformLocation","cmd+shift+z","classList","ctrl+j","texImage2D","_blendModeUniformLocation","button","File","push","hand","_blendModeOptions","tools","disabled","previousSibling","_paletteService","editIndex","_layerBlendModesUniformLocation","_name","_items","file.new","softLight","_viewportUpdate","exportImageClone","Unrecognized array type","buffer","isPointerDown","Rename Layer","Tool","nonce","ArrowRight","image.moveImageToTop","--vscode-foreground","startLayer","setData","onerror","Space","isItalic","metadata","_onStateSync","toLowerCase","_onKeyDown","viewService","style","onload","_onShowColorDetailsChange","INPUT","drawLine","_onDidAddTopItem","_serializeCompositeEntry","_setActiveItem","parentLayerId","restoreHistory","runAction","Gets the color of the nearest pixel.","view","ctrl+shift+f","Macintosh","releasePointerCapture","Finish Active Action","setPosition","Unrecognized blend mode","toggle-minimap","getLeftItems","No redo entry","_contextKeys"," * a_position;\n  v_position = a_position.xy;\n}","width","_isStencilUniformLocation","_updateWindowViewPosition","_imageService","window.toggleTopStatusBarView","activeToolId","not supported","No undo entry","syncGlobalState","image-new","clearColor","_fillRange","lighten","u_matrix","vscode.main","_glSelection","tool.hand","simple","Toggle Color Details","Toggle History Window","shaderSource","RGBA","mimeType","LINE_LOOP",", right: ","_lastCoord","_onRequestRender","selection-topleft","status-bar-item-","image.flipHorizontal","Rotate 90° Clockwise","luna:","_zoomLocation","Hand Until Release","uniform1f","_renderProgramsWithOrder","_ctx","createHsvColor","hotExitMaxPixels","removeAttribute","moveImageToBottom","primary","--vscode-breadcrumb-foreground","Eraser","_cached","setLayerName","_finishHistoryEntryOperationName","match","_listeners","value must not be falsy","channel","slice","luna:textFocused","getShaderInfoLog","4-bit","runCommand","toStringTag",") / 4., 2.));\n  outColor = vec4(c, c, c, 1);\n}","_event","transform","Green","_refreshColorDetails","Blue","getContext",", 1.) < 1. / ","_stateService","showToast","moveLayerDown","getParameter","pageY","scrollTop","window.toggleBottomStatusBarView","_onRequestTool","string-combo","layerRange","_onDidChangeVisibilityEmitter","isSoftDeleted","rgba(","zoom","_onPointerCoordChange","Cannot resize image in single layer task","offsetY","find","ALWAYS","checkbox","_loadedImages",'History entry "',"createRgbColor","encodeOptions","div","ctrl+y","_createWorker","_positionBuffer","drawArrays","Unknown History Entry","_configService"," window","Command","_frameBufferRenderBuffer","selection.erase","Create a new image","_primaryColorDiv","setActiveLayer","_model","composite","finishRectangle","pointerout","Middle","_vscodeApi",".jpg","_tileScaledDimensionsUniformLocation","clientHeight","Background","selectAll","_entryHandlers","_historyService","keydown","backupClipboardData","leftItems","ctrl+shift+s","interlaceMethod","2 colors","precision mediump float;uniform vec4 c;void main(){gl_FragColor=c;}","_target","_reportProgress","IpcService","Toggle Pixel Grid","View","header-content"," Layer","_addItem","isSelectionTool","uniform1i","_workbenchConfigService",'" failed: ',"onShowColorDetailsChange","Could not find layer for history entry","activeEntry","offsetX","onLayerVisibilityChange","Win32","AddImage","scaledWidth","options","navigator.clipboard.write not supported","keypress","Cannot delete last layer","step",".webp","Hue","image.addNewImage","Cannot restore state from previous version (",'Could not find non-existent static view "',"documentElement","max","tool.handUntilRelease","hidden","ctrlKey","nearestneighbor","tool.shape","createImageBitmap","_redoRange","redoBlendMode","mergeDown","pause","list","LINEAR","activeImage","_inputElement","setAttribute","tool.colorPicker","_openBlob","_windowResolvedPosition","getUniformLocation","_startHistoryEntryOperationName","head","dblclick","_unloadImageSet","--luna-icon-brightness","_createColorInfo","strictMode","Fill","topright","openFile","addEventListener","eraser","_redoImage","_updateLayer","SELECT","expand-canvas-to-selection","Moving layer exceeded maximum pixel count allowed (","Cannot finish composite entry without an entries array","cancelAnimationFrame","toString","luna-image://","_moveLayerUpButton","flipX","layer.goToLayerAbove","textContent","_imagesMap","Could not find temp layer ","onToolChange","onDimensionsChange","container",'Job dimension not found for task "',"restoreImage","onMimeTypeChange","version","open","moveImageToTop","altKey","write","_innerContainer","visibleCheckbox","Show All Commands","ceil","undo","Go to Top Layer","_isStretchEnabled","__param","Rename layer","rgb","Cannot run crop to selection without a selection","SRC_ALPHA","result"," not yet supported","pointA","onPixelGridEnabledChange","_stopAnimatingProgram","_update","_multiplyZoom","DEPTH_STENCIL_ATTACHMENT","layer.rotate180","layer.duplicateLayer","flipY","topStatusBar","slider-input-","sourceImage","_onDidRemoveBottomItem","data","dispose","%) 0%, hsl(","pattern","_clipspaceToCanvasCoordsMatrix","name","Menu","_replacedRange","_frameBufferTexture","_defaultValue","Colors","linear-gradient(180deg, rgba(","showColorDetails","ctrl+shift+x",";\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = ","a_position","getSnapSettingCoordsFromEvent","Float32Array","[createInstance] ","layer/cropToSelection","image.expandCanvasToSelection","_logProgress",'Unrecognized file extension "',"Go to Layer Below","Toggle Stretch","_activeRequests","registerRequestHandler","difference","getEventPositionFromCoords","initialIndex","save","hsl","statusBarPointerColor","_render","progress","image.toggleImagesWindow","_onUpdate","scaledImage","TEXTURE_MAG_FILTER","renderSelection","layer-delete","_rectangleShader","ctrl+a","moveLayerToTop","Move Layer to Bottom","uniform2f","_matrixNeedsUpdate","document","linear-gradient(90deg, rgb(255,0,0) 0%, rgb(255,255,0) 16.67%, rgb(0,255,0) 33.33%, rgb(0,255,255) 50%, rgb(0,0,255) 66.67%, rgb(255,0,255) 83.33%, rgb(255,0,0) 100%)","_renderPrograms"," < ","canvas","floor",'Unknown compression method "',"load","Move the active image up","Shape","image.rotate90CounterClockwise","onDblClick","_onBeforeRunLayerTask","Command: Show All Commands","InstantiationService","Move Selected Pixels","eraseRange","Multiple ","_lastAnimationFrame","_channelToHex","_rangeNotYetRequested","_layoutAll","secondaryColor","_onSoftDeletedChange","order","restore","setLayerVisibility","_applyData","createEmptyRgbColor","data-active-tool","Cut",";\n\nout vec2 v_position;\n\nvoid main() {\n  gl_Position = ","bilinear","Rotate 180°","_animationRenderPrograms","getPixel","_windowPosition","tool.eraser","onDispose","Value (aka brightness)","_quickPickService","onHistoryUpdateValue","luna-icon-before","modal","textureImage","goToImageAbove","Right","add","denied","currentScript","checked","onDidRemoveBottomItem","dest","_startHistoryEntryCtor"," ||\n      mod(v_position.y / ","_finishEdit","8-bit","canUndo","Cannot finish temporary layer without at least 1 step","close","createDocumentFragment","Layers are not supported for this image type","png","createEmptyHslColor","_startEdit","suffix","u_shift","_onCommit","Swap Colors","contextmenu","_keyDown","rgba",")->("," (RGB)","_onDidEndDrag","postMessage","pointerdown","onDidStartDrag","filter","createRenderProgram","start","Delete Image","fitToCoords","label","onChangedDimensions","insertAdjacentElement","Windows","_disposed","_texcoordBuffer","ready","_destRange","_onLayerVisibilityChange","linear-gradient(to right, rgb(255,255,255) 0%, rgb(","getProgramInfoLog","_pointerDownX","keyup","right-items","selection-size","moveLayerUp","dataLength","_onMimeTypeChange","luna:supportsMultipleImages","Invalid data length: ","click","onAttach","trim","addEntry","Erase","_onImageDeleted","sourceColor","join","clearRect","_scrollInterval","_previewCache","ctrl+9","Save","disposables","onStopAnimating","length","_layerListElement","#version 300 es\nprecision mediump float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.5, 0.5, 1, 0.5);\n}","_canvasDimensionsUniformLocation","ctor"," (Readonly)","_minValue","requestQuickPick","_lastActiveTool","#version 300 es\nlayout(location=0)in vec4 A;out vec2 v_texcoord;void main(){gl_Position=A;v_texcoord=(A.xy+1.)/2.;}","Active","linearDodgeAdd","layer.flipHorizontal","_backgroundColor","catch","_dropTargetElement","setImageSoftDeleted","1aDEsKo","onDidAddTopItem","attribute vec4 a_position;attribute vec2 a_texcoord;uniform mat4 a;uniform vec2 b;varying vec2 v_texcoord;void main(){gl_Position=a*(a_position*vec4(b,0.,1.));v_texcoord=a_texcoord;}","finishTemporaryLayer","_applyCommit","duplicateImage","createShader","Move the active image down","OffscreenCanvas","MacPPC","_stateHandlers","unloadedImages","_ipcService","visibleRange","_shiftLocation","canRedo","onPointerMove","invokeFunction","_undoBlendMode","pointerDownMove","toFixed","_onDimensionsChange","_targetIndex","luna-icon","saveState","absolute","ONE","Move Layer Down","element","Pencil","_rightItemsElement","layer.moveLayerToTop","_updateUniformValueMatrix","content","_getAnchorSide","radio","factory","outlineSize","_views","triggerRequestRender","SharedArrayBuffer is not supported","state","shiftKey","contentRect","Could not load tool ","_layer","_redoName","undoName","then","currentTemporaryLayerId","object","_renderService","Layer: ","drawImage","luna-layer://","createInstance","readonly","src","vscode.executeCommand","stopPropagation","createVertexArray"," x ","_renderSelection","layers","developerDirectory","registerTemporaryLayer","deleteTexture","resize","permissions","This image type doesn't support multiple images","_resetHexInput","contentRange","showDefaults","show","onStateChange","_createListItemElement","_color","getTemporaryLayerById","_getImageDragEventId","_getLayerDragEventId","_getJobDimension","_deleteCurrentLayer","_layerTexturesUniformLocation","_replacedImage","_scrollVelocity","_rangeBuffer","cmdctrl+v","scaledImageQuality","goToLayerBelow","acquireVsCodeApi","_resize","Uint32Array","setService","_isVisible","stopImmediatePropagation","getPropertyValue","entries","Empty","_lastCommittedRange","imageSet","createReadonlyRgbColor",'State handler for id "',"Cannot add composite entry to composite entry","querySelectorAll","_colorService","onKeyDown","request","_currentEntryPointer","unknown","warning","_refresh","_channel","--vscode-list-activeSelectionForeground","_startAnimatingProgram","_imageIdCounter","32-bit","_handlePointerDownMove"," to clipboard","_blendWithframeBufferUniformLocation","Trying to get visible viewport range before element is attached","merge","Cannot get coords without element",'", ignoring',"openBlob","No active image index","multiply","requestInput","toast-message","clipboard","runSyncAction","isBottomLayer","effectAllowed","_listElement","Image is readonly, edit is not supported","data-tool-state","New Image","indexOf","_sanitizeValue","_widgetContent","Go to Image Below","run","section","toRgb","bufferData","historyNewEdit","_finishCompositeEntry","subarray","colors-toggle-details","_createPaletteButton","getComputedStyle","offsetHeight","_swapImagePositions","layer.toggleLayersWindow","getType","layer-duplicate","aria-label","onZoomChange","Expand Canvas to Selection","Enter the height of the image","_targetElement","getColorSetFromPointerEvent","option","getAll","STENCIL_TEST","DYNAMIC_DRAW","pixel-grid","History entry factory ","Image size is ","renameLayer","replacedImage"],a2_0x4755=function(t,e){return a2_0x5cf8[t-=300]};(function(t,e){const i=a2_0x4755;for(;;)try{if(450410===parseInt(i(1258))+-parseInt(i(2041))+parseInt(i(533))*parseInt(i(999))+-parseInt(i(823))+-parseInt(i(1333))+parseInt(i(1857))*parseInt(i(855))+-parseInt(i(1137))*-parseInt(i(778)))break;t.push(t.shift())}catch(e){t.push(t.shift())}})(a2_0x5cf8),(()=>{var t={4738:t=>{t[a2_0x4755(538)]="#version 300 es\nprecision mediump float;uniform int a;uniform sampler2D b;uniform sampler2D c;in vec2 v_texcoord;out vec4 A;vec3 B(vec4 C,vec4 D,vec3 E){float a=C.a*D.a;return(C.a-a)*C.rgb+(D.a-a)*D.rgb+a*E;}vec4 F(vec4 C,vec4 D,int G){if(D.a==0.){return C;}if(C.a==0.){return D;}if(G==28){return D;}vec3 H;if(G==1){H=D.rgb;}else if(G==3){H=vec3(min(C.r,D.r),min(C.g,D.g),min(C.b,D.b));}else if(G==4){H=C.rgb*D.rgb;}else if(G==6){H=max(C.rgb+D.rgb-1.,0.);}else if(G==8){H=vec3(max(C.r,D.r),max(C.g,D.g),max(C.b,D.b));}else if(G==9){H=vec3(1.-(1.-C.r)*(1.-D.r),1.-(1.-C.g)*(1.-D.g),1.-(1.-C.b)*(1.-D.b));}else if(G==11){H=min(C.rgb+D.rgb,vec3(1.));}else if(G==13){H=vec3(C.r<.5?(2.*C.r*D.r):(1.-2.*(1.-C.r)*(1.-D.r)),C.g<.5?(2.*C.g*D.g):(1.-2.*(1.-C.g)*(1.-D.g)),C.b<.5?(2.*C.b*D.b):(1.-2.*(1.-C.b)*(1.-D.b)));}else if(G==14){H=vec3(D.r<.5?(2.*C.r*D.r+C.r*C.r*(1.-2.*D.r)):(sqrt(C.r)*(2.*D.r-1.)+2.*C.r*(1.-D.r)),D.g<.5?(2.*C.g*D.g+C.g*C.g*(1.-2.*D.g)):(sqrt(C.g)*(2.*D.g-1.)+2.*C.g*(1.-D.g)),D.b<.5?(2.*C.b*D.b+C.b*C.b*(1.-2.*D.b)):(sqrt(C.b)*(2.*D.b-1.)+2.*C.b*(1.-D.b)));}else if(G==20){H=abs(C.rgb-D.rgb);}else if(G==21){H=C.rgb+D.rgb-2.*C.rgb*D.rgb;}float I=D.a+C.a*(1.-D.a);return vec4(B(C,D,H)/I,I);}void main(){vec4 J=texture(b,v_texcoord);vec4 K=texture(c,v_texcoord);A=F(J,K,a);}"},7542:t=>{const e=a2_0x4755;t[e(538)]=e(1849)},3318:t=>{const e=a2_0x4755;t.exports=e(1364)},3716:t=>{const e=a2_0x4755;t[e(538)]=e(1859)},98:t=>{const e=a2_0x4755;t.exports=e(1558)},7034:t=>{const e=a2_0x4755;t[e(538)]=e(495)},6495:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{Z:()=>r,N:()=>a});var n=i(7166),o=i(4378);class r{constructor(t,e,i,s){const n=a2_0x4755;this[n(709)]=t,this._range=e,this[n(1902)]=i,this._f=s}async[s(1997)](){const t=s,e=(0,n.Qf)(this[t(1902)],this[t(642)]);await this[t(1902)][t(1158)]((async(t,e,i)=>(await this._f(t,e,i),this._range)));const i=(0,n.Qf)(this[t(1902)],this[t(642)]);return new o.$(this[t(709)],this[t(642)],this[t(1902)][t(1040)],this._layer.id,e,i)}}class a{constructor(t,e,i,n,o,r,a,h,c){const l=s;this._operationName=t,this[l(1902)]=e,this[l(1133)]=i,this._x=n,this._y=o,this[l(1933)]=r,this[l(630)]=a,this[l(685)]=h,this[l(799)]=c}async[s(1997)](){const t=s;let e;return await this[t(1902)].edit((async(i,s,n)=>{const o=t;return e=await this[o(799)][o(686)](o(496),{targetImage:{data:i,width:s,height:n},color:this._color,selection:this[o(1133)],x:this._x,y:this._y,tolerance:this[o(630)],blendMode:this[o(685)]}),e.range})),new o.$(this._operationName,e.range,this[t(1902)][t(1040)],this[t(1902)].id,e[t(590)],e.redoData)}}},4852:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{S:()=>n});class n{constructor(t,e,i,s,n,o){const r=a2_0x4755;this[r(709)]=t,this.requiresTool=e,this.stepState=i,this._imageFileId=s,this[r(918)]=n,this[r(340)]=o,this[r(335)]="singleLayer",this[r(510)]=0}async[s(1652)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t[e(1220)](this._imageFileId,this[e(918)],this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);if(n[e(817)][e(658)](),0===n[e(817)][e(1840)])throw new Error(e(469));const o=n.stepState[n[e(817)][e(1840)]-1];return this[e(888)](n,o),i}async redo(t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error("Could not find layer "+this[e(918)]);const n=await t[e(1220)](this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);return n[e(817)][e(1378)](this[e(817)]),this[e(888)](n,this.stepState),i}[s(888)](t,e){const i=s;Object.assign(t.currentState,e),t[i(1896)](),t.triggerHistoryAction()}[s(1348)](){const t=s;return{id:t(702),requiresTool:this[t(1253)],operationName:this.operationName,imageFileId:this[t(466)],layerId:this._layerId,tempLayerId:this[t(340)],stepState:this[t(817)]}}static[s(1182)](t){const e=s;return new n(t[e(709)],t[e(1253)],t[e(817)],t[e(1040)],t.layerId,t[e(989)])}}},8286:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{Z:()=>n});class n{constructor(t,e,i,s){const n=a2_0x4755;this[n(709)]=t,this[n(466)]=e,this[n(918)]=i,this[n(340)]=s,this[n(335)]=n(2178),this[n(1253)]=n(2046),this.pixelCount=0}async[s(1652)](t){const e=s,i=await t[e(331)](this._imageFileId,this._layerId);if(!i)throw new Error(e(1085)+this._layerId);const n=await t[e(1220)](this[e(466)],this._layerId,this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);if(0===n.stepState[e(1840)])throw new Error(e(1780));const o=n[e(817)][n[e(817)][e(1840)]-1];return this[e(888)](n.currentState,o),await i[e(1922)](n,!1),n[e(344)](),i}async[s(772)](t){const e=s,i=await t[e(331)](this._imageFileId,this[e(918)]);if(!i)throw new Error(e(1085)+this._layerId);const n=await t[e(1220)](this[e(466)],this[e(918)],this._tempLayerId);if(!n)throw new Error(e(1636)+this[e(918)]);return i.temporaryLayer=void 0,n.triggerHistoryUnset(),i}[s(888)](t,e){Object[s(1341)](t,e)}serialize(){const t=s;return{id:t(439),operationName:this[t(709)],imageFileId:this[t(466)],layerId:this[t(918)],tempLayerId:this[t(340)]}}static[s(1182)](t){const e=s;return new n(t[e(709)],t[e(1040)],t[e(1365)],t[e(989)])}}},6628:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{$:()=>r});var n=i(1003),o=i(7605);class r{constructor(t,e,i,s,o,r,a,h){const c=a2_0x4755;this.operationName=t,this[c(799)]=e,this[c(1812)]=i,this._replacedRange=s,this[c(466)]=o,this._layerId=r,this._tempLayerId=a,this._replacedImage=h,this[c(335)]=c(2178),this[c(1253)]=c(1070),this[c(510)]=(0,n.U6)(this[c(1682)])}async[s(1652)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t.getTempLayer(this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);if(0===n[e(817)].length)throw new Error(e(1780));const o=n[e(817)][n[e(817)].length-1];return n.currentState[e(1574)]=o[e(1574)],n[e(1167)][e(1517)]=o.offsetY,n.currentState[e(1632)]=o[e(1632)],n[e(1167)][e(1670)]=o.flipY,await i.registerTemporaryLayer(n,!1),await i.edit((async(t,i,s)=>{const n=e;return await this[n(799)][n(686)](n(1054),{targetImage:{data:t,width:i,height:s},putImage:{data:this[n(1940)][n(1675)],width:this._replacedImage[n(1436)],height:this._replacedImage[n(741)]},putRange:this[n(1682)],replacedImage:void 0,blend:"replace"}),this[n(1812)]})),n[e(344)](),i}async[s(772)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error("Could not find layer "+this[e(918)]);const n=await t[e(1220)](this[e(466)],this._layerId,this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);const o=n.stepState[n.stepState[e(1840)]-1];n[e(1167)].offsetX=this[e(1812)][e(1161)],n[e(1167)][e(1517)]=this[e(1812)][e(1116)],n[e(1167)].flipX=o[e(1632)],n[e(1167)][e(1670)]=o[e(1670)],i.temporaryLayer=void 0;const r=await n[e(624)][e(1273)][e(947)];let a;if(o[e(1578)]===r[e(1436)]&&o.scaledHeight===r[e(741)])a=r;else{const t=await this[e(799)].runLayerTask("layer/resize",{width:o[e(1578)],height:o.scaledHeight,resampling:o.quality},r,void 0)[e(1660)];a=t[e(1774)]}return await i[e(1158)]((async(t,i,s)=>{const o=e;return await this[o(799)][o(686)](o(1054),{targetImage:{data:t,width:i,height:s},putImage:{data:a[o(1675)],width:a[o(1436)],height:a[o(741)]},putRange:this[o(1812)],replacedImage:void 0,blend:o(1257),flipX:n.currentState[o(1632)],flipY:n[o(1167)][o(1670)]}),this[o(1812)]})),n[e(812)](),i}[s(1348)](){const t=s;return{id:t(881),operationName:this[t(709)],imageFileId:this[t(466)],layerId:this._layerId,tempLayerId:this[t(340)],destRange:this[t(1812)],replacedRange:this[t(1682)],replacedImage:(0,o.t)(this._replacedImage)}}static[s(1182)](t,e){const i=s;return new r(e[i(709)],t,e.destRange,e.replacedRange,e[i(1040)],e[i(1365)],e[i(989)],(0,o.e)(e[i(2026)]))}}},3817:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{O:()=>n});class n{constructor(t,e,i,s){const n=a2_0x4755;this[n(709)]=t,this[n(466)]=e,this[n(918)]=i,this._tempLayerId=s,this[n(335)]="singleLayer",this.requiresTool="rectangle",this[n(510)]=0}async[s(1652)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error("Could not find layer "+this[e(918)]);const n=await t.getTempLayer(this._imageFileId,this[e(918)],this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);if(0===n[e(817)][e(1840)])throw new Error("Cannot finish temporary layer without at least 1 step");const o=n.stepState[n[e(817)].length-1];return this[e(888)](n[e(1167)],o),await i.registerTemporaryLayer(n,!1),n[e(344)](),i}async[s(772)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t.getTempLayer(this._imageFileId,this[e(918)],this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);return i[e(2217)]=void 0,n.triggerHistoryUnset(),i}_apply(t,e){Object[s(1341)](t,e)}[s(1348)](){const t=s;return{id:t(1541),operationName:this[t(709)],imageFileId:this[t(466)],layerId:this[t(918)],tempLayerId:this._tempLayerId}}static[s(1182)](t){const e=s;return new n(t[e(709)],t[e(1040)],t[e(1365)],t[e(989)])}}},3089:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{o:()=>n});class n{constructor(t,e,i,s){const n=a2_0x4755;this[n(709)]=t,this._imageFileId=e,this[n(918)]=i,this[n(340)]=s,this[n(335)]=n(2178),this[n(1253)]="shape",this.pixelCount=0}async[s(1652)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t.getTempLayer(this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);if(0===n[e(817)][e(1840)])throw new Error(e(1780));const o=n.stepState[n[e(817)][e(1840)]-1];return this[e(888)](n[e(1167)],o),await i[e(1922)](n,!1),n[e(344)](),i}async[s(772)](t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t[e(1220)](this._imageFileId,this._layerId,this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);return i.temporaryLayer=void 0,n[e(812)](),i}[s(888)](t,e){Object[s(1341)](t,e)}[s(1348)](){const t=s;return{id:"finishShape",operationName:this[t(709)],imageFileId:this[t(466)],layerId:this[t(918)],tempLayerId:this[t(340)]}}static[s(1182)](t){const e=s;return new n(t[e(709)],t[e(1040)],t[e(1365)],t.tempLayerId)}}},707:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{o:()=>n});class n{constructor(t,e,i,s){const n=a2_0x4755;this.operationName=t,this[n(466)]=e,this[n(918)]=i,this._tempLayerId=s,this[n(335)]=n(2178),this[n(1253)]="text",this[n(510)]=0}async[s(1652)](t){const e=s,i=await t.getLayer(this[e(466)],this[e(918)]);if(!i)throw new Error("Could not find layer "+this[e(918)]);const n=await t[e(1220)](this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error(e(1636)+this._layerId);if(0===n[e(817)][e(1840)])throw new Error(e(1780));const o=n.stepState[n[e(817)].length-1];return this[e(888)](n[e(1167)],o),await i[e(1922)](n,!1),n[e(344)](),i}async[s(772)](t){const e=s,i=await t.getLayer(this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t[e(1220)](this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);return i.temporaryLayer=void 0,n[e(812)](),i}[s(888)](t,e){Object[s(1341)](t,e)}[s(1348)](){const t=s;return{id:t(2138),operationName:this[t(709)],imageFileId:this[t(466)],layerId:this[t(918)],tempLayerId:this[t(340)]}}static[s(1182)](t){const e=s;return new n(t[e(709)],t[e(1040)],t[e(1365)],t[e(989)])}}},6785:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{x:()=>o});var n=i(7605);class o{constructor(t,e,i,s,n,o){const r=a2_0x4755;this[r(709)]=t,this[r(466)]=e,this[r(918)]=i,this._range=s,this[r(542)]=n,this[r(347)]=o,this[r(335)]=r(2178),this.pixelCount=this._undoData.indexList[r(1840)]}[s(1652)](t){const e=s;return this._applyData(this[e(642)],this[e(542)],t)}[s(772)](t){const e=s;return this[e(1749)](this[e(642)],this._redoData,t)}serialize(){const t=s;return{id:"layerIndexList",operationName:this.operationName,imageFileId:this[t(466)],layerId:this._layerId,range:this[t(642)],undoData:(0,n.t)(this._undoData),redoData:(0,n.t)(this[t(347)])}}async[s(1749)](t,e,i){const n=s,o=await i.getLayer(this._imageFileId,this._layerId);if(!o)throw new Error(n(1572));return await o.edit((i=>{const s=n;let o=0;for(let t=0;t<e[s(1071)][s(1840)];t++)o=e.indexList[t],i[o]=e[s(1355)][4*t],i[o+1]=e[s(1355)][4*t+1],i[o+2]=e[s(1355)][4*t+2],i[o+3]=e[s(1355)][4*t+3];return t})),o}static[s(1182)](t){const e=s;return new o(t[e(709)],t.imageFileId,t[e(1365)],t.range,(0,n.e)(t.undoData),(0,n.e)(t.redoData))}}},4378:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{$:()=>o});var n=i(1003);class o{constructor(t,e,i,s,o,r){const a=a2_0x4755;this[a(709)]=t,this[a(664)]=e,this[a(466)]=i,this[a(918)]=s,this[a(542)]=o,this._redoData=r,this.type=a(2178),this[a(510)]=(0,n.U6)(this[a(664)])}async undo(t){const e=a2_0x4755;return await this[e(888)](this[e(542)],t)}async[s(772)](t){const e=s;return await this[e(888)](this[e(347)],t)}async _apply(t,e){const i=s,o=await e[i(331)](this[i(466)],this[i(918)]);if(!o)throw new Error(i(1085)+this._layerId);const r=(0,n.rY)(this[i(664)]),a=(0,n.Oq)(this.range),h=4*a;let c=0,l=0,d=0;return await o.edit(((e,s)=>{const n=i;for(let i=0;i<r;i++)l=i+this.range[n(1116)],c=4*(l*s+this[n(664)][n(1161)]),d=i*a*4,e.set(t[n(2003)](d,d+h),c);return this[n(664)]})),o}serialize(){const t=s;return{id:"layerRange",operationName:this.operationName,imageFileId:this._imageFileId,layerId:this[t(918)],range:this[t(664)],undoData:Array[t(2098)](this[t(542)]),redoData:Array[t(2098)](this._redoData)}}static[s(1182)](t){const e=s;return new o(t[e(709)],t[e(664)],t[e(1040)],t[e(1365)],new Uint8Array(t[e(590)]),new Uint8Array(t.redoData))}}},1375:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{C:()=>n});class n{constructor(t,e,i,s,n,o,r,a){const h=a2_0x4755;this[h(709)]=t,this[h(799)]=e,this[h(809)]=i,this._imageFileId=s,this[h(918)]=n,this[h(340)]=o,this[h(681)]=r,this[h(1095)]=a,this.type=h(2178),this[h(1253)]=h(1070),this.pixelCount=this[h(681)]*this._height}async[s(1652)](t){const e=s,i=await t[e(331)](this[e(466)],this._layerId);if(!i)throw new Error(e(1085)+this[e(918)]);const n=await t[e(1220)](this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);return n[e(817)].pop(),n[e(1167)][e(1574)]=n[e(384)].offsetX,n.currentState[e(1517)]=n[e(384)][e(1517)],n[e(1167)].flipX=n[e(384)][e(1632)],n[e(1167)][e(1670)]=n[e(384)][e(1670)],i[e(2217)]=void 0,await i[e(1158)]((async(t,i,s)=>{const o=e,r=await n[o(624)].image[o(947)],a=this[o(2065)](n);return await this._taskWorkerService.runTask(o(1054),{targetImage:{data:t,width:i,height:s},putImage:{data:r[o(1675)],width:r[o(1436)],height:r.height},putRange:a,replacedImage:void 0,blend:o(1257)}),a})),n[e(812)](),i}async[s(772)](t){const e=s,i=await t[e(331)](this[e(466)],this._layerId);if(!i)throw new Error("Could not find layer "+this[e(918)]);const n=await t[e(1220)](this[e(466)],this._layerId,this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);return n[e(817)].push(this[e(809)]),n.currentState[e(1574)]=this[e(809)][e(1574)],n[e(1167)][e(1517)]=this[e(809)][e(1517)],n[e(1167)][e(1632)]=this[e(809)][e(1632)],n.currentState[e(1670)]=this[e(809)][e(1670)],i[e(2217)]=n,await i.edit((async(t,i,s)=>{const o=e,r=this._getRange(n);return await this._taskWorkerService[o(686)](o(1738),{targetImage:{data:t,width:i,height:s},range:r}),r})),n[e(344)](),i}[s(2065)](t){const e=s;return{left:t.initialState.offsetX,top:t[e(384)].offsetY,right:t[e(384)][e(1574)]+t[e(624)][e(1273)][e(437)][e(1436)],bottom:t[e(384)].offsetY+t[e(624)][e(1273)][e(437)][e(741)]}}[s(1348)](){const t=s;return{id:"moveSelectedPixels",operationName:this.operationName,imageFileId:this[t(466)],layerId:this[t(918)],tempLayerId:this._tempLayerId,stepState:this._stepState,width:this[t(681)],height:this[t(1095)]}}static create(t,e){const i=s;return new n(e[i(709)],t,e[i(817)],e[i(1040)],e[i(1365)],e.tempLayerId,e[i(1436)],e[i(741)])}}},8549:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{i:()=>n});class n{constructor(t,e,i,s,n,o){const r=a2_0x4755;this[r(709)]=t,this.requiresTool=e,this[r(809)]=i,this._imageFileId=s,this._layerId=n,this._tempLayerId=o,this.type="singleLayer",this[r(510)]=0}async[s(1652)](t){const e=s,i=await t.getLayer(this[e(466)],this[e(918)]);if(!i)throw new Error("Could not find layer "+this[e(918)]);const n=await t.getTempLayer(this[e(466)],this[e(918)],this[e(340)]);if(!n)throw new Error("Could not find temp layer "+this[e(918)]);return n[e(817)][e(658)](),this[e(888)](n,n[e(384)]),i.temporaryLayer=void 0,n.triggerHistoryUnset(),i}async redo(t){const e=s,i=await t[e(331)](this[e(466)],this[e(918)]);if(!i)throw new Error(e(1085)+this._layerId);const n=await t[e(1220)](this[e(466)],this._layerId,this[e(340)]);if(!n)throw new Error(e(1636)+this[e(918)]);return n[e(817)][e(1378)](this._stepState),this[e(888)](n,this[e(809)]),await i.registerTemporaryLayer(n,!1),n[e(344)](),i}[s(888)](t,e){const i=s;Object[i(1341)](t[i(1167)],e),t[i(1896)]()}serialize(){const t=s;return{id:t(2120),requiresTool:this[t(1253)],operationName:this[t(709)],imageFileId:this[t(466)],layerId:this[t(918)],tempLayerId:this._tempLayerId,stepState:this[t(809)]}}static[s(1182)](t){const e=s;return new n(t[e(709)],t.requiresTool,t[e(817)],t[e(1040)],t[e(1365)],t.tempLayerId)}}},3491:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{M:()=>h,w:()=>c});var n=i(1815),o=i(5120),r=i(7605);let a=0;function h(t){a=Math[a2_0x4755(1590)](a,t)}class c extends o.JT{constructor(t,e){const i=a2_0x4755;super(),this[i(652)]=e,this._onCommit=this[i(1075)](new n.v),this[i(1208)]=this[i(1789)][i(2220)],this[i(1462)]=this.register(new n.v),this[i(613)]=this[i(1462)][i(2220)],this[i(2144)]=this[i(1075)](new n.v),this[i(815)]=this[i(2144)][i(2220)],this[i(858)]=this[i(1075)](new n.v),this[i(745)]=this[i(858)][i(2220)],t?(this.id=t,h(t)):this.id=++a}[s(1896)](){const t=s;this[t(1462)][t(393)]()}[s(344)](){const t=s;this[t(858)][t(393)]()}triggerHistoryUnset(){const t=s;this._onHistoryUnset[t(393)]()}[s(954)](t){const e=s;if(-1!==t&&this[e(652)].width*this[e(652)][e(741)]>t)return e(1626)+this[e(652)][e(1436)]*this[e(652)][e(741)]+e(690)+t+")"}[s(1348)](){const t=s;return{id:this.id,parentLayerId:this[t(652)].id,type:this[t(335)],staticState:(0,r.t)(this.staticState),initialState:(0,r.t)(this.initialState),currentState:(0,r.t)(this.currentState),stepState:this[t(817)][t(688)]((t=>(0,r.t)(t)))}}}},9199:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{r:()=>a});var n=i(4852),o=i(8549),r=i(3491);class a extends r.w{constructor(t,e,i,s){const n=a2_0x4755;super(i,t),this[n(1551)]=e,this.stepState=s}get[s(879)](){}get imageTextureRange(){}step(t,e=!1){const i=s,r=this._cloneState(this[i(1167)]);if(this[i(817)].length>0){let s=!1;if(e){const e=this[i(1551)][i(1953)][this._historyService[i(1953)][i(1840)]-1];e.operationName===t&&(e[i(817)]=r,this[i(817)][this[i(817)].length-1]=r,s=!0)}!s&&(this[i(1551)][i(1828)](new n.S(t,this[i(1253)],r,this[i(652)].imageFileId,this[i(652)].id,this.id)),this.stepState.push(r))}else this[i(1551)][i(1828)](this[i(1775)]?new(this[i(1775)])(this[i(1610)],r,this._parentLayer[i(1040)],this._parentLayer.id,this.id):new o.i(this._startHistoryEntryOperationName,this[i(1253)],r,this[i(652)][i(1040)],this[i(652)].id,this.id)),this[i(817)][i(1378)](r);this[i(1462)][i(393)]()}[s(927)](t,e,i,n){const o=s;this.currentState[e]!==t&&(this[o(1167)][e]=t,this[o(1583)](i,n),this.triggerRequestRender())}async[s(1061)](){const t=s;await this[t(1551)].createCompositeEntry(this[t(1482)],(async()=>{const e=t;this[e(1551)].addEntry(new(this[e(615)])(this[e(1482)],this[e(652)][e(1040)],this[e(652)].id,this.id)),await this[e(1861)]()})),this[t(1789)][t(393)]()}}},2811:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{B:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(8286),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x4755;super(t,s,r,a),this.staticState=e,this.initialState=i,this[c(1104)]=n,this._taskWorkerService=o,this.type=c(2046),this[c(1253)]=c(2046),this[c(615)]=h.Z,this._startHistoryEntryOperationName=c(490),this[c(1482)]=c(2101),this[c(1167)]=this[c(2147)](a[c(1840)]?a[a[c(1840)]-1]:this[c(384)]),this[c(745)]((()=>this._updateTextureIfNeeded())),a[c(1840)]>0&&this[c(608)]()}get imageTextureRange(){return this._imageTextureRange}get[s(879)](){return this[s(994)]}step(t,e=!1){const i=s;super[i(1583)](t,e),this[i(608)]()}async[s(608)](){const t=s,{image:e,resolve:i,reject:r}=(0,n.W)(this[t(652)][t(1436)],this._parentLayer[t(741)]);this[t(994)]=e,this._imageTextureRange=(0,o.DI)(this._parentLayer[t(1436)],this._parentLayer.height);const a=this[t(1167)];try{await this[t(799)].runTask(t(1416),{targetImage:e[t(437)],color:this[t(624)][t(957)]?a[t(1744)]:a[t(1212)],pointA:a[t(1662)],pointB:a[t(2110)],strokeWidth:a.strokeWidth,smoothing:a.smoothing,blendMode:a[t(903)],selection:this._selectionService[t(664)]}),e[t(1337)]=!0,i(e.resource),this[t(1462)][t(393)]()}catch(i){this[t(994)]===e&&(this[t(994)]=void 0),r(i)}}async[s(1861)](){const t=s;if(this[t(994)]){const e=await this[t(994)][t(947)],i=(0,o.DI)(e.width,e[t(741)]);await this[t(1551)][t(1422)](new a.Z(this[t(1482)],i,this[t(652)],(async(t,e,i)=>{await this.applyCommit(t,e,i)})))}}async[s(349)](t,e,i){const n=s;if(this[n(994)]){const s=await this[n(994)][n(947)],r=(0,o.DI)(s[n(1436)],s.height);await this._taskWorkerService[n(686)](n(1054),{blend:this.currentState[n(903)],targetImage:{data:t,width:e,height:i},putImage:s,putRange:r,replacedImage:void 0})}}[s(2147)](t){const e=s;return{pointA:{...t[e(1662)]},pointB:{...t[e(2110)]},primaryColor:t[e(1212)],secondaryColor:t[e(1744)],blendMode:t[e(903)],strokeWidth:t.strokeWidth,smoothing:t[e(580)]}}static[s(1182)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(624)]),(0,r.e)(t[a(384)]),i,n,o,t.id,t[a(817)][a(688)]((t=>(0,r.e)(t))))}}},270:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{m:()=>d});var n=i(2939),o=i(1003),r=i(7605),a=i(4852),h=i(6628),c=i(1375),l=i(3491);class d extends l.w{constructor(t,e,i,s,n,r,a,h=[]){const c=a2_0x4755;super(a,t),this[c(624)]=e,this[c(1551)]=s,this[c(1104)]=n,this[c(799)]=r,this[c(817)]=h,this[c(335)]=c(355),this.initialState=typeof i===c(1907)?i:{offsetX:e[c(664)][c(1161)],offsetY:e[c(664)].top,flipX:!1,flipY:!1,scaledWidth:(0,o.Oq)(e[c(664)]),scaledHeight:(0,o.rY)(e[c(664)]),quality:typeof i===c(2185)?i:"bilinear"},this[c(1167)]={...h?.[c(1840)]?h[h[c(1840)]-1]:this[c(384)]},this[c(745)]((()=>this[c(386)]())),h.length>0&&this[c(386)](),this[c(624)][c(1273)].readyPromise.then((()=>this[c(1462)].fire()))}get data(){const t=a2_0x4755;return this[t(624)][t(1273)][t(437)].data}get[s(1436)](){const t=s;return this[t(624)][t(1273)][t(437)][t(1436)]}get[s(741)](){const t=s;return this.staticState[t(1273)][t(437)][t(741)]}[s(1296)](t){const e=s;this[e(1167)].offsetX===t.left&&this[e(1167)].offsetY===t[e(1116)]&&this[e(1167)][e(1578)]===(0,o.Oq)(t)&&this[e(1167)][e(1299)]===(0,o.rY)(t)||(this.currentState[e(1574)]=t[e(1161)],this[e(1167)].offsetY=t[e(1116)],this[e(1167)].scaledWidth=(0,o.Oq)(t),this.currentState.scaledHeight=(0,o.rY)(t),this[e(1462)].fire())}[s(900)](){const t=s,e={...this.currentState};this[t(817)][t(1840)]>0?this[t(1551)][t(1828)](new a.S(t(840),t(1070),e,this[t(652)][t(1040)],this._parentLayer.id,this.id)):this[t(1551)][t(1828)](new c.C(t(1737),this._taskWorkerService,e,this[t(652)].imageFileId,this[t(652)].id,this.id,this.staticState[t(1273)][t(437)][t(1436)],this[t(624)][t(1273)][t(437)][t(741)])),this[t(386)](),this[t(817)][t(1378)](e),this[t(1462)][t(393)]()}[s(2047)](t){const e=s,i={...this.currentState};this[e(1551)][e(1828)](new a.S(t,"movePixels",i,this._parentLayer[e(1040)],this[e(652)].id,this.id)),this[e(386)](),this[e(817)].push(i),this._onRequestRender.fire()}[s(386)](){const t=s,e=this[t(1712)]?.[t(437)][t(1436)]||this[t(624)][t(1273)][t(437)][t(1436)],i=this[t(1712)]?.[t(437)][t(741)]||this[t(624)][t(1273)].resource.height;if(e===this[t(1167)][t(1578)]&&i===this[t(1167)][t(1299)]&&this.scaledImageQuality===this.currentState.quality)return;if(this[t(1944)]=this[t(1167)][t(362)],this.currentState[t(1578)]===this[t(624)].image.resource[t(1436)]&&this[t(1167)][t(1299)]===this[t(624)].image[t(437)][t(741)])return this[t(1712)]=this[t(624)][t(1273)],void this[t(1462)][t(393)]();let n;const o=new Promise((t=>n=t)),r={width:this[t(1167)][t(1578)],height:this[t(1167)].scaledHeight,data:new Uint8Array(0)};this[t(1712)]={isReady:!1,readyPromise:o,resource:r},this[t(624)].image[t(947)][t(1905)]((async e=>{const i=t,s=await this[i(799)][i(656)](i(430),{width:this[i(1167)][i(1578)],height:this[i(1167)][i(1299)],resampling:this[i(1167)][i(362)]},e,void 0)[i(1660)];r[i(1675)]=s[i(1774)][i(1675)],this[i(1712)]&&(this.scaledImage[i(1337)]=!0),n(r),this[i(1462)][i(393)]()}))}async[s(1061)](){const t=s,e=await(this.scaledImage?.[t(947)]||this.staticState[t(1273)][t(947)]),i=Math.max(this[t(1167)][t(1574)],0),o=Math[t(1590)](this[t(1167)][t(1517)],0),r=Math[t(2219)](this[t(1167)].offsetX+this.currentState[t(1578)],this[t(652)][t(1436)]),a=Math[t(2219)](this.currentState[t(1517)]+this[t(1167)][t(1299)],this[t(652)][t(741)]),c=r-i,l=a-o,d=(0,n.u)(c,this[t(652)][t(1436)],0)*(0,n.u)(l,this[t(652)][t(741)],0)*4,u={width:c,height:l,data:new Uint8Array(new SharedArrayBuffer(d))},m={left:this[t(1167)][t(1574)],top:this[t(1167)][t(1517)],right:this[t(1167)][t(1574)]+this.currentState.scaledWidth,bottom:this[t(1167)][t(1517)]+this[t(1167)][t(1299)]};d>0&&await this[t(652)][t(1158)]((async(i,s,n)=>{const o=t;return await this[o(799)][o(686)](o(1054),{putRange:m,targetImage:{data:i,width:s,height:n},putImage:e,replacedImage:u,blend:o(1257),flipX:this[o(1167)][o(1632)],flipY:this.currentState[o(1670)]}),m})),this[t(1551)].addEntry(new h.$(t(1307),this[t(799)],m,{left:i,top:o,right:r,bottom:a},this[t(652)].imageFileId,this._parentLayer.id,this.id,u)),this[t(1789)][t(393)]()}static[s(1182)](t,e,i,n,o){const a=s;return new d(e,(0,r.e)(t[a(624)]),(0,r.e)(t[a(384)]),i,n,o,t.id,t[a(817)][a(688)]((t=>(0,r.e)(t))))}}},807:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{F:()=>l});var n=i(7517),o=i(1003),r=i(7605),a=i(6495),h=i(3817),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x4755;super(t,s,r,a),this[c(624)]=e,this[c(384)]=i,this[c(1104)]=n,this[c(799)]=o,this[c(335)]=c(516),this.requiresTool="rectangle",this[c(615)]=h.O,this[c(1610)]=c(983),this[c(1482)]="Finish Rectangle",this.currentState=this[c(2147)](a.length?a[a[c(1840)]-1]:this.initialState)}async[s(1861)](){const t=s;await this[t(1551)][t(1422)](new a.Z(this[t(1482)],this[t(1167)][t(664)],this[t(652)],(async(t,e,i)=>{this.applyCommit(t,e,i)})))}async[s(349)](t,e,i){const n=s,r=this[n(1167)].range,a=this[n(1167)][n(903)],h=this.getRanges();if((0,o.U6)(r)>25e4){const s=[];for(const o of h)for(const r of o[n(1361)])s[n(1378)](this[n(799)][n(686)](n(923),{targetImage:{data:t,width:e,height:i},range:r,color:new Uint8Array(o.color),blendMode:a}));await Promise[n(1326)](s)}else for(const i of h)for(const s of i[n(1361)])this[n(1447)](t,e,s,i[n(1129)],a)}_cloneState(t){const e=s;return{primaryColor:t.primaryColor,secondaryColor:t[e(1744)],blendMode:t[e(903)],range:(0,o.BN)(t[e(664)]),outlineSize:t.outlineSize,style:t[e(1412)]}}[s(1447)](t,e,i,o,r){const a=s;for(let s=i[a(1116)];s<i[a(2077)];s++)for(let h=i[a(1161)];h<i[a(594)];h++)(0,n.B)(r,t,4*(s*e+h),o,0)}[s(756)](){const t=s,e=[],i=this[t(1167)],n=this[t(624)][t(957)]?i[t(1744)]:i[t(1212)],r=this[t(624)][t(957)]?i.primaryColor:i[t(1744)],a=2===i[t(1412)]?n:r,h=2===i[t(1412)]?r:n,c=this[t(1104)][t(664)]||(0,o.DI)(this._parentLayer[t(1436)],this[t(652)].height),l=(0,o.l$)({left:i[t(664)][t(1161)],right:i.range.right,top:i[t(664)][t(1116)],bottom:Math[t(2219)](i.range[t(1116)]+i[t(1894)],i.range[t(2077)])},c),d=(0,o.l$)({left:i[t(664)].left,right:i[t(664)][t(594)],top:Math[t(1590)](l.bottom,i[t(664)][t(2077)]-i[t(1894)]),bottom:i[t(664)][t(2077)]},c),u=(0,o.l$)({left:i[t(664)].left,right:i[t(664)].left+i.outlineSize,top:l[t(2077)],bottom:d.top},c),m=(0,o.l$)({left:Math[t(1590)](u[t(594)],i.range[t(594)]-i[t(1894)]),right:i[t(664)][t(594)],top:l[t(2077)],bottom:d[t(1116)]},c);return 2!==i[t(1412)]&&e.push({ranges:[l,d,u,m],color:h}),3===i.style?e[t(1378)]({ranges:[{left:u[t(594)],right:m[t(1161)],top:l[t(2077)],bottom:d.top}],color:a}):2===i[t(1412)]&&e[t(1378)]({ranges:[{left:u[t(1161)],right:m[t(594)],top:l.top,bottom:d[t(2077)]}],color:a}),e}static[s(1182)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(624)]),(0,r.e)(t[a(384)]),i,n,o,t.id,t[a(817)][a(688)]((t=>(0,r.e)(t))))}}},3670:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{n:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(3089),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x4755;super(t,s,r,a),this[c(624)]=e,this[c(384)]=i,this[c(1104)]=n,this[c(799)]=o,this[c(335)]=c(2175),this.requiresTool=c(2175),this._finishHistoryEntryCtor=h.o,this[c(1610)]=c(1332),this[c(1482)]=c(1204),this[c(1167)]=this[c(2147)](a.length?a[a.length-1]:this[c(384)]),this[c(745)]((()=>this[c(608)]())),a[c(1840)]>0&&this[c(608)]()}get imageTextureRange(){return this._imageTextureRange}get[s(879)](){return this[s(994)]}[s(1583)](t,e=!1){super[s(1583)](t,e),this._updateTextureIfNeeded()}async[s(608)](){const t=s,e=this[t(1167)];(!this[t(2193)]||!(0,o.ap)(this[t(2193)],e[t(664)]))&&(this._imageTextureRange=(0,o.kq)((0,o.BN)(e[t(664)])));const{image:i,resolve:r,reject:a}=(0,n.W)((0,o.Oq)(this[t(2193)]),(0,o.rY)(this[t(2193)]));this[t(994)]=i;try{await this[t(799)].runTask("drawShape",{targetImage:i[t(437)],primaryColor:this.staticState.invertColors?e.secondaryColor:e.primaryColor,secondaryColor:this.staticState[t(957)]?e[t(1212)]:e[t(1744)],dimensions:e[t(664)],type:e[t(335)],strokeWidth:this[t(1167)].outlineSize,smoothing:e.smoothing,style:e[t(1412)],blendMode:e[t(903)],selection:this._selectionService[t(664)],flipX:e[t(1632)],flipY:e[t(1670)]}),i[t(1337)]=!0,r(i[t(437)]),this[t(1462)].fire()}catch(e){this[t(994)]===i&&(this._imageTexture=void 0),a(e)}}async[s(1861)](){const t=s;this._imageTexture&&this[t(2193)]&&(await this[t(994)].readyPromise,await this[t(1551)][t(1422)](new a.Z(this._finishHistoryEntryOperationName,this[t(2193)],this._parentLayer,(async(e,i,s)=>{const n=t;await this[n(349)](e,i,s)}))))}async[s(349)](t,e,i){const n=s;if(!this[n(994)]||!this[n(2193)])return;const o=await this[n(994)].readyPromise;await this[n(799)].runTask(n(1054),{blend:this[n(1167)][n(903)],targetImage:{data:t,width:e,height:i},putImage:o,putRange:this[n(2193)],replacedImage:void 0})}_cloneState(t){const e=s;return{primaryColor:t.primaryColor,secondaryColor:t.secondaryColor,blendMode:t[e(903)],range:(0,o.BN)(t[e(664)]),outlineSize:t[e(1894)],style:t[e(1412)],smoothing:t.smoothing,type:t[e(335)],flipX:t[e(1632)],flipY:t[e(1670)]}}static create(t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(624)]),(0,r.e)(t[a(384)]),i,n,o,t.id,t.stepState.map((t=>(0,r.e)(t))))}}},7233:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{o:()=>l});var n=i(116),o=i(1003),r=i(7605),a=i(6495),h=i(707),c=i(9199);class l extends c.r{constructor(t,e,i,s,n,o,r,a=[]){const c=a2_0x4755;super(t,s,r,a),this[c(624)]=e,this.initialState=i,this[c(1104)]=n,this[c(799)]=o,this[c(335)]=c(531),this[c(1253)]=c(531),this[c(615)]=h.o,this[c(1610)]="Draw Text",this[c(1482)]="Finish Text",this[c(1167)]=this._cloneState(a.length?a[a[c(1840)]-1]:this[c(384)]),this[c(745)]((()=>this[c(832)]())),(a.length>0||i[c(531)][c(1840)]>0)&&this[c(832)]()}get[s(2150)](){return this[s(2193)]}get[s(879)](){return this._imageTexture}step(t,e=!1){const i=s;super.step(t,e),this[i(832)]()}async[s(832)](){const t=s,{image:e,resolve:i,reject:r}=(0,n.W)(this[t(652)][t(1436)],this._parentLayer[t(741)]);this[t(994)]=e,this[t(2193)]=(0,o.DI)(this[t(652)][t(1436)],this._parentLayer.height);const a=this[t(1167)];try{await this[t(799)][t(686)]("drawText",{targetImage:e[t(437)],primaryColor:this[t(624)][t(957)]?a[t(1744)]:a.primaryColor,secondaryColor:this.staticState[t(957)]?a[t(1212)]:a[t(1744)],dimensions:a[t(664)],blendMode:a.blendMode,selection:this[t(1104)][t(664)],text:a.text,isBold:a[t(2072)],isItalic:a[t(1406)],fontSize:a.fontSize,fontFamily:a[t(691)],alignment:a[t(826)],verticalAlignment:a[t(629)]}),e[t(1337)]=!0,i(e.resource),this[t(1462)][t(393)]()}catch(i){this._imageTexture===e&&(this[t(994)]=void 0,this[t(1462)][t(393)]()),r(i)}}async[s(1861)](){const t=s;if(this[t(994)]){const e=await this._imageTexture[t(947)],i=(0,o.DI)(e[t(1436)],e[t(741)]);await this[t(1551)][t(1422)](new a.Z(this[t(1482)],i,this[t(652)],(async(e,i,s)=>{const n=t;await this[n(349)](e,i,s)})))}}async applyCommit(t,e,i){const n=s;if(this._imageTexture){const s=await this[n(994)][n(947)],r=(0,o.DI)(s[n(1436)],s[n(741)]);await this[n(799)].runTask(n(1054),{blend:this.currentState.blendMode,targetImage:{data:t,width:e,height:i},putImage:s,putRange:r,replacedImage:void 0})}}[s(2147)](t){const e=s;return{primaryColor:t.primaryColor,secondaryColor:t[e(1744)],blendMode:t[e(903)],range:(0,o.BN)(t[e(664)]),text:t[e(531)],isBold:t[e(2072)],isItalic:t[e(1406)],fontSize:t[e(478)],fontFamily:t[e(691)],alignment:t[e(826)],verticalAlignment:t.verticalAlignment}}static[s(1182)](t,e,i,n,o){const a=s;return new l(e,(0,r.e)(t[a(624)]),(0,r.e)(t[a(384)]),i,n,o,t.id,t[a(817)].map((t=>(0,r.e)(t))))}}},1038:(t,e,i)=>{const s=a2_0x4755;var n={"./renderers/moveImageRangeRenderer.js":[504,504],"./tools/colorPicker.js":[6471,6471],"./tools/crop.js":[3976,3976],"./tools/eraser.js":[2996,2996],"./tools/fill.js":[7643,7643],"./tools/hand.js":[2333,2333],"./tools/line.js":[2844,2844],"./tools/movePixels.js":[687,687],"./tools/moveSelection.js":[403,403],"./tools/pencil.js":[5525,5525],"./tools/rectangle.js":[7440,7440],"./tools/selection.js":[3040,3040],"./tools/shape.js":[9113,9113],"./tools/text.js":[8488,8488],"./tools/zoom.js":[7710,7710]};function o(t){const e=a2_0x4755;if(!i.o(n,t))return Promise[e(2177)]()[e(1905)]((()=>{const i=e;var s=new Error(i(300)+t+"'");throw s[i(1109)]=i(965),s}));var s=n[t],o=s[0];return i.e(s[1])[e(1905)]((()=>i(o)))}o.keys=()=>Object[s(473)](n),o.id=1038,t.exports=o},1123:(t,e,i)=>{"use strict";function s(t,e){const i=a2_0x4755;t[i(341)].has(e[i(335)])&&g(t,u(e,i(1739)+e.type+" chunks not allowed",e.offset+4))}function n(t,e,i){const s=a2_0x4755;if(e[s(1821)]!==i){const n=u(e,"Invalid data length: "+e[s(1821)]+s(501)+i,e[s(1127)]);if(!(e.dataLength>i))throw n;g(t,n)}}function o(t,e,i){const s=a2_0x4755;if(e.dataLength<i)throw l(t,e,s(1824)+e.dataLength+s(1725)+i,e.offset)}function r(t,e,i){const s=a2_0x4755;t[s(341)][s(1225)](i)&&g(t,u(e,s(669)+i,e[s(1127)]+4))}function a(t,e,i){const s=a2_0x4755;if(!t.parsedChunks.has(i))throw l(t,e,s(2116)+i,e[s(1127)]+4)}function h(t,e,i){const s=a2_0x4755;t[s(341)][s(1225)](i)&&g(t,u(e,s(515)+i,e[s(1127)]+4))}function c(t,e,i,s){0!==i&&g(t,u(e,a2_0x4755(1728)+i+'"',s))}function l(t,e,i,s){return new d(t,e[a2_0x4755(335)]+": "+i,s)}i.d(e,{qA:()=>s,_c:()=>n,uf:()=>o,iw:()=>r,nW:()=>a,lf:()=>h,a1:()=>c,gS:()=>l,_9:()=>d,iU:()=>u,b4:()=>m,pP:()=>g});class d extends Error{constructor(t,e,i){const s=a2_0x4755;super(e),this[s(1127)]=i,this[s(968)]={details:s(599)in t&&t[s(599)]?{width:t[s(599)][s(1436)],height:t[s(599)].height,bitDepth:t.header.bitDepth,colorType:t[s(599)].colorType,interlaceMethod:t[s(599)][s(1556)]}:void 0,info:t[s(2117)],metadata:t[s(1407)],rawChunks:t[s(1323)],warnings:t[s(1173)]}}}function u(t,e,i){return new m(t[a2_0x4755(335)]+": "+e,i)}class m extends Error{constructor(t,e){const i=a2_0x4755;super(t),this[i(1127)]=e}}function g(t,e){const i=a2_0x4755;if(t.options[i(1616)])throw e;t.warnings.push(e)}},473:(t,e,i)=>{"use strict";i.d(e,{v8:()=>s,E:()=>n,pP:()=>o});class s extends Error{constructor(t,e){super(t),this.offset=e}}class n extends Error{constructor(t,e){const i=a2_0x4755;super(t),this[i(1127)]=e}}function o(t,e){const i=a2_0x4755;if(t[i(1579)][i(1616)])throw e;t.warnings[i(1378)](e)}},6815:(t,e,i)=>{"use strict";async function s(t,e){const s=a2_0x4755;return(await Promise.all([i.e(7885),i.e(9247)])[s(1905)](i.bind(i,9247)))[s(870)](t,e)}async function n(t,e){const s=a2_0x4755;return(await Promise[s(1326)]([i.e(7885),i.e(1551)])[s(1905)](i.bind(i,1551)))[s(2212)](t,e)}i.d(e,{dX:()=>s,Vx:()=>n}),i(1123),i(473)},8984:(t,e,i)=>{"use strict";i.d(e,{_9:()=>s,b4:()=>n,pP:()=>o});class s extends Error{constructor(t,e,i){const s=a2_0x4755;super(e),this.offset=i,this[s(968)]={details:{header:t[s(599)],footer:t[s(2126)],imageId:t[s(2148)],developerDirectory:t[s(1921)],extensionArea:t[s(783)]},warnings:t.warnings}}}class n extends Error{constructor(t,e){const i=a2_0x4755;super(t),this[i(1127)]=e}}function o(t,e){const i=a2_0x4755;if(t[i(1579)][i(1616)])throw e;t.warnings[i(1378)](e)}},4371:(t,e,i)=>{"use strict";const s=a2_0x4755;function n(t,e=2*t[s(1840)]){const i=s;let n;if(t instanceof Float32Array)n=new Float32Array(e);else if(t instanceof Uint8Array)n=new Uint8Array(e);else if(t instanceof Uint16Array)n=new Uint16Array(e);else{if(!(t instanceof Uint32Array))throw new Error(i(1393));n=new Uint32Array(e)}return n[i(475)](t),n}function o(t,e,i=!1){return e<Math.pow(2,8)?i?new Uint8Array(new SharedArrayBuffer(t)):new Uint8Array(t):e<Math.pow(2,16)?i?new Uint16Array(new SharedArrayBuffer(2*t)):new Uint16Array(t):i?new Uint32Array(new SharedArrayBuffer(4*t)):new Uint32Array(t)}function r(t){const e=s;if(window[e(320)]&&!(t[e(1394)]instanceof SharedArrayBuffer)){const i=new Uint8Array(new SharedArrayBuffer(t[e(1840)]));i[e(475)](t),t=i}return t}function a(t,e,i,s){t[e]=i[s],t[e+1]=i[s+1],t[e+2]=i[s+2],t[e+3]=i[s+3]}function h(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}i.d(e,{Rs:()=>n,X$:()=>o,pZ:()=>r,Yr:()=>a,fU:()=>h})},7517:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{B:()=>h});var n=i(4371);const o=new Float32Array(6);let r;const a={normal:(t,e)=>e,darken:(t,e)=>Math[s(2219)](t,e),multiply:(t,e)=>t*e,linearBurn:(t,e)=>Math[s(1590)](t+e-1,0),lighten:(t,e)=>Math[s(1590)](t,e),screen:(t,e)=>1-(1-t)*(1-e),linearDodgeAdd:(t,e)=>Math[s(2219)](t+e,1),overlay:(t,e)=>t<.5?2*t*e:1-2*(1-t)*(1-e),softLight:(t,e)=>e<.5?2*t*e+t*t*(1-2*e):Math.sqrt(t)*(2*e-1)+2*t*(1-e),difference:(t,e)=>Math[s(869)](t-e),exclusion:(t,e)=>t+e-2*t*e};function h(t,e,i,h,l,d=e,u=i){const m=s;if("replace"!==t){if(o[0]=h[l+3]/255,0===o[0])return e[i]=d[u],e[i+1]=d[u+1],e[i+2]=d[u+2],void(e[i+3]=d[u+3]);if(o[1]=d[u+3]/255,0===o[1])return e[i]=h[l],e[i+1]=h[l+1],e[i+2]=h[l+2],void(e[i+3]=h[l+3]);r=a[t],o[3]=r(d[u]/255,h[l]/255),o[4]=r(d[u+1]/255,h[l+1]/255),o[5]=r(d[u+2]/255,h[l+2]/255),o[2]=o[0]+o[1]*(1-o[0]),e[i]=Math[m(1266)](c(d[u]/255,o[1],h[l]/255,o[0],o[3])/o[2]*255),e[i+1]=Math[m(1266)](c(d[u+1]/255,o[1],h[l+1]/255,o[0],o[4])/o[2]*255),e[i+2]=Math[m(1266)](c(d[u+2]/255,o[1],h[l+2]/255,o[0],o[5])/o[2]*255),e[i+3]=Math.round(255*o[2])}else(0,n.Yr)(e,i,h,l)}function c(t,e,i,s,n){return(e-e*s)*t+(s-e*s)*i+e*s*n}},8752:(t,e,i)=>{"use strict";i.d(e,{WC:()=>h,FK:()=>c,B8:()=>s,m4:()=>n,mC:()=>r});var s,n,o,r,a=i(2939);function h(t,e){const i=a2_0x4755;if(t[i(1840)]!==e.length||t[i(335)]!==e[i(335)])return!1;for(let s=0;s<t[i(1840)];s++)if(t[s]!==e[s])return!1;return!0}function c(t){const e=a2_0x4755,i=new Float32Array(t);return i[e(335)]=t.type,i}!function(t){const e=a2_0x4755;function i(){const t=new Float32Array(3);return t.type="rgb",t}function s(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}t[e(1750)]=i,t[e(1523)]=s,t.createReadonlyRgbColor=function(t,e,i){return s(t,e,i)},t[e(971)]=function(t,i){const s=e,n=t[0]/255,o=t[1]/255,h=t[2]/255,c=Math[s(1590)](n,o,h),l=c-Math[s(2219)](n,o,h);let d;d=0===l?0:c===n?(o-h)/l%6:c===o?(h-n)/l+2:(n-o)/l+4,d=Math.round(60*d),d<0&&(d+=360);const u=(0,a.s)(0===c?0:l/c,2),m=(0,a.s)(c,2);return void 0!==i&&(0===u||0===m)&&(d=i),r[s(2132)](d,u,m)},t[e(610)]=function(t){const i=e,s=o[i(1785)](),n=t[0]/255,r=t[1]/255,a=t[2]/255,h=Math.max(n,r,a),c=Math.min(n,r,a),l=h-c,d=(h+c)/2;return s[0]=0===l?0:h===n?(r-a)/l%6:h===r?(a-n)/l+2:(n-r)/l+4,s[0]=Math.round(60*s[0]),s[0]<0&&(s[0]+=360),s[1]=0===l?0:l/(1-Math[i(869)](2*d-1)),s[2]=d,s},t.toRgba=function(t,i){return n[e(553)](t[0],t[1],t[2],i)}}(s||(s={})),function(t){const e=a2_0x4755;function i(){const t=a2_0x4755,e=new Float32Array(4);return e.type=t(1793),e}function n(t,e,s,n=255){const o=i();return o[0]=t,o[1]=e,o[2]=s,o[3]=n,o}t[e(322)]=i,t[e(553)]=n,t.createReadonlyRgbaColor=function(t,e,i,s=255){return n(t,e,i,s)},t[e(1999)]=function(t){return s[e(1957)](t[0],t[1],t[2])}}(n||(n={})),function(t){const e=a2_0x4755;function i(){const t=a2_0x4755,e=new Float32Array(3);return e[t(335)]=t(1706),e}function s(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}t[e(1785)]=i,t[e(1292)]=s,t.createReadonlyHslColor=function(t,e,i){return s(t,e,i)},t[e(880)]=function(t,i=255){const s=e,o=n[s(322)]();o[3]=i;const r=(1-Math[s(869)](2*t[2]-1))*t[1],a=r*(1-Math.abs(t[0]/60%2-1)),h=t[2]-r/2;return t[0]<60?(o[0]=r,o[1]=a,o[2]=0):t[0]<120?(o[0]=a,o[1]=r,o[2]=0):t[0]<180?(o[0]=0,o[1]=r,o[2]=a):t[0]<240?(o[0]=0,o[1]=a,o[2]=r):t[0]<300?(o[0]=a,o[1]=0,o[2]=r):(o[0]=r,o[1]=0,o[2]=a),o[0]=Math.round(255*(o[0]+h)),o[1]=Math[s(1266)](255*(o[1]+h)),o[2]=Math.round(255*(o[2]+h)),o}}(o||(o={})),function(t){const e=a2_0x4755;function i(){const t=a2_0x4755,e=new Float32Array(3);return e[t(335)]=t(444),e}function o(t,e,s){const n=i();return n[0]=t,n[1]=e,n[2]=s,n}function r(t){const i=e,n=s[i(1750)](),o=t[2]*t[1],r=o*(1-Math[i(869)](t[0]/60%2-1)),a=t[2]-o;return t[0]<60?(n[0]=o,n[1]=r,n[2]=0):t[0]<120?(n[0]=r,n[1]=o,n[2]=0):t[0]<180?(n[0]=0,n[1]=o,n[2]=r):t[0]<240?(n[0]=0,n[1]=r,n[2]=o):t[0]<300?(n[0]=r,n[1]=0,n[2]=o):(n[0]=o,n[1]=0,n[2]=r),n[0]=Math[i(1266)](255*(n[0]+a)),n[1]=Math[i(1266)](255*(n[1]+a)),n[2]=Math[i(1266)](255*(n[2]+a)),n}t[e(661)]=i,t[e(1473)]=o,t[e(2132)]=function(t,e,i){return o(t,e,i)},t[e(1999)]=r,t[e(880)]=function(t,i=255){const s=e,o=r(t);return n[s(553)](o[0],o[1],o[2],(0,a.u)(i,255,0))}}(r||(r={}))},1815:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{v:()=>n,B:()=>o});class n{constructor(t){const e=a2_0x4755;this._options=t,this[e(1484)]=[],this[e(1809)]=!1}get[s(2220)](){const t=s;return!this[t(1494)]&&(this[t(1494)]=e=>{const i=t;return 0===this[i(1484)].length&&this[i(645)]&&this[i(645)].onFirstListenerAdd&&this[i(645)][i(1346)](),this[i(1484)][i(1378)](e),{dispose:()=>{const t=i;if(!this[t(1809)])for(let i=0;i<this[t(1484)][t(1840)];i++)if(this[t(1484)][i]===e)return this[t(1484)][t(558)](i,1),void(0===this[t(1484)][t(1840)]&&this[t(645)]&&this[t(645)][t(1217)]&&this[t(645)][t(1217)]())}}}),this[t(1494)]}[s(393)](t,e){const i=s,n=[];for(let t=0;t<this[i(1484)].length;t++)n[i(1378)](this._listeners[t]);for(let s=0;s<n[i(1840)];s++)n[s][i(456)](void 0,t,e)}async fireAndWait(t,e){const i=s,n=[];for(let t=0;t<this[i(1484)].length;t++)n[i(1378)](this._listeners[t]);for(let s=0;s<n[i(1840)];s++)await n[s][i(456)](void 0,t,e)}[s(1676)](){const t=s;this[t(1484)]&&(this._listeners[t(1840)]=0),this[t(1809)]=!0}}function o(t,e){const i=s;return t(((t,s)=>e[i(393)](t,s)))}},7166:(t,e,i)=>{"use strict";i.d(e,{uF:()=>n,Qf:()=>o,M_:()=>r});var s=i(1003);function n(t,e){const i=a2_0x4755,s=typeof t===i(383)?t:t[i(1436)];return e="number"==typeof t?e:t[i(741)],{data:new Uint8Array(new(i(320)in window?SharedArrayBuffer:ArrayBuffer)(s*e*4)),width:s,height:e}}function o(t,e){const i=a2_0x4755,n=(0,s.Oq)(e),o=(0,s.rY)(e),r=new Uint8Array(n*o*4);let a=0,h=0;for(let s=0;s<o;s++)h=s+e[i(1116)],a=4*(h*t[i(1436)]+e[i(1161)]),r[i(475)](t[i(1675)][i(2003)](a,a+4*n),s*n*4);return r}function r(t,e,i,s,n=!0){const o=a2_0x4755;if(!n&&e<s&&t<i)return{left:Math[o(1266)]((i-t)/2),top:Math[o(1266)]((s-e)/2),width:t,height:e};const r={left:0,top:0,width:i,height:s};if(e>t){const s=t/e;r[o(1161)]=Math[o(1266)](i*(.5-s/2)),r[o(1436)]=Math.round(i*s)}else if(t>e){const i=e/t;r.top=Math[o(1266)](s*(.5-i/2)),r.height=Math[o(1266)](s*i)}return r}},5120:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{JT:()=>o,OF:()=>r,_c:()=>a,Lw:()=>h});var n=i(1815);class o{constructor(){const t=a2_0x4755;this[t(1358)]=[],this[t(825)]=!1,this[t(2161)]=this.register(new n.v),this.onDispose=this._onDispose[t(2220)]}[s(1676)](){const t=s;if(this[t(825)])throw new Error("Attempt to dispose a disposed entity");this[t(2161)].fire(),this[t(825)]=!0;for(const e of this[t(1358)])e[t(1676)]();this[t(1358)].length=0}[s(1075)](t){const e=s;return this._disposables[e(1378)](t),t}[s(2049)](t){const e=s,i=this[e(1358)].indexOf(t);-1!==i&&this[e(1358)][e(558)](i,1)}}function r(t){return{dispose:t}}function a(t){const e=s;if(t){for(const i of t)i[e(1676)]();t[e(1840)]=0}}function h(t,e,i,s){t.addEventListener(e,i);let n=!1;return{dispose:()=>{n||(n=!0,t[a2_0x4755(951)](e,i,s))}}}},2939:(t,e,i)=>{"use strict";function s(t,e,i=0){return Math[a2_0x4755(1590)](Math.min(t,e),i)}function n(t,e){const i=a2_0x4755,s=Math[i(524)](10,e);return Math[i(1266)](t*s)/s}i.d(e,{u:()=>s,s:()=>n})},116:(t,e,i)=>{"use strict";i.d(e,{d:()=>n,W:()=>o});var s=i(7166);function n(t){const e=a2_0x4755;return"object"==typeof t&&e(947)in t?t:{resource:t,readyPromise:Promise[e(2177)](t),isReady:!0}}function o(t,e){let i,n;const o=new Promise(((t,e)=>{i=t,n=e})),r=(0,s.uF)(t,e);return{image:{isReady:!1,readyPromise:o,resource:r},resource:r,resolve:i,reject:n}}},7896:(t,e,i)=>{"use strict";const s=a2_0x4755;i.d(e,{V5:()=>n,jn:()=>o});const n=[s(1426),s(1305),s(1866),s(733)][s(463)](navigator[s(388)]),o=([s(1808),s(1138),s(1576),s(1064)][s(463)](navigator[s(388)]),"vscode-webview:"===window[s(805)][s(1154)])},1003:(t,e,i)=>{"use strict";function s(t){const e=a2_0x4755;if(t)return{left:t[e(1161)],top:t.top,right:t[e(594)],bottom:t[e(2077)]}}function n(){return{left:-1,top:-1,right:-1,bottom:-1}}function o(t,e){return{left:t,top:e,right:t+1,bottom:e+1}}function r(t,e){return{left:0,top:0,right:t,bottom:e}}function a(t,e,i,s){const n=a2_0x4755,o=y({left:t,top:e,right:i,bottom:s});return o.right++,o[n(2077)]++,o}function h(t,e){const i=a2_0x4755;return c(t)?s(e):c(e)?s(t):{left:Math[i(2219)](t[i(1161)],e[i(1161)]),top:Math[i(2219)](t[i(1116)],e[i(1116)]),right:Math[i(1590)](t[i(594)],e.right),bottom:Math[i(1590)](t[i(2077)],e[i(2077)])}}function c(t){const e=a2_0x4755;return t.left===t[e(594)]||t[e(1116)]===t.bottom}function l(t,e){const i=a2_0x4755;return t[i(1161)]=Math.min(Math[i(1590)](t[i(1161)],e[i(1161)]),e[i(594)]),t[i(1116)]=Math[i(2219)](Math[i(1590)](t[i(1116)],e[i(1116)]),e[i(2077)]),t[i(594)]=Math[i(1590)](Math[i(2219)](t[i(594)],e.right),e[i(1161)]),t[i(2077)]=Math[i(1590)](Math[i(2219)](t[i(2077)],e[i(2077)]),e[i(1116)]),t}function d(t){const e=a2_0x4755;return t[e(1161)]=Math[e(1727)](t[e(1161)]),t.right=Math[e(1651)](t[e(594)]),t[e(1116)]=Math[e(1727)](t[e(1116)]),t[e(2077)]=Math.ceil(t[e(2077)]),t}function u(t,e,i){const s=a2_0x4755,n=e-t[s(1161)],o=i-t[s(1116)];t[s(1161)]=t[s(1161)]+n,t[s(594)]=t[s(594)]+n,t[s(1116)]=t[s(1116)]+o,t[s(2077)]=t.bottom+o}function m(t,e,i){const s=a2_0x4755;if(c(t))return t[s(1161)]=e,t.right=e+1,t.top=i,void(t[s(2077)]=i+1);t.left=Math[s(2219)](t[s(1161)],e),t.top=Math[s(2219)](t[s(1116)],i),t.right=Math[s(1590)](t.right,e+1),t[s(2077)]=Math[s(1590)](t[s(2077)],i+1)}function g(t,e){const i=a2_0x4755;return t[i(1161)]===e[i(1161)]&&t[i(1116)]===e[i(1116)]&&t[i(594)]===e[i(594)]&&t[i(2077)]===e[i(2077)]}function f(t,e,i){const s=a2_0x4755;return e>=t[s(1161)]&&e<t[s(594)]&&i>=t[s(1116)]&&i<t[s(2077)]}function p(t,e){const i=a2_0x4755;return e.left>=t[i(1161)]&&e.right<=t[i(594)]&&e.top>=t[i(1116)]&&e.bottom<=t[i(2077)]}function _(t,e){const i=a2_0x4755;return!(t[i(2077)]<e[i(1116)]||t.top>e.bottom||t[i(594)]<e[i(1161)]||t[i(1161)]>e[i(594)])}function y(t){const e=a2_0x4755;if(t[e(1161)]>t[e(594)]){const i=t.right;t[e(594)]=t[e(1161)],t.left=i}if(t[e(1116)]>t[e(2077)]){const i=t[e(2077)];t[e(2077)]=t[e(1116)],t[e(1116)]=i}if(t[e(594)]<t[e(1161)]){const i=t[e(1161)];t[e(1161)]=t.right,t[e(594)]=i}if(t.bottom<t[e(1116)]){const i=t[e(1116)];t[e(1116)]=t[e(2077)],t[e(2077)]=i}return t}function w(t){const e=a2_0x4755;return(t[e(594)]-t[e(1161)])*(t[e(2077)]-t.top)}function v(t){const e=a2_0x4755;return(t[e(594)]-t[e(1161)])/(t.bottom-t[e(1116)])}function b(t){const e=a2_0x4755;return"("+t.left+","+t[e(1116)]+e(1794)+t[e(594)]+","+t[e(2077)]+")"}function x(t){return t.right-t.left}function I(t){const e=a2_0x4755;return t[e(2077)]-t[e(1116)]}i.d(e,{BN:()=>s,Pq:()=>n,Re:()=>o,DI:()=>r,tH:()=>a,qi:()=>h,Bu:()=>c,l$:()=>l,kq:()=>d,Hd:()=>u,Hv:()=>m,ap:()=>g,RB:()=>f,ur:()=>p,b8:()=>_,FJ:()=>y,U6:()=>w,n3:()=>v,PW:()=>b,Oq:()=>x,rY:()=>I})},7605:(t,e,i)=>{"use strict";i.d(e,{t:()=>n,e:()=>o});var s=i(4371);function n(t){const e=a2_0x4755;if(!t||typeof t!==e(1907))return t;const i={};for(const o of Object[e(473)](t)){const r=t[o];typeof r===e(1907)?"readyPromise"in r?i[o]=(s=r,{dataType:a2_0x4755(1280),data:n(s.resource)}):r instanceof Float32Array?i[o]=a(r,e(1692)):r instanceof Uint8Array?i[o]=a(r,e(1234)):r instanceof Uint16Array?i[o]=a(r,e(1057)):r instanceof Uint32Array?i[o]=a(r,e(1948)):i[o]=r:i[o]=r}var s;return i}function o(t){const e=a2_0x4755;if(!t||"object"!=typeof t||(0,s.fU)(t))return t;const i={};for(const s of Object.keys(t)){const n=t[s];typeof n!==e(1907)||Array[e(2160)](n)?i[s]=n:e(876)in n?n[e(876)]===e(1280)?i[s]=r(n):i[s]=h(n):i[s]=o(n)}return i}function r(t){const e=a2_0x4755,i=o(t[e(1675)]);return{resource:i,readyPromise:Promise[e(2177)](i),isReady:!0}}function a(t,e){return{dataType:e,data:Array[a2_0x4755(2098)](t)}}function h(t){const e=a2_0x4755;return new(self[t[e(876)]])(t[e(1675)])}}},e={};function i(s){const n=a2_0x4755;var o=e[s];if(void 0!==o)return o[n(538)];var r=e[s]={exports:{}};return t[s](r,r[n(538)],i),r[n(538)]}i.m=t,i.n=t=>{const e=a2_0x4755;var s=t&&t.__esModule?()=>t[e(909)]:()=>t;return i.d(s,{a:s}),s},i.d=(t,e)=>{const s=a2_0x4755;for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object[s(708)](t,n,{enumerable:!0,get:e[n]})},i.f={},i.e=t=>{const e=a2_0x4755;return Promise[e(1326)](Object[e(473)](i.f).reduce(((e,s)=>(i.f[s](t,e),e)),[]))},i.u=t=>""+t+a2_0x4755(358),(()=>{const t=a2_0x4755;i[t(978)]=e=>(6122===e?t(1450):e)+".css"})(),i.g=function(){const t=a2_0x4755;if(typeof globalThis===t(1907))return globalThis;try{return this||new Function(t(353))()}catch(e){if(typeof window===t(1907))return window}}(),(()=>{const t=a2_0x4755;i.o=(e,i)=>Object[t(2169)][t(941)].call(e,i)})(),(()=>{const t=a2_0x4755;var e={},s=t(1467);i.l=(n,o,r,a)=>{const h=t;if(e[n])e[n][h(1378)](o);else{var c,l;if(void 0!==r)for(var d=document.getElementsByTagName("script"),u=0;u<d[h(1840)];u++){var m=d[u];if(m.getAttribute(h(1914))==n||m[h(727)](h(1268))==s+r){c=m;break}}!c&&(l=!0,(c=document[h(1132)](h(937))).charset=h(728),c[h(612)]=120,i.nc&&c[h(1605)](h(1398),i.nc),c[h(1605)](h(1268),s+r),c.src=n),e[n]=[o];var g=(t,i)=>{const s=h;c[s(1404)]=c.onload=null,clearTimeout(f);var o=e[n];if(delete e[n],c[s(1073)]&&c.parentNode.removeChild(c),o&&o.forEach((t=>t(i))),t)return t(i)},f=setTimeout(g[h(950)](null,void 0,{type:"timeout",target:c}),12e4);c[h(1404)]=g.bind(null,c[h(1404)]),c.onload=g[h(950)](null,c[h(1413)]),l&&document[h(1611)][h(984)](c)}}})(),i.r=t=>{const e=a2_0x4755;"undefined"!=typeof Symbol&&Symbol[e(1492)]&&Object[e(708)](t,Symbol.toStringTag,{value:e(905)}),Object[e(708)](t,"__esModule",{value:!0})},(()=>{const t=a2_0x4755;var e;i.g[t(546)]&&(e=i.g[t(805)]+"");var s=i.g[t(1722)];if(!e&&s&&(s[t(1771)]&&(e=s[t(1771)].src),!e)){var n=s[t(2197)]("script");n[t(1840)]&&(e=n[n[t(1840)]-1][t(1914)])}if(!e)throw new Error(t(1114));e=e[t(1257)](/#.*$/,"")[t(1257)](/\?.*$/,"")[t(1257)](/\/[^\/]+$/,"/"),i.p=e})(),(()=>{const t=a2_0x4755;var e={6122:0};i.f.j=(t,s)=>{const n=a2_0x4755;var o=i.o(e,t)?e[t]:void 0;if(0!==o)if(o)s[n(1378)](o[2]);else{var r=new Promise(((i,s)=>o=e[t]=[i,s]));s[n(1378)](o[2]=r);var a=i.p+i.u(t),h=new Error;i.l(a,(s=>{const r=n;if(i.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var a=s&&(s[r(335)]===r(1729)?r(769):s.type),c=s&&s.target&&s[r(440)][r(1914)];h[r(1020)]=r(1013)+t+r(1334)+a+": "+c+")",h[r(1680)]=r(429),h.type=a,h.request=c,o[1](h)}}),n(651)+t,t)}};var s=(t,s)=>{const n=a2_0x4755;var o,r,[a,h,c]=s,l=0;if(a[n(1287)]((t=>0!==e[t]))){for(o in h)i.o(h,o)&&(i.m[o]=h[o]);c&&c(i)}for(t&&t(s);l<a[n(1840)];l++)r=a[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0},n=self.webpackChunkluna=self.webpackChunkluna||[];n[t(776)](s[t(950)](null,0)),n[t(1378)]=s[t(950)](null,n.push[t(950)](n))})(),(()=>{"use strict";const t=a2_0x4755;var e=i(5120),s=i(1003),n=i(1815);class o extends e.JT{constructor(t){const e=a2_0x4755;super(),this._config=t,this[e(1035)]=this[e(1075)](new n.v),this[e(2071)]=this._onConfigChanged[e(2220)]}get config(){return this._config}set[t(1329)](e){const i=t;!this._configEquals(e)&&(this[i(689)]=e,this[i(1035)][i(393)](this._config))}_configEquals(e){const i=t,s=Object[i(473)](this[i(689)]);if(s.length!==Object.keys(e)[i(1840)])return!1;for(const t of s)if(this[i(689)][t]!==e[t])return!1;return!0}}class r extends e.JT{constructor(){const e=t;super(...arguments),this._onAttach=this.register(new n.v),this[e(1826)]=this[e(424)][e(2220)]}attach(e){const i=t;this.element=e,this[i(424)].fire(this[i(1885)])}}class a{constructor(){const e=t;this.type=e(1913),this[e(709)]=e(1530),this[e(510)]=0}[t(1348)](){return{id:t(1965)}}static[t(1182)](t){return new a}}class h extends e.JT{constructor(){const e=t;super(),this[e(1216)]=[],this[e(1964)]=-1,this[e(1550)]=new Map,this[e(734)]=new Map,this[e(627)]=this[e(1075)](new n.v),this[e(2051)]=this[e(627)][e(2220)],this[e(1223)]=this[e(1075)](new n.v),this[e(544)]=this._onUndo[e(2220)],this[e(334)]=this[e(1075)](new n.v),this[e(566)]=this[e(334)][e(2220)],this[e(1508)]=this[e(1075)](new n.v),this[e(2174)]=this[e(1508)][e(2220)],this.registerHistoryEntryHandler(e(1453),{undo:t=>t[e(1652)](),redo:t=>t[e(772)]()}),this[e(2085)](e(1540),(t=>this._restoreCompositeEntry(t))),this[e(2085)](e(1965),a[e(1182)])}get[t(1573)](){const e=t;return this[e(1216)][this[e(1964)]]}get entries(){return this[t(1216)]}get canUndo(){return this[t(1216)].length>1&&0!==this._currentEntryPointer}get[t(1872)](){const e=t;return this[e(1216)][e(1840)]>1&&this[e(1964)]!==this[e(1216)].length-1}addEntry(e,i){const s=t;if(this[s(314)]){if(e[s(335)]===s(1540))throw new Error(s(1959));if(e[s(335)]===s(1913))throw new Error(s(454));this._currentCompositeEntry.push(e)}else this[s(1216)][++this[s(1964)]]=e,this[s(1216)].length=this[s(1964)]+1,!i&&this._onEntriesChange[s(393)](!0)}async[t(1422)](t){const e=await t.run();e&&this.addEntry(e)}[t(1986)](t){const e=t.run();e&&this.addEntry(e)}[t(895)](){const e=t;this[e(1964)]=-1,this[e(314)]=void 0,this._entries[e(1840)]=0,this[e(627)][e(393)](!0)}async[t(1652)](){const e=t;if(-1===this[e(1964)])throw new Error(e(1443));const i=this._entries[this[e(1964)]];if(i[e(335)]===e(1913))throw new Error("Cannot undo readonly entry");if(this[e(1964)]--,await this[e(913)](i),i.type===e(1540)){const t=i[e(1953)];for(let i=t[e(1840)]-1;i>=0;i--)await this[e(1550)][e(781)](t[i][e(335)])[e(1652)](t[i])}else await this[e(1550)][e(781)](i[e(335)])[e(1652)](i);this[e(627)][e(393)](!1),this._onUndo.fire(i)}async redo(){const e=t;if(this[e(1216)][e(1840)]<=this._currentEntryPointer+1)throw new Error(e(1433));const i=this[e(1216)][this[e(1964)]+1];if(i[e(335)]===e(1913))throw new Error(e(752));if(this[e(1964)]++,await this._requestToolIfNeeded(i),"composite"===i[e(335)])for(const t of i[e(1953)])await this[e(1550)][e(781)](t[e(335)])[e(772)](t);else await this[e(1550)][e(781)](i.type)[e(772)](i);this[e(627)][e(393)](!1),this[e(334)][e(393)](i)}async createCompositeEntry(e,i){const s=t;if(this[s(314)])return i();this[s(314)]=[];try{await i()}catch(t){return console[s(1053)](s(1016),t),void this[s(2002)](e+s(390))}this[s(2002)](e)}[t(922)](e,i){const s=t;if(this[s(314)])return i();this[s(314)]=[];try{i()}catch(t){return console[s(1053)](s(1016),t),void this[s(2002)](e+s(390))}this[s(2002)](e)}_finishCompositeEntry(e){const i=t;if(!this._currentCompositeEntry)throw new Error(i(1627));const s=this[i(314)];this[i(314)]=void 0;const n=s[i(1056)](((t,e)=>e[i(510)]>t?e[i(510)]:t),0),o={type:i(1540),operationName:e,entries:s,pixelCount:n,serialize:()=>this[i(1418)](o)};this[i(1828)](o)}registerHistoryEntryHandler(e,i){const s=t;if(this[s(1550)][s(781)](e))throw new Error("History entry type "+e+" has already been registered");this[s(1550)][s(475)](e,i)}[t(2085)](e,i){const s=t;if(this._entryFactories[s(781)](e))throw new Error(s(2023)+e+s(2158));this[s(734)].set(e,i)}[t(1348)](e=0){const i=t;try{for(const t of this._entries)if(t[i(510)]>e)throw new Error(i(1522)+t[i(709)]+i(943)+t[i(510)]+" > "+e+")");const t=[];for(const e of this[i(1216)]){if(!e[i(1348)])throw new Error(i(980));t.push(e[i(1348)]())}return{currentEntry:this[i(1964)],entries:t}}catch(t){return console.warn(i(1322),t),{currentEntry:0,entries:[]}}}[t(1101)](e){const i=t;for(const t of e.entries)try{this[i(1828)](this._restoreEntry(t),!0)}catch{this.addEntry(new a,!0)}this._currentEntryPointer=Math[i(2219)](e[i(1166)],this[i(1216)][i(1840)]-1),this[i(627)].fire(!1)}[t(1092)](e){const i=t;if(!e.id)throw new Error("No history entry ID to restore");const s=this[i(734)].get(e.id);if(!s)throw new Error(i(587)+e.id+'"');return s(e)}[t(1418)](e){const i=t;return{id:i(1540),operationName:e[i(709)],entries:e[i(1953)].map((t=>{const s=i;if(!t[s(1348)])throw console[s(1053)](s(867),e),new Error(s(1038));return t[s(1348)]()})),requiresTool:e[i(1253)]}}_restoreCompositeEntry(e){const i=t,s=[];for(const t of e.entries)s[i(1378)](this[i(1092)](t));const n=s[i(1056)](((t,e)=>e[i(510)]>t?e[i(510)]:t),0);try{const t={type:"composite",operationName:e.operationName,entries:s,pixelCount:n,requiresTool:e[i(1253)],serialize:()=>this[i(1418)](t)};return t}catch{return new a}}async _requestToolIfNeeded(e){const i=t;if(e.type===i(1540)){const t=e[i(1953)];for(let e=t[i(1840)]-1;e>=0;e--){const s=t[e];if(s[i(1253)])return void await this._onRequestTool[i(723)](s[i(1253)])}}else e[i(1253)]&&await this[i(1508)][i(723)](e[i(1253)])}}var c=i(4371),l=i(7517),d=i(2939),u=i(6495);class m{constructor(e,i,s){const n=t;this[n(709)]=e,this._initialIndex=i,this[n(1879)]=s,this[n(335)]=n(736),this[n(510)]=0}[t(1652)](e){g(this[t(1879)],this._initialIndex,e)}redo(e){const i=t;g(this[i(930)],this[i(1879)],e)}serialize(){return{id:"moveLayer",operationName:this[t(709)],initialIndex:this._initialIndex,targetIndex:this._targetIndex}}static[t(1182)](e){const i=t;return new m(e.operationName,e.initialIndex,e[i(981)])}}function g(e,i,s){const n=t;if(i>=s.list[n(1840)])return!1;const o=s.list[e];if(!o)return!1;for(s.currentLayer=e;i>s.currentLayer;)s[n(1601)][s[n(1284)]]=s[n(1601)][s[n(1284)]+1],s[n(1601)][++s[n(1284)]]=o;for(;i<s.currentLayer;)s.list[s[n(1284)]]=s[n(1601)][s[n(1284)]-1],s[n(1601)][--s[n(1284)]]=o;return s[n(833)][n(393)](),!0}class f{constructor(e,i,s){const n=t;this[n(925)]=e,this[n(1879)]=i,this[n(1539)]=s}[t(1997)](){const e=t;if(this[e(1879)]===this[e(1539)].currentLayer)return;const i=this[e(1539)][e(1284)]<this._targetIndex?-1:1;let s=!1;for(let t=this[e(1879)];t!==this[e(1539)].currentLayer;t+=i)if(!this._model.list[t][e(1512)]){s=!0;break}if(!s)return;const n=this[e(1539)][e(1284)];return g(n,this[e(1879)],this[e(1539)])?new m(this[e(925)],n,this[e(1879)]):void 0}}class p{constructor(e,i,s,n){const o=t;this[o(925)]=e,this[o(918)]=i,this[o(1879)]=s,this[o(1539)]=n}run(){const e=t,i=this._model[e(1601)][e(409)]((t=>t.id===this._layerId));if(-1===i||this[e(1879)]===i)return;const s=i<this._targetIndex?-1:1;let n=!1;for(let t=this._targetIndex;t!==i;t+=s)if(!this[e(1539)].list[t][e(1512)]){n=!0;break}return n&&g(i,this[e(1879)],this._model)?new m(this._operationName,i,this[e(1879)]):void 0}}class _ extends f{constructor(e,i,s){const n=t,o=i.list[i.currentLayer],r=i[n(1601)].filter((t=>!t.isSoftDeleted)),a=r[n(1993)](o)+s;(a<0||a>=r[n(1840)])&&super(e,i[n(1284)],i);const h=r[a];super(e,i[n(1601)].indexOf(h),i)}}class y extends _{constructor(t){super("Move Layer Up",t,1)}}class w extends _{constructor(e){super(t(1884),e,-1)}}var v=i(4852);class b{constructor(e,i,s){const n=t;this.operationName=e,this[n(466)]=i,this[n(918)]=s,this[n(335)]="singleLayer",this[n(510)]=0}async undo(e){const i=t,s=await e[i(331)](this[i(466)],this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);return s[i(1512)]=!1,s[i(541)].fire(),s}async[t(772)](e){const i=t,s=await e[i(331)](this[i(466)],this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);return s[i(1512)]=!0,s[i(541)].fire(),s}serialize(){const e=t;return{id:e(1001),operationName:this[e(709)],imageFileId:this[e(466)],layerId:this._layerId}}static[t(1182)](e){const i=t;return new b(e[i(709)],e.imageFileId,e[i(1365)])}}var x=i(8286),I=i(6628),S=i(3817),C=i(3089),E=i(707);class T{constructor(e,i,s){const n=t;this[n(709)]=e,this[n(1181)]=i,this._redoDimensions=s,this[n(335)]="resize",this.pixelCount=0}undo(e){const i=t;e(this[i(1181)][i(1436)],this[i(1181)][i(741)])}redo(e){const i=t;e(this[i(415)][i(1436)],this[i(415)].height)}[t(1348)](){const e=t;return{id:"imageResize",operationName:this[e(709)],undoDimensions:this._undoDimensions,redoDimensions:this[e(415)]}}static create(e){const i=t;return new T(e.operationName,e[i(1112)],e[i(1267)])}}class L{constructor(e,i,s,n,o,r){const a=t;this.operationName=e,this[a(466)]=i,this._layerId=s,this._tempLayerId=n,this[a(681)]=o,this[a(1095)]=r,this.type=a(2178),this[a(1253)]=a(1070),this.pixelCount=this[a(681)]*this[a(1095)]}async[t(1652)](e){const i=t,s=await e[i(331)](this._imageFileId,this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);const n=await e.getTempLayer(this[i(466)],this[i(918)],this[i(340)]);if(!n)throw new Error(i(1636)+this[i(918)]);return s.temporaryLayer=void 0,n[i(812)](),s[i(541)][i(393)](),s}async redo(e){const i=t,s=await e[i(331)](this[i(466)],this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);const n=await e[i(1220)](this[i(466)],this[i(918)],this[i(340)]);if(!n)throw new Error(i(1636)+this[i(918)]);return s[i(2217)]=n,n[i(344)](),s[i(541)][i(393)](),s}[t(1348)](){const e=t;return{id:"importBlob",operationName:this[e(709)],imageFileId:this[e(466)],layerId:this[e(918)],tempLayerId:this[e(340)],width:this._width,height:this[e(1095)]}}static[t(1182)](e){const i=t;return new L(e[i(709)],e[i(1040)],e.layerId,e[i(989)],e[i(1436)],e[i(741)])}}var A=i(4378),R=i(7605);class D{constructor(e,i,s,n,o){const r=t;this[r(709)]=e,this[r(466)]=i,this[r(918)]=s,this._undoImage=n,this[r(1622)]=o,this[r(335)]="singleLayer",this[r(510)]=this[r(405)][r(1436)]*this[r(405)][r(741)]}async undo(e){const i=t,s=await e.getLayer(this[i(466)],this[i(918)]);if(!s)throw new Error("Could not find layer "+this[i(918)]);return await s[i(1158)]((()=>this[i(405)])),s}async redo(e){const i=t,s=await e[i(331)](this[i(466)],this._layerId);if(!s)throw new Error(i(1085)+this[i(918)]);return await s[i(1158)]((()=>this[i(1622)])),s}[t(1348)](){const e=t;return{id:e(885),operationName:this.operationName,imageFileId:this._imageFileId,layerId:this._layerId,undoImage:(0,R.t)(this._undoImage),redoImage:(0,R.t)(this[e(1622)])}}static[t(1182)](e){const i=t;return new D(e[i(709)],e.imageFileId,e[i(1365)],(0,R.e)(e[i(707)]),(0,R.e)(e[i(2102)]))}}var M=i(1375);class B{constructor(e,i,s,n,o){const r=t;this[r(709)]=e,this[r(466)]=i,this[r(918)]=s,this[r(681)]=n,this._height=o,this[r(335)]=r(2178),this[r(510)]=this[r(681)]*this._height}async undo(e){const i=t,s=await e[i(331)](this[i(466)],this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);return s[i(1512)]=!0,s.onUpdateEmitter[i(393)](),s}async[t(772)](e){const i=t,s=await e.getLayer(this[i(466)],this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);return s[i(1512)]=!1,s[i(541)].fire(),s}serialize(){const e=t;return{id:e(719),operationName:this.operationName,imageFileId:this[e(466)],layerId:this[e(918)],width:this[e(681)],height:this[e(1095)]}}static create(e){const i=t;return new B(e[i(709)],e[i(1040)],e[i(1365)],e.width,e[i(741)])}}class k{constructor(e){const i=t;this[i(709)]=e,this[i(335)]=i(1913),this.pixelCount=0}[t(1348)](){const e=t;return{id:e(1301),operationName:this[e(709)]}}static[t(1182)](e){return new k(e[t(709)])}}class P{constructor(){const e=t;this.type=e(1913),this[e(709)]=e(654),this[e(510)]=0}serialize(){return{id:t(1641)}}static create(t){return new P}}class U{constructor(e,i,s,n){const o=t;this._imageFileId=e,this[o(918)]=i,this[o(1875)]=s,this[o(611)]=n,this.type=o(2178),this[o(510)]=0,this[o(709)]="Layer Blend Mode: "+function(e){const i=t;return e[i(2218)](0,1).toUpperCase()+e[i(2218)](1)}(this._redoBlendMode)}async undo(e){const i=t,s=await e[i(331)](this[i(466)],this._layerId);if(!s)throw new Error("Could not find layer "+this[i(918)]);return s[i(903)]=this[i(1875)],s}async[t(772)](e){const i=t,s=await e.getLayer(this[i(466)],this._layerId);if(!s)throw new Error(i(1085)+this[i(918)]);return s.blendMode=this[i(611)],s}[t(1348)](){const e=t;return{id:e(670),imageFileId:this[e(466)],layerId:this[e(918)],undoBlendMode:this[e(1875)],redoBlendMode:this[e(611)]}}static[t(1182)](e){const i=t;return new U(e.imageFileId,e[i(1365)],e[i(2123)],e[i(1598)])}}class F{constructor(e,i,s,n){const o=t;this._imageFileId=e,this._layerId=i,this._undoName=s,this[o(1903)]=n,this[o(335)]=o(2178),this[o(510)]=0,this[o(709)]=o(1342)+function(e){const i=t;return e[i(2218)](0,1)[i(671)]()+e[i(2218)](1)}(this[o(1903)])}async[t(1652)](e){const i=t,s=await e[i(331)](this[i(466)],this[i(918)]);if(!s)throw new Error(i(1085)+this._layerId);return s[i(1680)]=this[i(626)],s}async[t(772)](e){const i=t,s=await e[i(331)](this._imageFileId,this[i(918)]);if(!s)throw new Error(i(1085)+this[i(918)]);return s[i(1680)]=this[i(1903)],s}[t(1348)](){const e=t;return{id:"setLayerName",imageFileId:this[e(466)],layerId:this[e(918)],undoName:this[e(626)],redoName:this._redoName}}static[t(1182)](e){const i=t;return new F(e[i(1040)],e[i(1365)],e[i(1904)],e[i(1130)])}}class O{constructor(e,i,s){const n=t;this._imageFileId=e,this[n(918)]=i,this._isVisible=s,this[n(335)]=n(2178),this.pixelCount=0,this[n(709)]=(this[n(1950)]?n(1240):"Hide")+n(1565)}async[t(1652)](e){const i=t,s=await e[i(331)](this._imageFileId,this._layerId);if(!s)throw new Error(i(1085)+this[i(918)]);return s[i(364)]=!this[i(1950)],s}async[t(772)](e){const i=t,s=await e[i(331)](this._imageFileId,this._layerId);if(!s)throw new Error(i(1085)+this._layerId);return s.isVisible=this[i(1950)],s}[t(1348)](){const e=t;return{id:"setLayerVisibility",imageFileId:this[e(466)],layerId:this[e(918)],isVisible:this._isVisible}}static[t(1182)](e){const i=t;return new O(e[i(1040)],e[i(1365)],e[i(364)])}}var N=i(8549),V=i(116);class H{constructor(e,i){const s=t;this._blendMode=e,this[s(1902)]=i}[t(1997)](){const e=t;if(this._layer[e(903)]===this[e(685)])return;const i=this[e(1902)][e(903)];return this._layer[e(903)]=this[e(685)],new U(this._layer[e(1040)],this[e(1902)].id,i,this[e(685)])}}class z{constructor(e,i){const s=t;this[s(1387)]=e,this[s(1902)]=i}[t(1997)](){const e=t;if(this[e(1902)][e(1680)]===this[e(1387)])return;const i=this._layer[e(1680)];return this[e(1902)].name=this[e(1387)],new F(this[e(1902)].imageFileId,this._layer.id,i,this[e(1387)])}}class W{constructor(e,i){const s=t;this[s(1950)]=e,this[s(1902)]=i}run(){const e=t;if(this[e(1902)].isVisible!==this[e(1950)])return this[e(1902)][e(364)]=this._isVisible,new O(this[e(1902)].imageFileId,this[e(1902)].id,this._isVisible)}}var j=i(6785);class q extends e.JT{constructor(e,i,o,r,a){const h=t;super(),this[h(1902)]=e,this[h(483)]=i,this[h(681)]=o,this[h(1095)]=r,this[h(1551)]=a,this[h(471)]=0,this[h(665)]=new Set,this[h(642)]=(0,s.Pq)(),this[h(1742)]=(0,s.Pq)(),this[h(1711)]=this[h(1075)](new n.v),this[h(835)]=this[h(1711)][h(2220)],this[h(1789)]=this.register(new n.v),this[h(1208)]=this[h(1789)][h(2220)],this[h(542)]={colorData:new Uint8Array(200),indexList:(0,c.X$)(50,this._width*this[h(1095)]*4)},this[h(347)]={colorData:new Uint8Array(200),indexList:(0,c.X$)(50,this._width*this[h(1095)]*4)}}[t(2099)](e,i,n,o){const r=t;if(e<0||e>=this[r(681)])return;const a=i*this[r(681)]+e;if(this[r(665)][r(1225)](a))return;this[r(665)][r(1769)](a),(0,s.Hv)(this[r(1742)],e,i),this[r(471)]>=this[r(542)][r(1071)][r(1840)]&&(this[r(542)][r(1071)]=(0,c.Rs)(this[r(542)].indexList),this[r(542)][r(1355)]=(0,c.Rs)(this[r(542)][r(1355)]),this[r(347)].indexList=(0,c.Rs)(this[r(347)][r(1071)]),this[r(347)][r(1355)]=(0,c.Rs)(this[r(347)].colorData));const h=4*(i*this[r(681)]+e),d=4*this[r(471)];this._undoData[r(1071)][this[r(471)]]=h,this._undoData.colorData[d]=this[r(483)][h],this[r(542)][r(1355)][d+1]=this[r(483)][h+1],this[r(542)][r(1355)][d+2]=this[r(483)][h+2],this[r(542)][r(1355)][d+3]=this[r(483)][h+3],this[r(347)][r(1071)][this[r(471)]]=h,o?((0,l.B)(o,this[r(483)],h,n,0),this[r(347)][r(1355)][d]=this._data[h],this[r(347)][r(1355)][d+1]=this._data[h+1],this[r(347)][r(1355)][d+2]=this[r(483)][h+2],this._redoData.colorData[d+3]=this[r(483)][h+3]):(this[r(347)].colorData[d]=this[r(483)][h]=n[0],this._redoData[r(1355)][d+1]=this[r(483)][h+1]=n[1],this[r(347)].colorData[d+2]=this[r(483)][h+2]=n[2],this[r(347)][r(1355)][d+3]=this[r(483)][h+3]=n[3]),this[r(471)]++}[t(1105)](e,i,s,n,o){const r=t,a=Math[r(1727)]((s-1)/2),h=s%2==0?1:0;let c=a,l=0,d=1-a;for(n?(this[r(1007)](e-a,e+a+h,i,o),h&&this._setHorizontalLine(e-a,e+a+h,i+1,o)):(this[r(2099)](e+a+h,i,o),this[r(2099)](e-a,i,o),h&&(this[r(2099)](e+a+h,i+1,o),this[r(2099)](e-a,i+1,o))),this[r(2099)](e,i+a+h,o),this[r(2099)](e,i-a,o);c>l&&(l++,d<=0?d=d+2*l+1:(c--,d=d+2*i-2*e+1),!(c<l));)n?(this[r(1007)](e-c,e+c+h,i+l+h,o),this[r(1007)](e-c,e+c+h,i-l,o),this._setHorizontalLine(e-l,e+l+h,i+c+h,o),this[r(1007)](e-l,e+l+h,i-c,o)):(this[r(2099)](e+c+h,i+l+h,o),this[r(2099)](e-c,i+l+h,o),this.setPixel(e+c+h,i-l,o),this.setPixel(e-c,i-l,o),this[r(2099)](e+l,i+c+h,o),this[r(2099)](e-l,i+c+h,o),this.setPixel(e+l,i-c,o),this[r(2099)](e-l,i-c,o))}[t(1007)](e,i,s,n){const o=t;for(let t=e;t<=i;t++)this[o(2099)](t,s,n),this[o(2099)](t,s,n)}[t(1295)](){const e=t;(0,s.Bu)(this._rangeNotYetRequested)||(this[e(642)]=(0,s.qi)(this[e(642)],this[e(1742)]),this[e(1711)][e(393)](this[e(1742)]),this[e(1742)]=(0,s.Pq)())}[t(1061)](e){const i=t,s={indexList:this[i(542)][i(1071)][i(2003)](0,this._pointCount),colorData:this._undoData[i(1355)][i(2003)](0,4*this[i(471)])},n={indexList:this._redoData[i(1071)][i(2003)](0,this[i(471)]),colorData:this[i(347)][i(1355)][i(2003)](0,4*this._pointCount)},o=new j.x(e,this[i(1902)][i(1040)],this[i(1902)].id,this._range,s,n);this[i(1551)][i(1828)](o),this[i(1789)][i(393)](this[i(642)])}}var G=i(270),X=i(6815);class Y extends e.JT{constructor(e,i,s,o,r,a,h,c,l,d){const u=t;super(),this[u(1551)]=e,this[u(1104)]=i,this[u(799)]=s,this.id=o,this[u(1040)]=r,this[u(1387)]=a,this[u(1047)]=h,this[u(1675)]=c,this[u(1436)]=l,this[u(741)]=d,this[u(1325)]=!1,this[u(685)]=u(1310),this[u(1950)]=!0,this[u(1011)]=!1,this[u(1987)]=!1,this[u(541)]=this[u(1075)](new n.v),this[u(835)]=this.onUpdateEmitter[u(2220)],this[u(1745)]=this.register(new n.v),this[u(575)]=this._onSoftDeletedChange[u(2220)],this[u(2146)]=this[u(1075)](new n.v),this[u(1806)]=this[u(2146)].event,this._onVisibilityChange=this[u(1075)](new n.v),this[u(1024)]=this[u(730)][u(2220)],this[u(1462)]=this[u(1075)](new n.v),this.onRequestRender=this[u(1462)][u(2220)],this._onTemporaryLayerRegistered=this[u(1075)](new n.v),this.onTemporaryLayerRegistered=this[u(771)][u(2220)],this[u(1041)]=this.register(new n.v),this[u(731)]=this[u(1041)].event}get[t(1680)](){return this[t(1387)]}set name(e){const i=t;e!==this[i(1387)]&&(this[i(1387)]=e,this[i(541)][i(393)]())}get blendMode(){return this._blendMode}set[t(903)](e){const i=t;e!==this[i(685)]&&(this[i(685)]=e,this[i(541)][i(393)]())}get[t(1512)](){return this[t(1011)]}set[t(1512)](e){const i=t;e!==this[i(1011)]&&(this[i(1011)]=e,this[i(1745)].fire())}get[t(364)](){return this[t(1950)]}set[t(364)](e){const i=t;e!==this[i(1950)]&&(this[i(1950)]=e,this[i(730)].fire(),this[i(541)][i(393)]())}get contentRange(){const e=t;let i=this[e(741)]-1;t:for(let t=0;t<this[e(741)];t++)for(let s=0;s<this[e(1436)];s++)if(this[e(1675)][4*(t*this.width+s)+3]>0){i=t;break t}let s=i;t:for(let t=this[e(741)]-1;t>i;t--)for(let i=0;i<this[e(1436)];i++)if(this.data[4*(t*this[e(1436)]+i)+3]>0){s=t;break t}let n=this.width-1;t:for(let t=0;t<this[e(1436)];t++)for(let o=i;o<=s;o++)if(this[e(1675)][4*(o*this[e(1436)]+t)+3]>0){n=t;break t}let o=n;t:for(let t=this[e(1436)]-1;t>n;t--)for(let n=i;n<=s;n++)if(this[e(1675)][4*(n*this[e(1436)]+t)+3]>0){o=t;break t}return{left:n,top:i,right:o,bottom:s}}async edit(e){const i=t;this._startEdit();try{const t=await e(this.data,this[i(1436)],this[i(741)]),s={image:t&&"data"in t?t:void 0,range:t&&i(1161)in t?t:void 0};this[i(1777)](s)}catch(t){throw this._finishEdit({range:(0,s.DI)(this[i(1436)],this[i(741)])}),t}}[t(1151)](){const e=t;this[e(1786)]();const i=new q(this,this[e(1675)],this[e(1436)],this[e(741)],this._historyService);return(0,n.B)(i[e(835)],this.onUpdateEmitter),i.onCommit((t=>this[e(1777)]({range:t}))),i}async[t(1977)](e){const i=t;if(e[i(364)])return this[i(1551)].runAction(new u.Z("Merge",(0,s.DI)(this[i(1436)],this.height),this,(async(t,s,n)=>{const o=i;!this[o(364)]&&t[o(475)](e[o(1675)],0);let r=0;for(let i=0;i<n;i++)for(let n=0;n<s;n++)r=4*(i*s+n),(0,l.B)(e.blendMode,t,r,e[o(1675)],r)})))}async[t(1922)](e,i=!0){const s=t;await this[s(1860)](),this[s(2217)]=e,i&&((0,n.B)(e[s(613)],this[s(1462)]),e[s(1208)]((()=>this.temporaryLayer=void 0))),this[s(771)].fire(this[s(2217)])}unregisterTemporaryLayer(e){const i=t;this.temporaryLayer===e&&(this[i(2217)]=void 0),this[i(1041)][i(393)](e)}async[t(1860)](){const e=t;await(this.temporaryLayer?.[e(1061)]()),this.temporaryLayer=void 0}async[t(1392)](){const e=t;if(!this.temporaryLayer)return this.data;const i=new Uint8Array(new SharedArrayBuffer(this.data[e(1840)]));if(i[e(475)](this[e(1675)],0),this.temporaryLayer.type===e(355)){const t=this.temporaryLayer,s=await t.staticState[e(1273)][e(947)],n={left:t[e(1167)].offsetX,top:t[e(1167)][e(1517)],right:t[e(1167)][e(1574)]+s[e(1436)],bottom:t[e(1167)][e(1517)]+s[e(741)]};let o=0;for(let t=n[e(1116)];t<n[e(2077)];t++)for(let r=n[e(1161)];r<n[e(594)];r++){o=4*(t*this[e(1436)]+r);const a=4*((t-n[e(1116)])*s[e(1436)]+r-n[e(1161)]);(0,c.Yr)(i,o,s[e(1675)],a)}}else e(349)in this[e(2217)]&&await this[e(2217)][e(349)](i,this[e(1436)],this.height);return i}async[t(2156)](e={}){const i=t;let n,o;if(e?.useMovingLayer&&this[i(2217)]?.[i(335)]===i(355)){const t=this.temporaryLayer;n=await t.staticState[i(1273)][i(947)],o=(0,s.DI)(n.width,n.height)}else await this[i(1860)](),n=this,o=e[i(664)]||(0,s.DI)(this.width,this[i(741)]);return J(function(e,i){const n=t,o=(0,s.Oq)(i),r=(0,s.rY)(i);let a,h=0;if(o===e[n(1436)])h=i[n(1116)]*o*4,a=new Uint8ClampedArray(e.data[n(2003)](h,h+o*r*4));else{a=new Uint8ClampedArray(o*r*4);for(let t=i[n(1116)];t<i[n(1116)]+r;t++)h=4*(t*e[n(1436)]+i.left),a[n(475)](e[n(1675)][n(2003)](h,h+4*o),(t-i[n(1116)])*o*4)}return new ImageData(a,o,r)}(n,o),e)}async[t(919)](e,i){const n=t,o=await window.createImageBitmap(e);let r;"OffscreenCanvas"in window?r=new OffscreenCanvas(o[n(1436)],o[n(741)]):(r=document.createElement(n(1726)),r.width=o[n(1436)],r[n(741)]=o[n(741)]);const a=r[n(1499)]("2d");a[n(1910)](o,0,0);const h=a[n(1021)](0,0,o[n(1436)],o.height),c={data:new Uint8Array(h[n(1675)]),width:h[n(1436)],height:h.height};let l;const d=this[n(1104)][n(664)];l=d&&(0,s.Oq)(d)===h[n(1436)]&&(0,s.rY)(d)===h.height?(0,s.BN)(d):i&&(0,s.Oq)(i)===h[n(1436)]&&(0,s.rY)(i)===h.height?(0,s.BN)(i):(0,s.DI)(h[n(1436)],h[n(741)]);const u={image:(0,V.d)(c),range:l},m=new G.m(this,u,void 0,this[n(1551)],this[n(1104)],this[n(799)]);m[n(817)][n(1378)]({...m[n(1167)]}),await this[n(1922)](m),this._historyService[n(1828)](new L("Import Blob",this.imageFileId,this.id,m.id,m[n(624)].image[n(437)][n(1436)],m.staticState[n(1273)][n(437)][n(741)]));const g=(0,s.l$)((0,s.DI)(h[n(1436)],h[n(741)]),(0,s.DI)(this[n(1436)],this[n(741)]));return this[n(541)][n(393)](g),m}[t(1786)](){const e=t;if(this[e(1047)])throw new Error(e(1990));if(this[e(1325)])throw new Error(e(555));this[e(1325)]=!0}[t(1777)](e){const i=t;if(e){if(e?.[i(1273)]){const t=this.width!==e[i(1273)][i(1436)]||this.width!==e[i(1273)][i(1436)];this[i(1675)]=e[i(1273)][i(1675)],this[i(1436)]=e[i(1273)].width,this[i(741)]=e.image[i(741)],t&&this[i(2146)][i(393)](this[i(1436)],this.height)}this[i(541)][i(393)](e[i(664)]),this[i(1325)]=!1}else this[i(1325)]=!1}[t(670)](e){const i=t;this[i(1551)][i(1986)](new H(e,this))}setName(e){const i=t;this[i(1551)][i(1986)](new z(e,this))}[t(850)](e){const i=t;this[i(1551)][i(1986)](new W(e,this))}[t(1348)](){const e=t;return{id:this.id,name:this._name,data:Array[e(2098)](this[e(1675)]),blendMode:this[e(685)],isSoftDeleted:this[e(1011)],isVisible:this._isVisible}}}async function J(e,i={}){const s=t;if(i[s(1524)]?.[s(335)]===s(481)){const t=await(0,X.Vx)({data:new Uint8Array(e[s(1675)][s(1394)],e[s(1675)][s(569)],e[s(1675)][s(476)]),width:e[s(1436)],height:e[s(741)]});return new Blob([t[s(1675)]],{type:i.encodeOptions[s(335)]})}const n=await createImageBitmap(e);if(!("OffscreenCanvas"in window)){const t=document[s(1132)](s(1726));return t.width=n[s(1436)],t[s(741)]=n[s(741)],t[s(1499)]("2d")[s(1910)](n,0,0),new Promise(((e,n)=>{const o=s;t[o(1314)]((t=>{if(!t)return n(t);e(t)}),i.encodeOptions?.type,i.encodeOptions?.[o(362)])}))}const o=new OffscreenCanvas(n.width,n[s(741)]);return o[s(1499)]("2d").drawImage(n,0,0),o[s(447)](i[s(1524)])}class K extends e.JT{constructor(){const e=t;super(),this[e(1284)]=0,this.isReadonly=!1,this[e(1601)]=[],this[e(833)]=this[e(1075)](new n.v),this[e(643)]=this[e(833)][e(2220)]}}var $=i(2811),Z=i(807),Q=i(3670),tt=i(7233);class et extends e.JT{constructor(e,i,s){const o=t;super(),this[o(1551)]=e,this[o(1104)]=i,this[o(799)]=s,this[o(1436)]=0,this.height=0,this[o(942)]=0,this[o(1002)]=0,this._temporaryLayerIdCounter=0,this[o(801)]="image/png",this[o(692)]=0,this[o(403)]=new Map,this[o(1711)]=this[o(1075)](new n.v),this[o(835)]=this._onUpdate[o(2220)],this._onChangedDimensions=this.register(new n.v),this[o(1806)]=this[o(2146)][o(2220)],this[o(572)]=this[o(1075)](new n.v),this.onLayerChange=this[o(572)][o(2220)],this[o(1813)]=this[o(1075)](new n.v),this[o(1575)]=this[o(1813)][o(2220)],this._onRequestRender=this[o(1075)](new n.v),this[o(613)]=this[o(1462)][o(2220)],this[o(771)]=this[o(1075)](new n.v),this[o(948)]=this[o(771)][o(2220)],this[o(1041)]=this.register(new n.v),this[o(731)]=this[o(1041)][o(2220)],this[o(1822)]=this[o(1075)](new n.v),this[o(1642)]=this[o(1822)][o(2220)];const r=new K;(0,n.B)(r[o(643)],this._onLayerChange),this._layersModel=[r],this._historyService[o(873)](o(736),{undo:t=>t[o(1652)](this[o(2053)]),redo:t=>t.redo(this[o(2053)])}),this[o(1551)][o(873)](o(1924),{undo:t=>t.undo(this.resize[o(950)](this)),redo:t=>t[o(772)](this.resize[o(950)](this))}),this._historyService.registerHistoryEntryFactory(o(1301),k[o(1182)]),this[o(1551)][o(2085)](o(1510),A.$.create),this[o(1551)][o(2085)](o(885),D[o(1182)]),this._historyService[o(2085)]("imageResize",T[o(1182)]),this[o(1551)].registerHistoryEntryFactory(o(670),U.create),this[o(1551)][o(2085)](o(1481),F[o(1182)]),this[o(1551)][o(2085)](o(1748),O[o(1182)]),this[o(1551)][o(2085)](o(1001),b[o(1182)]),this._historyService[o(2085)]("newImage",B.create),this._historyService[o(2085)](o(468),m[o(1182)]),this[o(1551)][o(2085)](o(1641),P[o(1182)]),this._historyService.registerHistoryEntryFactory(o(919),L[o(1182)]),this[o(1551)][o(2085)](o(2120),N.i[o(1182)]),this[o(1551)].registerHistoryEntryFactory(o(702),v.S[o(1182)]),this._historyService.registerHistoryEntryFactory(o(439),x.Z.create),this._historyService.registerHistoryEntryFactory("finishMovePixels",I.$.create[o(950)](null,this[o(799)])),this._historyService[o(2085)]("moveSelectedPixels",M.C[o(1182)][o(950)](null,this[o(799)])),this._historyService.registerHistoryEntryFactory(o(1541),S.O[o(1182)]),this[o(1551)][o(2085)](o(977),C.o[o(1182)]),this[o(1551)][o(2085)](o(2138),E.o.create),this[o(948)]((t=>this[o(403)].set(t.id,t))),this.onTemporaryLayerUnregistered((t=>this._activeTemporaryLayers[o(1279)](t.id)))}get currentLayer(){const e=t;return this._activeLayersModel.list[this[e(2053)][e(1284)]]}get[t(1920)](){const e=t;return this._activeLayersModel[e(1601)].filter((t=>!t[e(1512)]))}get mimeType(){return this[t(801)]}set[t(1458)](e){const i=t;this[i(801)]=e,this[i(1822)][i(393)](e)}get[t(2053)](){return this[t(371)][this._activeLayersModelIndex]}serialize(e=0){const i=t;if(-1!==e&&this[i(1436)]*this[i(741)]>e)throw new Error(i(2028)+this[i(1436)]*this[i(741)]+i(690)+e+")");for(const t of this[i(403)][i(1060)]())if(t.canSerialize){const s=t[i(954)](e);if(s)throw new Error(s)}const s=[];for(const t of this._activeTemporaryLayers[i(1060)]())s[i(1378)](t.serialize());const n={dimensions:{width:this[i(1436)],height:this[i(741)]},currentLayer:this[i(2053)][i(1284)],imageFileId:this[i(942)],isReadonly:this[i(2053)].isReadonly,layers:this[i(2053)][i(1601)][i(688)]((t=>t[i(1348)]())),temporaryLayers:s,currentTemporaryLayerId:this[i(1284)]?.temporaryLayer?.id};if(0===n[i(1920)].length)throw new Error(i(487));return n}[t(1101)](e,i){const s=t;if(this.width=e[s(312)][s(1436)],this.height=e.dimensions.height,this.activeImageFileId=e[s(1040)],i&&(this[s(2053)][s(1601)][s(1840)]=0,this[s(403)].clear()),this[s(2053)][s(1601)][s(1840)]>0)throw new Error("Cannot restore layers when layer(s) exist");for(const t of e[s(1920)]){const i=new Y(this._historyService,this[s(1104)],this[s(799)],t.id,e[s(1040)],t.name,e[s(1047)],new Uint8Array(t.data),e[s(312)].width,e[s(312)][s(741)]);i[s(903)]=t.blendMode,i[s(1512)]=t[s(1512)],i[s(364)]=t.isVisible,this[s(2053)][s(1601)].push(i),this._forwardLayerEvents(i),this[s(1002)]=Math.max(this._imageLayerIdCounter,t.id+1)}this[s(2053)][s(1047)]=e[s(1047)],this[s(2053)].currentLayer=e.currentLayer;for(const t of e[s(874)]){const e=this[s(2154)](t[s(1420)]);let i;switch(t.type){case"line":i=$.B[s(1182)];break;case"moving":i=G.m[s(1182)];break;case"rectangle":i=Z.F[s(1182)];break;case"shape":i=Q.n[s(1182)];break;case s(531):i=tt.o[s(1182)]}const o=i(t,e,this._historyService,this._selectionService,this._taskWorkerService);o.currentState.offsetX=t[s(1167)][s(1574)],o.currentState[s(1517)]=t.currentState[s(1517)],(0,n.B)(o[s(613)],this[s(1284)][s(1462)]),this._activeTemporaryLayers.set(t.id,o)}if(void 0!==e[s(1906)]){const t=this[s(1934)](e.currentTemporaryLayerId);this[s(1284)]?.registerTemporaryLayer(t)}this[s(373)](),this[s(1711)][s(393)](),this[s(2146)][s(393)](this[s(1436)],this[s(741)]),this[s(572)][s(393)]()}[t(2208)](e){this[t(1002)]=e-1}[t(2206)](){return++this[t(1081)]}[t(1343)](e){this[t(1081)]=e-1}async[t(1980)](e,i,s){const n=t;this[n(942)]=0,this[n(1458)]=e;const o=await window[n(1596)](i);let r;n(1865)in window?r=new OffscreenCanvas(o[n(1436)],o[n(741)]):(r=document[n(1132)](n(1726)),r[n(1436)]=o[n(1436)],r[n(741)]=o[n(741)]);const a=r[n(1499)]("2d");a.drawImage(o,0,0);const h=a[n(1021)](0,0,o.width,o[n(741)]);this.openImage(e,{data:new Uint8Array(h[n(1675)][n(1394)]),width:o[n(1436)],height:o[n(741)]},!0,s)}[t(1301)](e,i,s,n,o=t(1093)+(n?t(1845):"")){const r=t;this[r(942)]="id"in i?i.id:0,this[r(1458)]=e||r(481);for(const t of this[r(2053)][r(1601)])t.isSoftDeleted=!0,t[r(1676)]();this[r(2053)].list[r(1840)]=0,this[r(403)].clear();const a=this[r(1436)]!==i.width||this[r(741)]!==i[r(741)];this.width=i[r(1436)],this[r(741)]=i[r(741)],this[r(2053)][r(1047)]=n,this[r(2053)][r(1601)].push(this[r(574)](i[r(1675)])),this[r(373)](),s&&(this._historyService[r(895)](),this._historyService.addEntry(new k(o))),this._onUpdate[r(393)](),a&&this[r(2146)][r(393)](this[r(1436)],this[r(741)]),this[r(572)][r(393)]()}async[t(719)](e,i,s){const n=t;await this[n(572)].fireAndWait(),this.mimeType=s;const o=window[n(320)]?SharedArrayBuffer:ArrayBuffer,r=new Uint8Array(new o(e*i*4));r[n(979)](255);const a={data:r,width:e,height:i};this[n(1301)](void 0,a,!0,!1,n(1992))}async[t(2156)](e){const i=t;if(this[i(1458)]===i(1345))throw new Error(i(715));return await this[i(1097)](),this._activeLayersModel[i(1601)][this[i(2053)][i(1284)]][i(2156)](e)}async exportBlobClone(e){const i=t;if(this[i(1458)]===i(1345))throw new Error(i(715));const s=await this.exportImageClone();return J(new ImageData(new Uint8ClampedArray(s[i(1675)]),s[i(1436)],s[i(741)]),e)}[t(607)](){const e=t;return this[e(1097)](),{data:this[e(2053)][e(1601)][this[e(2053)][e(1284)]].data[e(1487)](0,this[e(1436)]*this[e(741)]*4),width:this.width,height:this.height}}async[t(1392)](){const e=t,i=this.layers.filter((t=>t.isVisible));if(0===i[e(1840)])return{data:new Uint8Array(0),width:0,height:0};const s={data:(await i[0][e(1392)]())[e(1487)](0,this[e(1436)]*this[e(741)]*4),width:this[e(1436)],height:this[e(741)]};for(let t=1;t<i[e(1840)];t++){const n=i[t],o=await n[e(1392)]();let r=0;for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)r=4*(t*this.width+i),(0,l.B)(n[e(903)],s[e(1675)],r,o,r)}return s}[t(1757)](e,i){const s=t,n=this[s(1920)].filter((t=>t[s(364)]));if(0===n.length)return;const o=4*(i*this[s(1436)]+e),r=n[0][s(1675)][s(2003)](o,o+4);let a;for(let t=1;t<n[s(1840)];t++)a=n[t],(0,l.B)(a[s(903)],r,0,a.data,o);return r}[t(2145)](){const e=t;return this[e(1458)]!==e(1345)}[t(2168)](){const e=t;if(!this[e(2145)]())throw new Error(e(1783))}[t(1008)](){const e=t;if(this[e(2053)].isReadonly)throw new Error(e(1990))}setActiveLayer(e){const i=t;this.currentLayer?.id!==e&&(this._checkLayerSupport(),this[i(2053)][i(1284)]=this._getIndexFromId(e),this[i(572)][i(393)]())}async[t(1094)](){const e=t;this[e(1008)](),this[e(2168)](),await(this[e(1284)]?.[e(1860)]());const i=window[e(320)]?SharedArrayBuffer:ArrayBuffer,s=this._createLayer(new Uint8Array(new i(this[e(1436)]*this[e(741)]*4)));this[e(2053)].list[e(558)](++this[e(2053)][e(1284)],0,s),this[e(1551)].addEntry(new B(e(529),s[e(1040)],s.id,s[e(1436)],s[e(741)])),this._onUpdate.fire(),this[e(572)].fire()}async[t(1001)](e){const i=t;if(this._checkCanEdit(),this[i(2168)](),this[i(2053)][i(1601)][i(1840)]<=1)throw new Error(i(743));await(this[i(1284)]?.[i(1860)]()),e?this._deleteLayerByIndex(this[i(2164)](e)):this[i(1938)](),this[i(572)][i(393)]()}async[t(547)](e){const i=t;let s;this._checkCanEdit(),void 0===e?(s=this.currentLayer,e=s.id):s=this[i(2154)](e),this[i(1920)][i(1840)]>0&&this[i(2168)](),await s[i(1860)]();const n=(0,c.X$)(s.data[i(1840)],255,!0);let o;if(n[i(475)](s[i(1675)],0),s[i(1680)].match(/ Copy$/)){let t=1;o=s[i(1680)]+" 1";do{o=o[i(1257)](/ \d+$/," "+ ++t)}while(this[i(2053)].list[i(1287)]((t=>t[i(1680)]===o)))}else{const t=s[i(1680)][i(1483)](/ Copy (\d)+$/);if(t&&t[1]){let e=parseInt(t[1]);do{o=s.name[i(1257)](/ \d+$/," "+ ++e)}while(this[i(2053)][i(1601)][i(1287)]((t=>t[i(1680)]===o)))}else o=s[i(1680)]+" Copy"}const r=++this[i(1002)],a=new Y(this[i(1551)],this[i(1104)],this[i(799)],r,this[i(942)],o,this[i(2053)].isReadonly,n,this.width,this[i(741)]);this._forwardLayerEvents(a);const h=this[i(2164)](e);this[i(2053)][i(1601)][i(558)](h+1,0,a),this[i(1538)](r),this[i(1551)][i(1828)](new B(i(2213),s[i(1040)],r,s.width,s[i(741)])),this._onUpdate[i(393)](),this[i(572)][i(393)]()}async mergeLayerDown(){const e=t;if(this[e(1008)](),this._checkLayerSupport(),0===this[e(2053)][e(1284)]||this[e(1920)][0]===this[e(1284)])throw new Error(e(792));const i=this[e(2053)][e(1601)][this[e(2053)][e(1284)]];await i[e(1860)]();const s=this[e(1920)][e(1993)](i),n=this[e(1920)][s-1],o=this._activeLayersModel[e(1601)][e(1993)](n);await this[e(1551)][e(810)]("Merge Layer Down",(async()=>{const t=e;i.setVisible(!0),n.setVisible(!0),await this[t(2053)].list[o][t(1977)](i),this[t(1938)](),this._activeLayersModel[t(1284)]=o,this[t(1284)]?.[t(850)](!0)}))}[t(2025)](e,i){const s=t;let n;this[s(1008)](),void 0===i?(n=this.currentLayer,i=n.id):n=this.getLayerById(i),n[s(722)](e),this[s(572)][s(393)]()}goToTopLayer(){const e=t;this._checkLayerSupport(),this.setActiveLayer(this[e(1920)][this[e(1920)][e(1840)]-1].id)}[t(1049)](){const e=t;this[e(2168)](),this[e(1538)](this.layers[0].id)}[t(717)](){const e=t;this[e(2168)](),this[e(343)](1)}[t(1945)](){const e=t;this[e(2168)](),this[e(343)](-1)}[t(343)](e){const i=t,s=this.currentLayer;if(!s)throw new Error(i(2215));const n=this[i(1920)],o=n[i(1993)](s);if(-1===o)throw new Error("Could not find current layer");const r=(0,d.u)(o+e,n[i(1840)]-1,0);this[i(1538)](n[r].id)}[t(1718)](){const e=t;this[e(1008)](),this._checkLayerSupport(),this[e(1551)][e(1986)](new f("Move Layer to Top",this[e(2053)].list[e(1840)]-1,this[e(2053)]))}moveLayerToBottom(){const e=t;this[e(1008)](),this[e(2168)](),this[e(1551)].runSyncAction(new f(e(1719),0,this._activeLayersModel))}[t(1820)](){const e=t;this._checkCanEdit(),this[e(2168)](),this[e(1551)][e(1986)](new y(this[e(2053)]))}[t(1503)](){const e=t;this[e(1008)](),this[e(2168)](),this[e(1551)][e(1986)](new w(this._activeLayersModel))}[t(1178)](e,i){const s=t;this[s(1008)](),this._checkLayerSupport();const n=this[s(2053)][s(1601)][s(409)]((t=>t.id===i));-1!==n&&this[s(1551)][s(1986)](new p("Move Layer",e,n,this[s(2053)]))}[t(1009)](e,i){return e>=0&&e<this[t(1436)]&&i>=0&&i<this.height}resize(e,i){const s=t;this[s(1008)](),this[s(1436)]===e&&this[s(741)]===i||(this[s(1436)]=e,this.height=i,this[s(1711)].fire(),this[s(2146)][s(393)](e,i))}[t(574)](e){const i=t;this[i(1920)].length>0&&this[i(2168)](),e=(0,c.pZ)(e);const s=++this[i(1002)],n=new Y(this[i(1551)],this[i(1104)],this[i(799)],s,this.activeImageFileId,1===s?i(1548):i(1077)+this[i(1233)](),this[i(2053)].isReadonly,e,this[i(1436)],this[i(741)]);return this[i(1044)](n),n}[t(1044)](e){const i=t;(0,n.B)(e[i(835)],this[i(1711)]),(0,n.B)(e.onSoftDeletedChange,this[i(572)]),(0,n.B)(e.onChangedDimensions,this[i(2146)]),(0,n.B)(e[i(1024)],this[i(1813)]),(0,n.B)(e[i(613)],this._onRequestRender),(0,n.B)(e.onTemporaryLayerRegistered,this[i(771)]),(0,n.B)(e.onTemporaryLayerUnregistered,this[i(1041)])}[t(1233)](){const e=t,i=this[e(1920)][e(688)]((t=>t[e(1680)]))[e(1800)]((t=>t[e(1483)](/^Layer \d+$/)))[e(688)]((t=>parseInt(t.substring(6))));let s=1;for(;i[e(463)](s);)s++;return s}[t(1938)](){const e=t;this[e(517)](this[e(2053)][e(1284)])}[t(517)](e){const i=t;if(1===this[i(824)]())throw new Error(i(1582));if(this[i(2053)][i(1284)]===e){let t=this._activeLayersModel[i(1284)]-1;for(;t>0&&this[i(2053)][i(1601)][t][i(1512)];)t--;if(t<0)for(t=this[i(2053)].currentLayer+1;t<this[i(2053)][i(1601)][i(1840)]-1&&this[i(2053)][i(1601)][t][i(1512)];)t++;this[i(2053)][i(1284)]=Math[i(1590)](t,0)}const s=this[i(2053)][i(1601)][e];s[i(1512)]=!0,this[i(1551)].addEntry(new b(i(933),s[i(1040)],s.id)),this._updateBottomLayer()}async[t(1097)](){const e=t;this[e(2168)](),this._getNonSoftDeletedLayerCount()>1&&(await this[e(1551)][e(810)](e(1026),(async()=>{const t=e;for(let e=this[t(1920)][t(1840)]-1;e>=1;e--){const i=this[t(1920)][e];await i[t(1860)](),await this[t(1920)][e-1][t(1977)](i),this[t(517)](e)}})),this[e(1711)][e(393)](),this[e(572)][e(393)]())}_updateBottomLayer(){const e=t;this[e(2053)][e(1601)][0][e(1987)]=!0;for(let t=1;t<this[e(2053)][e(1601)].length;t++)this._activeLayersModel[e(1601)][t].isBottomLayer=!1}[t(2164)](e){const i=t,s=this._activeLayersModel[i(1601)][i(409)]((t=>t.id===e));if(-1===s)throw new Error(i(2119));return s}getLayerById(e){const i=t;return this[i(2053)][i(1601)][this._getIndexFromId(e)]}[t(1934)](e){const i=t;return this[i(403)][i(781)](e)}_getNonSoftDeletedLayerCount(){let t=0;for(const e of this._activeLayersModel.list)!e.isSoftDeleted&&t++;return t}async eraseSelection(e=!1){const i=t;if(!this[i(1104)].range)return;const s=this[i(1284)];s&&(await(this[i(1284)]?.finishTemporaryLayer()),await this[i(1551)].createCompositeEntry("Erase Selection",(async()=>{const t=i;this[t(1104)].validate(s[t(1436)],s[t(741)]),this[t(1104)][t(1061)]("Validate Selection");const n=this[t(1104)][t(664)];n&&(await this[t(1551)][t(1422)](new u.Z(t(845),n,s,((e,i)=>{const s=t;for(let t=n[s(1116)];t<n[s(2077)];t++){const o=t*i*4;e.fill(0,o+4*n.left,o+4*n[s(594)])}}))),!e&&this._selectionService[t(1010)]())})))}[t(1549)](){const e=t,i=(0,s.DI)(this[e(1436)],this[e(741)]);return this[e(1104)][e(1033)](e(1285),i),i}}class it{constructor(e,i,s){const n=t;this[n(709)]=e,this._imageFileId=i,this[n(918)]=s,this.type="singleLayer",this[n(510)]=0}async[t(1652)](e){const i=t,s=await e.getLayer(this[i(466)],this._layerId);if(!s)throw new Error("Could not find layer for history entry");return s}async[t(772)](e){const i=t,s=await e[i(331)](this[i(466)],this[i(918)]);if(!s)throw new Error("Could not find layer for history entry");return s}[t(1348)](){const e=t;return{id:e(1954),operationName:this[e(709)],imageFileId:this._imageFileId,layerId:this[e(918)]}}static[t(1182)](e){const i=t;return new it(e[i(709)],e[i(1040)],e[i(1365)])}}var st=i(3491);class nt{constructor(e,i){const s=t;this[s(709)]=e,this[s(466)]=i,this.type=s(2063),this[s(510)]=0}async[t(1652)](e){const i=t;e[i(1856)](this[i(466)],!0)}async[t(772)](e){const i=t;e[i(1856)](this[i(466)],!1)}[t(1348)](){return{id:"AddImage",operationName:this[t(709)],imageFileId:this._imageFileId}}static create(e){const i=t;return new nt(e[i(709)],e[i(1040)])}}class ot{constructor(e,i){const s=t;this[s(709)]=e,this._imageFileId=i,this.type=s(2063),this[s(510)]=0}async[t(1652)](e){const i=t;e[i(1856)](this[i(466)],!1)}async[t(772)](e){e[t(1856)](this._imageFileId,!0)}[t(1348)](){const e=t;return{id:"DeleteImage",operationName:this[e(709)],imageFileId:this[e(466)]}}static[t(1182)](e){const i=t;return new ot(e.operationName,e[i(1040)])}}class rt{constructor(e,i,s){const n=t;this[n(709)]=e,this._initialIndex=i,this[n(1879)]=s,this[n(335)]=n(2063),this[n(510)]=0}undo(e){const i=t;e[i(857)](this[i(1879)],this[i(930)])}[t(772)](e){const i=t;e.swapImagePositions(this._initialIndex,this[i(1879)])}[t(1348)](){return{id:t(2211),operationName:this.operationName,initialIndex:this._initialIndex,targetIndex:this._targetIndex}}static create(e){const i=t;return new rt(e[i(709)],e[i(1704)],e[i(981)])}}class at extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1551)]=e,this[r(1439)]=i,this[r(1104)]=s,this[r(315)]=o,this[r(2084)]=!1,this[r(1521)]=new Map,this[r(1152)]=new Map,this._imageIdCounter=0,this._onImagesChange=this.register(new n.v),this[r(2182)]=this[r(507)][r(2220)],this[r(1830)]=this.register(new n.v),this[r(1195)]=this[r(1830)][r(2220)],this._historyService[r(873)]("singleLayer",{undo:async t=>{const e=r,i=await t[e(1652)](this);i.isSoftDeleted?this._imageService.setActiveLayer(this[e(1439)][e(1920)][0].id):this[e(1439)][e(1538)](i.id)},redo:async t=>{const e=r,i=await t[e(772)](this);i[e(1512)]?this._imageService[e(1538)](this[e(1439)][e(1920)][0].id):this[e(1439)][e(1538)](i.id)}}),this[r(1551)][r(873)](r(2063),{undo:async t=>{const e=r;t[e(1652)]({setImageSoftDeleted:this[e(863)][e(950)](this),swapImagePositions:this._swapImagePositions[e(950)](this,!0)})},redo:async t=>{const e=r;t.redo({setImageSoftDeleted:this[e(863)][e(950)](this),swapImagePositions:this[e(2008)][e(950)](this,!0)})}}),this._historyService.registerHistoryEntryFactory(r(2044),j.x[r(1182)]),this[r(1551)][r(2085)](r(1954),it.create),this._historyService[r(2085)](r(1577),nt[r(1182)]),this[r(1551)][r(2085)](r(754),ot[r(1182)]),this[r(1551)][r(2085)]("MoveImage",rt.create),this._selectionService[r(1208)]((()=>{const t=r;void 0!==this[t(1082)]&&this[t(1551)][t(1828)](new it(t(1954),this[t(2112)]()?.id||0,this[t(1439)][t(1284)]?.id||0))})),this._imageService[r(1806)]((()=>this[r(2187)]()))}async[t(863)](e,i){const s=t,n=this[s(808)]?.[s(1518)]((t=>t.id===e));n&&(i?(n[s(1512)]=i,this._getActiveImage()?.id===e&&await this[s(1256)](this[s(1082)],this[s(808)]),this[s(1830)].fire(e),this._onImagesChange[s(393)]()):(n[s(1512)]=i,this[s(507)][s(393)](),this[s(2055)](n.id)))}get[t(1956)](){const e=t;if(this[e(808)])return this._refreshActiveImage(),ht(this[e(808)])}_refreshActiveImage(){const e=t;if(this._imageSet&&this.activeImageSetIndex){const t=this._imageSet[this[e(1082)]],i=this._imageService[e(1284)];t&&i&&i[e(1675)]!==t[e(1675)]&&(t[e(1675)]=i[e(1675)],t[e(1436)]=i[e(1436)],t[e(741)]=i.height)}}openBlob(e,i,s){const n=t;return this[n(2084)]=s,this._imageService[n(1980)](e,i,s)}[t(1301)](e,i,s){const n=t;let o;if(this[n(2084)]=s,Array[n(2160)](i)){this[n(1613)]();const t=i;this.mimeType=e,this._imageSet=t[n(688)]((t=>({...t,id:++this[n(1971)]})));for(const t of this[n(808)])t[n(1675)]=(0,c.pZ)(t[n(1675)]);const s=t.reduce(((t,e,i)=>{const s=n;return e.width*e[s(741)]>t[s(766)]?(t[s(766)]=e[s(1436)]*e[s(741)],{index:i,dims:e[s(1436)]*e.height}):t}),{index:0,dims:0})[n(2153)];this.activeImageSetIndex=s,o=this[n(808)][s]}else o=i;this._imageService.openImage(e,o,!0,this[n(2084)]),Array[n(2160)](i)&&this[n(507)][n(393)]()}async newImage(e,i,s){const n=t;if(this[n(1613)](),e===n(1345)){await this[n(1439)][n(719)](i,s,e);const t=this[n(1439)].currentLayer;this[n(1458)]=e,this[n(808)]=[{data:t[n(1675)],width:i,height:s,bitness:32,id:++this[n(1971)]}],this.activeImageSetIndex=0,this[n(507)][n(393)]()}else await this[n(1439)][n(719)](i,s,e)}[t(1613)](){const e=t;if(this[e(808)]){for(const t of ht(this[e(808)]))this[e(1830)][e(393)](t.id);this.activeImageSetIndex=void 0}}async[t(2156)](e){const s=t;if(this[s(808)]){const t=(await i.e(7495).then(i[s(950)](i,7495)))[s(382)],e=await t(ht(this[s(808)]));return new Blob([e])}return this[s(1439)].exportBlob(e)}async[t(782)](e){const i=t;return this._imageSet?this.exportBlob(e):this[i(1439)].exportBlobClone(e)}[t(2200)](){const e=t;if(!this[e(808)])throw new Error(e(1926));return this[e(808)]}[t(1008)](){if(this._isReadonly)throw new Error("Image is readonly, edit is not supported")}async[t(789)](e,i){const s=t,n=this[s(2200)]();if(e>=n[s(1840)])throw new Error('Cannot find image "'+e+'" to set active');if(void 0!==this[s(1082)]){const t=n[this[s(1082)]];!i&&(await(this[s(1439)][s(1284)]?.[s(1860)]()),this._selectionService.range&&this[s(1104)].deselect());const e=this[s(1439)].serialize(-1);this[s(1521)][s(475)](t.id,e),this[s(1152)][s(475)](t.id,{x:this._viewportService.x,y:this._viewportService.y,zoom:this[s(315)][s(1514)]})}this[s(1082)]=e;const o=n[e],r=this[s(1521)][s(781)](o.id);r?this._imageService[s(1101)](r,!0):this[s(1439)][s(1301)](o[s(1458)],o,!1,this[s(2084)]);const a=this[s(1152)][s(781)](o.id);a?(this._viewportService.x=a.x,this._viewportService.y=a.y,this[s(315)][s(1514)]=a[s(1514)]):this._viewportService[s(846)](),this._onImagesChange[s(393)]()}async setActiveImageById(e,i){const s=t,n=this[s(2200)]().findIndex((t=>t.id===e));await this[s(789)](n,i)}async addImage(e,i,s){const n=t;this._checkCanEdit();const o=this[n(2200)](),r={id:++this[n(1971)],width:e,height:i,data:new Uint8Array(e*i*4),bitness:s,mimeType:n(32===s?481:461)};r[n(1675)][n(979)](255),o[n(1378)](r),await this[n(789)](o[n(1840)]-1),this._historyService[n(1828)](new nt(n(2034),r.id))}async deleteImage(e){const i=t;this[i(1008)]();const s=this[i(2200)]();if(s.length<=1)throw new Error("There must be at least one image");const n=this._getImageOrActiveIndex(e);if(void 0===n)throw new Error(i(1981));await this._focusNonActiveImage(n,s);const o=s[n];o[i(1512)]=!0,this[i(1830)][i(393)](o.id),this[i(507)][i(393)](),this[i(1551)][i(1828)](new ot(i(1803),o.id))}async duplicateImage(e){const i=t;this[i(1008)]();const s=this[i(2200)](),n=this[i(1004)](e);if(void 0===n)throw new Error(i(1981));!e&&(e=s[n]);const o={id:++this._imageIdCounter,width:e[i(1436)],height:e[i(741)],data:e.data[i(1487)](0),bitness:e[i(308)],mimeType:e[i(1458)]},r=n+1;s.splice(r,0,o),await this.setActiveImageByIndex(r),this[i(1551)][i(1828)](new nt(i(2196),o.id))}[t(1004)](e){const i=t,s=this[i(2200)]();let n;return e?(n=s[i(409)]((t=>t.id===e.id)),-1===n&&(n=void 0)):n=this[i(1082)],n}async[t(1256)](t,e){const i=t+1<e.length-1?t+1:t-1;await this.setActiveImageByIndex(i)}async[t(1131)](){const e=t;await this[e(789)](this[e(2200)]()[e(1840)]-1)}async[t(862)](){const e=t;await this[e(789)](0)}async[t(1767)](){const e=t;await this.setActiveImageByIndex((this[e(1082)]||0)+1)}async[t(819)](){const e=t;await this[e(789)]((this[e(1082)]||0)-1)}async moveImageToTop(){const e=t;this[e(323)](e(767),this[e(2200)]()[e(1840)]-1)}async[t(1476)](){const e=t;this[e(323)](e(2080),0)}async[t(721)](){const e=t;void 0!==this[e(1082)]&&this._moveActiveImageToIndex(e(1058),this[e(1082)]+1)}async[t(2062)](){const e=t;void 0!==this[e(1082)]&&this[e(323)]("Move Image Down",this[e(1082)]-1)}async[t(993)](e,i){const s=t,n=this[s(2200)](),o=(n[s(409)]((t=>t.id===e)),n.findIndex((t=>t.id===i)));await this[s(2055)](e),this[s(323)]("Move Image",o)}[t(323)](e,i){const s=t;if(void 0===this[s(1082)])return;this[s(1008)]();const n=this._checkSupportsMultipleImages();i=Math[s(1590)](Math[s(2219)](i,n[s(1840)]-1),0),this[s(1082)]!==i&&(this[s(1551)][s(1828)](new rt(e,this.activeImageSetIndex,i)),this[s(2008)](!1,this.activeImageSetIndex,i))}[t(2008)](e,i,s){const n=t;if(i===s)return;const o=this._checkSupportsMultipleImages(),r=this[n(2112)](),a=o[s],h=o.splice(i,1)[0];o[n(558)](s,0,h),(r?.id===h.id||r?.id===a.id)&&this[n(1082)]!==s&&(this[n(1082)]=s),this._onImagesChange[n(393)]()}[t(2112)](){const e=t,i=this[e(2200)]();if(void 0!==this[e(1082)])return i[this[e(1082)]]}async[t(331)](e,i){const s=t;if(!this[s(808)]){if(0!==e)throw new Error(s(351));return this._imageService[s(2154)](i)}let n=this._getActiveImage();return n?.id!==e&&(await this[s(2055)](e,!0),n=this[s(2112)]()),this[s(1439)][s(2154)](i)}async getTempLayer(e,i,s){const n=t;return await this[n(331)](e,i),this[n(1439)][n(1934)](s)}[t(1348)](e=0){const i=t;if(void 0!==this[i(1082)]){if(-1!==e){const t=this[i(808)].reduce(((t,e)=>{const s=i,n=e[s(1436)]*e[s(741)];return n>t?n:t}),0);if(t>e)throw new Error("Image exceeded maximum pixel count allowed ("+t+i(690)+e+")")}const t=Array[i(2098)](this[i(1521)][i(1060)]());return{mimeType:this.mimeType||i(481),activeImageSetIndex:this[i(1082)]||0,loadedImages:t,unloadedImages:this[i(808)][i(688)]((t=>(0,R.t)(t)))}}return{mimeType:this.mimeType||"image/png",activeImageSetIndex:0,loadedImages:[this._imageService[i(1348)](e)],unloadedImages:void 0}}deserialize(e){const i=t;if(this.mimeType=e[i(1458)],e[i(1868)]){let t=0;for(const s of e[i(441)][i(1060)]())t=s[i(1920)][i(1056)](((t,e)=>e.id>t?e.id:t),t),s.temporaryLayers[i(776)]((t=>(0,st.M)(t.id)));this[i(1439)][i(2208)](t+1),this[i(808)]=e.unloadedImages[i(688)]((t=>(0,R.e)(t)));for(const t of e[i(441)])this[i(1521)][i(475)](t[i(1040)],t);this[i(808)]&&this[i(789)](e.activeImageSetIndex)}else this._imageSet=void 0,this[i(1439)][i(1101)](e[i(441)][0]);this[i(1439)][i(1458)]=this[i(1458)],this[i(507)][i(393)]()}}function ht(e){return e[t(1800)]((t=>!0!==t.isSoftDeleted))}class ct extends e.JT{constructor(e){const i=t;super(),this[i(1055)]=[],this._onDblClick=this[i(1075)](new n.v),this[i(1733)]=this[i(1276)][i(2220)],this._onKeyDown=this[i(1075)](new n.v),this[i(1962)]=this._onKeyDown.event,this[i(678)]=this[i(1075)](new n.v),this.onKeyUp=this[i(678)][i(2220)],this._onPointerDown=this[i(1075)](new n.v),this[i(851)]=this._onPointerDown.event,this._onPointerDownMove=this[i(1075)](new n.v),this[i(966)]=this._onPointerDownMove[i(2220)],this[i(674)]=this[i(1075)](new n.v),this[i(1873)]=this[i(674)][i(2220)],this[i(396)]=this[i(1075)](new n.v),this[i(2184)]=this[i(396)][i(2220)],this._onWheel=this.register(new n.v),this.onWheel=this[i(342)][i(2220)],e[i(1826)]((t=>this._attach(t))),this.register({dispose:()=>this[i(737)]?.[i(1676)]()})}get[t(1395)](){return!!this[t(737)]}[t(2050)](i){const s=t;(0,e._c)(this._attachedDisposables),this[s(1055)][s(1840)]=0,this[s(1075)]((0,e.Lw)(document[s(2106)],s(1552),(t=>this[s(1410)].fire(t)))),this[s(1075)]((0,e.Lw)(document[s(2106)],s(1817),(t=>this[s(678)].fire(t)))),this[s(1075)]((0,e.Lw)(i,s(1798),(t=>{const n=s;i[n(635)](t[n(2207)]),this[n(737)]=(0,e.Lw)(i,n(795),(t=>this[n(2040)][n(393)](t))),this._onPointerDown[n(393)](t)}))),this.register((0,e.Lw)(i,s(1113),(t=>{const e=s;i.releasePointerCapture(t.pointerId),this._pointerDownMoveListener?.dispose(),this[e(737)]=void 0,this[e(396)][e(393)](t)}))),this.register((0,e.Lw)(i,s(1612),(t=>this._onDblClick[s(393)](t)))),this[s(1075)]((0,e.Lw)(i,s(1791),(t=>t[s(387)]()))),this[s(1075)]((0,e.Lw)(i,s(795),(t=>this[s(674)].fire(t)))),this.register((0,e.Lw)(i,s(442),(t=>this[s(342)][s(393)](t)),{passive:!0}))}}var lt=i(8752);class dt{constructor(e,i=255){const s=t;this[s(1933)]=e,this[s(1480)]=new Map,this[s(1711)]=new n.v,this.onUpdate=this._onUpdate[s(2220)],this._alpha=i,this[s(835)]((()=>this[s(1480)][s(554)]()))}[t(1676)](){const e=t;this._onUpdate[e(1676)]()}get sourceColor(){return this[t(1933)]}set[t(1831)](e){const i=t;this[i(1933)]=e,this._onUpdate[i(393)]()}get a(){return this[t(1148)]}set a(e){const i=t,s=(0,d.u)(e,255,0);this[i(1148)]!==s&&(this._alpha=s,this._onUpdate[i(393)]())}get[t(779)](){return this[t(444)][0]}set[t(779)](e){const i=t;switch(this[i(1933)].type){case i(444):if(e===this[i(1933)][0])return;this[i(1933)]=lt.mC[i(1473)](e,this._color[1],this[i(1933)][2]);break;case i(1657):{const t=lt.B8.toHsv(this[i(1933)]);if(e===t[0])return;this[i(1933)]=lt.mC[i(1473)](e,t[1],t[2]);break}}this[i(1711)][i(393)]()}get hsv(){const e=t;switch(this[e(1933)][e(335)]){case"hsv":return this[e(1933)];case"rgb":return this._getWithCache(this[e(1933)],e(444),lt.B8[e(971)])}}set hsv(e){const i=t,s=this[i(1933)][i(335)]===i(444)?this[i(1933)]:lt.B8[i(971)](this[i(1933)]);(0,lt.WC)(s,e)||(this[i(1933)]=e,this._onUpdate[i(393)]())}get[t(1657)](){const e=t;switch(this[e(1933)][e(335)]){case e(444):return this[e(2039)](this[e(1933)],e(1657),lt.mC.toRgb);case"rgb":return this[e(1933)]}}set[t(1657)](e){const i=t,s="rgb"===this._color[i(335)]?this[i(1933)]:lt.mC[i(1999)](this._color);(0,lt.WC)(s,e)||(this[i(1933)]=e,this[i(1711)][i(393)]())}get[t(1793)](){const e=t;switch(this[e(1933)].type){case e(444):return this[e(2039)](this[e(1933)],e(1793),(t=>lt.mC.toRgba(t,this[e(1148)])));case e(1657):return this[e(2039)](this[e(1933)],e(1793),(t=>lt.B8[e(880)](t,this[e(1148)])))}}set[t(1793)](e){const i=t,s="rgb"===this[i(1933)].type?this[i(1933)]:lt.mC.toRgb(this._color);s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&this._alpha===e[3]||(this[i(1933)]=lt.m4[i(1999)](e),this[i(1148)]=e[3],this[i(1711)].fire())}[t(2039)](e,i,s){const n=t,o=this[n(1480)][n(781)](i);if(o)return o;const r=s(e);return this[n(1480)][n(475)](i,r),r}}class ut extends e.JT{constructor(){const e=t;super(),this[e(1477)]=this[e(1075)](new dt(lt.B8[e(1523)](0,0,0),255)),this.secondary=this.register(new dt(lt.B8.createRgbColor(255,255,255),255)),this[e(1711)]=this[e(1075)](new n.v),this[e(835)]=this._onUpdate[e(2220)],(0,n.B)(this[e(1477)][e(835)],this[e(1711)]),(0,n.B)(this[e(433)][e(835)],this[e(1711)])}[t(1259)](){const e=t,i=this[e(433)][e(1831)],s=this[e(433)].a;this[e(433)][e(1831)]=this[e(1477)][e(1831)],this[e(433)].a=this[e(1477)].a,this[e(1477)][e(1831)]=i,this[e(1477)].a=s,this[e(1711)][e(393)]()}[t(356)](e,i){const s=t;this[s(2133)](e),this._validate(i),(!(0,lt.WC)(this[s(1477)].rgba,e)||!(0,lt.WC)(this[s(433)][s(1793)],i))&&(this[s(1477)].rgba=e,this[s(433)][s(1793)]=i,this[s(1711)][s(393)]())}getColorFromPointerEvent(e){const i=t;return 1&e[i(324)]?this[i(1477)].rgba:2&e[i(1376)]?this[i(433)][i(1793)]:void 0}[t(2017)](e){const i=t;return 1&e[i(324)]?[this[i(1477)].rgba,this[i(433)][i(1793)]]:[this[i(433)][i(1793)],this[i(1477)][i(1793)]]}_validate(e){if(4!==e[t(1840)])throw new Error("Could not set color to array of length smaller than 4")}}let mt=Float32Array;function gt(t,e,i,s,n,o,r=new mt(16)){return r[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(n-o),r[11]=0,r[12]=(t+e)/(t-e),r[13]=(i+s)/(i-s),r[14]=(n+o)/(n-o),r[15]=1,r}function ft(t,e,i,s,n=new mt(16)){var o=t[0],r=t[1],a=t[2],h=t[3],c=t[4],l=t[5],d=t[6],u=t[7],m=t[8],g=t[9],f=t[10],p=t[11],_=t[12],y=t[13],w=t[14],v=t[15];return t!==n&&(n[0]=o,n[1]=r,n[2]=a,n[3]=h,n[4]=c,n[5]=l,n[6]=d,n[7]=u,n[8]=m,n[9]=g,n[10]=f,n[11]=p),n[12]=o*e+c*i+m*s+_,n[13]=r*e+l*i+g*s+y,n[14]=a*e+d*i+f*s+w,n[15]=h*e+u*i+p*s+v,n}const pt=[0,0,0,1,1,0,1,0,0,1,1,1];function _t(e,i,s){const n=t,o=e[n(2167)]();if(e[n(2199)](o,wt(yt(e,e.VERTEX_SHADER,i))),e[n(2199)](o,wt(yt(e,e.FRAGMENT_SHADER,s))),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS))return o;console.error(e[n(1815)](o)),e[n(1136)](o)}function yt(e,i,s){const n=t,o=wt(e[n(1863)](i));if(e[n(1456)](o,s),e[n(539)](o),e.getShaderParameter(o,e[n(422)]))return o;console[n(1053)](e[n(1489)](o),{source:s}),e[n(1339)](o)}function wt(e){if(!e)throw new Error(t(1485));return e}function vt(){return[new Float32Array(16),new Float32Array(16)]}function bt(e,i,s,n,o){const r=t;gt(0,e[r(1726)][r(1436)]/window[r(1218)],e[r(1726)][r(741)]/window[r(1218)],0,-1,1,o[0]),ft(o[0],Math[r(1266)](e[r(1726)].width/window[r(1218)]/2)-s[r(1436)]/2*n[r(1514)]+n.x*n[r(1514)],Math[r(1266)](e[r(1726)].height/window.devicePixelRatio/2)-s[r(741)]/2*n[r(1514)]+n.y*n[r(1514)],0,o[1]),e[r(307)](i,!1,o[1])}function xt(e,i=e[t(1726)][t(1436)],s=e[t(1726)][t(741)]){const n=t,o=wt(e[n(770)]());return e[n(628)](e.TEXTURE_2D,o),e[n(2201)](e[n(1297)],e.TEXTURE_WRAP_S,e[n(426)]),e[n(2201)](e[n(1297)],e[n(901)],e[n(426)]),e.texParameteri(e[n(1297)],e[n(328)],e[n(2166)]),e.texParameteri(e.TEXTURE_2D,e[n(1713)],e[n(2166)]),e[n(1374)](e.TEXTURE_2D,0,e[n(1457)],i,s,0,e[n(1457)],e[n(605)],null),o}const It=t(694)+0+t(710)+t(1449)+t(982)+t(1449)+" * a_position;\n}",St=t(747);class Ct extends e.JT{constructor(e,i,s){const n=t;super(),this[n(2091)]=e,this[n(1439)]=i,this[n(315)]=s,this[n(1746)]=2,this[n(726)]=new Float32Array(8),this[n(1186)]=vt(),this._positionsNeedsUpdate=!0,this._matrixNeedsUpdate=!0;const o=this[n(2091)];this[n(729)]=wt(_t(o,It,St)),this._vertexArrayObject=wt(o[n(1917)]()),o[n(1135)](this[n(357)]),this[n(1528)]=wt(o[n(1282)]()),this[n(1012)]=wt(o.getUniformLocation(this[n(729)],"u_matrix")),o[n(360)](o[n(535)],this[n(1528)]),o[n(345)](0),o[n(638)](0,2,o[n(938)],!1,0,0),this[n(1075)](this[n(1439)][n(1806)]((()=>{const t=n;this[t(1288)]=!0,this[t(1721)]=!0}))),this[n(1075)](this[n(315)].onUpdate((()=>{const t=n;this[t(1721)]=!0,this[t(1288)]=!0})))}[t(625)](){const e=t;if(!this[e(1439)][e(1284)])return;const i=this._gl;i[e(1078)](this[e(729)]),i[e(1135)](this[e(357)]),this[e(672)](i,this[e(315)]),this._updateMatrixUniform(i,this[e(315)]),i[e(1529)](i[e(1459)],0,4)}_updateAttributeBuffers(e,i){const s=t;this[s(1288)]&&(e.bindVertexArray(this[s(357)]),e[s(360)](e[s(535)],this[s(1528)]),1===window.devicePixelRatio?(this._positionsArray[0]=this[s(726)][2]=-.5,this._positionsArray[1]=this[s(726)][7]=-.5,this._positionsArray[4]=this[s(726)][6]=this[s(1439)][s(1436)]*i.zoom+.5,this[s(726)][3]=this[s(726)][5]=this[s(1439)][s(741)]*i[s(1514)]+.5):(this[s(726)][0]=this[s(726)][2]=0,this[s(726)][1]=this[s(726)][7]=0,this._positionsArray[4]=this[s(726)][6]=this._imageService[s(1436)]*i.zoom,this[s(726)][3]=this._positionsArray[5]=this[s(1439)][s(741)]*i[s(1514)]),e.bufferData(e.ARRAY_BUFFER,this[s(726)],e[s(712)]),this[s(1288)]=!1)}[t(960)](e,i){const s=t;this[s(1721)]&&(bt(e,this[s(1012)],this[s(1439)],i,this[s(1186)]),this[s(1721)]=!1)}}var Et=i(3318),Tt=i.n(Et),Lt=i(3716),At=i.n(Lt),Rt=i(4738),Dt=i.n(Rt),Mt=i(7542),Bt=i.n(Mt),kt=i(98),Pt=i.n(kt),Ut=i(7034),Ft=i.n(Ut);const Ot=new Map([[t(1310),1],[t(1257),28],["darken",3],[t(1982),4],["linearBurn",6],[t(1448),8],["screen",9],[t(1851),11],[t(588),13],[t(1390),14],[t(1702),20],["exclusion",21]]),Nt=new Int32Array([0,1,2,3,4,5,6]);let Vt=0;class Ht extends e.JT{constructor(e,i,n){const o=t;super(),this._gl=e,this[o(1439)]=i,this._viewportService=n,this[o(1746)]=1,this._frameBufferTextures=[],this[o(310)]=!1,this[o(1214)]=new Map,this[o(407)]=new Float32Array(2),this[o(1163)]=new Int32Array(8);const r=this[o(2091)];this[o(729)]=wt(_t(r,At(),Tt())),this[o(357)]=wt(r[o(1917)]()),r[o(1135)](this._vertexArrayObject),0===Vt&&(Vt=r[o(1504)](r.MAX_TEXTURE_IMAGE_UNITS));const a=r[o(1074)](this[o(729)],o(1690));this[o(1528)]=wt(r[o(1282)]()),r[o(360)](r[o(535)],this._positionBuffer),r.bufferData(r[o(535)],new Float32Array(pt),r[o(712)]),r[o(345)](a),r.vertexAttribPointer(a,2,r[o(938)],!1,0,0);const h=r.getAttribLocation(this[o(729)],o(565));this[o(1810)]=wt(r[o(1282)]()),r[o(360)](r.ARRAY_BUFFER,this[o(1810)]),r[o(2e3)](r[o(535)],new Float32Array(pt),r[o(712)]),r[o(345)](h),r[o(638)](h,2,r[o(938)],!1,0,0),this._matrixUniformLocation=wt(r[o(1609)](this[o(729)],"a")),this._zoomLocation=wt(r.getUniformLocation(this[o(729)],"b")),this[o(1386)]=wt(r.getUniformLocation(this[o(729)],"c")),this._canvasDimensionsUniformLocation=wt(r[o(1609)](this[o(729)],"l")),this[o(796)]=wt(r[o(1609)](this._program,"n")),this[o(1975)]=wt(r[o(1609)](this[o(729)],"m")),this[o(445)]=wt(r[o(1609)](this[o(729)],"h")),this[o(883)]=wt(r.getUniformLocation(this[o(729)],"d")),this._tileScaledDimensionsUniformLocation=wt(r[o(1609)](this._program,"f")),this[o(311)]=wt(r.getUniformLocation(this[o(729)],"g")),this[o(1939)]=wt(r[o(1609)](this[o(729)],"j")),this[o(1437)]=wt(r[o(1609)](this[o(729)],"k")),this._flippedAxisUniformLocation=wt(r.getUniformLocation(this[o(729)],"o")),this[o(666)]=wt(r.createFramebuffer()),this[o(1231)]=wt(r[o(770)]()),r[o(1230)](r[o(839)]),r[o(628)](r[o(1297)],this[o(1231)]),r[o(2201)](r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r[o(1602)]),r[o(2201)](r[o(1297)],r.TEXTURE_MAG_FILTER,r[o(2166)]),r.texParameteri(r.TEXTURE_2D,r[o(911)],r.CLAMP_TO_EDGE),r[o(2201)](r[o(1297)],r.TEXTURE_WRAP_T,r[o(426)]),r[o(1374)](r[o(1297)],0,r[o(1457)],1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([255,255,255,255])),this[o(1075)](this[o(1439)].onUpdate((t=>{const e=o;typeof t===e(1907)&&"object"==typeof this[e(310)]?this[e(310)]=(0,s.qi)(t,this[e(310)]):this[e(310)]=!0}))),this[o(1075)](this[o(1439)][o(1806)]((()=>{const t=o;this[t(310)]=!0,this[t(1125)]()}))),this[o(1075)](this._viewportService.onZoomChange((()=>{this._updateUniformValueZoom()}))),this[o(672)](),this[o(1125)](),this[o(1889)]()}[t(1924)](){const e=t,i=this._gl;for(;this[e(398)][e(1840)]>0;)i[e(1923)](this[e(398)][e(658)]());this[e(1534)]&&(i[e(2222)](this._frameBufferRenderBuffer),this[e(1534)]=void 0),this[e(583)]?.[e(1924)](),this._rectangleShader?.resize(),this[e(1889)]()}[t(625)](){const e=t,i=this[e(1439)][e(1920)];if(0===i.length)return;this[e(310)]&&(!0===this._needsAttributeUpdate?this._updateAttributeBuffers():this[e(672)](this[e(310)]));const n=this[e(2091)];n[e(1078)](this[e(729)]),n[e(1135)](this[e(357)]),n[e(1368)](n[e(761)],null),n[e(368)](n[e(1263)]);const o=this[e(315)],r=this[e(1439)];let a=-1,h=null;const c=[],l=[],d=[],u=[],m=[];let g=!1;for(const t of i){if(!t.isVisible)continue;const i=this[e(1214)][e(781)](t.id);if(i){const o=t===this[e(1439)][e(1284)];let r;o?r=l:g?((0===m.length||7===m[m[e(1840)]-1][0][e(1840)])&&m[e(1378)]([]),r=m[m[e(1840)]-1]):((0===c[e(1840)]||7===c[c.length-1][0].length)&&c[e(1378)]([]),r=c[c[e(1840)]-1]);for(let t=0;t<i[e(417)][e(1840)];t++)!r[t]&&(r[t]=[]),r[t].push(i[e(417)][t]);if(o)if(g=!0,t[e(2217)]?.type!==e(2046)&&t[e(2217)]?.[e(335)]!==e(2175)&&"text"!==t[e(2217)]?.[e(335)]||!this[e(1439)][e(1284)][e(2217)][e(879)]?.[e(1337)]){if(t.temporaryLayer?.[e(335)]===e(355)&&t[e(2217)][e(624)][e(1273)][e(1337)]){const i=t[e(2217)];if(this[e(2033)]?.[e(2217)]!==i){if(this._cachedMovingLayer?.[e(746)]){for(const t of this[e(2033)][e(746)][e(417)])n[e(1923)](t.texture);this._cachedMovingLayer=void 0}const t=(i[e(1712)]?.[e(1337)]?i[e(1712)]?.resource:void 0)||i[e(624)][e(1273)].resource,o=wt(n.createTexture());n[e(1230)](n[e(839)]+0),n[e(628)](n[e(1297)],o),n[e(2201)](n[e(1297)],n[e(328)],n.LINEAR),n[e(2201)](n[e(1297)],n.TEXTURE_MAG_FILTER,n[e(2166)]),n[e(2201)](n[e(1297)],n.TEXTURE_WRAP_S,n[e(426)]),n[e(2201)](n[e(1297)],n[e(901)],n.CLAMP_TO_EDGE),n[e(1374)](n[e(1297)],0,n[e(1457)],t[e(1436)],t[e(741)],0,n[e(1457)],n[e(605)],t[e(1675)]),this[e(2033)]={temporaryLayer:i,renderLayer:{tiles:[{blendMode:Ot[e(781)](this[e(1439)].currentLayer.blendMode),texture:o,textureImage:t,range:(0,s.DI)(t[e(1436)],t.height),width:t[e(1436)],height:t[e(741)],scaledWidth:i[e(1167)][e(1578)],scaledHeight:i[e(1167)].scaledHeight,offsetX:i[e(1167)][e(1574)],offsetY:i[e(1167)].offsetY,flipX:i[e(1167)][e(1632)],flipY:i[e(1167)][e(1670)]}]}}}else{const t=this[e(2033)][e(746)].tiles[0];if(t[e(1574)]=i[e(1167)][e(1574)],t[e(1517)]=i.currentState[e(1517)],t[e(1632)]=i.currentState[e(1632)],t[e(1670)]=i[e(1167)][e(1670)],t.blendMode=Ot[e(781)](this._imageService[e(1284)][e(903)]),t[e(1578)]=i[e(1167)][e(1578)],t.scaledHeight=i[e(1167)][e(1299)],i[e(1712)]?.[e(1337)]&&t[e(1766)]!==i[e(1712)].resource){n[e(1923)](t[e(316)]);const s=wt(n.createTexture());n[e(1230)](n[e(839)]+0),n[e(628)](n[e(1297)],s),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n[e(2201)](n.TEXTURE_2D,n[e(1713)],n[e(2166)]),n.texParameteri(n[e(1297)],n[e(911)],n.CLAMP_TO_EDGE),n.texParameteri(n[e(1297)],n[e(901)],n[e(426)]),n[e(1374)](n[e(1297)],0,n[e(1457)],i[e(1712)].resource[e(1436)],i[e(1712)].resource[e(741)],0,n[e(1457)],n[e(605)],i[e(1712)][e(437)][e(1675)]),t[e(316)]=s,t[e(1766)]=i[e(1712)][e(437)]}}0!==this[e(2033)].renderLayer.tiles[0][e(1299)]&&0!==this[e(2033)].renderLayer[e(417)][0].scaledWidth&&d[e(1378)](this[e(2033)][e(746)][e(417)])}}else{const i=t[e(2217)];if(this._cachedVectorLayer?.[e(2217)]!==i){if(this[e(2038)]?.[e(746)]){for(const t of this[e(2038)][e(746)][e(417)])n[e(1923)](t[e(316)]);this[e(2038)]=void 0}const t=(i[e(879)]?.isReady?i[e(879)]?.[e(437)]:void 0)||void 0,o=i.imageTextureRange;if(t&&o){const r=wt(n[e(770)]());n[e(1230)](n[e(839)]+0),n[e(628)](n[e(1297)],r),n[e(2201)](n.TEXTURE_2D,n[e(328)],n[e(1602)]),n.texParameteri(n[e(1297)],n.TEXTURE_MAG_FILTER,n[e(2166)]),n[e(2201)](n[e(1297)],n[e(911)],n.CLAMP_TO_EDGE),n[e(2201)](n[e(1297)],n.TEXTURE_WRAP_T,n[e(426)]),n[e(1374)](n[e(1297)],0,n[e(1457)],t.width,t[e(741)],0,n[e(1457)],n.UNSIGNED_BYTE,t[e(1675)]),this[e(2038)]={temporaryLayer:i,renderLayer:{tiles:[{blendMode:Ot[e(781)](this[e(1439)][e(1284)][e(903)]),texture:r,textureImage:t,width:t[e(1436)],height:t[e(741)],range:(0,s.DI)(t[e(1436)],t[e(741)]),offsetX:o[e(1161)],offsetY:o[e(1116)]}]}}}}else{const t=this[e(2038)].renderLayer[e(417)][0];t[e(903)]=Ot[e(781)](this[e(1439)][e(1284)][e(903)]);const o=(i[e(879)]?.[e(1337)]?i[e(879)]?.[e(437)]:void 0)||void 0,r=i[e(2150)];if(o&&r&&t[e(1766)]!==o){n.deleteTexture(t[e(316)]);const i=wt(n[e(770)]());n[e(1230)](n[e(839)]+0),n[e(628)](n[e(1297)],i),n[e(2201)](n.TEXTURE_2D,n[e(328)],n[e(1602)]),n[e(2201)](n[e(1297)],n[e(1713)],n.NEAREST),n[e(2201)](n[e(1297)],n.TEXTURE_WRAP_S,n[e(426)]),n[e(2201)](n.TEXTURE_2D,n[e(901)],n[e(426)]),n[e(1374)](n[e(1297)],0,n.RGBA,o.width,o[e(741)],0,n[e(1457)],n[e(605)],o.data),t[e(316)]=i,t[e(1766)]=o,t.width=o.width,t.height=o.height,t[e(664)]=(0,s.DI)(o[e(1436)],o[e(741)]),t[e(1574)]=r.left,t[e(1517)]=r[e(1116)]}}this[e(2038)]&&u[e(1378)](this[e(2038)][e(746)][e(417)])}}}const f=[];f[e(1378)](...c),l[e(1840)]>0&&f[e(1378)](l),d.length>0&&f[e(1378)](d),f[e(1378)](...m);for(const[t,i]of f[e(1953)]()){let s;if(t<f.length-1?(s=this[e(570)](n,++a),n.bindFramebuffer(n[e(761)],this[e(666)]),n[e(1180)](n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0)):n[e(1368)](n.FRAMEBUFFER,null),i===l&&"rectangle"===this[e(1439)][e(1284)][e(2217)]?.[e(335)]){const c=this[e(1439)][e(1284)][e(2217)];!s&&(s=this._getFrameBufferTexture(n,++a),n.bindFramebuffer(n[e(761)],this[e(666)]),n[e(1180)](n[e(761)],n[e(1160)],n[e(1297)],s,0)),this[e(786)](n,i,!1,!1,r,o),n[e(628)](n.TEXTURE_2D,null),!this._rectangleShader&&(this._rectangleShader=new Wt(n,this[e(315)]));const l=Ot[e(781)](c[e(1167)].blendMode),d=c[e(756)](),u=this[e(1716)][e(1100)](this[e(1439)][e(1284)],d);!this._blendShader&&(this[e(583)]=new zt(n)),t<f[e(1840)]-1?(s=this[e(583)].blend(s,u,l),h&&(s=this[e(583)][e(847)](h,s,i[0][0][e(903)]))):h?(s=this._blendShader[e(847)](s,u,l),this[e(583)].blend(h,s,i[0][0][e(903)],!1)):this._blendShader[e(847)](s,u,l,!1),n.useProgram(this._program),n[e(1135)](this[e(357)])}else if(i!==l||this[e(1439)][e(1284)][e(2217)]?.[e(335)]!==e(2046)&&this[e(1439)][e(1284)].temporaryLayer?.[e(335)]!==e(2175)&&this._imageService[e(1284)][e(2217)]?.[e(335)]!==e(531)||!this[e(1439)][e(1284)][e(2217)].imageTexture)i===l&&d[e(1840)]>0?(n[e(1230)](n.TEXTURE0+7),n.bindTexture(n[e(1297)],h||this._nullTexture),this[e(1534)]?n[e(2111)](n.RENDERBUFFER,this._frameBufferRenderBuffer):(this[e(1534)]=wt(n.createRenderbuffer()),n[e(2111)](n[e(369)],this[e(1534)]),n.renderbufferStorage(n.RENDERBUFFER,n[e(2081)],n.canvas[e(1436)],n[e(1726)][e(741)])),n.framebufferRenderbuffer(n.FRAMEBUFFER,n[e(1667)],n.RENDERBUFFER,this[e(1534)]),n.clear(n[e(408)]|n[e(706)]|n[e(816)]),n[e(1098)](n[e(2020)]),n[e(498)](n[e(1519)],1,255),n[e(1246)](n[e(367)],n[e(367)],n.REPLACE),n[e(790)](!1,!1,!1,!1),this[e(786)](n,d,!1,!0,r,o),n[e(498)](n[e(380)],1,255),n[e(1246)](n[e(367)],n[e(367)],n[e(367)]),n[e(790)](!0,!0,!0,!0),this[e(786)](n,i,!1,!1,r,o),n[e(628)](n[e(1297)],null),n[e(368)](n[e(2020)]),h&&(n[e(573)](n[e(761)],n[e(1667)],n[e(369)],null),n[e(2111)](n[e(369)],null),!this._blendShader&&(this._blendShader=new zt(n)),s=this[e(583)][e(847)](h,s,i[0][0][e(903)]),n[e(1078)](this[e(729)]),n[e(1135)](this[e(357)]))):(n.activeTexture(n[e(839)]+7),n[e(628)](n[e(1297)],h||this._nullTexture),this[e(786)](n,i,!!h,!1,r,o),n[e(628)](n[e(1297)],null));else{const c=this[e(1439)][e(1284)][e(2217)];!s&&(s=this[e(570)](n,++a),n[e(1368)](n[e(761)],this[e(666)]),n[e(1180)](n[e(761)],n.COLOR_ATTACHMENT0,n[e(1297)],s,0)),this[e(786)](n,i,!1,!1,r,o),n[e(628)](n.TEXTURE_2D,null);const l=xt(n);n[e(1180)](n[e(761)],n[e(1160)],n[e(1297)],l,0),this[e(786)](n,u,!1,!1,r,o);const d=Ot[e(781)](c[e(1167)][e(903)]);n[e(628)](n[e(1297)],null),n[e(573)](n[e(761)],n[e(1667)],n[e(369)],null),n[e(2111)](n[e(369)],null),!this._blendShader&&(this[e(583)]=new zt(n)),t<f[e(1840)]-1?(s=this[e(583)][e(847)](s,l,d),h&&(s=this._blendShader[e(847)](h,s,i[0][0][e(903)]))):h?(s=this[e(583)].blend(s,l,d),this[e(583)][e(847)](h,s,i[0][0][e(903)],!1)):this[e(583)][e(847)](s,l,d,!1),n[e(1078)](this[e(729)]),n.bindVertexArray(this._vertexArrayObject)}s&&(h=s)}}[t(570)](e,i){const s=t;for(;this[s(398)][s(1840)]<i+1;)this[s(398)][s(1378)](xt(e));return this[s(398)][i]}_renderTileSet(e,i,s,n,o,r){const a=t,h=new Float32Array(16),c=Math.round(e.canvas[a(1436)]/window.devicePixelRatio/2)-o[a(1436)]/2*r.zoom+r.x*r[a(1514)],l=Math[a(1266)](e[a(1726)][a(741)]/window.devicePixelRatio/2)-o[a(741)]/2*r.zoom+r.y*r[a(1514)];for(const t of i){const i=t[0];ft(this[a(1679)],c+i[a(664)][a(1161)]*r.zoom,l+i[a(664)][a(1116)]*r[a(1514)],0,h),e[a(1720)](this[a(1843)],e[a(1726)].width,e[a(1726)][a(741)]),e[a(1568)](this[a(796)],7),e[a(1568)](this[a(1975)],s?1:0),e.uniformMatrix4fv(this._matrixUniformLocation,!1,h),e.uniform1iv(this._layerTexturesUniformLocation,Nt),e[a(1720)](this[a(1468)],this[a(407)][0],this[a(407)][1]);let d=0;for(;d<t.length;d++)this._uniformValueBlendModes[d]=t[d][a(903)],e[a(1230)](e[a(839)]+d),e[a(628)](e[a(1297)],t[d][a(316)]);for(;d<=6;d++)e[a(1230)](e.TEXTURE0+d),e.bindTexture(e.TEXTURE_2D,this._nullTexture);e[a(485)](this[a(1386)],this[a(1163)]),e[a(1568)](this[a(445)],t[a(1840)]),e[a(1720)](this._layerOffsetUniformLocation,i[a(1574)]||0,i[a(1517)]||0),e[a(1720)](this[a(1546)],i.scaledWidth??i[a(1436)],i[a(1299)]??i.height),e[a(1720)](this[a(311)],o[a(1436)],o[a(741)]),e[a(1568)](this[a(1437)],n?1:0),e[a(1720)](this[a(1370)],i[a(1632)]?1:0,i[a(1670)]?1:0),e[a(1529)](e[a(675)],0,6)}}[t(672)](e){const i=t;if(0===this[i(1439)][i(1920)][i(1840)])return;this[i(310)]=!1;const s=this._gl;s[i(1135)](this[i(357)]);for(const t of this[i(1439)][i(1920)])this[i(385)](s,t,e)}_updateAttributeBuffersForLayer(e,i,s){const n=t;e.bindVertexArray(this[n(357)]);let o=this._renderLayers.get(i.id);!o&&(o={tiles:[]},this._renderLayers.set(i.id,o)),this[n(1159)](e,o,i,s)}[t(1159)](e,i,n,o){const r=t,a=n[r(1436)],h=Math[r(1651)](n[r(741)]/128);let c=0;i.tiles[r(1840)]=h;for(let t=0;t<h;t++){const l=c,d=Math[r(1266)](n[r(741)]/h*(t+1)),u=d-c;c=d;const m={top:l,bottom:d,left:0,right:a};if(i[r(417)][t]){if(o&&!(0,s.b8)(o,m))continue;e[r(1923)](i[r(417)][t].texture)}const g=wt(e[r(770)]());i.tiles[t]={width:a,height:u,range:m,texture:g,blendMode:Ot[r(781)](n[r(903)])||1},n[r(1574)]&&(i[r(417)][t].offsetX=n[r(1574)]),n[r(1517)]&&(i[r(417)][t][r(1517)]=n.offsetY),e[r(1230)](e[r(839)]+0),e[r(628)](e.TEXTURE_2D,g),e[r(2201)](e[r(1297)],e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e[r(1297)],e[r(1713)],e[r(2166)]),e[r(2201)](e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e[r(2201)](e[r(1297)],e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e[r(1374)](e[r(1297)],0,e[r(1457)],a,u,0,e[r(1457)],e[r(605)],n[r(1675)],l*n[r(1436)]*4)}}[t(1125)](){const e=t;this[e(407)][0]=this[e(315)][e(1514)]*this[e(1439)][e(1436)],this[e(407)][1]=this[e(315)][e(1514)]*this[e(1439)][e(741)]}[t(1889)](){const e=t;this._clipspaceToCanvasCoordsMatrix=gt(0,this[e(2091)][e(1726)][e(1436)]/window[e(1218)],this[e(2091)][e(1726)].height/window[e(1218)],0,-1,1)}}class zt{constructor(e){const i=t;this._gl=e;const s=this[i(2091)];this._program=wt(_t(s,Bt(),Dt())),this[i(357)]=wt(s[i(1917)]()),s.bindVertexArray(this[i(357)]),this._frameBuffer=wt(s[i(1051)]()),this[i(1683)]=xt(s),s[i(1368)](s.FRAMEBUFFER,this[i(666)]);const n=s[i(1282)]();s[i(360)](s[i(535)],n),s[i(2e3)](s[i(535)],new Float32Array([-1,-1,-1,1,1,-1,1,-1,-1,1,1,1]),s[i(712)]),s[i(345)](0),s[i(638)](0,2,s[i(938)],!1,0,0),this[i(352)]=wt(s.getUniformLocation(this[i(729)],"b")),this[i(777)]=wt(s[i(1609)](this._program,"c")),this._blendModeUniformLocation=wt(s[i(1609)](this[i(729)],"a"))}blend(e,i,s,n=!0){const o=t,r=this._gl;return r[o(1078)](this[o(729)]),r[o(1135)](this[o(357)]),n?(r.bindFramebuffer(r[o(761)],this[o(666)]),r.framebufferTexture2D(r[o(761)],r[o(1160)],r[o(1297)],this[o(1683)],0)):r[o(1368)](r[o(761)],null),r[o(1230)](r[o(839)]),r.bindTexture(r[o(1297)],e),r[o(1568)](this[o(352)],0),r[o(1230)](r[o(839)]+1),r.bindTexture(r[o(1297)],i),r[o(1568)](this[o(777)],1),r[o(1568)](this[o(1375)],s),r[o(1529)](r[o(675)],0,6),r[o(1230)](r[o(839)]),r[o(628)](r[o(1297)],null),r[o(1230)](r[o(839)]+1),r[o(628)](r[o(1297)],null),r[o(1368)](r.FRAMEBUFFER,null),this[o(1683)]}resize(){const e=t;this._gl[e(1923)](this[e(1683)]),this[e(1683)]=xt(this[e(2091)])}}class Wt{constructor(e,i){const s=t;this[s(2091)]=e,this[s(315)]=i,this[s(1186)]=vt();const n=this[s(2091)];this[s(729)]=wt(_t(n,Ft(),Pt())),this[s(357)]=wt(n[s(1917)]()),n[s(1135)](this[s(357)]),this[s(1029)]=wt(n.getUniformLocation(this._program,"c")),this[s(902)]=wt(n.getUniformLocation(this[s(729)],"a")),this[s(366)]=wt(n[s(1609)](this[s(729)],"b")),this._frameBuffer=wt(n[s(1051)]()),this[s(1683)]=xt(n),n[s(1368)](n.FRAMEBUFFER,this[s(666)]),this[s(1942)]=wt(n[s(1282)]()),n[s(360)](n.ARRAY_BUFFER,this._rangeBuffer),n[s(345)](0),n[s(638)](0,2,n[s(938)],!1,0,0)}draw(e,i){const s=t,n=this[s(2091)];n[s(1078)](this[s(729)]),n[s(1135)](this[s(357)]),n.bindFramebuffer(n[s(761)],this[s(666)]),n[s(1180)](n.FRAMEBUFFER,n[s(1160)],n[s(1297)],this[s(1683)],0),n[s(554)](n[s(408)]),bt(n,this._matrixUniformLocation,e,this._viewportService,this[s(1186)]),n[s(1720)](this[s(366)],this._viewportService[s(1514)],this._viewportService.zoom);for(const t of i){n[s(361)](this[s(1029)],t.color[0]/255,t.color[1]/255,t[s(1129)][2]/255,t[s(1129)][3]/255),n[s(360)](n[s(535)],this._rangeBuffer);const e=new Float32Array(12*t[s(1361)][s(1840)]);for(let i=0;i<t[s(1361)][s(1840)];i++){const n=t[s(1361)][i],o=12*i;e[o]=e[o+2]=e[o+8]=n.left,e[o+1]=e[o+5]=e[o+7]=n.top,e[o+4]=e[o+6]=e[o+10]=n.right,e[o+3]=e[o+9]=e[o+11]=n.bottom}n[s(2e3)](n[s(535)],e,n[s(2021)]),n[s(1529)](n.TRIANGLES,0,e[s(1840)]/2)}return this[s(1683)]}resize(){const e=t;this[e(2091)][e(1923)](this._frameBufferTexture),this[e(1683)]=xt(this[e(2091)])}}const jt=t(694)+0+t(710)+t(1449)+";\n\nvoid main() {\n  gl_Position = "+t(1449)+" * a_position;\n}",qt=t(1245)+t(987)+t(1689)+"u_color"+t(2057);class Gt extends e.JT{constructor(e,i,s){const n=t;super(),this[n(2091)]=e,this[n(1439)]=i,this._viewportService=s,this[n(1746)]=2,this[n(726)]=new Float32Array(48),this[n(1186)]=vt(),this._positionsNeedsUpdate=!0,this[n(1721)]=!0,this[n(1853)]=new Float32Array(4);const o=this[n(2091)];this._program=wt(_t(o,jt,qt)),this[n(357)]=wt(o[n(1917)]()),o[n(1135)](this[n(357)]),this[n(1528)]=wt(o.createBuffer()),this[n(528)]=wt(o.getUniformLocation(this[n(729)],n(987))),this[n(1012)]=wt(o.getUniformLocation(this[n(729)],n(1449))),this[n(378)](),o[n(360)](o[n(535)],this[n(1528)]),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,o[n(938)],!1,0,0),this.register(this[n(1439)][n(1806)]((()=>{this[n(1288)]=!0,this._matrixNeedsUpdate=!0}))),this[n(1075)](this._viewportService[n(835)]((()=>{const t=n;this._matrixNeedsUpdate=!0,this[t(1288)]=!0})))}[t(378)](e=3){const i=t,s=window[i(2006)](document[i(1589)]).getPropertyValue(i(620))[i(1827)]();if(!s&&e>0)return void setTimeout((()=>this[i(378)](--e)),0);const n=function(e){const i=t;switch(e[i(1840)]){case 7:return(parseInt(e[i(1487)](1),16)<<8|255)>>>0;case 9:return parseInt(e[i(1487)](1),16)>>>0}throw new Error(i(480))}(s||"#181e29");this._backgroundColor[0]=(n>>24&255)/255,this._backgroundColor[1]=(n>>16&255)/255,this[i(1853)][2]=(n>>8&255)/255,this[i(1853)][3]=(255&n)/255}render(){const e=t;if(!this[e(1439)].currentLayer)return;const i=this[e(2091)];i.useProgram(this[e(729)]),i[e(1135)](this._vertexArrayObject),i[e(368)](i[e(1263)]),i[e(361)](this[e(528)],this[e(1853)][0],this._backgroundColor[1],this[e(1853)][2],this[e(1853)][3]),this[e(672)](i,this[e(315)]),this[e(960)](i,this[e(315)]),i[e(1529)](i[e(1015)],0,24)}_updateAttributeBuffers(e,i){const s=t;if(!this._positionsNeedsUpdate)return;e[s(1135)](this[s(357)]),e.bindBuffer(e[s(535)],this[s(1528)]);const n=this[s(584)](),o=this._positionsArray;o[0]=o[2]=o[36]=o[38]=o[40]=o[44]=n[s(1161)],o[4]=o[6]=o[32]=o[34]=o[42]=o[46]=0,o[8]=o[10]=o[18]=o[22]=o[26]=o[28]=o[30]=this[s(1439)][s(1436)]*i[s(1514)],o[12]=o[14]=o[16]=o[20]=o[24]=n[s(594)],o[1]=o[5]=o[9]=o[13]=n[s(1116)],o[3]=o[7]=o[11]=o[15]=o[17]=o[19]=o[45]=o[47]=0,o[21]=o[23]=o[31]=o[35]=o[39]=o[41]=o[43]=this[s(1439)].height*i[s(1514)],o[25]=o[27]=o[29]=o[33]=o[37]=n.bottom,e[s(2e3)](e.ARRAY_BUFFER,this._positionsArray,e.STATIC_DRAW),this[s(1288)]=!1}_updateMatrixUniform(e,i){const s=t;this[s(1721)]&&(bt(e,this[s(1012)],this._imageService,i,this[s(1186)]),this[s(1721)]=!1)}[t(584)](){const e=t,i=this[e(820)](-1,-1),s=this._screenPixelToCanvasCoord(this[e(2091)][e(1726)][e(1436)],this[e(2091)].canvas[e(741)]);return{left:i[0],top:i[1],right:s[0],bottom:s[1]}}[t(820)](e,i){const s=t,n=this[s(2091)];let o=e-n[s(1726)][s(1436)]/2,r=i-n[s(1726)][s(741)]/2;return o+=this[s(1439)][s(1436)]*this[s(315)][s(1514)]/2,r+=this[s(1439)][s(741)]*this[s(315)].zoom/2,o-=this[s(315)].x*this._viewportService[s(1514)],r-=this[s(315)].y*this._viewportService.zoom,[o,r]}}const Xt=t(694)+0+t(710)+t(1449)+t(1753)+t(1449)+t(1435),Yt="#version 300 es\nprecision mediump float;\n\nuniform float "+t(585)+";\n\nin vec2 v_position;\n\nout vec4 outColor;\n\nvoid main() {\n  if (mod(v_position.x / "+t(585)+", 1.) < 1. / "+t(585)+t(1776)+t(585)+t(1500)+"u_pixelsize"+t(504);class Jt extends e.JT{constructor(e,i,s){const n=t;super(),this[n(2091)]=e,this[n(1439)]=i,this[n(315)]=s,this.order=2,this._positionsArray=new Float32Array(8),this[n(1186)]=vt(),this[n(1288)]=!0,this[n(1721)]=!0;const o=this._gl;this._program=wt(_t(o,Xt,Yt)),this[n(357)]=wt(o[n(1917)]()),o[n(1135)](this[n(357)]),this[n(1528)]=wt(o[n(1282)]()),this[n(1012)]=wt(o[n(1609)](this[n(729)],"u_matrix")),this[n(1250)]=wt(o[n(1609)](this[n(729)],"u_pixelsize")),o.bindBuffer(o[n(535)],this[n(1528)]),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,o.FLOAT,!1,0,0),this[n(1075)](this[n(1439)][n(1806)]((()=>{const t=n;this[t(1288)]=!0,this[t(1721)]=!0}))),this.register(this[n(315)][n(835)]((()=>{const t=n;this[t(1721)]=!0,this[t(1288)]=!0})))}[t(625)](){const e=t;if(!this[e(1439)][e(1284)])return;if(!this._viewportService.isPixelGridEnabled||this._viewportService[e(1514)]<4)return;const i=this._gl;i.useProgram(this[e(729)]),i.bindVertexArray(this[e(357)]),i[e(1098)](i[e(1263)]),i[e(750)](i.SRC_ALPHA,i[e(1122)],i[e(1883)],i.ONE_MINUS_SRC_ALPHA),this[e(672)](i,this[e(315)]),this[e(960)](i,this[e(315)]),i[e(1470)](this[e(1250)],this[e(315)].zoom/1),i[e(1529)](i[e(2066)],0,4)}_updateAttributeBuffers(e,i){const s=t;this[s(1288)]&&(e[s(1135)](this[s(357)]),e[s(360)](e[s(535)],this[s(1528)]),this._positionsArray[4]=this[s(726)][6]=this[s(1439)][s(1436)]*i[s(1514)],this._positionsArray[3]=this[s(726)][5]=this[s(1439)][s(741)]*i[s(1514)],e[s(2e3)](e[s(535)],this._positionsArray,e.STATIC_DRAW),this[s(1288)]=!1)}[t(960)](e,i){const s=t;this[s(1721)]&&(bt(e,this[s(1012)],this[s(1439)],i,this._workMatrices),this[s(1721)]=!1)}}const Kt=t(694)+0+t(710)+t(1449)+";\n\nvoid main() {\n  gl_Position = "+t(1449)+" * a_position;\n}",$t=t(470)+"u_shift;\n\nout vec4 outColor;\n\nvoid main() {\n  float c = floor(mod((float(gl_FragCoord.x) + float(gl_FragCoord.y) + "+t(1788)+t(1493);class Zt extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(2091)]=e,this[r(1439)]=i,this[r(1104)]=s,this[r(315)]=o,this.order=2,this[r(726)]=new Float32Array(8),this[r(1186)]=vt(),this[r(1288)]=!1,this[r(1721)]=!0,this._shiftValue=0,this[r(2036)]=!1,this[r(455)]=this[r(1075)](new n.v),this[r(492)]=this[r(455)][r(2220)],this[r(1089)]=this[r(1075)](new n.v),this[r(1839)]=this[r(1089)][r(2220)];const a=this[r(2091)];this[r(729)]=wt(_t(a,Kt,$t)),this._vertexArrayObject=wt(a.createVertexArray()),a[r(1135)](this[r(357)]),this[r(1528)]=wt(a[r(1282)]()),this[r(1012)]=wt(a.getUniformLocation(this[r(729)],"u_matrix")),this[r(1871)]=wt(a[r(1609)](this[r(729)],"u_shift")),a[r(360)](a[r(535)],this[r(1528)]),a[r(345)](0),a[r(638)](0,2,a.FLOAT,!1,0,0),this[r(1075)](this[r(1104)].onUpdate((()=>{const t=r;this[t(1288)]=!0,this[t(2036)]!==!!this[t(1104)][t(664)]&&(this[t(2036)]=!!this[t(1104)][t(664)],this[t(2036)]?this[t(455)].fire():this[t(1089)][t(393)]())}))),this[r(1075)](this[r(1439)][r(1806)]((()=>{const t=r;this._matrixNeedsUpdate=!0,this[t(1288)]=!0}))),this[r(1075)](this[r(315)][r(835)]((()=>{const t=r;this[t(1721)]=!0,this[t(1288)]=!0})))}[t(625)](){const e=t;if(!this[e(1439)][e(1284)])return;const i=this._selectionService[e(664)];if(!i)return;const s=this._gl;s[e(1078)](this[e(729)]),s.bindVertexArray(this[e(357)]),s[e(1098)](s[e(1263)]),s.blendFunc(s.SRC_ALPHA,s[e(1122)]),this[e(672)](s,i,this[e(315)]),this[e(960)](s,this[e(315)]),s[e(1529)](s.LINE_LOOP,0,4)}updateAnimation(){this._updateShiftUniform(this._gl)}_updateAttributeBuffers(e,i,s){const n=t;this._positionsNeedsUpdate&&(e[n(1135)](this[n(357)]),e[n(360)](e[n(535)],this[n(1528)]),1===window.devicePixelRatio?(this._positionsArray[0]=this[n(726)][2]=i[n(1161)]*s[n(1514)]-.5,this._positionsArray[4]=this[n(726)][6]=i[n(594)]*s[n(1514)]+.5,this[n(726)][1]=this[n(726)][7]=i.top*s[n(1514)]-.5,this._positionsArray[3]=this._positionsArray[5]=i.bottom*s[n(1514)]+.5):(this[n(726)][0]=this[n(726)][2]=i.left*s[n(1514)],this._positionsArray[4]=this._positionsArray[6]=i[n(594)]*s[n(1514)],this[n(726)][1]=this[n(726)][7]=i[n(1116)]*s[n(1514)],this[n(726)][3]=this[n(726)][5]=i[n(2077)]*s.zoom),e.bufferData(e[n(535)],this[n(726)],e.STATIC_DRAW),this._positionsNeedsUpdate=!1)}[t(960)](e,i){const s=t;this[s(1721)]&&(bt(e,this[s(1012)],this[s(1439)],i,this._workMatrices),this[s(1721)]=!1)}_updateShiftUniform(e){const i=t;e.useProgram(this[i(729)]),e[i(1135)](this._vertexArrayObject),this[i(2048)]=(this[i(2048)]+1)%8,e[i(1470)](this._shiftLocation,this[i(2048)])}}const Qt=t(694)+0+") in vec4 a_position;\n\nuniform mat4 "+t(1449)+t(982)+"u_matrix"+t(1018),te=t(1842);class ee extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this._gl=e,this._imageService=i,this[r(1104)]=s,this[r(1141)]=n,this[r(315)]=o,this[r(1746)]=2,this[r(395)]=new Float32Array(8),this[r(1186)]=vt(),this[r(1288)]=!1,this[r(1721)]=!0;const a=this[r(2091)];this[r(729)]=wt(_t(a,Qt,te)),this[r(357)]=wt(a[r(1917)]()),a[r(1135)](this._vertexArrayObject),this[r(1528)]=wt(a.createBuffer()),this._matrixLocation=wt(a[r(1609)](this._program,r(1449))),a[r(360)](a.ARRAY_BUFFER,this[r(1528)]),a.enableVertexAttribArray(0),a[r(638)](0,2,a[r(938)],!1,0,0),this.register(this._selectionService[r(835)]((()=>this[r(1288)]=!0))),this[r(1075)](this[r(315)][r(835)]((()=>{this[r(1288)]=!0,this._matrixNeedsUpdate=!0})))}render(){const e=t;if(!this[e(1439)].currentLayer)return;if(!this[e(1141)][e(462)]?.[e(1567)])return;const i=this[e(1104)].range;if(!i)return;const s=this._gl;s.useProgram(this[e(729)]),s[e(1135)](this._vertexArrayObject),function(e,i){const s=t;if(i!==s(1310))throw new Error(s(1430));e[s(1098)](e[s(1263)]),e.blendFuncSeparate(e[s(1659)],e.ONE_MINUS_SRC_ALPHA,e.ONE,e[s(1122)])}(s,e(1310)),this[e(672)](s,i,this[e(315)]),this[e(960)](s,this._viewportService),s.drawArrays(s[e(2066)],0,4)}[t(672)](e,i,s){const n=t;this[n(1288)]&&(e[n(360)](e[n(535)],this._positionBuffer),this._positionArray[0]=this[n(395)][2]=i.left*s.zoom,this[n(395)][4]=this[n(395)][6]=i.right*s[n(1514)],this[n(395)][1]=this._positionArray[7]=i[n(1116)]*s[n(1514)],this._positionArray[3]=this[n(395)][5]=i.bottom*s[n(1514)],e[n(2e3)](e[n(535)],this[n(395)],e.DYNAMIC_DRAW),this[n(1288)]=!1)}_updateMatrixUniform(e,i){const s=t;this[s(1721)]&&(bt(e,this[s(1012)],this[s(1439)],i,this[s(1186)]),this._matrixNeedsUpdate=!1)}}class ie extends e.JT{constructor(i,s,n,o,r){const a=t;if(super(),this[a(1086)]=i,this._imageService=s,this[a(1104)]=n,this._toolService=o,this[a(315)]=r,this[a(1724)]=[],this[a(1756)]=[],this[a(1039)]=new Set,this[a(773)]=0,this[a(1321)]=0,this[a(1063)]=!1,this[a(1740)]=0,this._isPaused=!1,this[a(392)]=[],this[a(2029)]=[],this._canvas=document[a(1132)]("canvas"),this[a(963)]=document[a(1132)](a(1726)),this._canvasSelection[a(1372)][a(1769)](a(725)),this._viewsElement=document[a(1132)](a(1525)),this[a(413)][a(1372)].add(a(1349)),this._container[a(684)](this[a(640)],this[a(963)],this[a(413)]),this[a(1075)]({dispose:()=>{const t=a;this[t(640)][t(1198)]&&this[t(1086)].removeChild(this[t(640)]),this[t(640)][t(1198)]&&this[t(1086)][t(803)](this[t(963)]),this._container[t(803)](this[t(413)])}}),this[a(1075)](this._viewportService[a(1638)](((t,e)=>{const i=a;this._resize(t,e),this[i(625)](),this[i(1714)](!0)}))),this[a(1075)](this._viewportService[a(835)]((()=>{const t=a;this.render(),this[t(1714)](!0)}))),this.register(this[a(1104)].onUpdate((()=>this[a(1714)](!0)))),this[a(1075)](this[a(1439)][a(835)]((()=>this.render()))),this.register(this[a(1439)][a(613)]((()=>this[a(625)]()))),this[a(1075)](this[a(1439)].onLayerChange((()=>this[a(625)]()))),this[a(1075)](this[a(1141)][a(1637)]((t=>this[a(2075)](t)))),this[a(1075)]((0,e.Lw)(this[a(640)],a(655),(()=>this.showError(a(581))))),!(a(320)in window)){const t=a(1897);throw this[a(2179)](t),new Error(t)}const h=this[a(640)][a(1499)]("webgl2",{antialias:!1,premultipliedAlpha:!1,stencil:!0});if(!h){const t="WebGL2 is not supported";throw this[a(2179)](t),new Error(t)}this[a(2091)]=h,this[a(1451)]=wt(this._canvasSelection.getContext(a(748),{antialias:!1})),this[a(1947)](this[a(1086)][a(1338)],this[a(1086)][a(1547)]),this[a(2091)][a(1446)](0,0,0,0),this._gl.clear(this[a(2091)][a(408)]),this[a(1451)].clearColor(0,0,0,0),this[a(1451)][a(554)](this[a(2091)].COLOR_BUFFER_BIT),this[a(1724)][a(1378)](new Gt(this._gl,this[a(1439)],this[a(315)])),this[a(1724)][a(1378)](new Ct(this[a(2091)],this[a(1439)],this[a(315)])),this[a(1144)]=new Ht(this[a(2091)],this[a(1439)],this[a(315)]),this[a(1724)][a(1378)](new Jt(this._gl,this[a(1439)],this[a(315)])),this[a(1756)][a(1378)](new ee(this[a(1451)],this[a(1439)],this._selectionService,this._toolService,this[a(315)])),this._animationRenderPrograms[a(1378)](new Zt(this._glSelection,this._imageService,this[a(1104)],this[a(315)]));for(const t of this[a(1756)])t[a(492)]&&t[a(1839)]&&(t[a(492)]((()=>this[a(1970)](t))),t.onStopAnimating((()=>this[a(1664)](t))));const c=new MutationObserver((()=>{const t=a;this[t(698)](),this[t(625)]()}));c[a(718)](document[a(1589)],{attributes:!0,attributeFilter:[a(1412)]}),this[a(1075)]({dispose:()=>c[a(2183)]()}),this[a(698)](),this.render();let l=this[a(1439)][a(835)]((()=>{this[a(1086)].classList.add("loaded"),l?.dispose(),l=void 0}));this[a(1075)]({dispose:()=>l?.dispose()})}[t(698)](){const e=t;for(const t of this[e(1724)])t[e(378)]?.()}[t(1947)](e,i){const s=t,n=e*window.devicePixelRatio,o=i*window.devicePixelRatio;this[s(640)].width=n,this[s(640)][s(741)]=o,this[s(640)].style[s(1436)]=e+"px",this[s(640)][s(1412)][s(741)]=i+"px",this._canvasSelection[s(1436)]=n,this[s(963)][s(741)]=o,this._canvasSelection[s(1412)][s(1436)]=e+"px",this._canvasSelection[s(1412)][s(741)]=i+"px",this[s(2091)].viewport(0,0,n,o),this._glSelection[s(818)](0,0,n,o),this[s(413)][s(1412)][s(399)]=s(1882),this[s(413)][s(1412)][s(1161)]="0",this[s(413)].style[s(1116)]="0",this[s(413)][s(1412)].right="0",this[s(413)][s(1412)].bottom="0",this._imageCanvasRenderProgram?.[s(1924)]()}[t(1600)](){this[t(561)]=!0}[t(697)](){const e=t;this._isPaused&&(this[e(561)]=!1,this[e(625)](),this[e(1714)](!0))}[t(625)](){const e=t;0===this[e(773)]&&(this[e(773)]=window[e(513)]((()=>this[e(1708)]())))}[t(1714)](e=!1){const i=t;if(this._isPaused&&!e)return window[i(1628)](this[i(1321)]),void(this[i(1321)]=0);this[i(1063)]=this[i(1063)]||e,0===this[i(1321)]&&(this[i(1321)]=window[i(513)]((()=>this._renderSelection())))}_render(){const e=t;this._renderProgramsWithOrder(this[e(1724)],1),!this[e(1141)][e(462)]?.[e(1567)]&&this[e(1471)](this[e(392)],1),this[e(1144)][e(625)](),this[e(1471)](this[e(1724)],2),!this[e(1141)][e(462)]?.[e(1567)]&&this[e(1471)](this._toolRenderPrograms,2),this[e(773)]=0}[t(1919)](){const e=t,i=!!this[e(1104)][e(664)];if(this[e(963)][e(1412)][e(370)]=e(i?802:696),this[e(1321)]=0,!i)return void(this._forceSelectionAnimation=!1);const s=this[e(1740)]<=Date[e(449)]()-50;if(!this[e(1063)]&&!s)return this[e(1063)]=!1,void this.renderSelection();if(this[e(1063)]=!1,s){for(const t of this._animationRenderPrograms)t.updateAnimation&&t[e(1188)]();this[e(1740)]=Date[e(449)]()}this[e(1039)][e(1354)]>0&&this[e(1471)](this[e(1756)],2),this[e(1141)][e(462)]?.isSelectionTool&&this[e(1471)](this._toolRenderPrograms,2),this[e(1714)]()}[t(1471)](e,i){const s=t;for(const t of e)t[s(1746)]===i&&t[s(625)]()}[t(1970)](e){const i=t;this[i(1039)][i(1769)](e),this[i(1714)]()}_stopAnimatingProgram(e){const i=t;this[i(1039)][i(1279)](e)}[t(2075)](i){const s=t;(0,e._c)(this._toolDisposables),this[s(2029)].length=0;for(const t of this[s(392)])t[s(1676)]&&t[s(1676)]();let n;this._toolRenderPrograms[s(1840)]=0,i[s(1801)]?n=i.createRenderProgram(this[s(2091)]):i[s(714)]&&(n=i.createDomRenderProgram(this._viewsElement)),n&&(Array[s(2160)](n)?this._toolRenderPrograms[s(1378)](...n):this[s(392)].push(n),i[s(613)]&&this[s(2029)][s(1378)](i[s(613)]((()=>this[s(625)]())))),n&&this.render()}[t(2179)](e){const i=t;this._canvas.parentElement&&this._container[i(803)](this[i(640)]);const s=document[i(1132)](i(1525));s[i(1634)]=e,s[i(1412)][i(399)]=i(1882),s[i(1412)][i(1161)]="50%",s[i(1412)][i(1116)]=i(568),s[i(1412)][i(1495)]=i(414),this[i(1086)][i(1372)][i(650)]("loaded"),this[i(1086)][i(984)](s)}[t(1502)](e){const i=t,s=document[i(1132)](i(1525));s[i(1634)]=e,s.classList[i(1769)](i(1984)),this[i(1086)][i(984)](s),setTimeout((()=>{s[i(1372)].add("fade"),setTimeout((()=>{s.remove()}),500)}),250)}}class se extends e.JT{constructor(e,i,s,n,o){const r=t;super(),this._elementService=e,this._imageService=i,this._selectionService=s,this[r(1141)]=n,this[r(315)]=o,this.register(this[r(1183)][r(1826)]((t=>this[r(2050)](t)))),this[r(1075)]({dispose:()=>this[r(2137)]?.[r(1676)]()})}[t(625)](){const e=t;this[e(2137)]?.[e(625)]()}[t(1600)](){const e=t;this._renderer?.[e(1600)]()}[t(697)](){const e=t;this[e(2137)]?.[e(697)]()}[t(2050)](e){const i=t;this[i(2137)]?.dispose(),this[i(2137)]=new ie(e,this[i(1439)],this._selectionService,this[i(1141)],this[i(315)])}[t(2179)](t){this._renderer?.showError(t)}[t(1502)](e){const i=t;this[i(2137)]?.[i(1502)](e)}}class ne{constructor(e,i,s,n,o){const r=t;this[r(1104)]=e,this.operationName=i,this[r(1253)]=s,this[r(550)]=n,this[r(1597)]=o,this[r(335)]=r(548),this[r(510)]=0}undo(){this[t(888)](this.undoRange)}[t(772)](){const e=t;this[e(888)](this[e(1597)])}[t(888)](e){const i=t;this[i(1104)][i(664)]=e?{left:e[i(1161)],top:e[i(1116)],right:e.right,bottom:e.bottom}:void 0}[t(1348)](){const e=t;return{id:e(548),operationName:this[e(709)],requiresTool:this[e(1253)],undoRange:this[e(550)],redoRange:this[e(1597)]}}static create(e,i){const s=t;return new ne(e,i.operationName,i[s(1253)],i[s(550)],i[s(348)])}}class oe extends e.JT{constructor(e){const i=t;super(),this[i(1551)]=e,this[i(1711)]=this[i(1075)](new n.v),this[i(835)]=this[i(1711)][i(2220)],this[i(1789)]=this.register(new n.v),this[i(1208)]=this[i(1789)][i(2220)],this[i(1551)].registerHistoryEntryHandler(i(548),{undo:t=>{const e=i;t[e(1652)](this[e(642)]),this._lastCommittedRange=t[e(550)]},redo:t=>{const e=i;t[e(772)](this._range),this[e(1955)]=t.undoRange}}),this[i(1551)][i(2085)](i(548),ne[i(1182)][i(950)](null,this))}get[t(664)](){return this[t(642)]}set[t(664)](e){const i=t;if(e&&(e[i(1161)]>e[i(594)]||e[i(1116)]>e[i(2077)]))throw new Error("Invalid range - left: "+e.left+i(1460)+e[i(594)]+i(1119)+e[i(1116)]+", bottom: "+e[i(2077)]);this[i(642)]=e,this._onUpdate[i(393)]()}[t(1277)](e,i){const n=t;if(!this[n(642)])return;const o=(0,s.BN)(this.range);(0,s.Hd)(o,e,i),this[n(664)]=o}[t(1271)](e,i){const s=t;this[s(642)]&&(this[s(642)][s(1161)]>=e||this[s(642)][s(1116)]>=i||this[s(642)].bottom<=0||this[s(642)][s(594)]<=0?this[s(642)]=void 0:this.range={left:Math[s(1590)](this[s(642)][s(1161)],0),top:Math[s(1590)](this[s(642)].top,0),right:Math[s(2219)](this[s(642)].right,e),bottom:Math[s(2219)](this[s(642)].bottom,i)})}deselect(){const e=t;this[e(664)]=void 0,this[e(1061)]("Deselect")}[t(1033)](e,i){this[t(664)]=i,this.commit(e)}[t(1061)](e,i){const s=t;if(function(e,i){const s=t;return i&&e?e[s(1161)]===i[s(1161)]&&e[s(1116)]===i.top&&e.right===i[s(594)]&&e[s(2077)]===i.bottom:!e&&!i}(this._lastCommittedRange,this[s(664)]))return;const n=new ne(this,e,i,this[s(1955)],this[s(664)]);this._historyService.createCompositeEntrySync(e,(()=>{const t=s;this._historyService[t(1828)](n),this._onCommit[t(393)]()})),this[s(1955)]=this[s(664)]}[t(1009)](e,i){const s=t;return!this[s(642)]||e>=this[s(642)][s(1161)]&&e<this[s(642)].right&&i>=this[s(642)].top&&i<this[s(642)][s(2077)]}[t(1348)](){return this[t(642)]}[t(1101)](e){this[t(664)]=e}}var re=i(7166);class ae{constructor(e,i,s){const n=t;this[n(709)]=e,this[n(1902)]=i,this._f=s}async[t(1997)](){const e=t,i={data:(0,re.Qf)(this[e(1902)],(0,s.DI)(this._layer[e(1436)],this[e(1902)][e(741)])),width:this[e(1902)].width,height:this._layer.height};let n;await this._layer[e(1158)]((async(t,e,i)=>(n=await this._f(t,e,i),n)));const o={data:(0,re.Qf)(n,(0,s.DI)(n[e(1436)],n[e(741)])),width:n.width,height:n.height};return new D(this.operationName,this[e(1902)][e(1040)],this[e(1902)].id,i,o)}}class he{constructor(e,i,s,n){const o=t;this[o(925)]=e,this[o(1439)]=i,this[o(681)]=s,this[o(1095)]=n}[t(1997)](){const e=t;if(this[e(1439)].width===this[e(681)]&&this[e(1439)][e(741)]===this[e(1095)])return;const i={width:this._imageService.width,height:this[e(1439)][e(741)]},s={width:this[e(681)],height:this[e(1095)]},n=new T(this[e(925)],i,s);return n[e(772)](this[e(1439)][e(1924)][e(950)](this._imageService)),n}}class ce extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1551)]=e,this[r(1439)]=i,this[r(1104)]=s,this._taskWorkerService=o,this[r(1219)]=this.register(new n.v),this[r(1088)]=this._onProgress[r(2220)],this[r(1734)]=this[r(1075)](new n.v),this[r(423)]=this[r(1734)].event}async[t(764)](e,i){const s=t,n=this[s(1439)][s(1920)];if(0===n[s(1840)])return;await this[s(1734)][s(723)](this[s(997)](e));const o={left:0,top:0,right:this[s(1439)].width,bottom:this._imageService[s(741)]},r="Image: "+le(e);await this._historyService[s(810)](r,(async()=>{const t=s;let a;for(const s of n)a=await this[t(623)](e,i,s,r,o);a&&(a[t(1774)][t(1436)]!==o.right||a[t(1774)][t(741)]!==o[t(2077)])&&this[t(1551)].runSyncAction(new he("Resize",this[t(1439)],a[t(1774)].width,a[t(1774)][t(741)])),a?.[t(548)]!==this._selectionService[t(664)]&&(this[t(1104)].range=a?.selection,this[t(1104)][t(1061)]("Update Selection"))}))}async executeOnSingleLayer(e,i){const s=t,n=this[s(1439)][s(1284)];if(!n)return;await this[s(1734)].fireAndWait(this[s(997)](e));const o={left:0,top:0,right:n.width,bottom:n[s(741)]},r=s(1909)+le(e);await this[s(1551)][s(810)](r,(async()=>{const t=s,a=await this._doExecuteOnLayer(e,i,n,r,o);if(a?.selection!==this[t(1104)][t(664)]&&(this[t(1104)].range=a?.[t(548)],this[t(1104)][t(1061)](t(614))),a&&(a.dest.width!==o.right||a[t(1774)][t(741)]!==o[t(2077)]))throw new Error(t(1516))}))}async[t(623)](e,i,s,o,r){const a=t;let h;return await this._historyService[a(1422)](new ae(o,s,(async(t,s,o)=>{const r=a,c=this._taskWorkerService.runLayerTask(e,i,{data:t,width:s,height:o},this[r(1104)][r(664)]);return(0,n.B)(c[r(1088)],this[r(1219)]),h=await c.result,h[r(1774)]}))),h}[t(997)](e){return{finishSelection:e!==t(679)}}}function le(e){const i=t;switch(e){case"layer/crop":return i(482);case i(1694):return"Crop to Selection";case i(679):return i(2014);case i(467):return"Flip Horizontal";case i(545):return i(436);case"layer/invertColors":return"Invert Colors";case"layer/resize":return i(2113);case"layer/resizeCanvas":return i(394);case i(683):return"Rotate 180°";case i(460):return"Rotate 90° Clockwise";case i(811):return"Rotate 90° Counter-Clockwise";default:return"Unknown"}}function de(){const e=t;return new Worker(i.p+e(775))}const ue=new Map;ue.set(t(923),(e=>(0,s.rY)(e[t(664)]))),ue[t(475)](t(1091),(e=>e[t(1091)][t(741)])),ue[t(475)](t(1416),(()=>1)),ue[t(475)](t(866),(()=>1)),ue.set(t(1115),(()=>1)),ue[t(475)](t(1738),(t=>(0,s.rY)(t.range))),ue[t(475)](t(2176),(()=>1)),ue[t(475)](t(496),(()=>1)),ue.set(t(304),(e=>e[t(2068)][t(741)])),ue[t(475)](t(1054),(e=>(0,s.rY)(e[t(1153)])));let me=!1;class ge extends e.JT{get disableWorkers(){return me}set disableWorkers(t){me=t}[t(656)](t,e,i,s){return new pe(t,e,i,s)}runTask(e,i){const s=t;return new _e(e,i,this[s(1937)](e,i))[s(1660)]}[t(1937)](e,i){const s=t,n=ue.get(e);if(!n)throw new Error(s(1640)+e+'"');return n(i)}async generateLayerPreview(e,i,s){const n=t,o={sourceImage:e,destImage:(0,re.uF)(i,s)};let r;return e[n(1436)]===i&&e[n(741)]===s?r=new ImageData(new Uint8ClampedArray(o[n(1673)].data),i,s):(await this[n(686)](n(304),o),r=new ImageData(new Uint8ClampedArray(o[n(2068)].data),i,s)),createImageBitmap(r)}}class fe extends e.JT{constructor(e,i){const s=t;super(),this[s(1387)]=e,this[s(2134)]=i,this[s(1244)]=0,this[s(1e3)]=0,this[s(1219)]=this[s(1075)](new n.v),this[s(1088)]=this._onProgress[s(2220)],this._startTime=performance[s(449)](),this[s(1238)]=setInterval((()=>this[s(1696)]()),1e3)}[t(523)](){const e=t;this[e(1238)]&&(clearInterval(this._reportInterval),this._reportInterval=0,this[e(1696)]())}[t(431)](e,i){const s=t;this._progress[e]=i,this[s(578)]()}[t(578)](){const e=t;!this[e(1e3)]&&(this._progressTimeout=window[e(961)]((()=>{const t=e;this[t(1560)](),this[t(1e3)]=0}),0))}_reportProgress(){const e=t,i=this[e(2134)][e(1056)](((t,e)=>t+e),0)/this[e(2134)].length;this._progressLast!==i&&(this[e(1219)].fire(i),this[e(1244)]=i)}[t(1696)](){const e=t,i=this[e(2134)][e(1056)](((t,e)=>t+e),0)/this[e(2134)].length,s=Math.round(i/.05),n=20-s;let o="["+"█".repeat(s)+" "[e(1106)](n)+"]";if(1===i){const t=" "+(performance[e(449)]()-this[e(2130)])[e(1877)](0)+"ms ";o="["+t[e(327)](t[e(1840)]+Math[e(1727)]((20-t.length)/2),"█")[e(1066)](20,"█")+"]"}console.info(o+" "+Math[e(1266)](100*i)[e(1629)]()[e(327)](3," ")+"% "+this._name)}}class pe extends fe{constructor(e,i,n,o){const r=t,a="width"in i&&r(741)in i;let h=a?i[r(1436)]:n[r(1436)],c=a?i[r(741)]:n[r(741)];switch(e){case r(1694):if(!o)throw new Error(r(1658));const t=(0,s.l$)(o,(0,s.DI)(n[r(1436)],n.height));h=(0,s.Oq)(t),c=(0,s.rY)(t);break;case r(679):if(!o)throw new Error("Cannot run expand canvas to selection without a selection");const e=(0,s.DI)(n[r(1436)],n[r(741)]),i=(0,s.qi)(e,o);h=(0,s.Oq)(i),c=(0,s.rY)(i);break;case r(460):case r(811):h=n[r(741)],c=n[r(1436)]}const l=h*c*4,d=r(1774)in i?i.dest:{data:new Uint8Array(new SharedArrayBuffer(l)),width:h,height:c},u=[],m=Math.min(navigator[r(2037)]||1,Math[r(1590)](d[r(741)]/100,1));super(e,new Float32Array(m));for(let t=0;t<m;t++){const s={id:t,yStart:Math[r(1727)](t/m*d[r(741)]),yEnd:Math[r(2219)](Math[r(1727)]((t+1)/m*d.height),d[r(741)]),xStart:Math[r(1727)](t/m*d[r(1436)]),xEnd:Math[r(2219)](Math[r(1727)]((t+1)/m*d.width),d.width)};u[r(1378)](this[r(1527)](e,i,n,d,o,s))}this[r(1660)]=Promise[r(1326)](u)[r(1905)]((()=>(this[r(523)](),{selection:this.selection,dest:d})))[r(1854)]((t=>{throw this[r(523)](),t}))}[t(1527)](t,e,s,n,o,r){return new Promise((async(a,h)=>{const c=a2_0x4755;let l;if(me){const t=await i.e(9174).then(i[c(950)](i,9174));l=new ye(t.createMessageHandler)}else l=new de;const d={type:c(1402),taskName:t,source:s,dest:n,selection:o,options:e,job:r};l[c(1797)](d),l[c(676)]=e=>{const i=c;switch(e[i(1675)][i(335)]){case i(907):this[i(431)](r.id,1),this[i(548)]=e[i(1675)][i(548)],a(),l.terminate();break;case i(1053):this[i(431)](r.id,1),h('Task "'+t+i(1570)+e[i(1675)][i(1020)]),l[i(890)]();break;case i(1709):this[i(431)](r.id,e[i(1675)][i(974)])}}}))}}class _e extends fe{constructor(e,i,s){const n=t,o=[],r=Math.min(navigator[n(2037)]||1,Math[n(1590)](Math[n(1651)](s/100),1));super(e,new Float32Array(r));for(let t=0;t<r;t++){const a=Math[n(1727)](t/r*s),h=Math.floor((t+1)/r*s),c={id:t,start:a,end:h,size:h-a};o[n(1378)](this[n(1527)](e,i,c))}this.result=Promise[n(1326)](o).then((t=>{const e=n;return this[e(523)](),0===t[e(1840)]?void 0:t[0]}))[n(1854)]((t=>{throw this[n(523)](),t}))}[t(1527)](t,e,s){return new Promise((async(n,o)=>{const r=a2_0x4755;let a;if(me){const t=await i.e(9174)[r(1905)](i[r(950)](i,9174));a=new ye(t.createMessageHandler)}else a=new de;const h={type:r(1802),taskName:t,args:e,job:s};a.onmessage=e=>{const i=r;switch(e.data[i(335)]){case i(907):this[i(431)](s.id,1),n(e[i(1675)].result),a[i(890)]();break;case i(1053):this[i(431)](s.id,1),o(i(2190)+t+i(1570)+e[i(1675)][i(1020)]),a[i(890)]();break;case"progress":this[i(431)](s.id,e[i(1675)].percent)}},a[r(1797)](h)}))}}class ye{constructor(e){const i=t;this[i(676)]=()=>{},this._messageHandler=e(this[i(931)][i(950)](this))}[t(1797)](e){this[t(1111)]({data:e})}[t(890)](){}[t(931)](e){this[t(676)]({data:e})}}const we=new Map([[t(975),{file:t(975)}],[t(1006),{file:"crop"}],[t(1621),{file:t(1621)}],[t(979),{file:t(979)}],[t(1379),{file:t(1379)}],[t(2046),{file:"line"}],[t(1070),{file:"movePixels"}],[t(2214),{file:t(2214)}],[t(1014),{file:t(1014)}],[t(516),{file:t(516)}],[t(548),{file:t(548)}],[t(2175),{file:t(2175)}],[t(531),{file:"text"}],[t(1514),{file:t(1514)}]]);class ve extends e.JT{constructor(e,i,s,o,r,a,h,c,l){const d=t;super(),this[d(1531)]=e,this[d(1551)]=i,this[d(1439)]=s,this._inputService=o,this[d(1384)]=r,this[d(1104)]=a,this[d(695)]=h,this[d(799)]=c,this[d(315)]=l,this[d(1067)]=!1,this[d(962)]=0,this._pointerDownX=0,this[d(2139)]=0,this[d(1017)]=this[d(1075)](new n.v),this[d(1637)]=this[d(1017)][d(2220)],this._sc={configService:this[d(1531)],historyService:this._historyService,imageService:this[d(1439)],paletteService:this[d(1384)],selectionService:this[d(1104)],taskService:this[d(695)],taskWorkerService:this[d(799)],viewportService:this._viewportService},this._inputService.onPointerDown((t=>{const e=d;this[e(1067)]=!0,document.body[e(1372)].toggle(e(765),0===t[e(1376)]),document.body[e(1372)][e(494)](e(1168),2===t.button),this._lastPointerEvent=t})),this[d(1102)].onPointerDownMove((t=>this[d(891)]=t)),this._inputService[d(1873)]((t=>this[d(891)]=t)),this[d(1102)][d(2184)]((()=>{const t=d;this[t(1067)]=!1,document.body[t(1372)][t(650)]("mouseleft"),document[t(2106)][t(1372)][t(650)](t(1168))})),this[d(1075)](this[d(315)][d(835)]((()=>{const t=d;if(this[t(891)]){const e=this._activeUntilReleaseTool||this[t(462)];e?.[t(604)]?.(this._lastPointerEvent,this[t(1067)]),this[t(1067)]&&e?.pointerDownMove?.(this[t(891)])}}))),this[d(1102)].onKeyUp((t=>{const e=d;t[e(1030)]===this._activeUntilReleaseToolKey&&(this[e(619)]=void 0,this._clearUntilReleaseTool())})),this[d(1551)][d(2174)]((t=>this.setTool(t))),this[d(1439)][d(948)]((t=>{const e=d;t.type===e(355)&&this.setTool("movePixels")})),this[d(1551)].onUndo((()=>this[d(560)]())),this[d(1551)][d(566)]((()=>this[d(560)]())),this[d(1102)][d(851)]((t=>{const e=d;this[e(962)]=Date[e(449)](),this[e(1816)]=t[e(1574)],this[e(2139)]=t[e(1517)]})),this[d(1351)](this._inputService.onDblClick,d(2142)),this[d(1351)](this[d(1102)][d(1962)],d(1302)),this[d(1351)](this[d(1102)][d(969)],"keyUp"),this[d(1351)](this._inputService[d(851)],d(1117)),this[d(1351)](this[d(1102)][d(966)],d(1876)),this[d(1351)](this[d(1102)][d(1873)],d(604)),this.register(this[d(1102)][d(2184)]((t=>{const e=d,i=Math[e(869)](this[e(1816)]-t.offsetX),s=Math[e(869)](this[e(2139)]-t[e(1517)]);let n=!1;i<10&&s<10&&Date[e(449)]()-this._pointerDownStartTime<150&&(n=!0),(this[e(1171)]||this[e(462)])?.[e(318)]?.(t,n),void 0===this._activeUntilReleaseToolKey&&this[e(2043)]()})))}get activeTool(){return this._activeTool}async setTool(e,i){const s=t;if(e===this[s(537)]?.id)return;if(i?.[s(2205)]&&this[s(1171)])return;if(!i?.untilRelease&&this._activeTool?.[s(1676)](),"string"!=typeof e)return void(i?.[s(2205)]?(this[s(1171)]=e,this[s(619)]=i[s(2205)]):this[s(537)]=e);const n=we[s(781)](e);if(!n)throw new Error(s(621)+e);if(!n.factory){this[s(537)]=void 0;const t=await this[s(1335)](s(1381),n.file);n[s(1893)]=e=>new t(e)}const o=n[s(1893)](this._sc);i?.[s(2205)]?(this[s(1171)]=o,this[s(619)]=i[s(2205)]):this[s(537)]=o,document[s(2106)][s(1605)](s(1751),o.id),this[s(1366)](o),o.onStateChange&&o.onStateChange((()=>this[s(1366)](o))),this[s(1017)].fire(o)}[t(1366)](e){const i=t;e[i(1898)]?document.body[i(1605)](i(1991),e.state):document[i(2106)][i(1475)]("data-tool-state")}_clearUntilReleaseTool(){const e=t;this[e(1171)]&&!this[e(1067)]&&(this._activeUntilReleaseToolKey||(this[e(1171)]=void 0,this[e(462)]&&(document[e(2106)][e(1605)](e(1751),this[e(462)].id),this[e(1366)](this[e(462)]),this._onToolChange[e(393)](this[e(462)]))))}async[t(1335)](e,s){const n=t,o=await i(1038)("./"+e+"/"+s+n(358));if(!o)throw new Error(n(1901)+s+", try reopening the editor.");return o.default}[t(1351)](e,i){const s=t;this[s(1075)](e((t=>{const e=s,n=this[e(1171)]||this[e(462)],o=n?n[i]:void 0;o&&o[e(950)](n)(t,this[e(1102)]?.[e(1395)])})))}[t(560)](){const e=t;this[e(891)]&&window[e(961)]((()=>{const t=e;this[t(891)]&&(this[t(1171)]||this.activeTool)?.pointerMove?.(this[t(891)],this[t(1067)])}))}[t(1348)](){const e=t;return{activeToolId:this._activeTool?.id,activeToolState:this[e(462)]?.[e(1348)]?.()}}[t(1101)](e){const i=t;e[i(1441)]&&this[i(2075)](e[i(1441)])[i(1905)]((()=>{const t=i;e[t(797)]&&(this._activeTool?this[t(537)][t(1101)]?this._activeTool[t(1101)](e[t(797)]):console.error('No matching deserialize call for tool "'+e.activeToolId+'"'):console[t(1053)](t(924)+e[t(1441)]+'"'))}))}}var be=i(7896);const xe=new Uint16Array([1,2,3,4,5,6,7,8,9,10,11,12,13,15,17,19,21,24,27,30,34,38,43,48,54,60,64,70,76,82,90,100]);class Ie extends e.JT{constructor(e,i,s,o){const r=t;super(),this[r(1531)]=e,this[r(1183)]=i,this[r(1439)]=s,this[r(878)]="scroll",this[r(990)]=20,this._isPixelGridEnabled=!0,this._isScrollLocked=!1,this._x=0,this._y=0,this[r(1941)]={x:0,y:0},this[r(1834)]=0,this[r(1711)]=this[r(1075)](new n.v),this.onUpdate=this._onUpdate[r(2220)],this[r(1878)]=this[r(1075)](new n.v),this[r(1638)]=this[r(1878)].event,this[r(1347)]=this.register(new n.v),this.onPixelGridEnabledChange=this[r(1347)][r(2220)],this._onZoomChange=this[r(1075)](new n.v),this.onZoomChange=this[r(1177)].event,this._onPointerCoordChange=this[r(1075)](new n.v),this.onPointerCoordChange=this[r(1515)][r(2220)],this[r(1531)][r(2071)]((t=>this.mouseWheelBehavior=t[r(878)])),this[r(1075)](this[r(1439)][r(1806)]((()=>this[r(846)]()))),this.register(this._elementService[r(1826)]((t=>{const e=r;this._elementResizeObserver?.[e(2183)](),this._elementResizeObserver=new ResizeObserver((([t])=>{const i=e;this[i(1878)][i(393)](t[i(1900)].width,t[i(1900)][i(741)]),this[i(1711)].fire()})),this[e(2031)].observe(t)}))),this.register({dispose:()=>{this[r(2031)]?.disconnect()}}),this[r(1075)](o[r(301)]((t=>this[r(420)](t)))),this[r(1075)](o[r(966)]((t=>this[r(1973)](t)))),this[r(1075)](o[r(1873)]((t=>this[r(632)](t)))),this[r(1075)](o.onPointerUp((()=>this[r(354)]())))}get[t(1870)](){const e=t,i=this[e(1183)][e(1885)];if(!i)throw new Error(e(1976));const s=i[e(479)]/this[e(1514)],n=i[e(2007)]/this[e(1514)],o=this[e(1439)][e(1436)]/2-this._x,r=this[e(1439)].height/2-this._y;return{left:Math[e(1590)](o-s/2,0),right:Math[e(2219)](o+s/2,this._imageService[e(1436)]),top:Math[e(1590)](r-n/2,0),bottom:Math[e(2219)](r+n/2,this._imageService[e(741)])}}get[t(1514)](){return parseFloat(this[t(990)].toFixed(2))}set[t(1514)](e){const i=t;e<=0||(this._zoom=e,this[i(1711)][i(393)](),this[i(1177)][i(393)]())}get isPixelGridEnabled(){return this[t(1249)]}set isPixelGridEnabled(e){const i=t;e!==this[i(1249)]&&(this[i(1249)]=e,this[i(1711)][i(393)](),this[i(1347)][i(393)]())}get x(){return this._x}set x(e){const i=t,s=this[i(1439)].width/2;this._x=(0,d.u)(e,s,-s),this[i(1711)][i(393)]()}get y(){return this._y}set y(e){const i=t,s=this[i(1439)][i(741)]/2;this._y=(0,d.u)(e,s,-s),this[i(1711)][i(393)]()}[t(785)](e=.2){return this[t(1666)](e)}[t(2125)](e=.2){return this[t(1666)](-e)}[t(846)](){const e=t,i=this._elementService[e(1885)];if(!i)return;const s=(i[e(479)]-10)/this[e(1439)][e(1436)],n=(i[e(2007)]-10)/this[e(1439)].height;this[e(1514)]=Math[e(2219)](s,n),this._x=0,this._y=0,this[e(1072)]=!0,this[e(1711)][e(393)]()}[t(321)](){const e=t,i=this[e(1439)][e(1284)];if(!i)return;const n=i[e(1928)];(0,s.Bu)(n)||this[e(1804)]([n[e(1161)],n.top],[n.right,n.bottom])}[t(1804)](e,i){const s=t,n=this._elementService[s(1885)];if(!n)return;const o=(n[s(479)]-10)/(i[0]-e[0]),r=(n[s(2007)]-10)/(i[1]-e[1]);this[s(1514)]=Math[s(2219)](o,r,100),this._x=-((i[0]+e[0])/2-this[s(1439)][s(1436)]/2),this._y=-((i[1]+e[1])/2-this[s(1439)][s(741)]/2),this[s(1711)].fire()}[t(420)](e){const i=t;if(this[i(1183)][i(1885)]){if(this[i(878)]===i(988)&&e[i(1593)]||"zoom"===this[i(878)]&&!e[i(1593)]){const t=this[i(1514)],s=be.V5?e[i(894)]<0?this.zoomIn(-e[i(894)]/20):this[i(2125)](e.deltaY/20):e[i(894)]<0?this[i(785)]():this[i(2125)](),n=s/t;if(t!==s){const t=(e[i(1313)]-this[i(1183)].element[i(1338)]/2)*(n-1),o=(e[i(1505)]-this[i(1183)][i(1885)][i(1547)]/2)*(n-1);this.x-=t/s,this.y-=o/s}}else!be.V5&&e[i(1899)]?this.x-=this[i(1193)](e[i(894)])/this[i(1514)]:(this.x-=this._normalizeWheelDelta(e.deltaX)/this[i(1514)],this.y-=this[i(1193)](e.deltaY)/this[i(1514)]);this[i(1072)]=!1,e[i(387)]()}}[t(1193)](t){return be.V5?t:Math.abs(t)<100?40*t:t}[t(1973)](e){const i=t,s=this[i(1183)][i(1885)];s&&(e.offsetX<30?this[i(1941)].x=this[i(1243)](30-e[i(1574)]):e[i(1574)]>s[i(1338)]-30?this[i(1941)].x=-this[i(1243)](e[i(1574)]-s[i(1338)]-30):this[i(1941)].x=0,e[i(1517)]<30?this[i(1941)].y=this[i(1243)](30-e[i(1517)]):e.offsetY>s[i(1547)]-30?this[i(1941)].y=-this._calculateScrollVelocity(e.offsetY-s[i(1547)]-30):this._scrollVelocity.y=0,!this[i(1834)]&&(this[i(1316)](),this[i(1834)]=setInterval((()=>this._outOfFrameScroll()),16)))}[t(632)](e){const i=t,s=this[i(477)](e);if(void 0!==s||void 0!==this._pointerCoord)return void 0===s||void 0===this._pointerCoord?(this[i(1320)]=s,void this._onPointerCoordChange[i(393)](this[i(1320)])):void(s[0]===this[i(1320)][0]&&s[1]===this[i(1320)][1]||(this[i(1320)]=s,this[i(1515)][i(393)](this[i(1320)])))}_calculateScrollVelocity(e){const i=t;return 1+Math.pow(Math[i(1590)](e/20,3),2)}[t(354)](){const e=t;this[e(1941)].x=0,this[e(1941)].y=0,clearInterval(this[e(1834)]),this[e(1834)]=0}[t(1316)](){const e=t;this._isScrollLocked||(this[e(1941)].x&&(this.x+=1*this[e(1941)].x/this[e(1514)]),this[e(1941)].y&&(this.y+=1*this[e(1941)].y/this.zoom))}_multiplyZoom(e){const i=t,s=this[i(990)]+this[i(990)]*e;if(s<=.02)return this._zoom=.02,this[i(990)];let n=-1;if(e>0){for(const t of xe)if(t>this[i(990)]){n=t;break}if(-1===n)return this._zoom;this[i(990)]=n<s?n:s}else{for(const t of xe){if(t>=this._zoom)break;n=t}this[i(990)]=n>s?n:s}return this._onUpdate[i(393)](),this._onZoomChange[i(393)](),this[i(990)]}[t(1317)](e){const i=t,s=this[i(1330)](e);return[Math[i(1727)](s[0]),Math[i(1727)](s[1])]}[t(1330)](e){const i=t,s=this[i(1183)].element;if(!s)throw new Error("Cannot get coords without element");let n=e[i(1574)]-Math[i(1727)](s[i(1338)]/2),o=e[i(1517)]-Math[i(1727)](s[i(1547)]/2);return n/=this.zoom,o/=this[i(1514)],n+=this[i(1439)].width/2,o+=this[i(1439)][i(741)]/2,n-=this.x,o-=this.y,[n,o]}[t(1691)](e,i){const s=t;return i&&!this[s(1531)].config[s(2058)]?this.getFineCoordsFromEvent(e):this[s(1317)](e)}[t(1703)](e){const i=t,s=this[i(1183)].element;if(!s)throw new Error(i(1978));let n=e[0],o=e[1];return n+=.5,o+=.5,n+=this.x,o+=this.y,n-=this._imageService[i(1436)]/2,o-=this[i(1439)][i(741)]/2,n*=this[i(1514)],o*=this[i(1514)],n+=Math.floor(s[i(1338)]/2),o+=Math[i(1727)](s[i(1547)]/2),n=Math[i(1266)](n),o=Math[i(1266)](o),[n,o]}[t(477)](e){const i=t,s=this[i(1317)](e);if(!(s[0]<0||s[0]>=this[i(1439)][i(1436)]||s[1]<0||s[1]>=this[i(1439)][i(741)]))return s}serialize(){const e=t;return{x:this._x,y:this._y,zoom:this[e(990)]}}[t(1101)](e){const i=t;this._x=e.x,this._y=e.y,this[i(990)]=e[i(1514)],this[i(1711)][i(393)](),this[i(1177)].fire()}}i(8984);class Se extends e.JT{constructor(e){const i=t;super(),this._configService=this[i(1075)](new o(e)),this[i(1183)]=this[i(1075)](new r),this[i(1384)]=this[i(1075)](new ut),this._historyService=this[i(1075)](new h),this[i(799)]=this[i(1075)](new ge),this[i(1104)]=this[i(1075)](new oe(this[i(1551)])),this._imageService=this[i(1075)](new et(this[i(1551)],this._selectionService,this._taskWorkerService)),this._inputService=this[i(1075)](new ct(this[i(1183)])),this[i(315)]=this.register(new Ie(this[i(1531)],this[i(1183)],this._imageService,this[i(1102)])),this._imageFileService=this[i(1075)](new at(this[i(1551)],this[i(1439)],this[i(1104)],this._viewportService)),this._taskService=this[i(1075)](new ce(this._historyService,this._imageService,this[i(1104)],this[i(799)])),this[i(1141)]=this[i(1075)](new ve(this._configService,this[i(1551)],this[i(1439)],this[i(1102)],this._paletteService,this[i(1104)],this[i(695)],this[i(799)],this[i(315)])),this[i(1908)]=this[i(1075)](new se(this[i(1183)],this._imageService,this._selectionService,this[i(1141)],this[i(315)])),this[i(1329)]=new Ce(this[i(1531)]),this[i(1232)]=new Ee(this._historyService,this[i(976)],this[i(1439)],this[i(1104)],this._toolService,this[i(315)]),this[i(540)]=new Te(this[i(1551)]),this.image=new Le(this[i(976)]),this[i(526)]=new Ae(this[i(1439)],this[i(1104)],this[i(799)]),this.palette=new De(this[i(1384)]),this[i(625)]=new Me(this._renderService),this.selection=new Be(this[i(1439)],this[i(1104)]),this[i(1221)]=new ke(this[i(695)],this[i(799)]),this[i(735)]=new Pe(this[i(315)]),this[i(1196)]=new Ue(this[i(1141)]),this[i(818)]=new Fe(this[i(1183)],this[i(315)])}}class Ce{constructor(t){this._configService=t}get[t(1060)](){return this._configService.config}set[t(1060)](e){const i=t;this[i(1531)][i(1329)]=e}}class Ee{constructor(e,i,s,n,o,r){const a=t;this[a(1551)]=e,this[a(976)]=i,this[a(1439)]=s,this[a(1104)]=n,this._toolService=o,this._viewportService=r}get mimeType(){return this[t(1439)].mimeType}get[t(1642)](){const e=t;return this[e(1439)][e(1642)]}[t(2156)](e){const i=t;return this._imageFileService[i(2156)](e)}[t(782)](e){const i=t;return this[i(976)][i(782)](e)}[t(607)](){const e=t;return this[e(1439)][e(607)]()}[t(1392)](){const e=t;return this[e(1439)][e(1392)]()}async openFile(e,s,n){const o=t,r=s.toLowerCase();let a;switch(r){case o(1201):a=o(1345);break;case o(1197):a=o(481);break;case o(1275):case".tpic":a="image/x-tga";break;case o(2105):case".jpe":case o(1545):case o(597):a=o(1290);break;case o(2042):case".dib":a=o(461);break;case o(1584):a=o(2173);break;default:throw new Error(o(1697)+r+'"')}let h=!1;switch(a){case o(1345):const s=(await i.e(6959).then(i[o(950)](i,6959)))[o(985)],r=await s(e);await Promise.allSettled(r.map((t=>t[o(947)]))),await this[o(1309)](o(1345),r[o(688)]((t=>t[o(437)])),n);break;case o(481):{const t=await(0,X.dX)(e,{force32:!0});h=!!(t[o(1173)]&&t[o(1173)][o(1840)]>0),this[o(1301)](o(481),t[o(1273)],n);break}case"image/x-tga":{n=!0;const s=await async function(e,s){const n=t;return(await i.e(7127)[n(1905)](i[n(950)](i,7127)))[n(1143)](e,{detectAmbiguousAlphaChannel:!0})}(e);h=!!(s[o(1173)]&&s.warnings[o(1840)]>0),this[o(1301)]("image/x-tga",s.image,n);break}case o(1290):case o(461):case"image/webp":await this[o(1607)](a,new Blob([e],{type:a}),n)}return h}async[t(1301)](e,i,s){const n=t;this._imageFileService[n(1301)](e,i,s),this[n(315)][n(846)]()}async[t(1309)](e,i,s){const n=t;this._imageFileService[n(1301)](e,i,s),this[n(315)][n(846)]()}async _openBlob(e,i,s){const n=t;await this[n(1439)][n(1980)](e,i,s),this[n(315)].fitToWindow()}async newImage(e,i,s){const n=t,o=s===n(1201)?"image/x-ico":n(481);await this[n(976)][n(719)](o,e,i),this._viewportService.fitToWindow()}restoreState(e){const i=t;if(e[i(1643)]<8)throw new Error(i(1587)+e[i(1643)]+")");this._selectionService.deserialize(e.body[i(548)]),this._historyService[i(1101)](e[i(2106)][i(540)]),this[i(315)][i(1101)](e[i(2106)].viewport),this[i(976)][i(1101)](e[i(2106)].file),this[i(1141)].deserialize(e[i(2106)].tool)}[t(1881)](e){const i=t;return{version:8,body:{file:this[i(976)].serialize(e),history:this[i(1551)][i(1348)](e),selection:this[i(1104)][i(1348)](),tool:this[i(1141)][i(1348)](),viewport:this[i(315)][i(1348)]()}}}}class Te{constructor(e){this[t(1551)]=e}get[t(1573)](){const e=t;return this[e(1551)][e(1573)]}get[t(1953)](){const e=t;return this[e(1551)][e(1953)]}get[t(1872)](){const e=t;return this._historyService[e(1872)]}get[t(1779)](){const e=t;return this[e(1551)][e(1779)]}get onEntriesChange(){return this._historyService.onEntriesChange}[t(772)](){const e=t;return this[e(1551)][e(772)]()}[t(1652)](){return this[t(1551)].undo()}async createCompositeEntry(e,i){const s=t;return this[s(1551)][s(810)](e,i)}[t(922)](e,i){return this[t(1551)].createCompositeEntrySync(e,i)}}class Le{constructor(e){this[t(976)]=e}get[t(1956)](){const e=t;return this[e(976)][e(1956)]}get[t(2182)](){const e=t;return this[e(976)][e(2182)]}get[t(1195)](){const e=t;return this[e(976)][e(1195)]}get[t(1603)](){const e=t;return this[e(976)][e(1082)]}async setActiveImage(e){const i=t;if(e!==this._imageFileService[i(1082)]){if(void 0===e)throw new Error(i(864));await this[i(976)].setActiveImageByIndex(e)}}[t(853)](e,i,s){const n=t;return this._imageFileService[n(853)](e,i,s)}[t(1356)](e){return this[t(976)].deleteImage(e)}[t(1862)](e){const i=t;return this[i(976)][i(1862)](e)}[t(1131)](){const e=t;return this._imageFileService[e(1131)]()}[t(862)](){const e=t;return this[e(976)][e(862)]()}[t(1767)](){const e=t;return this._imageFileService[e(1767)]()}[t(819)](){const e=t;return this[e(976)][e(819)]()}[t(1645)](){return this._imageFileService.moveImageToTop()}moveImageToBottom(){const e=t;return this[e(976)][e(1476)]()}[t(721)](){const e=t;return this._imageFileService[e(721)]()}moveImageDown(){const e=t;return this[e(976)][e(2062)]()}[t(993)](e,i){return this[t(976)].moveImageTo(e,i)}}class Ae{constructor(e,i,s){const n=t;this._imageService=e,this[n(1104)]=i,this[n(799)]=s}get[t(1436)](){return this[t(1439)].width}get[t(741)](){const e=t;return this[e(1439)][e(741)]}get[t(2152)](){const e=t;return this._imageService[e(1806)]}get[t(313)](){const e=t;return this[e(1439)][e(835)]}get[t(643)](){return this._imageService.onLayerChange}get[t(1575)](){const e=t;return this[e(1439)][e(1575)]}get[t(1920)](){const e=t;return this[e(1439)][e(1920)].map((t=>new Re(t,this._selectionService,this[e(799)])))||[]}get activeLayer(){const e=t,i=this[e(1439)].currentLayer;if(i)return new Re(i,this[e(1104)],this._taskWorkerService)}set[t(2073)](e){const i=t;if(void 0===e)throw new Error(i(787));this[i(1439)][i(1538)](e.id)}[t(1094)](){const e=t;return this._imageService[e(1094)]()}[t(1001)](e){const i=t;return this[i(1439)][i(1001)](e?.id)}duplicateLayer(e){const i=t;return this._imageService[i(547)](e?.id)}[t(534)](){const e=t;return this[e(1439)][e(534)]()}[t(1097)](){const e=t;return this[e(1439)][e(1097)]()}[t(2025)](e,i){const s=t;return this[s(1439)][s(2025)](e,i?.id)}[t(2202)](){const e=t;this[e(1439)][e(2202)]()}goToBottomLayer(){const e=t;this[e(1439)][e(1049)]()}[t(717)](){this._imageService.goToLayerAbove()}[t(1945)](){const e=t;this._imageService[e(1945)]()}[t(1718)](){const e=t;this[e(1439)][e(1718)]()}[t(505)](){const e=t;this._imageService[e(505)]()}[t(1820)](){const e=t;this[e(1439)][e(1820)]()}[t(1503)](){const e=t;this._imageService[e(1503)]()}[t(1178)](e,i){const s=t;this[s(1439)][s(1178)](e.id,i.id)}async[t(1860)](){const e=t;await(this[e(1439)][e(1284)]?.finishTemporaryLayer())}[t(1757)](e,i,s){const n=t;if(e<0||e>=this[n(1436)]||i<0||i>=this[n(741)])return;const o=this._imageService[n(1284)];if(o){if(!s){const t=4*(i*o[n(1436)]+e);return o[n(1675)][n(2003)](t,t+4)}return this._imageService[n(1757)](e,i)}}}class Re{constructor(e,i,s){const n=t;this[n(1902)]=e,this._selectionService=i,this._taskWorkerService=s,this[n(1835)]=new Map,this[n(1902)][n(835)]((()=>this[n(1835)].clear()))}get[t(1760)](){const e=t;return this[e(1902)][e(575)]}get[t(835)](){const e=t;return this[e(1902)][e(835)]}get id(){return this[t(1902)].id}get[t(1680)](){const e=t;return this[e(1902)][e(1680)]}set name(e){const i=t;this._layer[i(1680)]=e}get blendMode(){const e=t;return this._layer[e(903)]}set[t(903)](e){const i=t;this[i(1902)][i(670)](e)}get[t(364)](){return this[t(1902)].isVisible}set[t(364)](e){const i=t;this[i(1902)][i(850)](e)}[t(304)](e,i){const s=t,n=e+"x"+i,o=this[s(1835)][s(781)](n);if(o)return o;const r={data:this[s(1902)][s(1675)],width:this[s(1902)][s(1436)],height:this[s(1902)].height},a=this[s(799)][s(309)](r,e,i);return this[s(1835)][s(475)](n,a),a}exportBlob(e){return this[t(1902)].exportBlob(e)}async[t(919)](e,i){const n=t,o=await this[n(1902)][n(919)](e,i);this[n(1104)][n(664)]=(0,s.BN)(o.staticState[n(664)]),this[n(1104)][n(1061)](n(2107))}}class De{constructor(e){this[t(1384)]=e}get[t(1192)](){const e=t;return this[e(1384)][e(835)]}get[t(1477)](){const e=t;return this[e(1384)][e(1477)]}get[t(433)](){const e=t;return this[e(1384)][e(433)]}[t(1259)](){this[t(1384)].swap()}}class Me{constructor(t){this._renderService=t}[t(1600)](){this._renderService.pause()}[t(697)](){this[t(1908)].resume()}[t(2179)](e){const i=t;this[i(1908)][i(2179)](e)}[t(1502)](e){this[t(1908)].showToast(e)}}class Be{constructor(e,i){const s=t;this[s(1439)]=e,this[s(1104)]=i}get[t(835)](){const e=t;return this._selectionService[e(835)]}get[t(664)](){return this[t(1104)].range}[t(1010)](){const e=t;this[e(1104)][e(1010)]()}[t(582)](){return this[t(1439)].eraseSelection()}[t(2172)](){const e=t;return this[e(1439)][e(428)](!0)}selectAll(){const e=t;return this[e(1439)][e(1549)]()}}class ke{constructor(e,i){const s=t;this[s(695)]=e,this[s(799)]=i}get[t(2171)](){const e=t;return this[e(799)][e(2171)]}set[t(2171)](t){this._taskWorkerService.disableWorkers=t}get[t(1088)](){const e=t;return this._taskService[e(1088)]}executeOnAllLayers(e,i){const s=t;return this._taskService[s(764)](e,i)}[t(563)](e,i){return this[t(695)].executeOnSingleLayer(e,i)}}class Pe{constructor(t){this._viewportService=t}getCellPosition(e,i){const s=t,[n,o]=this[s(315)][s(1703)]([e,i]);return{x:n,y:o}}}class Ue{constructor(e){this[t(1141)]=e}get onToolChange(){const e=t;return this[e(1141)][e(1637)]}get activeTool(){const e=t;return this[e(1141)][e(462)]?.id}get[t(1145)](){const e=t;return this[e(1141)][e(462)]?.[e(1145)]||[]}get[t(1579)](){const e=t;return this[e(1141)][e(462)]?.options||[]}get[t(2117)](){const e=t;return this._toolService[e(462)]?.info||[]}async[t(2075)](e,i){const s=t;await this[s(1141)][s(2075)](e,i)}}class Fe{constructor(e,i){this[t(1183)]=e,this._viewportService=i}get[t(835)](){const e=t;return this[e(315)][e(835)]}get onZoomChange(){return this[t(315)].onZoomChange}get[t(1663)](){const e=t;return this[e(315)][e(1663)]}get[t(945)](){const e=t;return this[e(315)][e(945)]}get x(){return this[t(315)].x}set x(e){this[t(315)].x=e}get y(){return this[t(315)].y}set y(e){this[t(315)].y=e}get[t(1870)](){const e=t;return this[e(315)][e(1870)]}get[t(1514)](){const e=t;return this[e(315)][e(1514)]}set[t(1514)](e){const i=t;this[i(315)][i(1514)]=e}get[t(958)](){const e=t;return this[e(315)][e(958)]}set[t(958)](e){const i=t;this[i(315)][i(958)]=e}get[t(878)](){const e=t;return this[e(315)][e(878)]}set mouseWheelBehavior(e){this[t(315)].mouseWheelBehavior=e}attach(e){this[t(1183)].attach(e)}focus(){document.activeElement.blur()}[t(785)](e){const i=t;this[i(315)][i(785)](e)}zoomOut(e){const i=t;this[i(315)][i(2125)](e)}[t(846)](){const e=t;this[e(315)][e(846)]()}[t(321)](){const e=t;this[e(315)][e(321)]()}}const Oe=t(1283),Ne=new Map;function Ve(e){const i=t;if(Ne[i(1225)](e))return Ne[i(781)](e);const s=function(t,e,n){const o=i;if(3!==arguments[o(1840)])throw new Error(o(711));He(s,t,n)};return s[i(1629)]=()=>e,Ne[i(475)](e,s),s}function He(e,i,s){const n=t;i.di$target===i?i[Oe][n(1378)]({id:e,index:s}):(i[Oe]=[{id:e,index:s}],i.di$target=i)}const ze=Ve(t(757)),We=Ve(t(813)),je=Ve(t(1736));class qe{constructor(){this._commands=new Map}register(e,i){const s=t;this[s(375)][s(475)](e,i)}[t(781)](e){const i=t,s=this[i(375)][i(781)](e);if(!s)throw new Error('Could not find non-existent command "'+e+'"');return s}[t(2019)](){const e=t;return this[e(375)][e(1060)]()}}const Ge=new qe;var Xe=function(t,e){return function(i,s){e(i,s,t)}};let Ye=class{constructor(e,i){this[t(509)]=e,this._contextKeyService=i}getCommand(e){return Ge[t(781)](e)}[t(1003)](){return Ge[t(2019)]()}[t(527)](e){const i=t,s=Ge[i(781)](e);if(void 0===s[i(1289)])return!0;const n=this[i(2059)][i(781)](s[i(1289)]);if(!n)return!0;const o=n[i(781)]();return s[i(519)]?!o:o}[t(1491)](e,...i){const s=t;if(!this.canRunCommand(e))return void console[s(1062)](s(639)+e+"\", it's disabled");const n=Ge[s(781)](e);return console[s(2117)]("Command "+e+s(411)),this[s(509)][s(1874)](n[s(1997)],...i)}[t(952)](e,i){const s=t,n=Ge[s(2019)](),o=[];for(const t of n)if((t[s(1998)]+": "+t[s(1805)])[s(1409)]()[s(463)](e[s(1409)]())&&(o[s(1378)](t),o[s(1840)]===i))return o;return o}};Ye=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([Xe(0,je),Xe(1,We)],Ye);const Je=Ve(t(884));class Ke extends e.JT{constructor(){const e=t;super(...arguments),this.serviceBrand=void 0,this._onConfigChanged=this[e(1075)](new n.v),this[e(2071)]=this[e(1035)][e(2220)],this[e(689)]={statusBarPointerColor:"currentLayer",defaultTool:e(548)}}get[t(1329)](){return this[t(689)]}set[t(1329)](e){const i=t;!this[i(2188)](e)&&(this._config=e,this[i(1035)][i(393)](this._config))}[t(2188)](e){const i=t,s=Object[i(473)](this[i(689)]);if(s[i(1840)]!==Object[i(473)](e)[i(1840)])return!1;for(const t of s)if(this[i(689)][t]!==e[t])return!1;return!0}}class $e{constructor(){this[t(2186)]=void 0,this._contextKeys=new Map}[t(781)](e){const i=t;return this[i(1434)][i(781)](e)}bind(e,i){const s=t,n=new Ze(i);return this._contextKeys[s(475)](e,n),n}}class Ze extends e.JT{constructor(e){const i=t;super(),this[i(1684)]=e,this[i(1711)]=this[i(1075)](new n.v),this[i(835)]=this[i(1711)][i(2220)],this[i(807)]=this[i(1684)]}[t(475)](e){const i=t;this[i(807)]!==e&&(this[i(807)]=e,this._onUpdate.fire(e))}reset(){const e=t;this[e(475)](this[e(1684)])}[t(781)](){return this[t(807)]}}const Qe=Ve("ContextMenuService"),ti=Ve(t(762));class ei{constructor(...e){const i=t;this[i(1216)]=new Map;for(const[t,s]of e)this[i(475)](t,s)}[t(475)](e,i){const s=t,n=this[s(1216)][s(781)](e);return this[s(1216)][s(475)](e,i),n}[t(776)](e){const i=t;this[i(1216)][i(776)](((t,i)=>e(i,t)))}[t(1225)](e){return this[t(1216)].has(e)}[t(781)](e){const i=t;return this[i(1216)][i(781)](e)}}class ii{constructor(){const e=t;this[e(499)]=new ei,this[e(499)].set(je,this)}setService(e,i){const s=t;this[s(499)][s(475)](e,i)}[t(434)](e){const i=t;return this[i(499)][i(781)](e)}createInstance(e,...i){const s=t,n=(r=e,r[Oe]||[])[s(419)](((t,e)=>t[s(2153)]-e[s(2153)])),o=[];var r;for(const t of n){const i=this[s(499)].get(t.id);if(!i)throw new Error(s(1693)+e[s(1680)]+s(759)+t.id+".");o[s(1378)](i)}const a=n.length>0?n[0][s(2153)]:i[s(1840)];if(i[s(1840)]!==a)throw new Error(s(346)+e[s(1680)]+s(1324)+(a+1)+s(1222)+i.length+s(700));return new e(...[...i,...o])}[t(1874)](t,...e){return t({get:t=>{const e=this[a2_0x4755(434)](t);if(!e)throw new Error("[invokeFunction] unknown service '"+t+"'");return e}},...e)}}const si=Ve(t(412)),ni=Ve(t(2163)),oi=Ve(t(1165));class ri extends e.JT{constructor(){const e=t;super(...arguments),this._items=new Map([[1,new ai],[0,new ai]]),this[e(1417)]=this[e(1075)](new n.v),this[e(1858)]=this[e(1417)][e(2220)],this[e(450)]=this[e(1075)](new n.v),this[e(1294)]=this[e(450)][e(2220)],this._onDidAddBottomItem=this.register(new n.v),this[e(837)]=this[e(955)][e(2220)],this[e(1674)]=this[e(1075)](new n.v),this[e(1773)]=this[e(1674)].event}createItem(e){const i=t,s=this[i(1388)][i(781)](e[i(440)]),n=0===e[i(826)]?s[i(1554)]:s[i(1340)];if(n[i(1225)](e))throw new Error("Status bar item already added");return n.add(e),(0===e.target?this._onDidAddTopItem:this._onDidAddBottomItem).fire(e),{dispose:()=>{this[i(520)](e)}}}[t(1432)](e){const i=t;return this[i(1388)][i(781)](e).leftItems[i(1060)]()}[t(595)](e){const i=t;return this[i(1388)].get(e).rightItems[i(1060)]()}[t(520)](e){const i=t,s=this[i(1388)][i(781)](e[i(440)]);(0===e[i(826)]?s[i(1554)]:s.rightItems)[i(1279)](e),(0===e[i(440)]?this[i(450)]:this[i(1674)]).fire(e)}}class ai{constructor(){const e=t;this[e(1554)]=new Set,this[e(1340)]=new Set}}const hi=Ve(t(668)),ci=Ve("ViewService"),li=Ve("StateService");class di{constructor(){this[t(1895)]=new Map}[t(1075)](e,i){const s=t;this[s(1895)][s(475)](e,i)}[t(781)](e){const i=t,s=this[i(1895)][i(781)](e);if(!s)throw new Error(i(1588)+e+'"');return s}getAll(){const e=t;return this._views[e(1953)]()}}const ui=new di;class mi{constructor(){this[t(1895)]=new Map}[t(1075)](e,i){const s=t;this._views[s(475)](e,i)}get(e){const i=t,s=this[i(1895)][i(781)](e);if(!s)throw new Error(i(1369)+e+'"');return s}[t(2019)](){const e=t;return this[e(1895)][e(1953)]()}}const gi=new mi;function fi(t,e,i){return s=(s,n)=>{const o=a2_0x4755,r=o(843)+n,a=o(956)+n;return function(...n){!this[a]&&(this[a]=i?i():void 0),clearTimeout(this[r]),e&&(this[a]=e(this[a],...n),n=[this[a]]),this[r]=setTimeout((()=>{s.apply(this,n),this[a]=i?i():void 0}),t)}},(t,e,i)=>{const n=a2_0x4755;let o=null,r=null;if(typeof i[n(1076)]===n(1050)?(o="value",r=i[n(1076)]):"function"==typeof i[n(781)]&&(o=n(781),r=i[n(781)]),!r)throw new Error(n(1442));i[o]=s(r,e)};var s}var pi=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect.decorate)h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h},_i=function(t,e){return function(i,s){e(i,s,t)}};let yi=class extends e.JT{constructor(e,i){const s=t;super(),this[s(509)]=e,this[s(1501)]=i,this[s(1895)]=new Map,this[s(896)]=!1,this[s(1758)]=new Map,this[s(1608)]=new Map,this[s(2131)]=this[s(1075)](new n.v),this[s(1931)]=this[s(2131)][s(2220)],this[s(649)]=this.register(new n.v),this[s(339)]=this[s(649)][s(2220)];for(const[t,e]of ui[s(2019)]()){let i;switch(e[s(749)]){case"top":i=this[s(509)][s(1912)](e[s(1844)],document[s(525)]("#top"));break;case s(2077):i=this[s(509)].createInstance(e.ctor,document.querySelector(s(1110)))}i&&this[s(1895)][s(475)](t,i)}this[s(413)]=document[s(525)](s(579)),window[s(1620)](s(1924),(()=>this[s(1743)]())),(0,n.B)(this[s(1931)],this[s(649)]),this[s(1501)][s(2108)](s(1411),this)}[t(1929)](){const e=t;for(const[t,i]of gi[e(2019)]())i.defaultVisible&&this._createWindowView(t,i)}[t(1743)](){const e=t;for(const[t,i]of this[e(1758)][e(1953)]())if(i){const s=this._views.get(t);if(s&&"setPosition"in s){if(this._isWindowAnchor(i?.x)&&i?.x[e(440)]||this[e(680)](i?.y)&&i?.y[e(440)])continue;this[e(1438)](s,i||gi.get(t)[e(2032)])}}}[t(946)](e){const i=t,s=this[i(1895)][i(781)](e);s?s.isVisible=!s[i(364)]:this[i(1312)](e,gi[i(781)](e)),!1===s?.isVisible&&this[i(1608)][i(1279)](e),!this[i(896)]&&(this._onStateChange[i(393)](),this[i(844)](e))}[t(1157)](e){const i=t,s=this[i(1895)][i(781)](e);s&&s[i(364)]&&(s[i(364)]=!1,this[i(1608)][i(1279)](e),!this._isRestoringState&&(this._onStateChange[i(393)](),this[i(844)](e)))}[t(1087)](e){const i=t,s=this[i(1895)][i(781)](e);s?!s[i(364)]&&(s.isVisible=!0,!this[i(896)]&&(this[i(2131)][i(393)](),this._layoutDependentViews(e))):this[i(946)](e)}[t(364)](e){const i=t;return this[i(1895)][i(781)](e)?.[i(364)]||!1}[t(1312)](e,i){const s=t,n=this._instantiationService[s(1912)](i.ctor,this._viewsElement);this[s(1438)](n,i[s(2032)]),n[s(464)]((()=>{const t=s;!1===n[t(364)]&&(n[t(1676)](),this._views[t(1279)](e),!this[t(896)]&&(this[t(2131)][t(393)](),this[t(844)](e)),this._windowResolvedPosition[t(1279)](e))})),n[s(1799)]((t=>{const e=s;!this[e(1855)]&&setTimeout((()=>{const i=e;this[i(1855)]=document[i(1132)](i(1525)),this[i(1855)].classList[i(1769)](i(2100)),this._dropTargetElement.style[i(2203)]=i(1326),this._dropTargetElement[i(1620)]("drop",(e=>{const s=i,o=this[s(413)].getBoundingClientRect(),r=e[s(1229)]+t[s(1574)]-o[s(1161)]-10+t[s(1436)]/2>o[s(1436)]/2?s(1300):s(1802),a=e[s(893)]+t.offsetY-o[s(1116)]-10+t[s(741)]/2>o.height/2?"end":s(1802);let h,c;h=r===s(1802)?e[s(1229)]+t.offsetX-o[s(1161)]-10:o[s(1436)]-(e.clientX+t.offsetX)-t.width-10,c=a===s(1802)?e[s(893)]+t[s(1517)]-o[s(1116)]-10:o[s(741)]-(e[s(893)]+t.offsetY)-t[s(741)]+10+1,this[s(1438)](n,{x:{side:r,distance:Math[s(1590)](h,0)},y:{side:a,distance:Math[s(1590)](c,0)}})})),this._dropTargetElement[i(1620)](i(491),(t=>t.preventDefault())),this._viewsElement.appendChild(this[i(1855)])}))})),n[s(397)]((()=>{const t=s;this[t(1855)]&&(this[t(413)][t(803)](this[t(1855)]),this[t(1855)]=void 0),this._onStateChange.fire()})),this[s(1895)][s(475)](e,n)}[t(1438)](e,i){const s=t;let n,o,r,a;this[s(1758)][s(475)](e.id,i),this._windowResolvedPosition[s(1279)](e.id);const h=this._isWindowAnchor(i.x)?i.x.target:void 0,c=this._isWindowAnchor(i.y)?i.y[s(440)]:void 0,l=this._isWindowAnchor(i.x)?i.x[s(1179)]:i.x;let u=this[s(680)](i.x)?(i.x[s(2064)]||0)+10:10;if(h){const t=this[s(1608)][s(781)](h);t&&(u+=(l===s(1802)?t.left:t.right)||0,u+=this[s(1895)][s(781)](h)?.[s(741)]||0)}if(l===s(1802)?a=(0,d.u)(u,this._viewsElement[s(479)]-e[s(1436)]-10,10):o=(0,d.u)(u,this[s(413)][s(479)]-e.width-10,10),!h&&c){const t=this._windowResolvedPosition[s(781)](c);t&&(a=t[s(1161)],o=t[s(594)])}let m=this._isWindowAnchor(i.y)?i.y[s(1179)]:i.y,g=this[s(680)](i.y)?(i.y[s(2064)]||0)+10:10;if(c){const t=this[s(1758)].get(c),i=this[s(1608)][s(781)](c);if(i&&(void 0!==i.top?g=i[s(1116)]-g-this[s(1895)][s(781)](e.id)?.[s(741)]||0:void 0!==i[s(2077)]&&(g+=i[s(2077)]),t)){const e=this[s(1891)](t.y);m===e&&(g+=this._views[s(781)](c)?.[s(741)]||0),m=e}}if(m===s(1802)?n=(0,d.u)(g,this[s(413)][s(2007)]-e[s(741)]-10,10):r=(0,d.u)(g,this[s(413)][s(2007)]-e[s(741)]-10,10),!c&&h){const t=this[s(1608)][s(781)](h);t&&(n=t[s(1116)],r=t[s(2077)])}e[s(1429)](n?n+"px":"",o?o+"px":"",r?r+"px":"",a?a+"px":""),this._windowResolvedPosition.set(e.id,{top:n,right:o,bottom:r,left:a}),this._layoutDependentViews(e.id)}[t(844)](e){const i=t;for(const t of this[i(1895)][i(1060)]()){if(!(i(1429)in t))continue;const s=this[i(1758)][i(781)](t.id)||gi[i(781)](t.id)[i(2032)];t[i(364)]&&(this._isWindowAnchor(s.x)&&s.x.target===e||this[i(680)](s.y)&&s.y[i(440)]===e)&&this._updateWindowViewPosition(t,s)}}[t(1881)](){const e=t,i=[];for(const t of this[e(1895)][e(1060)]())i[e(1378)]({id:t.id,position:this[e(1758)][e(781)](t.id),isVisible:t.isVisible});return{views:i}}[t(1298)](e){const i=t;this[i(896)]=!0;for(const t of e[i(1349)])t[i(364)]?this[i(1087)](t.id):this[i(1157)](t.id);for(const t of this[i(1895)][i(473)]()){let s=!1;for(const n of e[i(1349)][i(1060)]())if(n.id===t){s=!0;break}!s&&this.hideView(t)}for(const t of e[i(1349)])if(t[i(364)]){const e=this[i(1895)][i(781)](t.id);if(e&&i(1429)in e){if(this._isWindowAnchor(t[i(399)]?.x)&&t[i(399)]?.x[i(440)]||this[i(680)](t[i(399)]?.y)&&t[i(399)]?.y[i(440)])continue;this[i(1438)](e,t.position||gi[i(781)](t.id)[i(2032)])}}this[i(896)]=!1}[t(680)](e){return!!e&&typeof e!==t(2185)}[t(1891)](t){return this._isWindowAnchor(t)?t.side:t}};pi([fi(500)],yi[t(2169)],t(1743),null),yi=pi([_i(0,je),_i(1,li)],yi);const wi=Ve(t(763));class vi extends e.JT{constructor(){const e=t;super(...arguments),this._showViewport=!0,this._isStretchEnabled=!0,this._onShowViewportChange=this[e(1075)](new n.v),this.onShowViewportChange=this[e(742)].event,this._onStretchEnabledChange=this[e(1075)](new n.v),this[e(557)]=this[e(337)][e(2220)]}get[t(1156)](){return this[t(306)]}set showViewport(e){const i=t;this[i(306)]!==e&&(this[i(306)]=e,this[i(742)][i(393)](e))}get[t(886)](){return this[t(1654)]}set[t(886)](e){const i=t;this[i(1654)]!==e&&(this[i(1654)]=e,this[i(337)][i(393)](e))}}const bi=Ve(t(1096));let xi=class extends e.JT{constructor(e){const i=t;super(),this[i(1344)]=!1,this[i(564)]=!1,this._onStateChange=this.register(new n.v),this[i(1931)]=this[i(2131)][i(2220)],this[i(1414)]=this[i(1075)](new n.v),this[i(1571)]=this._onShowColorDetailsChange[i(2220)],e[i(2108)](i(1129),this),this[i(1571)]((()=>{const t=i;!this[t(564)]&&this._onStateChange[t(393)]({global:!0})}))}get showColorDetails(){return this[t(1344)]}set[t(1687)](e){const i=t;this[i(1344)]!==e&&(this[i(1344)]=e,this[i(1414)][i(393)](e))}[t(1881)](){return{showColorDetails:this[t(1344)]}}[t(1298)](e){const i=t;this[i(564)]=!0,this[i(1687)]=e[i(1687)],this._ignoreStateChangeEvents=!1}};var Ii,Si;xi=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect[o(1226)])h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(Ii=0,Si=li,function(t,e){Si(t,e,Ii)})],xi);class Ci extends e.JT{constructor(){const e=t;super(...arguments),this[e(1867)]=new Map,this[e(798)]=new Map,this[e(2131)]=this[e(1075)](new n.v),this[e(1931)]=this._onStateChange[e(2220)],this[e(1408)]=this[e(1075)](new n.v),this[e(1037)]=this._onStateSync[e(2220)]}get[t(1898)](){const e=t,i=[];for(const[t,s]of this._state[e(1953)]())i[e(1378)]({id:t,state:s});return{version:3,entries:i}}[t(2108)](e,i){const s=t;if(this[s(1867)][s(1225)](e))throw new Error(s(1958)+e+s(906));this[s(1867)][s(475)](e,i),i[s(1931)]((t=>{const n=s,o=this[n(506)](i,e);this[n(2131)][n(393)]({id:e,global:typeof t===n(1907)?t[n(549)]:void 0,state:o})}))}[t(506)](e,i){const s=t,n=e[s(1881)]();return this[s(798)].set(i,n),n}hasStateHandler(e){const i=t;return this[i(1867)][i(1225)](e)}[t(1298)](e){const i=t;if(e)if(3===e[i(1643)])for(const t of e[i(1953)]){const e=this[i(1867)][i(781)](t.id);e?e.restoreState(t[i(1898)]):console[i(1062)](i(514)+t.id+i(1979))}else console.warn(i(1187)+e[i(1643)]+i(1725)+3+")");else for(const[t,e]of this[i(1867)][i(1953)]())this._setState(e,t)}syncGlobalState(t){this.restoreState(t)}}class Ei{constructor(){this[t(1293)]=[]}[t(1075)](e){const i=t;this[i(1293)][i(1378)](e)}getAll(){const e=t;return this[e(1293)][e(1060)]()}[t(554)](){const e=t;this[e(1293)][e(1840)]=0}}const Ti=new Ei;const Li=Ve(t(1561));class Ai{constructor(e){const i=t;this._vscodeApi=e,this[i(2186)]=void 0,this._extHostRequestHandlers=new Map,this[i(1700)]=new Map,window[i(1620)](i(1020),(async t=>{const e=i;if(e(622)in t[e(1675)]){const i=t[e(1675)][e(622)],s=this[e(1700)][e(781)](i);if(!s)throw new Error(e(2109)+i+'"');return this[e(1700)][e(1279)](i),void s(this[e(591)](t[e(1675)]))}if(e(577)in t.data){const i=this[e(852)][e(781)](t[e(1675)].type);if(!i)throw new Error('No handler for webview request "'+t.data.type+'"');const s=await i(this[e(591)](t[e(1675)])),n={type:t[e(1675)][e(335)],body:be.jn?s:(0,R.t)(s),extHostRequestId:t.data[e(577)]};this[e(1544)][e(1797)](n)}}))}[t(1701)](e,i){const s=t;if(this._extHostRequestHandlers.has(e))throw new Error(s(1209)+e+'"');this[s(852)].set(e,i)}async[t(1963)](e,i){const s=t,n=Math[s(1266)](1e6*Math[s(303)]());return new Promise((t=>{const o=s;this._activeRequests[o(475)](n,t),this[o(1544)].postMessage({type:e,body:i,webviewRequestId:n})}))}[t(591)](e){const i=t;if(void 0===e[i(2106)])return e[i(2106)];const s=e[i(2106)];for(const t of Object.keys(s)){const e=s[t];typeof e===i(1907)&&i(335)in e&&e.type===i(1027)&&(s[t]=new Uint8Array(e[i(1675)]))}return(0,R.e)(s)}}class Ri{[t(1075)](t){}[t(2019)](){return[].values()}}let Di=class{constructor(e){this[t(1762)]=e}async[t(1930)](e){const i=t;return this[i(1762)][i(1847)]("",e)}};var Mi,Bi;Di=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(Mi=0,Bi=hi,function(t,e){Bi(t,e,Mi)})],Di);class ki{constructor(){}async open(){throw new Error("NYI")}async[t(1705)](){throw new Error(t(493))}async[t(1200)](){throw new Error(t(493))}}async function Pi(t){return new Promise((e=>setTimeout(e,t)))}var Ui=function(t,e){return function(i,s){e(i,s,t)}};let Fi=class{constructor(e,i){this[t(1869)]=e,this._lunaService=i}async requestLayerTaskOptions(e){const i=t;switch(e){case i(430):{const t=await this[i(532)]();await Pi(50);const e=await this._ipcService[i(1963)](i(636),{items:[{id:i(1754),label:i(995),description:i(662),detail:i(898)},{id:i(1594),label:i(667),description:"Hard edges",detail:i(1423)}],options:{placeHolder:i(929)}});if(void 0===e)throw new Error(i(1103));return{...t,resampling:e}}case i(1142):{const t=await this[i(532)]();await Pi(50);const e=await this[i(1869)].request(i(636),{items:[{id:i(831),label:i(1126),description:"↘"},{id:i(1116),label:"Top",description:"↓"},{id:i(1618),label:i(2074),description:"↙"},{id:i(1161),label:i(1120),description:"→"},{id:i(1155),label:i(1543),description:"·"},{id:"right",label:i(1768),description:"←"},{id:"bottomleft",label:"Bottom left",description:"↗"},{id:"bottom",label:i(1164),description:"↑"},{id:i(2094),label:i(2170),description:"↖"}],options:{placeHolder:"Select where to anchor the existing image"}});if(void 0===e)throw new Error("Anchor not selected");return{...t,anchor:e}}default:throw new Error(i(953)+e+i(1661))}}async[t(532)](){const e=t;await Pi(50);const i=await this[e(1869)][e(1963)](e(659),{title:e(2209),prompt:e(350),widthDefaultValue:this[e(793)][e(526)][e(1436)],heightDefaultValue:this._lunaService.layer.height,minValue:1});if(void 0===i)throw new Error("Width not selected");let s,n;if(typeof i===e(383)?(await Pi(50),s=i,n=await this[e(1869)].request(e(1281),{title:e(2015),prompt:e(899),defaultValue:this[e(793)][e(526)].height,minValue:1})):(s=i[e(1436)],n=i[e(741)]),void 0===n)throw new Error("Height not selected");return{width:s,height:n}}async[t(1847)](e,i){const s=t;return await Pi(50),await this[s(1869)][s(1963)]("quickPick",{options:{placeHolder:e},items:i})}async[t(1983)](e,i){const s=t;return await Pi(50),await this[s(1869)][s(1963)]("inputBoxString",{prompt:e,defaultValue:i})}async requestInputNumber(e,i,s,n){const o=t;return await Pi(50),await this._ipcService[o(1963)](o(1281),{prompt:e,defaultValue:i,minValue:s,maxValue:n})}};Fi=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect.decorate===o(1050))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([Ui(0,Li),Ui(1,ni)],Fi);const Oi=Ve("HelpService");let Ni=class{constructor(e){this[t(1869)]=e}async[t(1286)](){const e=t;return this[e(1869)][e(1963)](e(1286),void 0)}};var Vi,Hi;Ni=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(Vi=0,Hi=Li,function(t,e){Hi(t,e,Vi)})],Ni);class zi{constructor(){this[t(1216)]=[]}[t(1075)](e){const i=t;this[i(1216)][i(1378)](e)}getAll(){return this[t(1216)]}[t(554)](){const e=t;this[e(1216)][e(1840)]=0}}const Wi=new zi;function ji(e){const i=t;if(Ge[i(1075)](e.id,{id:e.id,label:e[i(1805)],section:e.section,run:e[i(1997)],checked:e.checked,negateChecked:e[i(1134)],enabled:e[i(1289)],negateEnabled:e[i(519)]}),e[i(473)])if(Array[i(2160)](e[i(473)]))for(const t of e[i(473)])Wi.register({commandId:e.id,keys:t});else Wi[i(1075)]({commandId:e.id,keys:e[i(473)]})}ji({id:t(1353),label:"Invert",section:t(1099),run:async e=>{const i=t,s=e.get(ni);await s[i(1221)][i(563)]("layer/invertColors",{selection:s[i(548)][i(664)]})},keys:t(601)});class qi extends e.JT{constructor(e,i,s){const o=t;super(),this.id=e,this[o(413)]=i,this[o(1950)]=!0,this[o(1511)]=this[o(1075)](new n.v),this[o(464)]=this[o(1511)].event,this._onDidStartDrag=this[o(1075)](new n.v),this[o(1799)]=this[o(586)][o(2220)],this[o(1796)]=this[o(1075)](new n.v),this[o(397)]=this[o(1796)][o(2220)],this[o(732)]=document[o(1132)]("div"),this._viewElement.id=s[o(1409)]()[o(1257)](/ /g,""),this._viewElement.classList.add("view","window");const r=document[o(1132)]("div");r[o(1372)].add(o(599)),r[o(1620)](o(1147),(()=>this._viewElement[o(1270)]=!0)),r[o(1620)](o(2103),(()=>this[o(732)].draggable=!1)),r.addEventListener(o(1791),(t=>t[o(387)]())),this._viewElement.addEventListener(o(646),(t=>{const e=o;t[e(502)]&&(t.dataTransfer[e(576)]=e(2086),t.dataTransfer[e(1988)]=e(2086));const i=this._viewElement.getBoundingClientRect();this[e(586)][e(393)]({offsetX:i[e(1161)]-t[e(1229)],offsetY:i[e(1116)]-t[e(893)],width:i[e(1436)],height:i[e(741)]})})),this[o(732)][o(1620)]("dragend",(()=>this[o(1796)].fire())),this[o(732)].addEventListener("contextmenu",(t=>{const e=o,i=t[e(440)];(i.tagName!==e(1415)||!(e(335)in i)||"text"!==i[e(335)]&&"number"!==i[e(335)])&&"TEXTAREA"!==i[e(755)]&&t[e(387)]()}));const a=document[o(1132)](o(1525));a[o(1372)].add("title"),a.textContent=s,this._headerContentElement=document[o(1132)](o(1525)),this[o(2143)][o(1372)].add(o(1564));const h=document.createElement(o(1376));h[o(1372)][o(1769)](o(1781),"luna-icon"),h[o(1605)](o(2012),o(2092)+s+o(1532)),h[o(1620)]("mousedown",(t=>t[o(1951)]())),h[o(1620)]("click",(()=>this[o(364)]=!1)),r.append(a,this[o(2143)],h),this[o(2096)]=document.createElement("div"),this[o(2096)][o(1372)][o(1769)](o(1890)),this[o(732)][o(684)](r,this[o(2096)]),this[o(413)].appendChild(this[o(732)]),this.register({dispose:()=>{const t=o;this[t(413)][t(803)](this[t(732)])}})}get[t(364)](){return this[t(1950)]}set isVisible(e){const i=t;this[i(1950)]=e,this[i(1511)][i(393)](e)}get[t(741)](){const e=t;return this[e(732)][e(1202)]().height}get width(){const e=t;return this[e(732)][e(1202)]()[e(1436)]}setPosition(e,i,s,n){const o=t;this[o(732)][o(1412)].top=e||"",this[o(732)][o(1412)].right=i||"",this[o(732)][o(1412)][o(2077)]=s||"",this._viewElement[o(1412)].left=n||""}}class Gi extends e.JT{constructor(i,s,o,r,a,h){const c=t;super(),this[c(2089)]=i,this[c(1086)]=s,this[c(1846)]=a,this[c(854)]=h,this[c(326)]=this[c(1075)](new n.v),this[c(917)]=this._onSliderChange[c(2220)],this[c(1995)]=document[c(1132)](c(1525)),this._widgetContent[c(1372)][c(1769)](r),this[c(1205)]=document[c(1132)](c(1525)),this._sliderContainer.classList[c(1769)](c(1189)),this[c(606)]=document[c(1132)]("div"),this._sliderGradientElement[c(1372)].add(c(973)),this[c(606)][c(1412)][c(897)]=this[c(2056)](),this[c(606)].addEventListener(c(830),(t=>{const e=c;this[e(1205)][e(1372)][e(1215)](e(887))&&t[e(324)]&&this[e(325)](t[e(1574)])})),this[c(606)].addEventListener(c(1798),(t=>{const e=c;this[e(606)][e(635)](t[e(2207)]),this[e(1205)][e(1372)][e(1769)](e(887)),this._updateViaSlider(t[e(1574)])})),this[c(606)][c(1620)](c(1113),(t=>{const e=c;this[e(606)][e(1427)](t[e(2207)]),this._sliderContainer.classList[e(650)]("active")})),this[c(606)][c(1620)](c(442),(t=>{const e=c;0!==t[e(894)]&&this[e(1028)](this._getValue()+(t[e(894)]>0?-1:1))})),this[c(2162)]=document.createElement("div"),this[c(2162)][c(1372)].add("slider-tab"),this[c(1205)][c(684)](this._sliderGradientElement,this[c(2162)]),this[c(1995)][c(684)](this[c(1205)]),this._container[c(684)](this._widgetContent),this[c(1967)](),this.register((0,e.OF)((()=>this[c(1995)][c(650)]()))),this[c(1075)](o((()=>this[c(1967)]())))}[t(1967)](){const e=t;this._sliderContainer[e(1372)][e(1215)](e(887))||(this[e(606)][e(1412)][e(897)]=this[e(2056)](),this[e(2162)][e(1412)][e(1161)]=this[e(915)]()/this._maxValue*(this[e(606)][e(479)]-1)+"px")}[t(325)](e){const i=t,s=Math[i(1590)](Math[i(2219)](e/(this[i(606)][i(479)]-1),1),0)*this[i(854)];this[i(1028)](s),this[i(2162)].style[i(1161)]=s/this[i(854)]*(this[i(606)].offsetWidth-1)+"px",this[i(326)][i(393)]()}}class Xi extends Gi{constructor(i,s,n,o,r,a,h,c,l){const d=t;super(i,s,n,"slider-with-input",a,h);const u=d(1672)+Math[d(1266)](1e8*Math[d(303)]()),m=document.createElement(d(1805));m[d(1634)]=o+":",m[d(1605)](d(760),u),m[d(865)]=c;const g=document[d(1132)]("input");g[d(335)]=d(383),g[d(2219)]=a[d(1629)](),g[d(1590)]=h[d(1629)](),g[d(1076)]=r.toString(),g.id=u,g.addEventListener("input",(()=>this._setValue(parseInt(g.value)))),g[d(1620)](d(1269),(()=>g[d(1076)]=this[d(915)]()[d(1629)]())),this[d(1260)]=g;const f=document[d(1132)]("div");if(f[d(1372)][d(1769)]("input-container"),f[d(684)](g),l){this._hiddenText=document[d(1132)](d(1210)),this[d(1090)].classList[d(1769)](d(1592)),this[d(1090)][d(1634)]=g.value,g[d(1620)](d(2061),(()=>this[d(921)]())),g[d(1620)](d(1581),(()=>this[d(921)]())),this[d(1075)](this.onSliderChange((()=>this[d(921)]()))),this[d(1075)](n((()=>this[d(921)]())));const t=document[d(1132)]("div");t.classList[d(1769)](d(1787)),t[d(684)](this[d(1090)],document[d(1336)](l)),f[d(684)](t)}this.register(n((()=>{const t=d;document[t(1108)]!==g?(g[t(1076)]=this._getValue()[t(1629)](),this[t(921)]()):this[t(921)]()}))),this[d(1995)][d(389)](m),this[d(1995)][d(684)](f),this[d(1075)]((0,e.OF)((()=>{const t=d;m[t(650)](),g[t(650)]()})))}[t(921)](){const e=t;this[e(1090)]&&(this[e(1090)][e(1634)]=this[e(1260)][e(1076)])}}const Yi=["r","g","b","a"];class Ji extends Xi{constructor(e,i,s){const n=t;super(e,i,e.palette[n(1192)],s[n(671)](),e[n(2083)][n(1477)][n(1793)][Yi.indexOf(s)],0,255,"a"===s?n(486):("r"===s?"Red":n("g"===s?1496:1498))+n(1795),void 0),this._channel=s,this._channelIndex=Yi[n(1993)](s),this._refresh()}_sanitizeValue(e){const i=t;return Math[i(1590)](Math[i(2219)](Math[i(1266)](e)||0,255),0)}_getValue(){const e=t;return this[e(2089)][e(2083)].primary.rgba[Yi[e(1993)](this[e(1968)])]}_setValue(e){const i=t,s=(0,lt.FK)(this[i(2089)][i(2083)][i(1477)].rgba);s[this[i(949)]]=this[i(1994)](e),this._luna[i(2083)][i(1477)].rgba=s}[t(2056)](){const e=t;if(void 0===this[e(949)])return"transparent";const i=this[e(2089)].palette[e(1477)].rgb,s=[0===this._channelIndex?0:i[0],1===this._channelIndex?0:i[1],2===this[e(949)]?0:i[2],3===this[e(949)]?0:1],n=[0===this._channelIndex?255:i[0],1===this._channelIndex?255:i[1],2===this[e(949)]?255:i[2],(this._channelIndex,1)];return e(1052)+s[e(1832)](",")+") 0%, rgba("+n[e(1832)](",")+e(1304)}}class Ki extends e.JT{constructor(i,s){const n=t;super(),this[n(2089)]=i,this[n(1086)]=s,this[n(2045)]=document[n(1132)]("div"),this._rectangleElement[n(1372)][n(1769)](n(768)),this[n(2045)].addEventListener(n(1798),(t=>{const e=n;this[e(2045)][e(635)](t[e(2207)]),this._innerContainer[e(1372)][e(1769)](e(887)),this[e(325)](t)})),this[n(2045)][n(1620)](n(795),(t=>this[n(325)](t))),this[n(2045)][n(1620)](n(1113),(t=>{const e=n;this[e(2045)][e(1427)](t[e(2207)]),this[e(1648)][e(1372)][e(650)](e(887))})),this._targetElement=document.createElement("div"),this[n(2016)].classList[n(1769)]("color-picker-target"),this[n(1648)]=document[n(1132)](n(1525)),this[n(1648)][n(1372)][n(1769)](n(1176)),this[n(1648)][n(684)](this[n(2045)]),this[n(1648)][n(684)](this._targetElement),this[n(1086)].append(this[n(1648)]),this[n(1967)](),this.register((0,e.OF)((()=>this[n(1648)][n(650)]()))),this[n(1075)](this[n(2089)][n(2083)].onChange((()=>{const t=n;!this._innerContainer.classList[t(1215)](t(887))&&this[t(1967)]()})))}[t(325)](e){const i=t;if(!this._innerContainer[i(1372)][i(1215)](i(887)))return;const s=(0,d.u)(e[i(1574)]/(this._rectangleElement[i(479)]-1),1,0),n=1-(0,d.u)(e[i(1517)]/(this[i(2045)][i(2007)]-1),1,0),o=this._luna[i(2083)][i(1477)][i(444)];this[i(2089)][i(2083)][i(1477)].hsv=lt.mC[i(2132)](o[0],s,n),this._targetElement[i(1412)][i(1161)]=s*(this[i(2045)][i(479)]-1)+"px",this._targetElement[i(1412)][i(2077)]=n*(this[i(2045)].offsetHeight-1)+"px",this[i(1967)]()}[t(1967)](){const e=t,i=this[e(2089)][e(2083)].primary[e(1657)];this[e(2016)][e(1412)][e(897)]="rgba("+i[0]+","+i[1]+","+i[2]+e(1139);const s=this[e(2089)][e(2083)][e(1477)][e(444)];!this[e(1648)].classList[e(1215)](e(887))&&(this[e(2016)][e(1412)][e(1161)]=s[1]*(this[e(2045)][e(479)]-1)+"px",this[e(2016)][e(1412)][e(2077)]=s[2]*(this._rectangleElement[e(2007)]-1)+"px");const n=lt.mC[e(1999)](lt.mC.createReadonlyHsvColor(s[0],1,1));this._rectangleElement.style[e(897)]="linear-gradient(rgba(0,0,0,0) 0%, rgb(0,0,0) 100%),"+(e(1814)+n[0])+","+n[1]+","+n[2]+e(1304)}}let $i=class extends e.JT{constructor(i,s){const n=t;super(),this[n(2089)]=i;const o=document[n(1132)](n(1525));o[n(1372)].add(n(1486));const r=document.createElement("label");r[n(1634)]="Hex:",r.setAttribute("for",n(1318)),r[n(865)]=n(2078),this._hexInputElement=document.createElement(n(2061)),this[n(2155)].id="hex",this[n(2155)][n(1678)]="[0-9a-fA-F]*",this[n(2155)].title=n(800),this[n(1927)](),this[n(2155)][n(1620)](n(2061),(()=>{const t=n,e=this._hexInputElement.value;if(6===e[t(1840)]){const i=(0,lt.FK)(this[t(2089)].palette[t(1477)][t(1657)]);i[0]=parseInt(e[t(2218)](0,2),16),i[1]=parseInt(e[t(2218)](2,4),16),i[2]=parseInt(e[t(2218)](4,6),16),this[t(2089)][t(2083)].primary[t(1657)]=i}})),this[n(2155)][n(1620)](n(1552),(t=>{const e=n;switch(t.key){case e(338):this[e(788)](t,be.V5&&t.metaKey||!be.V5&&t[e(1593)]?16:1);break;case e(503):this[e(788)](t,be.V5&&t[e(562)]||!be.V5&&t[e(1593)]?-16:-1);break;case e(2195):(be.V5&&t[e(562)]||!be.V5&&t.ctrlKey)&&this._changeHexInput(t,-255);break;case e(1399):(be.V5&&t[e(562)]||!be.V5&&t[e(1593)])&&this._changeHexInput(t,255)}})),this._hexInputElement[n(1620)](n(806),(()=>{const t=n,e=this[t(2155)][t(1076)];if(e[t(1483)](/^[0-9a-fA-F]+$/))if(3===e[t(1840)]){const i=(0,lt.FK)(this[t(2089)][t(2083)][t(1477)][t(1657)]);i[0]=parseInt(e[t(2218)](0,1)[t(1106)](2),16),i[1]=parseInt(e.substring(1,2)[t(1106)](2),16),i[2]=parseInt(e[t(2218)](2,3)[t(1106)](2),16),this[t(2089)][t(2083)].primary.rgb=i}else this._resetHexInput();else this[t(1927)]()})),o[n(684)](r,this._hexInputElement),s[n(984)](o),this[n(1075)](this[n(2089)].palette.onChange((()=>this._resetHexInput()))),this[n(1075)]((0,e.OF)((()=>o.remove())))}[t(1927)](){const e=t;this._hexInputElement&&(this._hexInputElement[e(1076)]=this[e(660)](this[e(2089)][e(2083)][e(1477)][e(1657)]))}[t(788)](e,i){const s=t;if(!this[s(2155)])return;const n=this[s(2155)][s(377)],o=this._hexInputElement[s(705)];if(null===n||null===o)return;const r=n<=1,a=n>1&&n<4||o>2&&o<4||n<=1&&o>=4,h=n>=4||o>4;if(!r&&!a&&!h)return;const c=(0,lt.FK)(this._luna.palette[s(1477)][s(1657)]);r&&(c[0]=Math[s(2219)](255,Math[s(1590)](0,parseInt(this._hexInputElement[s(1076)][s(2218)](0,2),16)+i))),a&&(c[1]=Math[s(2219)](255,Math[s(1590)](0,parseInt(this[s(2155)][s(1076)][s(2218)](2,4),16)+i))),h&&(c[2]=Math.min(255,Math[s(1590)](0,parseInt(this[s(2155)][s(1076)].substring(4,6),16)+i))),this[s(2089)].palette[s(1477)][s(1657)]=c,e[s(387)](),this[s(2155)][s(377)]=n,this[s(2155)][s(705)]=o}[t(660)](e){const i=t;return""+this[i(1741)](e[0])+this._channelToHex(e[1])+this[i(1741)](e[2])}_channelToHex(e){const i=t;return e[i(1629)](16)[i(327)](2,"0")[i(671)]()}};var Zi,Qi;$i=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect.decorate===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([(Zi=0,Qi=ni,function(t,e){Qi(t,e,Zi)})],$i);const ts=["h","s","v"];class es extends Xi{constructor(e,i,s){const n=t;super(e,i,e[n(2083)][n(1192)],s[n(671)](),Math[n(1266)](e[n(2083)][n(1477)][n(444)][ts.indexOf(s)]*("h"===s?1:100)),0,"h"===s?360:100,n("h"===s?1585:"s"===s?2090:1761)+n(932),"h"===s?void 0:"%"),this[n(1968)]=s,this[n(949)]=ts[n(1993)](s),this._refresh()}[t(1994)](e){const i=t;return Math.max(Math.min(Math[i(1266)](e)||0,this[i(854)]),0)}[t(915)](){const e=t,i=this[e(2089)].palette[e(1477)][e(444)][ts[e(1993)](this[e(1968)])];return Math.round(i*("h"===this[e(1968)]?1:100))}_setValue(e){const i=t,s=this[i(1994)](e);if("h"===this[i(1968)])this[i(2089)][i(2083)][i(1477)][i(779)]=s;else{const t=this[i(2089)][i(2083)][i(1477)][i(444)];let e;e="s"===this[i(1968)]?lt.mC[i(2132)](t[0],s/100,t[2]):lt.mC[i(2132)](t[0],t[1],s/100),this._luna.palette[i(1477)][i(444)]=e}}_getSliderBackground(){const e=t;if(void 0===this._channelIndex)return"transparent";if("h"===this[e(1968)])return e(1723);const i=this[e(2089)][e(2083)][e(1477)][e(444)],s=[0===this._channelIndex?0:i[0],1===this[e(949)]?0:Math[e(1266)](100*i[1]),2===this._channelIndex?0:Math[e(1266)](100*i[2])],n=[0===this[e(949)]?360:i[0],1===this[e(949)]?100:Math.round(100*i[1]),2===this[e(949)]?100:Math[e(1266)](100*i[2])];return e(2052)+s[0]+","+s[1]+"%,"+s[2]+e(1677)+n[0]+","+n[1]+"%,"+n[2]+e(821)}}class is extends Gi{constructor(e,i){const s=t;super(e,i,e.palette[s(1192)],s(779),0,360)}[t(915)](){const e=t;return this[e(2089)].palette[e(1477)].hue}[t(1028)](e){const i=t;this[i(2089)][i(2083)][i(1477)][i(779)]=e>360?e%360:e}[t(2056)](){return t(1723)}}var ss=function(t,e){return function(i,s){e(i,s,t)}};let ns=class extends qi{constructor(i,s,n,o,r){const a=t;super(a(1360),i,a(1685)),this[a(2089)]=s,this._colorService=n,this._commandService=o,this[a(330)]=r[a(950)](0,!0),this[a(1075)](this[a(464)]((t=>this[a(330)][a(475)](t))));const h=this[a(1242)](a(2004),"color.toggleDetails",this._colorService.showColorDetails,a(1162));this._colorService[a(1571)]((t=>{const e=a;h[e(1772)]=t,this[e(1497)]()})),this[a(2143)][a(684)](h),this._luna[a(2083)].primary.rgba=lt.m4[a(2124)](0,0,0,255),this._luna.palette.secondary[a(1793)]=lt.m4.createReadonlyRgbaColor(255,255,255,255);const c=document[a(1132)](a(1525));c[a(1372)][a(1769)](a(1328)),this[a(1537)]=this[a(1615)](a(1477)),this[a(1068)]=this._createColorInfo("secondary");const l=document[a(1132)]("button");l.classList[a(1769)]("swap",a(1880)),this[a(1075)]((0,e.Lw)(l,"click",(()=>o[a(1491)]("color.swapColors")))),c[a(684)](this[a(1537)].parentElement,this[a(1068)][a(1198)],l);const d=document[a(1132)]("div");d[a(1372)].add(a(1161)),d.append(c);const u=document[a(1132)]("div");u.classList[a(1769)](a(1155)),this[a(418)]=document[a(1132)](a(1525)),this[a(418)][a(1372)][a(1769)]("right"),this[a(1075)](new Ki(this._luna,u)),this[a(1075)](new is(this[a(2089)],u)),this[a(2096)][a(684)](d,u,this[a(418)]),this[a(1075)]((0,e.OF)((()=>{const t=a;(0,e._c)(this[t(1199)]),this[t(1199)]=void 0,d.remove(),u[t(650)]()}))),this[a(1967)](),this[a(1075)](this[a(2089)].palette[a(1192)]((()=>this[a(1967)]())))}[t(1615)](e){const i=t,s=document[i(1132)]("div");s.id=e,s[i(1372)].add(e);const n=document[i(1132)](i(1525));return n[i(1372)][i(1769)](i(402)),s[i(984)](n),n}[t(1967)](){const e=t,i=this[e(2089)][e(2083)][e(1477)][e(1793)],s=i[0]+","+i[1]+","+i[2];this[e(1537)][e(1412)][e(897)]="linear-gradient(180deg, rgba("+s+e(376)+s+","+i[3]/255+e(1304);const n=this._luna[e(2083)][e(433)][e(1793)],o=n[0]+","+n[1]+","+n[2];this._secondaryColorDiv[e(1412)][e(897)]=e(1686)+o+",1) 0%, rgba("+o+","+n[3]/255+e(1304)}_createToggle(e,i,s,n){const o=t,r=document.createElement(o(2061));return r.type=o(1520),r.id=e,r.checked=s,r[o(865)]=n,r.classList[o(1769)](e,o(1880)),r[o(1620)](o(1825),(()=>this[o(1191)][o(1491)](i))),r}[t(1497)](){const i=t;if(this[i(1961)][i(1687)]){if(!this._colorDetailsDisposables&&!this[i(2155)]){this[i(1199)]=[];for(const t of Yi)this._colorDetailsDisposables[i(1378)](new Ji(this._luna,this._rightElement,t));this[i(1199)][i(1378)](new $i(this._luna,this._rightElement));for(const t of ts)this[i(1199)].push(new es(this[i(2089)],this[i(418)],t))}}else(0,e._c)(this[i(1199)]),this._colorDetailsDisposables=void 0,this[i(2155)]=void 0}};ns=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([ss(1,ni),ss(2,bi),ss(3,ze),ss(4,We)],ns);class os extends e.JT{constructor(e){const i=t;super(),this._luna=e,this[i(564)]=!1,this[i(2131)]=this[i(1075)](new n.v),this[i(1931)]=this[i(2131)][i(2220)],this._luna[i(2083)][i(1192)]((()=>{const t=i;!this[t(564)]&&this[t(2131)][t(393)]({global:!0})}))}saveState(){const e=t;return{primary:Array[e(2098)](this[e(2089)][e(2083)].primary[e(1793)]),secondary:Array.from(this[e(2089)][e(2083)][e(433)].rgba)}}[t(1298)](e){const i=t;this[i(564)]=!0,this[i(2089)][i(2083)][i(1477)][i(1793)]=lt.m4.createReadonlyRgbaColor(e[i(1477)][0],e[i(1477)][1],e[i(1477)][2],e.primary[3]),this._luna[i(2083)][i(433)][i(1793)]=lt.m4[i(2124)](e[i(433)][0],e.secondary[1],e[i(433)][2],e.secondary[3]),this._ignoreStateChangeEvents=!1}}Ti[t(1075)]({start(e){const i=t,s=e[i(781)](ni);e.get(li)[i(2108)](i(2083),new os(s))}}),ji({id:t(1367),label:t(488),section:t(1357),checked:0,run:e=>e[t(781)](ci)[t(946)](t(1360))}),ji({id:"color.swapColors",label:t(1790),section:t(1685),run:e=>e.get(ni).palette[t(1259)](),keys:"x"}),ji({id:"color.toggleDetails",label:t(1454),section:t(1685),run:e=>{const i=t,s=e[i(781)](bi);s[i(1687)]=!s.showColorDetails}}),gi[t(1075)]("colors",{ctor:ns,defaultVisible:!0,defaultPosition:{x:t(1802),y:t(1300)}});class rs extends e.JT{constructor(e,i){const s=t;super(),this[s(2096)]=document[s(1132)](s(1525)),this[s(2096)].id=i[s(1409)]().replace(/ /g,""),this[s(2096)].classList[s(1769)](s(1424),s(1765)),e.appendChild(this[s(2096)]),this[s(1075)]({dispose:()=>{const t=s;e[t(803)](this[t(2096)])}})}}let as=class extends rs{constructor(e,i){const s=t;super(e,"Command Palette"),this[s(1191)]=i,this[s(2122)]=[];const n=document.createElement(s(1525));n[s(1372)][s(1769)](s(780)),this._inputElement=document[s(1132)](s(2061)),this[s(1604)].type="text",this._inputElement[s(1620)](s(2061),(()=>this[s(474)]())),this[s(1604)][s(1620)](s(1552),(t=>this._keyDown(t))),n[s(984)](this._inputElement);const o=document[s(1132)]("ul");o[s(1372)][s(1769)](s(838));for(let t=0;t<18;t++)this._listItemElements[s(1378)](this._createListItemElement());o[s(684)](...this._listItemElements),this[s(474)](),this._contentElement[s(1372)][s(1769)]("cmd-palette"),this._contentElement[s(684)](n,o),this[s(1604)][s(500)]()}[t(1932)](){return document[t(1132)]("li")}[t(474)](){const e=t,i=this[e(1191)].filterCommands(this._inputElement[e(1076)],18);let s=0;for(;s<i[e(1840)];s++){const t=i[s],n=this[e(2122)][s];n[e(1634)]=t[e(1998)]+": "+t[e(1805)],n[e(1372)][e(650)](e(1592))}for(;s<18;s++)this[e(2122)][s][e(1372)][e(1769)]("hidden")}[t(1792)](e){const i=t;if("Enter"===e[i(1030)]){const t=this[i(1191)][i(952)](this._inputElement[i(1076)],18);return t[i(1840)]>0&&this[i(1191)].runCommand(t[0].id),void this[i(1676)]()}}};var hs;let cs;async function ls(e){const i=t,n=document[i(1108)];if(n?.[i(755)]===i(1415)){const t=n;let e;return e=null===t[i(377)]||null===t[i(705)]||t[i(377)]===t[i(705)]?t[i(1076)]:t.value[i(2218)](t[i(377)],t[i(705)]),void navigator[i(1985)].writeText(e)}const o=e.get(ni);if(!o[i(548)][i(664)])return;const r=o[i(526)].activeLayer;if(!r)return;const a=await r[i(2156)]({range:o[i(548)][i(664)],useMovingLayer:!0});cs=o.selection[i(664)],await hs.write(a),o[i(625)].showToast(i(716)+(0,s.Oq)(o[i(548)][i(664)])+"x"+(0,s.rY)(o[i(548)][i(664)])+i(1974))}var ds,us;as=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(ds=1,us=ze,function(t,e){us(t,e,ds)})],as),ji({id:t(1735),label:t(1650),section:t(1533),run:e=>{const i=t;e[i(781)](je).createInstance(as,document[i(2106)])},keys:[t(1080),"f1"]}),function(e){const i=t;e[i(1647)]=async function(t){const e=a2_0x4755,i=new ClipboardItem({"image/png":t});if(!(e(1647)in navigator[e(1985)]))throw new Error(e(1580));await navigator.clipboard[e(1647)]([i])},e.canRead=async function(){const t=i;return(await navigator[t(1925)][t(1207)]({name:t(992)}))[t(1898)]!==t(1770)||(console[t(1053)](t(920)),!1)},e[i(465)]=async function(){const t=i;if("denied"===(await navigator[t(1925)].query({name:t(992)})).state)return void console.error(t(920));const e=await navigator[t(1985)][t(465)]();for(const i of e){if(i[t(1042)].includes(t(481)))return await i[t(2010)]("image/png");console.log(t(317))}}}(hs||(hs={})),Ti[t(1075)]({start(e){const i=t,s=e[i(781)](ni),n=e[i(781)](We)[i(950)](10,!1),o=e.get(We).bind(9,!1);s.history[i(2051)]((()=>{const t=i;n[t(475)](s[t(540)][t(1872)]),o[t(475)](s[t(540)][t(1779)])}))}}),ji({id:t(1185),label:t(1752),section:t(2159),run:function(e){const i=t,s=e[i(781)](ni);return s.history.createCompositeEntry(i(704),(async()=>{const t=i;await ls(e),await s[t(548)][t(582)]()}))},keys:"cmdctrl+x"}),ji({id:t(738),label:"Copy",section:t(2159),run:ls,keys:"cmdctrl+c"}),ji({id:t(1023),label:t(1237),section:t(2159),run:async function(e){const i=t,s=e.get(ni),n=s[i(526)][i(2073)];if(!n)return;if(!hs.canRead())return;await s[i(526)].finishTemporaryLayer();const o=await hs[i(465)]();o&&await s[i(540)][i(810)](i(936),(()=>n[i(919)](o,cs)))},keys:t(1943)}),ji({id:"edit.redo",label:t(2141),section:"Edit",run:e=>e.get(ni)[t(540)].redo(),keys:be.V5?t(1371):t(1526),enabled:10}),ji({id:t(616),label:t(1213),section:t(2159),run:e=>e.get(ni)[t(540)][t(1652)](),keys:t(814),enabled:9}),ji({id:t(1389),label:t(2027),section:t(1377),run:e=>e.get(ni)[t(1232)][t(719)](20,15),keys:"ctrl+n"}),ji({id:"file.open",label:"Open",section:t(1377),run:async e=>e[t(781)](ti).open(),keys:"ctrl+o"}),ji({id:"file.save",label:t(1837),section:"File",run:async e=>e[t(781)](ti)[t(1705)](),keys:t(1190)}),ji({id:"file.saveAs",label:"Save As",section:t(1377),run:async e=>e[t(781)](ti).saveAs(),keys:t(1555)});var ms=function(t,e){return function(i,s){e(i,s,t)}};let gs=class e extends qi{constructor(e,i,s){const n=t;super(n(540),e,"History"),this[n(2089)]=i,this[n(2059)]=s,this[n(2122)]=[],this[n(330)]=this._contextKeyService[n(950)](7,!0),this[n(1075)](this[n(464)]((t=>this[n(330)][n(475)](t)))),this[n(1989)]=document.createElement("ul"),this[n(1989)][n(1372)][n(1769)](n(448)),this[n(1075)](this[n(2089)][n(540)][n(2051)]((()=>this[n(1708)]()))),this[n(1708)](),this[n(2096)][n(984)](this._listElement)}[t(1708)](){const i=t,s=document[i(1782)](),n=this[i(2089)][i(540)][i(1573)];let o,r=!1,a=!1;for(const[t,h]of this._luna[i(540)][i(1953)].entries()){let c;if(t<this[i(2122)][i(1840)])c=this[i(2122)][t];else{c=document.createElement("li"),c[i(1194)]=0;const n=async()=>{const s=i;if(!this[s(2089)][s(540)][s(1573)])return;const n=t-this._luna[s(540)].entries.indexOf(this[s(2089)][s(540)].activeEntry),o=n>0?e[s(2198)]?e[s(2198)]:this[s(2089)][s(540)][s(772)]:e[s(600)]?e[s(600)]:this[s(2089)][s(540)].undo;for(let t=0;t<Math[s(869)](n);t++)await o()};c.addEventListener(i(1825),(()=>n())),c[i(1620)]("keydown",(t=>{const e=i;switch(t[e(1030)]){case e(338):c[e(1383)]?.focus(),t[e(387)](),t[e(1951)]();break;case e(503):c[e(1303)]?.[e(500)](),t[e(387)](),t[e(1951)]();break;case e(374):case e(1405):n(),t.preventDefault(),t[e(1951)]()}})),s[i(984)](c),this[i(2122)].push(c)}c[i(1634)]=h[i(709)],c.classList.toggle("redo",r),a=h===n,c[i(1372)][i(494)](i(887),a),a&&(r=!0,o=c)}for(this._listElement[i(984)](s);this[i(2122)][i(1840)]>this._luna[i(540)][i(1953)][i(1840)];)this._listElement[i(803)](this[i(2122)][i(658)]());o?(this[i(2096)][i(1506)]+this[i(1989)][i(1084)]>o.offsetTop||this[i(2096)][i(1506)]<o[i(1084)]-this._contentElement.offsetHeight)&&(this[i(2096)][i(1506)]=o[i(1084)]-this[i(1989)][i(1084)]):this[i(2096)][i(1506)]=this[i(2096)][i(644)]}};gs=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect[o(1226)])h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([ms(1,ni),ms(2,We)],gs),gi[t(1075)](t(540),{ctor:gs,defaultVisible:!0,defaultPosition:{x:t(1300),y:t(1802)}}),ji({id:"history.toggleHistoryWindow",label:t(1455),section:t(1357),checked:7,run:e=>e[t(781)](ci)[t(946)](t(540))});let fs=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(440)]=1,this.alignment=1,this[i(703)]=i(794),this[i(998)]=!0,this[i(1140)]=i(1146),this._onUpdate=this[i(1075)](new n.v),this[i(835)]=this._onUpdate[i(2220)],this[i(793)][i(526)][i(2152)]((()=>this[i(1665)]())),this[i(1665)]()}[t(1665)](){const e=t;(this[e(681)]!==this[e(793)][e(526)][e(1436)]||this[e(1095)]!==this[e(793)][e(526)][e(741)])&&(this[e(681)]=this[e(793)][e(526)].width,this[e(1095)]=this[e(793)][e(526)].height,this[e(531)]=this[e(681)]+e(1918)+this[e(1095)],this[e(865)]=e(2024)+this[e(681)]+e(914)+this[e(1095)]+" pixels tall",this._onUpdate[e(393)]())}};var ps,_s;fs=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if("object"==typeof Reflect&&typeof Reflect.decorate===o(1050))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([(ps=0,_s=ni,function(t,e){_s(t,e,ps)})],fs);var ys=function(t,e){return function(i,s){e(i,s,t)}};let ws=class extends qi{constructor(i,s,n,o,r,a){const h=t;super(h(693),i,"Images"),this[h(2089)]=s,this[h(1191)]=n,this._contextKeyService=o,this[h(2140)]=r,this[h(1762)]=a,this[h(536)]=new Map,this[h(1635)]=new Map,this[h(330)]=this[h(2059)][h(950)](2,!0),this[h(1075)](this[h(464)]((t=>this[h(330)][h(475)](t)))),this._imageListElement=document[h(1132)](h(1525)),this[h(871)].classList[h(1769)](h(425));const c=document[h(1132)]("div");c[h(1372)][h(1769)]("actions"),c[h(684)](this[h(593)](h(1445),(()=>this[h(1191)][h(1491)](h(1586))),h(1536)),this[h(593)]("image-delete",(()=>this[h(2089)][h(1273)][h(1356)]()),h(459)),this[h(593)](h(1319),(()=>this[h(2089)].image[h(721)]()),h(1730)),this[h(593)]("image-move-down",(()=>this[h(2089)][h(1273)].moveImageDown()),h(1864))),this[h(2096)][h(684)](this[h(871)],c),this.register(this._luna[h(1273)][h(2182)]((()=>this._renderImages()))),this.register({dispose:()=>{const t=h;for(const i of this._imageListItems.values())(0,e._c)(i[t(1838)])}}),this[h(443)]()}[t(593)](e,i,s){const n=t,o=document[n(1132)](n(1376));o.id=e,o.title=s;const r=document[n(1132)](n(458));return o[n(984)](r),o[n(1372)][n(1769)](e,n(1880)),o[n(1620)](n(1825),i),o}[t(959)](){const e=t,i=this[e(2089)][e(1273)][e(1956)];if(this[e(1635)].clear(),i)for(const t of i)this._imagesMap[e(475)](t.id,t)}[t(443)](){const i=t,s=this[i(2089)][i(1273)][i(1956)],n=this._luna.image[i(1603)];if(!s||void 0===n)return;this[i(959)]();let o=null;const r=s;for(let t=r[i(1840)]-1;t>=0;t--){const s=t,a=r[t].id;if(!this[i(536)][i(1225)](a)){const t={container:document.createElement("div"),nameSpan:document[i(1132)](i(1210)),previewCanvas:document[i(1132)](i(1726)),disposables:[]};t[i(1639)][i(1372)].add(i(1211)),t[i(856)][i(1372)][i(1769)](i(939)),t[i(856)][i(1436)]=40,t[i(856)].height=40;let n=!1;t[i(1838)][i(1378)](this[i(2089)].layer[i(313)]((()=>n=!0))),this[i(1358)][i(1378)](this[i(2089)][i(540)][i(2051)]((()=>{n&&(this[i(836)](a,t),n=!1)}))),this[i(836)](a,t),t.container[i(984)](t[i(856)]),t.container[i(1194)]=0,t.container[i(1270)]=!0,t[i(1838)].push((0,e.Lw)(t[i(1639)],i(646),(t=>{const e=i;this[e(2096)].classList[e(1769)]("dragging"),t[e(502)]&&(t.dataTransfer.dropEffect=e(2086),t[e(502)][e(1988)]=e(2086),t[e(502)][e(1403)]("text/plain",e(1630)+l.id)),t[e(1951)]()}))),t[i(1838)].push((0,e.Lw)(t.container,i(1034),(()=>{const t=i;this[t(2096)][t(1372)][t(650)](t(2079))}))),t[i(1838)][i(1378)]((0,e.Lw)(t[i(1639)],i(521),(e=>{const s=i;t[s(1639)][s(1372)][s(650)](s(472));const n=this._getImageDragEventId(e);n&&(this._luna[s(1273)].moveImageTo(n,l.id),setTimeout((()=>{const t=s;this[t(536)][t(781)](n)?.[t(1639)][t(500)]()}))),e[s(1951)]()}))),t[i(1838)].push((0,e.Lw)(t[i(1639)],i(491),(e=>{const s=i,n=this[s(1935)](e);l.id!==n&&(e[s(387)](),t[s(1639)].classList[s(1769)](s(472)))}))),t.disposables[i(1378)]((0,e.Lw)(t[i(1639)],i(421),(e=>{const s=i;t[s(1639)].classList[s(650)](s(472))}))),t[i(602)][i(1372)][i(1769)](i(1680)),t[i(1639)][i(1620)]("click",(()=>this[i(1419)](a))),t[i(1639)].addEventListener(i(1791),(async t=>{const e=i;switch(t[e(387)](),t.stopImmediatePropagation(),await this[e(2140)].show([{id:e(551),label:"Duplicate image"},{id:e(1279),label:e(972)}])){case e(551):await this[e(2089)][e(1273)][e(1862)](l);break;case e(1279):await this[e(2089)][e(1273)][e(1356)](l)}})),t[i(1639)][i(1620)]("keydown",(async e=>{const n=i;switch(e.key){case n(338):t[n(1639)][n(1383)]?.[n(500)](),e[n(387)]();break;case n(503):t[n(1639)].nextSibling?.[n(500)](),e[n(387)]();break;case n(374):case"Space":await this[n(1419)](s)}})),t[i(1639)][i(984)](t[i(602)]),this[i(536)][i(475)](a,t),t[i(1838)][i(1378)](this[i(2089)][i(1273)].onImageDeleted((e=>{const s=i;if(e===a){this._imageListElement[s(803)](t[s(1639)]);for(const e of t[s(1838)])e[s(1676)]();this[s(536)].delete(a)}})))}const h=this[i(536)][i(781)](a),c=t===n;h[i(1639)][i(1372)].toggle(i(887),c);const l=this[i(1635)].get(a);this[i(2194)](l,h),null===o?(!h[i(1639)].parentElement||null!==h[i(1639)][i(1383)])&&(this[i(871)][i(1031)]?this[i(871)].insertBefore(h[i(1639)],this[i(871)][i(1031)]):this[i(871)][i(984)](h[i(1639)])):h.container[i(1383)]!==o&&o.insertAdjacentElement("afterend",h[i(1639)]),o=h[i(1639)]}}async _generatePreview(e,i){const s=t;this[s(959)]();const n=this._imagesMap[s(781)](e);if(!n)return;const o=new ImageData(new Uint8ClampedArray(n[s(1675)]),n[s(1436)],n.height),r=await createImageBitmap(o),a=i[s(856)][s(1499)]("2d");a[s(1833)](0,0,40,40),n[s(1436)]>=40||n.width>=40?a[s(1910)](r,0,0,40,40):a[s(1910)](r,Math[s(1266)]((40-n.width)/2),(40-n[s(741)])/2,n.width,n[s(741)]),this[s(2194)](n,i)}[t(2194)](e,i){const s=t,n=[-1===e.bitness?"corrupt":e[s(308)]+s(400)];e[s(1458)]&&n.push("("+(e[s(1458)]===s(461)?s(1362):s(1784))+")"),i[s(602)][s(1634)]=e[s(1436)]+"x"+e[s(741)]+(n[s(1840)]>0?s(991)+n[s(1832)](" "):"")}async[t(1419)](e){const i=t,s=this[i(2089)][i(1273)][i(1956)]?.findIndex((t=>t.id===e));-1!==s&&await this[i(2089)].image[i(673)](s)}[t(1935)](e){const i=t;if(e[i(502)]){const t=e[i(502)][i(2181)]("text/plain");if(t?.[i(935)](i(1630)))return parseInt(t[i(2218)](13))}}};ws=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect[o(1226)])h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([ys(1,ni),ys(2,ze),ys(3,We),ys(4,Qe),ys(5,hi)],ws);let vs=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(440)]=1,this[i(826)]=1,this.className=i(2095),this.hasImage=!0,this[i(451)]=!1,this[i(1140)]=i(1146),this[i(1711)]=this.register(new n.v),this.onUpdate=this[i(1711)][i(2220)],this[i(793)].viewport.onPointerCoordChange((t=>this[i(1665)](t)))}[t(1665)](e){const i=t;this.visible=!!e,e&&(this[i(531)]=e[0]+","+e[1]),this[i(1711)].fire()}};var bs,xs;vs=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1226)]===o(1050))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(bs=0,xs=ni,function(t,e){xs(t,e,bs)})],vs);var Is=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h},Ss=function(t,e){return function(i,s){e(i,s,t)}};let Cs=class extends e.JT{constructor(e,i){const s=t;super(),this[s(793)]=e,this[s(1569)]=i,this[s(440)]=1,this.alignment=1,this.className=s(2127),this[s(998)]=!0,this[s(451)]=!0,this[s(865)]=s(567),this[s(1140)]=s(452),this[s(1711)]=this[s(1075)](new n.v),this[s(835)]=this[s(1711)][s(2220)],this[s(793)][s(818)][s(945)]((t=>{this[s(1461)]=t,this._update(t)})),this._lunaService[s(526)][s(313)]((()=>this[s(1665)](this[s(1461)])))}[t(1665)](e){const i=t,s=this._workbenchConfigService[i(1329)][i(1707)]===i(634);let n;e&&(n=this[i(793)][i(526)][i(1757)](e[0],e[1],s));const o=n?n[0]+","+n[1]+","+n[2]+","+n[3]:"";this[i(531)]!==o&&(this.text=o,this[i(1711)][i(393)]())}};Is([fi(50)],Cs.prototype,t(1665),null),Cs=Is([Ss(0,ni),Ss(1,Je)],Cs),gi[t(1075)](t(693),{ctor:ws,defaultVisible:!1,defaultPosition:{x:t(1300),y:{target:"minimap",side:"end"}}}),Ti[t(1075)]({start(e){const i=t,s=e[i(781)](oi),n=e[i(781)](je);s[i(827)](n[i(1912)](Cs)),s[i(827)](n.createInstance(vs)),s[i(827)](n[i(1912)](fs))}}),ji({id:t(1710),label:t(774),section:t(1357),checked:2,run:e=>{const i=t;if(void 0===e[i(781)](ni)[i(1273)].imageSet)throw new Error(i(877));e[i(781)](ci)[i(946)](i(693))}}),ji({id:t(1586),label:"Add Image",section:t(2069),enabled:11,run:async e=>{const i=t,s=e.get(hi),{width:n,height:o}=await s[i(532)](),r=await s.requestQuickPick(i(904),[{id:"1",label:i(1124),description:i(1557)},{id:"4",label:i(1490),description:"16 colors"},{id:"8",label:i(1778),description:i(2129)},{id:"24",label:"24-bit",description:i(647)},{id:"32",label:i(1972),description:i(2060)}]);if(void 0!==r)return e[i(781)](ni).image[i(853)](n,o,parseInt(r))}}),ji({id:"image.deleteImage",label:t(1803),section:t(2069),enabled:11,run:async e=>e[t(781)](ni).image[t(1356)]()}),ji({id:"image.goToTopImage",label:t(2165),section:t(2069),run:e=>e[t(781)](ni).image[t(1131)]()}),ji({id:t(609),label:t(1149),section:t(2069),run:e=>e[t(781)](ni)[t(1273)][t(862)]()}),ji({id:"image.goToImageAbove",label:t(2104),section:t(2069),run:e=>e[t(781)](ni)[t(1273)][t(1767)]()}),ji({id:t(724),label:t(1996),section:t(2069),run:e=>e[t(781)](ni)[t(1273)].goToImageBelow()}),ji({id:t(1400),label:t(767),section:t(2069),run:e=>e.get(ni)[t(1273)][t(1645)]()}),ji({id:"image.moveImageUp",label:t(1058),section:t(2069),run:e=>e.get(ni).image[t(721)]()}),ji({id:t(751),label:"Move Image Down",section:t(2069),run:e=>e[t(781)](ni)[t(1273)][t(2062)]()}),ji({id:"image.moveImageToBottom",label:t(2080),section:"Image",run:e=>e[t(781)](ni)[t(1273)].moveImageToBottom()}),ji({id:t(861),label:t(592),section:t(2069),run:async e=>{const i=t,s=e[i(781)](ni);await s[i(1221)].executeOnAllLayers("layer/cropToSelection",{selection:s[i(548)].range})},keys:t(1688),enabled:8}),ji({id:"image.expandCanvasToSelection",label:t(2014),section:t(2069),run:async e=>{const i=t,s=e.get(ni);await s[i(1221)].executeOnAllLayers(i(679),{selection:s[i(548)][i(664)]}),s[i(818)][i(846)]()},enabled:8}),ji({id:"image.resize",label:t(2113),section:t(2069),run:async e=>{const i=t,s=await e[i(781)](ni),n=await e[i(781)](hi)[i(2070)]("layer/resize");await s[i(1221)][i(764)](i(430),n)},keys:t(791)}),ji({id:"image.resizeCanvas",label:"Resize Canvas",section:t(2069),run:async e=>{const i=t,s=e[i(781)](ni),n=await e[i(781)](hi)[i(2070)](i(1142));await s[i(1221)][i(764)](i(1142),n)},keys:"ctrl+shift+r"}),ji({id:t(1465),label:t(1252),section:t(2069),run:async e=>{const i=t,s=e[i(781)](ni);await s.task.executeOnAllLayers(i(467),{selection:s.selection[i(664)]})}}),ji({id:t(1255),label:t(436),section:t(2069),run:async e=>{const i=t,s=e[i(781)](ni);await s.task[i(764)](i(545),{selection:s.selection[i(664)]})}}),ji({id:"image.rotate180",label:t(1755),section:t(2069),run:async e=>{const i=t,s=e[i(781)](ni);await s[i(1221)][i(764)]("layer/rotate180",{selection:s[i(548)].range})},keys:t(1373)}),ji({id:t(543),label:t(1466),section:t(2069),run:async e=>{const i=t,s=e[i(781)](ni);await s[i(1221)].executeOnAllLayers(i(460),{selection:s[i(548)][i(664)]})},keys:t(872)}),ji({id:t(1732),label:t(556),section:t(2069),run:async e=>{const i=t,s=e.get(ni);await s[i(1221)].executeOnAllLayers("layer/rotate90CounterClockwise",{selection:s[i(548)][i(664)]})},keys:t(618)}),ji({id:t(512),label:"Flatten Layers",section:t(2069),run:e=>e.get(ni)[t(526)][t(1097)](),keys:t(1425)}),ji({id:t(934),label:t(1428),section:t(2069),run:e=>e[t(781)](ni)[t(526)][t(1860)](),keys:t(910)}),ji({id:"image.customizePointerColorStatusBarItem",label:t(2136),section:t(2069),run:async e=>{const i=t,s=e[i(781)](Je),n=s[i(1329)][i(1707)],o=await e[i(781)](hi)[i(1847)]("What pixel color do you want to show?",[{id:i(1284),label:i(2157),description:n===i(1284)?i(1850):void 0,detail:"The color of only the current layer"},{id:i(634),label:i(2069),description:"allLayers"===n?i(1850):void 0,detail:i(829)}]);if(o)switch(o){case i(1284):s[i(1329)]={...s.config,statusBarPointerColor:"currentLayer"};break;case i(634):s[i(1329)]={...s[i(1329)],statusBarPointerColor:i(634)}}}}),Ti[t(1075)]({start:()=>{const e=t;document[e(1960)](".view")[e(776)]((t=>{const i=e;t[i(1620)](i(1552),(t=>{const e=i,s=t[e(440)]?.[e(755)];if(s===e(1624)){t[e(1916)]();const i=new Event("input",{bubbles:!0});return void t[e(440)].dispatchEvent(i)}if(s!==e(1415))return;const n=t[e(440)];if("text"===n[e(335)])return void((be.V5&&!t[e(562)]||!be.V5&&!t[e(1593)])&&t[e(1916)]());if(n[e(335)]!==e(383))return;let o;if(be.V5&&t[e(562)]||!be.V5&&t.ctrlKey)switch(t.key){case"ArrowUp":o=parseInt(n[e(1076)])+10;break;case e(503):o=parseInt(n.value)-10;break;case"ArrowLeft":o=""!==n[e(2219)]?parseInt(n.min):void 0;break;case e(1399):o=""!==n[e(1590)]?parseInt(n.max):void 0}else switch(t.key){case e(338):o=parseInt(n[e(1076)])+1;break;case e(503):o=parseInt(n[e(1076)])-1;break;case e(2195):case"ArrowRight":return void t.stopImmediatePropagation()}if(void 0===o)return;""!==n[e(2219)]&&(o=Math[e(1590)](o,parseInt(n.min))),""!==n[e(1590)]&&(o=Math[e(2219)](o,parseInt(n[e(1590)]))),n[e(1076)]=o[e(1629)](),t[e(387)](),t[e(1951)]();const r=new Event(e(2061),{bubbles:!0});n[e(1172)](r)})),t[i(1620)](i(739),(t=>{const e=i,s=t[e(440)]?.[e(755)];if(s!==e(1415))return;const n=t[e(440)];if(n[e(335)]!==e(383))return;const o=parseInt(n[e(1076)]);if(isNaN(o))n.value=n.min;else{const t=parseInt(n[e(2219)]);if(!isNaN(t)&&o<t)n.value=n[e(2219)];else{const t=parseInt(n[e(1590)]);!isNaN(t)&&o>t&&(n.value=n.max)}}}))}))}});var Es=function(t,e){return function(i,s){e(i,s,t)}};let Ts=class extends qi{constructor(e,i,s){const n=t;super(n(2083),e,n(2093)),this[n(2089)]=i,this[n(330)]=s[n(950)](5,!0),this[n(1075)](this[n(464)]((t=>this._windowVisibleContextKey.set(t)))),this[n(2096)].append(this[n(2005)](255,255,255),this[n(2005)](0,0,0),this[n(2005)](255,0,0),this[n(2005)](255,255,0),this._createPaletteButton(0,255,0),this[n(2005)](0,255,255),this[n(2005)](0,0,255),this._createPaletteButton(255,0,255),document[n(1132)]("br"),this[n(2005)](255,255,255,192),this[n(2005)](0,0,0,192),this[n(2005)](255,0,0,192),this[n(2005)](255,255,0,192),this[n(2005)](0,255,0,192),this[n(2005)](0,255,255,192),this[n(2005)](0,0,255,192),this[n(2005)](255,0,255,192),document.createElement("br"),this._createPaletteButton(255,255,255,128),this._createPaletteButton(0,0,0,128),this._createPaletteButton(255,0,0,128),this[n(2005)](255,255,0,128),this[n(2005)](0,255,0,128),this._createPaletteButton(0,255,255,128),this[n(2005)](0,0,255,128),this[n(2005)](255,0,255,128),document[n(1132)]("br"),this[n(2005)](255,255,255,64),this[n(2005)](0,0,0,64),this[n(2005)](255,0,0,64),this[n(2005)](255,255,0,64),this[n(2005)](0,255,0,64),this[n(2005)](0,255,255,64),this[n(2005)](0,0,255,64),this._createPaletteButton(255,0,255,64))}_createPaletteButton(e,i,s,n=255){const o=t,r=document[o(1132)](o(1525));r.classList[o(1769)](o(2204));const a=document.createElement("div");r[o(1620)](o(1825),(()=>this[o(2089)][o(2083)][o(1477)][o(1793)]=lt.m4[o(2124)](e,i,s,n))),r[o(1620)]("contextmenu",(t=>{const r=o;this._luna[r(2083)][r(433)][r(1793)]=lt.m4[r(2124)](e,i,s,n),t[r(387)]()})),a[o(1372)][o(1769)]("color-overlay");const h=o(1513)+e+","+i+","+s+",1)";return a[o(1412)][o(897)]="linear-gradient(180deg, "+h+o(1032)+e+","+i+","+s+","+n/255+o(1304),r[o(984)](a),r}};Ts=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([Es(1,ni),Es(2,We)],Ts),gi[t(1075)]("palette",{ctor:Ts,defaultVisible:!1,defaultPosition:{x:"start",y:{target:t(1360),side:"end"}}}),ji({id:t(648),label:"Toggle Palette Window",section:t(1357),checked:5,run:e=>e[t(781)](ci)[t(946)]("palette")});let Ls=class extends e.JT{constructor(e){const i=t;super(),this[i(793)]=e,this.target=1,this[i(826)]=0,this.className=i(1819),this[i(998)]=!0,this[i(451)]=!1,this[i(1711)]=this[i(1075)](new n.v),this[i(835)]=this[i(1711)][i(2220)],this[i(793)][i(548)][i(835)]((()=>this[i(1665)]())),this[i(1665)]()}_update(){const e=t,i=this[e(793)].selection[e(664)];if(!i)return void(this[e(451)]&&(this.text="",this[e(451)]=!1,this[e(1711)][e(393)]()));const n=(0,s.Oq)(i),o=(0,s.rY)(i);this.text=n+e(1918)+o,this[e(865)]=e(1272)+n+e(914)+o+e(2221),this[e(451)]=!0,this._onUpdate[e(393)]()}};var As,Rs;Ls=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect.decorate===o(1050))h=Reflect.decorate(e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h}([(As=0,Rs=ni,function(t,e){Rs(t,e,As)})],Ls);let Ds=class extends e.JT{constructor(e){const i=t;super(),this[i(793)]=e,this[i(440)]=1,this.alignment=0,this[i(703)]=i(1463),this[i(998)]=!0,this[i(451)]=!1,this[i(1711)]=this.register(new n.v),this[i(835)]=this[i(1711)][i(2220)],this._lunaService[i(548)][i(835)]((()=>this[i(1665)]())),this[i(1665)]()}[t(1665)](){const e=t,i=this._lunaService[e(548)][e(664)];i?(this[e(531)]=i[e(1161)]+", "+i[e(1116)],this.title=e(2192)+i[e(1161)]+e(2030)+i[e(1116)],this.visible=!0,this._onUpdate[e(393)]()):this.visible&&(this[e(531)]="",this.visible=!1,this[e(1711)][e(393)]())}};var Ms,Bs;Ds=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect[o(1226)])h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(Ms=0,Bs=ni,function(t,e){Bs(t,e,Ms)})],Ds),Ti[t(1075)]({start(e){const i=t;e.get(oi)[i(827)](e[i(781)](je)[i(1912)](Ds)),e.get(oi)[i(827)](e[i(781)](je).createInstance(Ls));const s=e[i(781)](ni),n=e[i(781)](We)[i(950)](8,!1);s[i(548)][i(835)]((()=>{const t=i;n[t(475)](!!s.selection[t(664)])}))}}),ji({id:t(1254),label:t(1285),section:"Selection",run:e=>e[t(781)](ni)[t(548)][t(1549)](),keys:t(1717)}),ji({id:"selection.deselect",label:t(1350),section:"Selection",run:e=>e.get(ni)[t(548)][t(1010)](),keys:t(1306),enabled:8}),ji({id:t(1535),label:t(1829),section:t(889),run:e=>e[t(781)](ni).selection[t(582)](),keys:t(1279),enabled:8}),ji({id:"selection.eraseKeepSelection",label:t(2097),section:t(889),run:e=>e.get(ni)[t(548)][t(2172)](),enabled:8});class ks extends e.JT{constructor(e,i,s){const n=t;super(),this.id=e,this[n(1950)]=!0,this._contentElement=document[n(1132)]("div"),this._contentElement.id=s.toLowerCase().replace(/ /g,""),this._contentElement.classList.add(n(1424),n(1291)),i[n(984)](this[n(2096)]),i[n(1620)](n(1791),(t=>{const e=n,i=t[e(440)];(i.tagName!==e(1415)||!(e(335)in i)||"text"!==i[e(335)]&&i[e(335)]!==e(383))&&"TEXTAREA"!==i[e(755)]&&t[e(387)]()})),this[n(1075)]({dispose:()=>{const t=n;i.removeChild(this[t(2096)])}})}get[t(364)](){return this._isVisible}set[t(364)](e){const i=t;this[i(1950)]=e,this[i(2096)][i(1412)][i(370)]=this[i(1950)]?"":"none"}}var Ps=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object.getOwnPropertyDescriptor(i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect[o(1226)])h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object.defineProperty(i,s,h),h},Us=function(t,e){return function(i,s){e(i,s,t)}};class Fs extends ks{constructor(e,i,s,n){const o=t;super(o(0===e?1671:416),i,o(0===e?1019:1251)),this[o(1559)]=e,this[o(336)]=s,this[o(1191)]=n,this[o(332)]=new Map,this[o(2096)][o(1372)][o(1769)](o(868)),this[o(928)]=document.createElement(o(1525)),this[o(928)][o(1372)][o(1769)](o(2121)),this[o(1887)]=document.createElement("div"),this._rightItemsElement.classList[o(1769)](o(1818)),(0===this._target?this[o(336)].onDidAddTopItem:this[o(336)].onDidAddBottomItem)((t=>this[o(1566)](t))),(0===this[o(1559)]?this[o(336)][o(1294)]:this[o(336)].onDidRemoveBottomItem)((t=>this._removeItem(t))),this._contentElement[o(684)](this[o(928)],this._rightItemsElement),this[o(1075)]({dispose:()=>{const t=o;for(const e of this[t(332)][t(1060)]())for(const t of e)t.dispose()}})}_addItem(e){const i=t,s=[],n=0===e[i(826)]?this[i(928)]:this._rightItemsElement,o=document[i(1132)](i(1210));if(o[i(1372)].add(i(1170)),e.className&&o[i(1372)].add(e[i(703)]),e[i(998)]&&o.classList[i(1769)]("image",i(1764)),e[i(865)]&&(o[i(865)]=e.title),o[i(1620)](i(1825),(()=>{const t=i;e.commandId&&this[t(1191)][t(1491)](e[t(1140)])})),e.input){const t=i(1464)+Math[i(1266)](1e6*Math[i(303)]());switch(e[i(2061)][i(335)]){case"boolean":{const s=e[i(2061)];if(!e[i(998)]){const s=document[i(1132)](i(1805));s[i(1634)]=e[i(531)]+": ",s.setAttribute(i(760),t),o.append(s)}o.addEventListener(i(1825),(()=>s[i(653)](!o.classList.contains(i(1772))))),s[i(1763)]((t=>o[i(1372)][i(494)](i(1772),t)));break}case i(2185):{const s=e[i(2061)],n=document[i(1132)](i(1805));n[i(1634)]=e[i(531)]+": ",n.setAttribute(i(760),t);const r=document.createElement(i(1033));r.id=t;for(const t of s.options){const e=document[i(1132)](i(2018));e.value=t,e.textContent=t,r.appendChild(e)}r[i(1076)]=s[i(848)],r[i(1620)](i(806),(t=>{const e=i;s[e(653)](r[e(1076)])})),s[i(1763)]((t=>r.value=t)),o[i(684)](n,r);break}case i(1509):{const s=e.input,n=document.createElement(i(1805));n.textContent=e[i(531)]+": ",n[i(1605)](i(760),t);const r=document.createElement(i(2061));r[i(335)]=i(531),r.id=t;const a=document.createElement("datalist");for(const t of s[i(1579)]){const e=document[i(1132)](i(2018));e[i(1076)]=t,a[i(984)](e)}a.id="list-"+t,r[i(1605)](i(1601),"list-"+t),r[i(1076)]=s[i(848)],r[i(1620)](i(806),(t=>{const e=i;s[e(653)](r[e(1076)])})),s[i(1763)]((t=>r[i(1076)]=t)),o[i(684)](n,r,a);break}case i(383):{const s=e.input,n=document[i(1132)](i(1805));n[i(1634)]=e.text+": ",n[i(1605)]("for",t);const r=document.createElement(i(2061));r.id=t,r[i(335)]="number",s[i(2219)]&&(r[i(2219)]=s[i(2219)][i(1629)]()),s.max&&(r.max=s[i(1590)].toString()),r[i(1076)]=s.currentValue[i(1629)](),r[i(1620)](i(2061),(t=>{const e=i;s[e(653)](parseFloat(r[e(1076)]))})),r[i(1620)](i(806),(t=>{const e=i;s[e(653)](parseFloat(r[e(1076)]))})),s[i(1763)]((t=>r[i(1076)]=t.toString())),o[i(684)](n,r);break}}}e[i(835)]&&s.push(e[i(835)]((()=>this[i(849)](e,o)))),this[i(849)](e,o),n[i(984)](o),s.push({dispose:()=>n[i(803)](o)}),this[i(332)][i(475)](e,s)}_removeItem(e){const i=t,s=this[i(332)][i(781)](e);if(s){for(const t of s)t.dispose();this._itemDisposables[i(1279)](e)}}[t(849)](e,i){const s=t;e[s(2061)]&&!e[s(998)]?i[s(525)](s(1805)).textContent=e[s(531)]+": ":(i[s(1634)]=e[s(531)],i[s(1372)].toggle(s(559),0===e.text?.[s(1840)])),e[s(865)]&&(i.title=e[s(865)]),i[s(1412)][s(370)]=!1===e[s(451)]?s(696):"",i[s(1372)][s(494)](s(1045),!!e[s(1140)]&&!1!==e.enabled),i[s(1372)][s(494)](s(1772),!!e[s(1772)]),void 0!==e[s(1289)]&&i[s(1372)][s(494)]("disabled",!e.enabled)}}let Os=class extends Fs{constructor(t,e,i){super(0,t,e,i)}};Os=Ps([Us(1,oi),Us(2,ze)],Os);let Ns=class extends Fs{constructor(t,e,i){super(1,t,e,i)}};Ns=Ps([Us(1,oi),Us(2,ze)],Ns),ui[t(1075)](t(1671),{anchor:t(1116),ctor:Os}),ui[t(1075)](t(416),{anchor:t(2077),ctor:Ns}),ji({id:t(1440),label:t(435),section:"Window",run:e=>e[t(781)](ci)[t(946)](t(1671))}),ji({id:t(1507),label:"Toggle Bottom Status Bar View",section:"Window",run:e=>e[t(781)](ci)[t(946)](t(416))});class Vs extends e.JT{constructor(e,i){const s=t;super(),this[s(663)]=e,this[s(703)]=i,this[s(440)]=0,this[s(826)]=0,this[s(998)]=!0,this[s(531)]="",this[s(1711)]=this.register(new n.v),this[s(835)]=this[s(1711)][s(2220)],this[s(663)][s(835)]&&this.register(this[s(663)][s(835)]((()=>this[s(1665)]()))),this._update()}[t(1665)](){const e=t;switch(this[e(663)].type){case e(302):this[e(1140)]=e(861);break;case e(1625):this[e(1140)]=e(1695);break;default:throw new Error(e(637)+this[e(663)][e(335)]+'"')}this[e(865)]=this._action[e(1680)],this[e(1289)]=this[e(663)][e(1289)],this[e(1711)][e(393)]()}}class Hs{constructor(){this[t(677)]=[]}start(e){const i=t,s=e[i(781)](ni),n=e[i(781)](oi);s[i(1196)].onToolChange((()=>this[i(1665)](s,n)))}[t(1665)](e,i){const s=t;for(const t of this._activeItems)t[s(1676)]();this[s(677)][s(1840)]=0;const n=e[s(1196)][s(1145)];for(const t of n)this._activeItems[s(1378)](i.createItem(new Vs(t,e[s(1196)].activeTool+"-"+t.type)))}}class zs extends e.JT{constructor(e,i){const s=t;super(),this[s(784)]=e,this[s(703)]=i,this[s(440)]=1,this[s(826)]=0,this[s(998)]=!0,this[s(451)]=!1,this._onUpdate=this[s(1075)](new n.v),this[s(835)]=this[s(1711)].event,this[s(1075)](this[s(784)][s(835)]((()=>this[s(1665)]()))),this[s(1665)]()}[t(1665)](){const e=t;this[e(784)][e(451)]?(this[e(531)]=this[e(784)].getInfo(),this[e(865)]=this[e(784)][e(329)](),this[e(451)]=!0,this[e(1711)][e(393)]()):this[e(451)]&&(this[e(531)]="",this[e(451)]=!1,this[e(1711)][e(393)]())}}class Ws{constructor(){this[t(677)]=[]}[t(1802)](e){const i=t,s=e[i(781)](ni),n=e.get(oi);s[i(1196)][i(1637)]((()=>this[i(1665)](s,n)))}[t(1665)](e,i){const s=t;for(const t of this[s(677)])t[s(1676)]();switch(this._activeItems[s(1840)]=0,e[s(1196)][s(462)]){case s(2046):case"rectangle":case"shape":case s(531):for(const t of e[s(1196)][s(2117)])(t[s(335)]===s(1354)||t[s(335)]===s(831)||t[s(335)]===s(1840)||t.type===s(682))&&this[s(677)][s(1378)](i.createItem(new zs(t,e[s(1196)][s(462)]+"-"+t[s(335)])))}}}class js{constructor(){this[t(677)]=[]}[t(1802)](e){const i=t,s=e[i(781)](ni),n=e.get(oi);s[i(1196)][i(1637)]((()=>this[i(1665)](s,n)))}_update(e,i){const s=t;for(const t of this[s(677)])t[s(1676)]();this[s(677)][s(1840)]=0;const n=e[s(1196)][s(1579)];for(const t of n)switch(t.type){case s(2054):const n=new qs(e,t);this[s(677)].push(i[s(827)](n));break;case s(2185):const o=t;this[s(2135)](e[s(1196)][s(462)],i,{text:t[s(1680)]},{type:"string",currentValue:o.value,options:o.options,setOption:e=>t[s(1076)]=e,onHistoryUpdateValue:t[s(1763)]});break;case"string-combo":const r=t;this[s(2135)](e[s(1196)].activeTool,i,{text:t.name},{type:s(1509),currentValue:r[s(1076)],options:r[s(1579)],setOption:e=>t[s(1076)]=e,onHistoryUpdateValue:t[s(1763)]});break;case s(383):const a=t;this[s(2135)](e.tool[s(462)],i,{text:t.name},{type:s(383),currentValue:a[s(1076)],min:a.min,max:a[s(1590)],setOption:e=>t[s(1076)]=e,onHistoryUpdateValue:t[s(1763)]});break;default:throw new Error(s(2067)+t[s(335)]+'"')}}[t(2135)](e,i,s,n){const o=t,r={target:0,alignment:0,dispose:()=>{},text:s[o(998)]?"":s[o(531)],title:s.hasImage?s[o(531)]:void 0,className:e+"-"+s.text[o(1409)]().replace(/ /g,"-"),hasImage:s[o(998)],input:n};this[o(677)][o(1378)](i[o(827)](r))}}class qs extends e.JT{constructor(e,i){const s=t;super(),this[s(1236)]=i,this[s(440)]=0,this.alignment=0,this.hasImage=!0,this[s(531)]="",this._onUpdate=this[s(1075)](new n.v),this[s(835)]=this._onUpdate[s(2220)],this[s(865)]=i[s(1680)],this[s(703)]=e.tool[s(462)]+"-"+i.name[s(1409)]()[s(1257)](/ /g,"-"),this[s(2061)]={type:s(2054),currentValue:i[s(1076)],setOption:t=>{this[s(1772)]=t,this.update()},onHistoryUpdateValue:i.onHistoryUpdateValue},this[s(1772)]=i[s(1076)]}update(){const e=t;this.checked||this[e(1236)][e(2151)]?(this[e(1236)][e(1076)]=this.checked,this._onUpdate[e(393)]()):this[e(1236)].value=!0}}var Gs=function(t,e){return function(i,s){e(i,s,t)}};const Xs=new Map([[t(548),"S"],[t(1006),"C"],[t(1070),"M"],[t(1014),"P"],[t(2214),"M"],["eraser","E"],[t(975),"K"],["fill","F"],[t(2046),"O"],[t(516),"O"],[t(2175),"O"],[t(531),"T"],[t(1379),"H"],[t(1514),"Z"]]),Ys=[t(548),t(1070),t(1006),t(2214),t(453),"pencil","eraser",t(975),t(979),"separator","line",t(516),t(2175),t(531),t(453),t(1379),t(1514)];let Js=class extends qi{constructor(e,i,s,o,r){const a=t;super(a(1381),e,a(319)),this[a(2089)]=i,this[a(2059)]=s,this[a(828)]=new Map,this[a(1848)]={activeTool:a(548)},this[a(2131)]=this[a(1075)](new n.v),this[a(1931)]=this[a(2131)][a(2220)],this[a(1848)][a(462)]=r[a(1329)][a(944)],o[a(2108)](a(1036),this),this[a(330)]=this[a(2059)].bind(1,!0),this.register(this.onDidChangeVisibility((t=>this[a(330)].set(t)))),this._luna[a(1196)][a(1637)]((t=>{const e=a;t.id!==this[e(1848)][e(462)]&&this[e(2131)].fire()}));const h=r[a(1329)][a(944)],c=document[a(1782)]();for(const[t,e]of Ys[a(1953)]()){if(e===a(453)){const t=document[a(1132)]("hr");t[a(1372)][a(1769)](a(1880)),c[a(984)](t);continue}const i=document.createElement(a(1525));i[a(1372)][a(1769)](a(1048));const s=document[a(1132)](a(2061));s[a(1680)]=a(1196),s.type=a(1892),s[a(1372)][a(1769)]("tool",e,"luna-icon");const n=Ks(e),o=Xs[a(781)](e);s[a(865)]=o?n+" ("+o+")":""+n,s.setAttribute(a(2012),n),this[a(828)][a(475)](e,s),s[a(1772)]=e===h,s.addEventListener(a(806),(()=>this[a(2089)][a(1196)].setTool(e))),s[a(1620)]("keydown",(s=>{const n=a;switch(s[n(1030)]){case n(338):i[n(1383)]?.[n(1383)]?.firstChild?.focus(),s[n(387)](),s[n(1951)]();break;case"ArrowDown":const o=i[n(1303)]?.[n(1303)]?.firstChild;o?o[n(500)]():i[n(1303)]?.[n(1031)]?.[n(500)](),s[n(387)](),s[n(1951)]();break;case n(2195):t%2==1&&i[n(1383)]?.[n(1031)]?.[n(500)](),s[n(387)](),s[n(1951)]();break;case n(1399):if(t%2==0){const t=i.nextSibling?.firstChild;t?t[n(500)]():i[n(1383)]?.firstChild?.[n(500)]()}s[n(387)](),s[n(1951)]();break;case n(374):this[n(2089)][n(1196)][n(2075)](e)}})),i[a(984)](s),c[a(984)](i)}this[a(2096)][a(984)](c),this[a(1075)](this[a(2089)][a(1196)][a(1637)]((t=>{const e=a;this[e(828)][e(781)](t.id).checked=!0;for(const[i,s]of this[e(828)].entries())s[e(1198)]?.classList[e(494)]("checked",i===t.id)}))),this[a(2089)].tool.setTool(h)}saveState(){const e=t;return{activeTool:this._luna[e(1196)][e(462)]}}[t(1298)](e){const i=t;e[i(462)]&&e.activeTool!==this._luna[i(1196)][i(462)]&&(this._lastActiveTool[i(462)]=e[i(462)],this[i(2089)].tool.setTool(e[i(462)]))}};function Ks(e){const i=t;return((e[i(2218)](0,1)[i(671)]()+e.substring(1))[i(1483)](/[A-Z][a-z]+/g)||[])[i(1832)](" ")}function $s(e,i,s){const n=t,o=e[n(781)](ni);o[n(1196)][n(2075)](i,s),o[n(818)].focus()}Js=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&"function"==typeof Reflect[o(1226)])h=Reflect.decorate(e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([Gs(1,ni),Gs(2,We),Gs(3,li),Gs(4,Je)],Js),gi.register(t(1381),{ctor:Js,defaultVisible:!0,defaultPosition:{x:t(1802),y:"start"}}),Ti[t(1075)](new js),Ti[t(1075)](new Hs),Ti[t(1075)](new Ws),ji({id:"tool.toggleToolsWindow",label:"Toggle Tools Window",section:t(1357),checked:1,run:e=>e[t(781)](ci)[t(946)]("tools")}),ji({id:t(1606),label:"Color Picker",section:t(1397),run:e=>$s(e,t(975)),keys:"k"}),ji({id:t(916),label:t(482),section:t(1397),run:t=>$s(t,"crop"),keys:"c"}),ji({id:t(1759),label:t(1479),section:t(1397),run:t=>$s(t,"eraser"),keys:"e"}),ji({id:t(1059),label:t(1617),section:t(1397),run:t=>$s(t,"fill"),keys:"f"}),ji({id:t(1452),label:"Hand",section:t(1397),run:e=>$s(e,t(1379)),keys:"h"}),ji({id:t(1591),label:t(1469),section:t(1397),run:t=>$s(t,"hand",{untilRelease:" "}),keys:t(2149)}),ji({id:t(699),label:"Line",section:t(1397),run:e=>$s(e,t(2046))}),ji({id:"tool.toggleShapeTool",label:t(834),section:"Tool",run:e=>{const i=t,s=e[i(781)](ni)[i(1196)];"line"===s.activeTool?$s(e,i(516)):s[i(462)]===i(516)?$s(e,"shape"):$s(e,i(2046))},keys:"o"}),ji({id:"tool.movePixels",label:t(840),section:t(1397),run:t=>$s(t,"movePixels")}),ji({id:t(753),label:t(740),section:t(1397),run:e=>$s(e,t(2214))}),ji({id:t(908),label:"Toggle Move Tool",section:"Tool",run:e=>{const i=t;"movePixels"===e[i(781)](ni)[i(1196)][i(462)]?$s(e,"moveSelection"):$s(e,i(1070))},keys:"m"}),ji({id:t(372),label:t(1886),section:t(1397),run:e=>$s(e,t(1014)),keys:"p"}),ji({id:t(720),label:t(305),section:t(1397),run:e=>$s(e,t(516)),keys:"o"}),ji({id:t(1595),label:t(1731),section:t(1397),run:e=>$s(e,t(2175)),keys:"o"}),ji({id:t(1174),label:"Selection",section:t(1397),run:e=>$s(e,t(548)),keys:"s"}),ji({id:t(986),label:"Text",section:t(1397),run:e=>$s(e,t(531)),keys:"t"}),ji({id:t(996),label:t(859),section:t(1397),run:e=>$s(e,t(1514)),keys:"z"}),ji({id:t(333),label:t(804),section:t(1563),run:e=>e[t(781)](ni)[t(818)][t(500)]()}),ji({id:t(2118),label:t(518),section:t(1563),run:e=>e[t(781)](ni)[t(818)].zoomIn()}),ji({id:"view.zoomOut",label:t(1079),section:"View",run:e=>e[t(781)](ni)[t(818)][t(2125)]()}),ji({id:t(438),label:"Actual Size",section:"View",run:e=>e[t(781)](ni)[t(818)][t(1514)]=1,keys:t(1836)}),ji({id:"view.fitToWindow",label:"Fit to Window",section:t(1563),run:e=>e[t(781)](ni)[t(818)].fitToWindow(),keys:t(860)}),ji({id:"view.fitLayerToWindow",label:t(1203),section:t(1563),run:e=>e[t(781)](ni).viewport[t(321)]()}),ji({id:t(489),label:t(1562),section:"View",run:e=>{const i=t,s=e.get(ni)[i(818)];s[i(958)]=!s[i(958)]}});let Zs=class extends e.JT{constructor(e){const i=t;super(),this[i(793)]=e,this[i(440)]=0,this[i(826)]=1,this.className=i(2022),this[i(998)]=!0,this[i(531)]="",this[i(865)]=i(2114),this[i(1140)]=i(489),this[i(1711)]=this.register(new n.v),this[i(835)]=this._onUpdate[i(2220)],this[i(793)][i(818)][i(1663)]((()=>this[i(1665)]())),this._update()}[t(1665)](){const e=t;this[e(1772)]=this[e(793)][e(818)][e(958)],this[e(1711)][e(393)]()}};var Qs,tn;Zs=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if("object"==typeof Reflect&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(Qs=0,tn=ni,function(t,e){tn(t,e,Qs)})],Zs);let en=class extends e.JT{constructor(e){const i=t;super(),this._lunaService=e,this[i(440)]=1,this.alignment=1,this[i(703)]=i(1514),this[i(998)]=!0,this[i(1711)]=this.register(new n.v),this[i(835)]=this._onUpdate[i(2220)],this[i(793)][i(818)][i(2013)]((()=>this._update())),this[i(1665)]()}_update(){const e=t,i=(100*this._lunaService[e(818)].zoom).toFixed(0);this.text=i+"%",this.title="Zoom level is "+i+"%",this[e(1711)][e(393)]()}};var sn,nn;en=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(sn=0,nn=ni,function(t,e){nn(t,e,sn)})],en),Ti[t(1075)]({start(e){const i=t,s=e[i(781)](oi),n=e[i(781)](je);s[i(827)](n[i(1912)](en)),s[i(827)](n[i(1912)](Zs))}});var on=function(t,e){return function(i,s){e(i,s,t)}};let rn=class extends qi{constructor(i,s,n,o,r){const a=t;super("minimap",i,a(1025)),this[a(2089)]=s,this[a(2059)]=n,this._commandService=o,this[a(1121)]=r,this[a(457)]=0,this[a(330)]=this._contextKeyService[a(950)](6,!0),this[a(1075)](this[a(464)]((t=>this._windowVisibleContextKey.set(t))));const h=this._createToggle("minimap-stretch","minimap.toggleStretch",this._minimapService[a(886)],a(410));this._minimapService.onStretchEnabledChange((t=>{const e=a;h.checked=t,this[e(841)](),this[e(1391)]()}));const c=this[a(1242)](a(892),a(964),this[a(1121)][a(1156)],"Toggle the viewport display in the minimap");this[a(1121)][a(552)]((t=>{const e=a;c[e(1772)]=t,this[e(1391)]()})),this._headerContentElement.append(h,c),this[a(640)]=document[a(1132)]("canvas"),this._canvas.width=200,this._canvas[a(741)]=200,this[a(640)][a(1412)][a(1436)]="200px",this[a(640)][a(1412)][a(741)]="200px",this[a(1075)]((0,e.Lw)(this[a(640)],a(1798),(t=>{const e=a;if(!this._eventInViewport(t)){const i=this[e(1022)]();this[e(2089)][e(818)].x=-((t[e(1574)]-i[e(1161)])/i[e(1436)]*this[e(2089)][e(526)][e(1436)]-this[e(2089)][e(526)][e(1436)]/2),this[e(2089)].viewport.y=-((t[e(1517)]-i[e(1116)])/i[e(741)]*this._luna[e(526)][e(741)]-this._luna.layer[e(741)]/2)}this._canvas[e(635)](t[e(2207)]),this._canvas.classList[e(1769)]("grabbed"),this[e(1175)]=[t[e(1574)],t[e(1517)]],this._viewportOrigin=[this[e(2089)][e(818)].x,this._luna.viewport.y]}))),this[a(1075)]((0,e.Lw)(this[a(640)],a(1113),(t=>{const e=a;this._canvas[e(1427)](t[e(2207)]),this._canvas[e(1372)][e(650)](e(1150)),this[e(1175)]=void 0,this[e(2082)]=void 0}))),this[a(1075)]((0,e.Lw)(this[a(640)],a(795),(t=>{const e=a,i=this._luna[e(818)][e(1870)],s=0===i[e(1161)]&&0===i[e(1116)]&&i[e(594)]===this[e(2089)][e(526)][e(1436)]&&i[e(2077)]===this[e(2089)][e(526)][e(741)];if(this[e(640)].classList[e(494)](e(522),!s&&this[e(484)](t)),!this[e(1175)]||!this[e(2082)])return;const n=this[e(1022)]();this[e(2089)].viewport.x=this._viewportOrigin[0]+(this[e(1175)][0]-n[e(1161)]-(t.offsetX-n[e(1161)]))*(this[e(2089)][e(526)][e(1436)]/n[e(1436)]),this[e(2089)][e(818)].y=this[e(2082)][1]+(this._clickOrigin[1]-n[e(1116)]-(t[e(1517)]-n[e(1116)]))*(this[e(2089)][e(526)][e(741)]/n[e(741)])}))),this[a(1075)]((0,e.Lw)(this._canvas,a(1542),(t=>{const e=a;this._canvas[e(1372)][e(650)](e(522))}))),this[a(1075)]((0,e.Lw)(this[a(640)],a(442),(t=>{const e=a;be.V5?t.deltaY<0?this[e(2089)][e(818)][e(785)](-t[e(894)]/20):this[e(2089)][e(818)][e(2125)](t.deltaY/20):t[e(894)]<0?this._luna.viewport[e(785)]():this[e(2089)][e(818)][e(2125)]()}))),this[a(1472)]=this[a(640)].getContext("2d"),this[a(596)]=document.createElement(a(1525)),this._viewportElement[a(1372)][a(1769)]("minimap-viewport"),this[a(2096)][a(684)](this._canvas,this[a(596)]),this[a(1075)](this[a(2089)][a(540)].onEntriesChange((()=>this[a(841)]()))),this.register(this[a(2089)][a(526)].onLayerVisibilityChange((()=>this[a(841)]()))),this[a(1075)](this[a(2089)][a(818)].onUpdate((()=>this[a(1391)]()))),this[a(1665)](),this._viewportUpdate()}[t(841)](){const e=t;this[e(2089)][e(526)][e(1436)]&&0===this[e(457)]&&(this._timeout=setTimeout((()=>{const t=e;this[t(1665)](),this[t(457)]=0})))}async[t(1665)](){const e=t,i=await this[e(2089)][e(1232)][e(1392)]();if(!i[e(1436)]||!i.height)return void this[e(640)][e(1372)][e(1769)](e(1592));this[e(640)][e(1372)][e(650)](e(1592));const s=new ImageData(new Uint8ClampedArray(i.data),i[e(1436)],i[e(741)]),n=await createImageBitmap(s);this[e(1472)][e(633)]=i.width>200||i[e(741)]>200,this[e(1472)].clearRect(0,0,200,200);const o=this[e(1022)]();this._ctx.drawImage(n,o.left,o.top,o[e(1436)],o[e(741)])}[t(1391)](){const e=t;if(!this[e(2089)].layer.width)return;const i=this[e(2089)][e(526)],n=this._createMinimapImageBounds(),o=this._luna[e(818)][e(1870)],r=0===o[e(1161)]&&0===o[e(1116)]&&o.right===i[e(1436)]&&o.bottom===i[e(741)];this[e(596)][e(1372)][e(494)](e(1592),r||!this[e(1121)][e(1156)]),this[e(1363)]={left:n[e(1161)]+Math.round(o[e(1161)]/i.width*n[e(1436)]),top:n[e(1116)]+Math[e(1266)](o.top/i.height*n[e(741)]),width:Math[e(1266)]((0,s.Oq)(o)/i[e(1436)]*n[e(1436)]),height:Math[e(1266)]((0,s.rY)(o)/i[e(741)]*n[e(741)])},this[e(596)][e(1412)][e(1161)]=this._viewportPosition[e(1161)]+"px",this._viewportElement[e(1412)][e(1116)]=this[e(1363)].top+"px",this[e(596)][e(1412)][e(1436)]=this[e(1363)].width+"px",this._viewportElement[e(1412)][e(741)]=this[e(1363)][e(741)]+"px"}[t(484)](e){const i=t;return!!this[i(1363)]&&e[i(1574)]>this[i(1363)].left&&e[i(1574)]<this[i(1363)].left+this[i(1363)][i(1436)]&&e[i(1517)]>this[i(1363)][i(1116)]&&e.offsetY<this._viewportPosition[i(1116)]+this[i(1363)][i(741)]}[t(1242)](e,i,s,n){const o=t,r=document[o(1132)](o(2061));return r[o(335)]=o(1520),r.id=e,r[o(1772)]=s,r[o(865)]=n,r[o(1372)][o(1769)](e,o(1880)),r[o(1620)](o(1825),(()=>this._commandService[o(1491)](i))),r}_createMinimapImageBounds(){const e=t;return(0,re.M_)(this[e(2089)][e(526)][e(1436)],this[e(2089)][e(526)][e(741)],200,200,this[e(1121)].isStretchEnabled)}};rn=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if("object"==typeof Reflect&&typeof Reflect.decorate===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([on(1,ni),on(2,We),on(3,ze),on(4,wi)],rn);let an=class extends e.JT{constructor(e){const i=t;super(),this[i(1274)]=e,this[i(440)]=0,this[i(826)]=1,this.className=i(1431),this.hasImage=!0,this[i(531)]="",this[i(865)]="Toggle the minimap",this.commandId=i(875),this[i(1711)]=this[i(1075)](new n.v),this.onUpdate=this[i(1711)].event,this[i(1274)][i(339)]((()=>this[i(1665)]())),this[i(1665)]()}[t(1665)](){const e=t;this.checked=this[e(1274)][e(364)](e(1227)),this[e(1711)][e(393)]()}};var hn,cn;an=function(e,i,s,n){const o=t;var r,a=arguments.length,h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e[o(1840)]-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([(hn=0,cn=ci,function(t,e){cn(t,e,hn)})],an),gi[t(1075)](t(1227),{ctor:rn,defaultVisible:!1,defaultPosition:{x:t(1300),y:"end"}}),Ti[t(1075)]({start(e){const i=t,s=e.get(oi),n=e[i(781)](je);s[i(827)](n.createInstance(an))}}),ji({id:t(875),label:t(1327),section:"Window",checked:6,run:e=>e[t(781)](ci)[t(946)](t(1227))}),ji({id:t(964),label:t(1308),section:t(1025),run:e=>{const i=t,s=e.get(wi);s[i(1156)]=!s[i(1156)]}}),ji({id:"minimap.toggleStretch",label:t(1699),section:t(1025),run:e=>{const i=t,s=e[i(781)](wi);s[i(886)]=!s[i(886)]}});var ln=function(t,e){return function(i,s){e(i,s,t)}};let dn=class extends qi{constructor(i,s,n,o,r){const a=t;super(a(1920),i,a(2216)),this[a(2089)]=s,this[a(2059)]=n,this[a(2140)]=o,this[a(1762)]=r,this[a(2088)]=new Map,this[a(1380)]=new Map,this[a(330)]=this._contextKeyService.bind(3,!0),this[a(657)]=this[a(2059)].bind(4,!1),this[a(1075)](this[a(464)]((t=>this[a(330)].set(t)))),this[a(1841)]=document[a(1132)]("div"),this[a(1841)][a(1372)][a(1769)](a(1043));const h=document[a(1132)]("div");h[a(1372)][a(1769)]("actions"),h.append(this._createButton(a(1046),(()=>this[a(2089)][a(526)][a(1094)]()),a(511)),this[a(593)](a(1715),(()=>this._luna.layer[a(1001)]()),"Delete the active layer"),this[a(593)](a(2011),(()=>this[a(2089)][a(526)][a(547)]()),"Duplicate the active layer"),this[a(1241)]=this[a(593)](a(404),(()=>this[a(2089)][a(526)][a(534)]()),a(508)),this[a(1631)]=this[a(593)](a(1206),(()=>this[a(2089)].layer[a(1820)]()),a(1065)),this[a(1184)]=this[a(593)](a(497),(()=>this[a(2089)][a(526)].moveLayerDown()),a(1261)),this[a(967)]()),this[a(2096)].append(this[a(1841)],h),this.register(this._luna[a(526)][a(643)]((()=>this[a(1214)]()))),this[a(1075)]({dispose:()=>{const t=a;for(const i of this[t(2088)][t(1060)]())(0,e._c)(i[t(1838)])}}),this[a(1214)]()}[t(593)](e,i,s){const n=t,o=document[n(1132)]("button");o.id=e,o[n(865)]=s;const r=document[n(1132)](n(458));return o[n(984)](r),o[n(1372)].add(e,n(1880)),o[n(1620)](n(1825),i),o}[t(967)](){const e=t,i=document[e(1132)]("select"),s=[e(1310),e(926),e(1982),e(1248),"lighten","screen","linearDodgeAdd",e(588),e(1390),e(1702),e(359)];for(const t of s){const s=document.createElement(e(2018));s[e(1634)]=t,s[e(1076)]=t,this[e(1380)][e(475)](t,s),i[e(984)](s)}return i.addEventListener(e(806),(()=>{const t=e;this[t(2089)][t(526)][t(2073)]&&(this[t(2089)].layer[t(2073)].blendMode=i[t(1076)])})),i}_renderLayers(){const i=t,s=this._luna[i(526)][i(1920)],n=this[i(2089)][i(526)][i(2073)];let o=null;for(let t=s.length-1;t>=0;t--){const r=s[t];if(!this[i(2088)].has(r.id)){const t={container:document.createElement(i(1525)),nameSpan:document[i(1132)](i(1210)),previewCanvas:document.createElement(i(1726)),visibleCheckbox:document[i(1132)](i(2061)),disposables:[]};t[i(1639)].classList[i(1769)](i(526)),t[i(1639)].tabIndex=0,t[i(1639)][i(1270)]=!0,t[i(1838)][i(1378)]((0,e.Lw)(t.container,i(646),(t=>{const e=i;this._contentElement[e(1372)][e(1769)](e(2079)),t.dataTransfer&&(t[e(502)][e(576)]="move",t[e(502)][e(1988)]="move",t[e(502)][e(1403)](e(1239),e(1911)+r.id)),t.stopImmediatePropagation()}))),t.disposables[i(1378)]((0,e.Lw)(t[i(1639)],i(1034),(()=>{const t=i;this[t(2096)][t(1372)][t(650)](t(2079))}))),t[i(1838)][i(1378)]((0,e.Lw)(t.container,i(521),(e=>{const s=i;t[s(1639)][s(1372)][s(650)]("drop-target");const n=this._getLayerDragEventId(e),o=this[s(2089)][s(526)][s(1920)][s(1518)]((t=>t.id===n));o&&this._luna[s(526)].moveLayerTo(o,r),e[s(1951)]()}))),t[i(1838)][i(1378)]((0,e.Lw)(t[i(1639)],i(491),(e=>{const s=i,n=this[s(1936)](e);r.id!==n&&(e[s(387)](),t[s(1639)][s(1372)][s(1769)](s(472)))}))),t[i(1838)][i(1378)]((0,e.Lw)(t[i(1639)],i(421),(e=>{const s=i;t[s(1639)][s(1372)][s(650)](s(472))}))),t.disposables[i(1378)]((0,e.Lw)(t[i(1639)],i(500),(()=>this[i(657)][i(475)](!0)))),t.disposables[i(1378)]((0,e.Lw)(t.container,i(1269),(()=>this[i(657)][i(475)](!1)))),t.previewCanvas[i(1372)][i(1769)]("preview"),t[i(856)][i(1436)]=40,t[i(856)][i(741)]=40;let s=!1;t[i(1838)][i(1378)](r[i(835)]((()=>{s=!0,this[i(1623)](t,r)}))),t.disposables[i(1378)](this._luna[i(540)][i(2051)]((()=>{s&&(this._generatePreview(r,t),s=!1)}))),this[i(836)](r,t),t[i(1639)][i(984)](t[i(856)]),t.nameSpan[i(1372)][i(1769)](i(1680)),t[i(1639)].appendChild(t[i(602)]),t[i(1649)][i(335)]="checkbox",t.visibleCheckbox[i(1372)][i(1769)](i(451)),t[i(1649)].addEventListener("change",(()=>r[i(364)]=!r[i(364)])),t[i(1639)][i(984)](t[i(1649)]);const n=e=>{const s=i;e?.[s(440)]!==t[s(1649)]&&(this[s(2089)][s(526)][s(2073)]=r)};t.container[i(1620)](i(1825),(t=>{const e=i;n(t),t[e(1646)]&&this._luna.viewport[e(321)]()})),t.container[i(1620)]("contextmenu",(async t=>{const e=i;switch(t[e(387)](),t[e(1951)](),await this[e(2140)][e(1930)]([{id:"duplicate",label:"Duplicate layer"},{id:"delete",label:e(1315)},{id:e(1311),label:e(1656)},{id:e(1599),label:e(744)},{id:e(631),label:"",kind:-1},{id:e(321),label:"Fit layer to window ["+(be.V5?"⌥":"Alt")+e(2128)}])){case e(551):await this[e(2089)].layer[e(547)](r);break;case"delete":this[e(2089)][e(526)][e(1001)](r);break;case e(1311):const t=await this[e(1762)][e(1983)]("Enter the new name",r.name);t&&this._luna[e(526)].renameLayer(t,r);break;case"mergeDown":this[e(2089)][e(526)][e(2073)]=r,await this[e(2089)][e(526)][e(534)]();break;case e(321):this[e(2089)].viewport[e(321)]()}})),t[i(1639)][i(1620)](i(1552),(e=>{const s=i;switch(e[s(1030)]){case s(338):t[s(1639)][s(1383)]?.[s(500)](),e.preventDefault();break;case s(503):t[s(1639)].nextSibling?.[s(500)](),e[s(387)]();break;case"Enter":case"Space":n()}})),this[i(2088)].set(r.id,t),t.disposables[i(1378)](r[i(1760)]((()=>{const e=i;this._layerListElement[e(803)](t[e(1639)]);for(const i of t[e(1838)])i[e(1676)]();this[e(2088)].delete(r.id)})))}const a=this._layerListItems.get(r.id),h=r.id===n?.id;if(a[i(1639)][i(1372)].toggle(i(887),h),this[i(1623)](a,r),h){const e=t>0?s[t-1]:void 0,n=t<s.length-1?s[t+1]:void 0;e?(this[i(1241)][i(1265)](i(1382),!1),this[i(1241)][i(865)]=""):(this[i(1241)][i(1265)](i(1382),!0),this[i(1241)].title="There is no layer to merge down into"),this[i(1631)][i(1265)](i(1382),!n),this[i(1631)][i(865)]=n?"":"There is no layer above this layer",this[i(1184)][i(1265)](i(1382),!e),this[i(1184)].title=n?"":i(1005)}null===o?(!a[i(1639)][i(1198)]||null!==a[i(1639)][i(1383)])&&(this[i(1841)][i(1031)]?this[i(1841)].insertBefore(a.container,this[i(1841)].firstChild):this[i(1841)][i(984)](a[i(1639)])):a[i(1639)].previousSibling!==o&&o[i(1807)]("afterend",a[i(1639)]),o=a[i(1639)]}if(n){const t=this[i(1380)][i(781)](n[i(903)]);t&&(t[i(1235)]=!0)}}[t(1623)](e,i){const s=t;e[s(602)][s(1634)]=i.name,e.visibleCheckbox[s(1772)]=i[s(364)];const n=this[s(2089)][s(526)][s(2073)];if(i.id===n?.id){const t=this[s(1380)][s(781)](n[s(903)]);t&&(t[s(1235)]=!0)}}_getLayerDragEventId(e){const i=t,s=e[i(502)][i(2181)](i(1239));if(s?.[i(935)](i(1911)))return parseInt(s[i(2218)](13))}async[t(836)](e,i){const s=t,n=await e[s(304)](40,40),o=i[s(856)][s(1499)]("2d");o.imageSmoothingEnabled=!1,o[s(1833)](0,0,40,40),o[s(1910)](n,0,0)}};dn=function(e,i,s,n){const o=t;var r,a=arguments[o(1840)],h=a<3?i:null===n?n=Object[o(2191)](i,s):n;if(typeof Reflect===o(1907)&&typeof Reflect[o(1226)]===o(1050))h=Reflect[o(1226)](e,i,s,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(h=(a<3?r(h):a>3?r(i,s,h):r(i,s))||h);return a>3&&h&&Object[o(708)](i,s,h),h}([ln(1,ni),ln(2,We),ln(3,Qe),ln(4,hi)],dn),gi[t(1075)](t(1920),{ctor:dn,defaultVisible:!0,defaultPosition:{x:"end",y:{side:t(1300),target:t(1227)}}}),ji({id:t(2009),label:"Toggle Layers Window",section:"Window",checked:3,run:e=>e[t(781)](ci)[t(946)](t(1920))}),ji({id:t(2210),label:t(1262),section:t(2157),run:e=>e[t(781)](ni).layer[t(1094)](),keys:"ctrl+shift+n"}),ji({id:t(391),label:t(933),section:t(2157),run:e=>e.get(ni)[t(526)].deleteLayer(),keys:"ctrl+shift+delete"}),ji({id:t(1669),label:t(2213),section:t(2157),run:e=>e[t(781)](ni)[t(526)][t(547)](),keys:"ctrl+shift+d"}),ji({id:t(2076),label:t(842),section:t(2157),run:e=>e[t(781)](ni)[t(526)][t(534)](),keys:t(589)}),ji({id:"layer.renameLayer",label:t(1396),section:t(2157),run:async e=>{const i=t,s=e[i(781)](ni),n=e[i(781)](hi),o=await n[i(1983)](i(2115),s[i(526)].activeLayer?.[i(1680)]||"");o&&s[i(526)][i(2025)](o)}}),ji({id:t(1852),label:t(1252),section:t(2157),run:async e=>{const i=t,s=e[i(781)](ni);await s.task.executeOnSingleLayer("layer/flipHorizontal",{selection:s.selection[i(664)]})}}),ji({id:"layer.flipVertical",label:t(436),section:"Layer",run:async e=>{const i=t,s=e[i(781)](ni);await s[i(1221)][i(563)](i(545),{selection:s.selection[i(664)]})}}),ji({id:t(1668),label:t(1128),section:t(2157),run:async e=>{const i=t,s=e.get(ni);await s.task[i(563)](i(683),{selection:s[i(548)][i(664)]})}}),ji({id:"layer.goToTopLayer",label:t(1653),section:t(2157),run:e=>e[t(781)](ni).layer.goToTopLayer(),keys:t(1118)}),ji({id:"layer.goToBottomLayer",label:t(427),section:t(2157),run:e=>e[t(781)](ni)[t(526)][t(1049)](),keys:"ctrl+alt+pagedown"}),ji({id:t(1633),label:t(381),section:t(2157),run:e=>e[t(781)](ni).layer[t(717)](),keys:"alt+pageup"}),ji({id:"layer.goToLayerBelow",label:t(1698),section:t(2157),run:e=>e[t(781)](ni)[t(526)][t(1945)](),keys:"alt+pagedown"}),ji({id:t(1888),label:t(1352),section:"Layer",run:e=>e[t(781)](ni).layer[t(1718)]()}),ji({id:t(970),label:t(1359),section:t(2157),run:e=>e[t(781)](ni)[t(526)][t(1820)]()}),ji({id:"layer.moveLayerDown",label:t(1884),section:t(2157),run:e=>e[t(781)](ni)[t(526)].moveLayerDown()}),ji({id:t(758),label:t(1719),section:"Layer",run:t=>t.get(ni).layer.moveLayerToBottom()});class un extends e.JT{constructor(){const e=t;super(...arguments),this.target=0,this[e(826)]=1,this[e(703)]=e(1278),this[e(998)]=!0,this[e(531)]="",this[e(865)]=e(1123),this[e(1140)]="help.reportIssue"}}Ti[t(1075)]({start(e){const i=t,s=e[i(781)](oi),n=e.get(je);s[i(827)](n[i(1912)](un))}}),ji({id:"help.reportIssue",label:t(617),section:t(701),run:e=>e[t(781)](Oi)[t(1286)]()});var mn=i(1123);async function gn(e,i,s,n,o=!1){const r=t;try{const t=await s[r(1232)][r(1619)](e,i,o);return".ico"===i&&fn(n),t}catch(t){throw r(1629)in t&&s[r(625)][r(2179)](t[r(1629)]()),t}}function fn(e){const i=t;e.showView(i(693)),e[i(1157)](i(1920)),e[i(1157)]("minimap")}function pn(){const e=t,i=vn(getComputedStyle(document[e(1589)])[e(1952)](e(1401)));void 0!==i&&document.body.style.setProperty(e(1614),i);const s=vn(getComputedStyle(document[e(1589)])[e(1952)](e(1969)));void 0!==s&&document[e(2106)][e(1412)].setProperty(e(1228),s);const n=vn(getComputedStyle(document.documentElement)[e(1952)](e(1478)));void 0!==n&&document.body[e(1412)][e(571)](e(603),n)}function _n(e,i,s){const n=t;i[n(1329)][n(1060)]=s,e[n(1329)]={defaultTool:s.defaultTool,statusBarPointerColor:s.statusBarPointerColor}}function yn(e,i,s){const n=t;e[n(781)](11)?.[n(475)](s),wn(i,n(1823),s)}function wn(e,i,s){const n=t;return e[n(1963)](n(598),{key:i,value:s})}function vn(e){const i=t;let s,n,o,r;if(e.startsWith("rgba"))[s,n,o,r]=e.substring(5,e[i(1993)](")")).split(",")[i(688)]((t=>+t[i(1827)]()));else{if(7!==e.length)return;s=parseInt(e[i(2218)](1,3),16),n=parseInt(e[i(2218)](3,5),16),o=parseInt(e.substring(5,7),16),r=1}return((s+n+o)*r/765)[i(1877)](2)}Ti[t(1075)]({start(e){const i=t,s=e[i(781)](ni),n=e[i(781)](We),o=e.get(Je),r=e.get(Li),a=e.get(li),h=e[i(781)](ci);let c;r[i(1701)](i(1247),(async t=>{const s=i;let n=!0;try{await e[s(781)](ze).runCommand(t)}catch(e){console.error("Command "+t+" failed",e),n=!1}return{success:n}})),r.registerRequestHandler(i(530),(t=>{_n(o,s,t)})),r.registerRequestHandler(i(1705),(async t=>{const n=i,o=e.get(hi),r=s[n(1232)][n(1458)];if(void 0===c&&(r===n(1290)||r===n(2173))){if(c=await o[n(1069)](n(1169),80,0,100),void 0===c)throw new Error(n(432));c/=100}const a=performance[n(449)](),h=await(t[n(446)]?s[n(1232)][n(782)]():s[n(1232)].exportBlob({encodeOptions:{quality:c,type:r}}));return{blobBuffer:new Uint8Array(await h[n(882)]()),encodeDuration:performance[n(449)]()-a}})),r[i(1701)](i(2189),(async t=>{const e=i;return t[e(1474)]&&t.hotExitMaxPixels<s.layer[e(1436)]*s[e(526)].height?{success:!1}:{success:!0,state:s.file.saveState(t.hotExitMaxPixels),workbenchState:a[e(1898)]}})),r[i(1701)]("open",(async t=>{const e=i;c=void 0,gn(t[e(1675)],t[e(1224)],s,h)})),r[i(1963)](i(1811),void 0)[i(1905)]((async t=>{const e=i,c=performance.now();switch(_n(o,s,t[e(1329)]),!t[e(1047)]&&h[e(1929)](),"open"!==t[e(335)]&&window.focus(),t[e(335)]){case e(1107):{await s.file[e(719)](t.dimensions[e(1436)],t.dimensions[e(741)],t[e(1224)]);const i=t[e(1224)]===e(1201);yn(n,r,i),i&&fn(h);break}case e(2035):try{let i=t[e(1675)];if(!i){const t=await hs[e(465)]();t&&(i=new Uint8Array(await t[e(882)]()))}i?(s[e(1232)][e(1619)](i,e(1197),!1),r.request(e(1553),i)):(await s[e(1232)][e(719)](t[e(2087)][e(1436)],t[e(2087)][e(741)]),yn(n,r,!1));break}catch(t){console[e(1053)](e(1264),t)}await s.file.newImage(t[e(2087)][e(1436)],t[e(2087)][e(741)]),yn(n,r,!1);break;case e(1644):try{const i=await gn(t.data,t.extName,s,h,t[e(1047)]);yn(n,r,t[e(1224)]===e(1201)),i&&await r[e(1963)](e(940),{level:e(1966)})}catch(t){throw t instanceof mn._9&&await r[e(1963)](e(940),{level:e(1053)}),t}break;case e(1747):if((!t[e(1421)]||0===t[e(1898)][e(2106)][e(540)]?.entries?.[e(1840)])&&(t.state[e(2106)][e(540)]={currentEntry:0,entries:[(new P).serialize()]}),s[e(1232)][e(1298)](t[e(1898)]),void 0!==t.editIndex&&t[e(1385)]!==t[e(1898)][e(2106)][e(540)].currentEntry){let i=t[e(1898)][e(2106)].history[e(1166)]-t.editIndex;if(i>0)for(;0!=i--&&s[e(540)][e(1779)];)await s[e(540)][e(1652)]();else if(i<0)for(;0!=i++&&s[e(540)].canRedo;)await s[e(540)][e(772)]()}yn(n,r,!1)}a[e(1298)](t.workbenchState),r.request("parseFinished",{duration:performance[e(449)]()-c})})),r[i(1701)]("syncGlobalState",(t=>{a[i(1444)](t)})),a[i(1931)]((t=>r[i(1963)](i(401),t))),r[i(1701)](i(912),(()=>s[i(625)][i(1600)]())),window[i(1620)](i(500),(()=>{const t=i;wn(r,"luna:focused",!0),s[t(625)].resume()})),window.addEventListener(i(1269),(()=>{wn(r,i(641),!1)})),window[i(1620)]("focusin",(t=>{const e=i,s=t[e(440)];if(s.tagName!==e(1415))wn(r,e(1488),!1);else{const t=s,i="text"===t[e(335)]||t[e(335)]===e(383);wn(r,e(1488),i)}})),window[i(1620)](i(739),(t=>{wn(r,i(1488),!1)})),s[i(540)][i(2051)]((t=>{const e=i;!t||s[e(540)][e(1953)][e(1840)]<=1||s[e(540)][e(1573)]!==s[e(540)][e(1953)][s.history.entries.length-1]||r[e(1963)](e(2001),{label:s[e(540)].activeEntry[e(709)]})})),s.file[i(1642)]((t=>{const e=i;r[e(1963)](e(1331),t)})),ji({id:i(365),label:i(687),section:i(1563),run:()=>{const t=i;return r[t(1963)](t(1915),{command:t(1083),args:">Luna: "})}}),e.get(oi)[i(827)]({text:i(1681),alignment:0,className:i(363),hasImage:!0,target:0,dispose:()=>{},commandId:"vscode.toggleMenuBar"}),n[i(781)](8)?.[i(835)]((t=>wn(r,i(822),t))),n[i(781)](4)?.[i(835)]((t=>wn(r,i(406),t))),gs[i(2198)]=()=>r[i(1963)]("vscode.executeCommand",{command:i(772)}),gs[i(600)]=()=>r.request(i(1915),{command:i(1652)}),new MutationObserver((()=>pn())).observe(document[i(1589)],{attributes:!0,attributeFilter:[i(1412)]}),pn()}});const bn=new ii,xn=new Se({mouseWheelBehavior:"scroll",snapToPixelGrid:!0});xn[t(1221)][t(2171)]=!0,!(t(320)in window)&&(window[t(320)]=ArrayBuffer),bn[t(1949)](ni,xn);const In=window[t(1946)]();window[t(1946)]=void 0,bn[t(1949)](Je,bn[t(1912)](Ke)),bn[t(1949)](Li,bn[t(1912)](Ai,In)),bn[t(1949)](li,bn.createInstance(Ci)),bn[t(1949)](hi,bn[t(1912)](Fi)),bn[t(1949)](Qe,bn[t(1912)](Di)),bn[t(1949)](We,bn[t(1912)]($e)),bn[t(1949)](ze,bn.createInstance(Ye)),bn[t(1949)](ti,bn[t(1912)](ki)),bn.setService(oi,bn.createInstance(ri)),bn[t(1949)](si,bn[t(1912)](Ri)),bn.setService(bi,bn[t(1912)](xi)),bn[t(1949)](wi,bn[t(1912)](vi)),bn[t(1949)](ci,bn.createInstance(yi)),bn[t(1949)](Oi,bn.createInstance(Ni)),new class{constructor(e){const i=t,s=document[i(525)]("#canvas");e[i(434)](ni)[i(818)][i(2180)](s);for(const t of Ti[i(2019)]())e.invokeFunction(t[i(1802)].bind(t))}}(bn)})()})();