"use strict";(self.webpackChunkluna=self.webpackChunkluna||[]).push([[3],{32:(t,e,n)=>{n.r(e),n.d(e,{ByteStream:()=>r});class r{constructor(t){this.offset=0,this.array=new Uint8Array(t),this.view=new DataView(this.array.buffer,this.array.byteOffset,this.array.byteLength)}writeUint8(t){this.view.setUint8(this.offset,t),this.offset+=1}writeUint16(t){this.view.setUint16(this.offset,t),this.offset+=2}writeUint32(t){this.view.setUint32(this.offset,t),this.offset+=4}writeArray(t){this.array.set(t,this.array.byteOffset+this.offset),this.offset+=t.length}assertAtEnd(){if(this.offset!==this.array.length)throw new Error("Writing finished before expected length of stream")}}},33:(t,e,n)=>{n.r(e),n.d(e,{encodeChunk:()=>h});var r=n(25),i=n(32),a=n(26),o=n(34);function h(t,e){const n=function(t,e){if(t.bitDepth<8)throw new Error("Only bit depth 8 and 16 is supported currently");if(2===e.data.BYTES_PER_ELEMENT&&8===t.bitDepth)throw new Error("16 to 8 bit conversion isn't supported yet");if(0!==t.interlaceMethod)throw new Error("Only interlace method 0 is supported currently");let n;switch(t.colorType){case 0:case 3:n=1;break;case 2:n=3;break;case 4:n=2;break;case 6:n=4}return(1+n*(16===t.bitDepth?2:1)*e.width)*e.height}(t,e),a=new i.ByteStream(n);!function(t,e,n){let r,i=0,a=0,o=0;if(3===t.colorType){if(!t.palette)throw new Error("Cannot encode indexed file without palette");if(2===e.data.BYTES_PER_ELEMENT)throw new Error("Cannot encode indexed file from 16-bit image");for(;o<e.height;o++)for(n.writeUint8(0),a=0;a<e.width;a++)n.writeUint8(t.palette.get(e.data[i]<<24|e.data[i+1]<<16|e.data[i+2]<<8|e.data[i+3])),i+=4;return}if(t.options.filterPattern){if(0===t.options.filterPattern.length)throw new Error("Filter pattern with 0 entries");r=t.options.filterPattern}const h=4*e.data.BYTES_PER_ELEMENT,f=[];for(const t of[0,1,2,3,4])f[t]=c(h,h*e.width,t);const w=d(t.colorType);for(;o<e.height;o++){const h=r?r[o%r.length]:s(t.colorType,e,o*e.width*4,f),c=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);n.writeUint8(h);let d=0,u=0;for(a=0;a<e.width;a++){for(u of w)for(d=e.data.BYTES_PER_ELEMENT-1;d>=0;d--)n.writeUint8(f[h](c,(i+u)*e.data.BYTES_PER_ELEMENT+d,0===a));i+=4}}}(t,e,a);const h=r.deflate(a.array);return(0,o.writeChunk)("IDAT",h)}function s(t,e,n,r){const i=[];e.data.BYTES_PER_ELEMENT;for(const a of[0,1,2,3,4]){let o=0;const h=d(t),s=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);let c=0,f=0;for(let t=n;t<n+4*e.width;t+=4)for(c of h)for(f=e.data.BYTES_PER_ELEMENT-1;f>=0;f--)o+=r[a](s,(t+c)*e.data.BYTES_PER_ELEMENT+f,t===n);i[a]=o}let a=0,o=i[0];for(const t of[1,2,3,4])i[t]<o&&(a=t,o=i[t]);return a}function c(t,e,n){let r=0,i=0,o=0;switch(n){case 0:return(t,e)=>t[e];case 1:return(e,n,i)=>(r=i?-1:n-t,(e[n]-(r<0?0:e[n-t])+256)%256);case 2:return(t,n)=>(i=n-e,(t[n]-(i<0?0:t[i])+256)%256);case 3:return(n,a,o)=>(r=o?-1:a-t,i=a-e,(n[a]-Math.floor(((r<0?0:n[r])+(i<0?0:n[i]))/2)+256)%256);case 4:return(n,h,s)=>(r=s?-1:h-t,i=h-e,o=s?-1:h-t-e,(n[h]-(0,a.paethPredicator)(r<0?0:n[r],i<0?0:n[i],o<0?0:n[o])+256)%256)}}function d(t){switch(t){case 0:return[0];case 2:return[0,1,2];case 4:return[0,3];case 6:return[0,1,2,3]}}},35:(t,e,n)=>{n.r(e),n.d(e,{encodeChunk:()=>i});var r=n(34);function i(){return(0,r.writeChunk)("IEND",new Uint8Array(0))}},36:(t,e,n)=>{n.r(e),n.d(e,{encodeChunk:()=>i});var r=n(34);function i(t,e){if(e.width<=0||e.height<=0)throw new Error(`Invalid dimensions ${e.width}x${e.height}`);return(0,r.writeChunkDataFn)("IHDR",13,(n=>{n.writeUint32(e.width),n.writeUint32(e.height),n.writeUint8(t.bitDepth),n.writeUint8(t.colorType),n.writeUint8(0),n.writeUint8(0),n.writeUint8(t.interlaceMethod)}))}},31:(t,e,n)=>{n.r(e),n.d(e,{encodePng:()=>s});var r=n(32),i=n(33),a=n(35),o=n(36),h=n(7);async function s(t,e={}){if(t.data.length!==t.width*t.height*4)throw new h.EncodeError(`Provided image data length (${t.data.length}) is not expected length (${t.width*t.height*4})`,Math.min(t.data.length,t.width*t.height*4)-1);const s=[];s.push(function(){const t=new r.ByteStream(8);return t.writeUint8(137),t.writeUint8(80),t.writeUint8(78),t.writeUint8(71),t.writeUint8(13),t.writeUint8(10),t.writeUint8(26),t.writeUint8(10),t.assertAtEnd(),t.array}());const c=function(t,e={}){const n=[],r=[],i=t.width*t.height*4,a=new Set,o=new Set;let s=0;if(2===t.data.BYTES_PER_ELEMENT)for(let e=0;e<i;e+=4)s=t.data[e]<<48|t.data[e+1]<<32|t.data[e+2]<<16|t.data[e+3],t.data[e+3]<65535&&o.add(s),a.add(s);else for(let e=0;e<i;e+=4)s=t.data[e]<<24|t.data[e+1]<<16|t.data[e+2]<<8|t.data[e+3],t.data[e+3]<255&&o.add(s),a.add(s);let c,d=e.colorType;switch(void 0===d&&(d=a.size>256||2===t.data.BYTES_PER_ELEMENT?2:3),d){case 0:case 2:c=1===o.size,!c&&o.size>1&&(d=2===d?6:4,2===e.colorType&&(0,h.handleWarning)({options:e,warnings:n},new h.EncodeWarning(`Cannot encode image as color type Truecolor as it contains ${o.size} transparent colors`,0)));break;case 3:c=o.size>0;break;default:c=!1}return void 0===e.colorType&&r.push(`Using color type ${d}`),{colorType:d,bitDepth:2===t.data.BYTES_PER_ELEMENT?16:8,interlaceMethod:0,colorSet:a,transparentColorCount:o.size,firstTransparentColor:o.size>0?o.values().next().value:void 0,useTransparencyChunk:c,options:e,warnings:n,info:r}}(t,e);if(s.push((0,o.encodeChunk)(c,t)),3===c.colorType){const e=(await n.e(26).then(n.bind(n,64))).encodeChunk(c,t);c.palette=e.palette,s.push(e.chunkData)}if(c.useTransparencyChunk&&s.push((await n.e(25).then(n.bind(n,63))).encodeChunk(c,t)),s.push((0,i.encodeChunk)(c,t)),void 0===(null==e?void 0:e.ancillaryChunks))s.push((await n.e(27).then(n.bind(n,65))).encodeChunk(c,t,"Software","@lunapaint/png-codec"));else for(const r of e.ancillaryChunks){if("tEXt"!==r.type)throw new Error(`Cannot encode chunk type "${r.type}"`);s.push((await n.e(27).then(n.bind(n,65))).encodeChunk(c,t,r.keyword,r.text))}s.push((0,a.encodeChunk)());const d=s.reduce(((t,e)=>t+e.length),0),f=new Uint8Array(d);let w=0;for(const t of s)f.set(t,w),w+=t.length;return{data:f,warnings:c.warnings,info:c.info}}},34:(t,e,n)=>{n.r(e),n.d(e,{writeChunkType:()=>a,writeChunk:()=>o,writeChunkDataFn:()=>h});var r=n(32),i=n(30);function a(t,e){t.writeUint8(e.charCodeAt(0)),t.writeUint8(e.charCodeAt(1)),t.writeUint8(e.charCodeAt(2)),t.writeUint8(e.charCodeAt(3))}function o(t,e){const n=new r.ByteStream(8+e.length+4);if(n.writeUint32(e.length),4!==t.length)throw new Error(`Cannot encode a chunk type of length ${t.length}`);return a(n,t),n.writeArray(e),n.writeUint32((0,i.crc32)(n.view,4,4+e.length)),n.assertAtEnd(),n.array}function h(t,e,n){const o=new r.ByteStream(8+e+4);if(o.writeUint32(e),4!==t.length)throw new Error(`Cannot encode a chunk type of length ${t.length}`);return a(o,t),n(o),o.writeUint32((0,i.crc32)(o.view,4,4+e)),o.assertAtEnd(),o.array}},30:(t,e,n)=>{let r;function i(){if(r)return r;r=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;r[t]=e>>>0}return r}function a(t,e,n){return(4294967295^function(t,e,n,r){const a=i();let o=4294967295;for(let t=0;t<r;t++)o=a[255&(o^e.getUint8(n+t))]^o>>>8;return o}(0,t,e,n))>>>0}n.r(e),n.d(e,{getCrcTable:()=>i,crc32:()=>a})},26:(t,e,n)=>{function r(t,e,n){const r=t+e-n,i=Math.abs(r-t),a=Math.abs(r-e),o=Math.abs(r-n);return i<=a&&i<=o?t:a<=o?e:n}n.r(e),n.d(e,{paethPredicator:()=>r})}}]);