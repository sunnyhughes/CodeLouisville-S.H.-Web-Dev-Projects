"use strict";var Lt=Object.defineProperty,Ka=Object.defineProperties,Xa=Object.getOwnPropertyDescriptor,Ja=Object.getOwnPropertyDescriptors,Qa=Object.getOwnPropertyNames,ti=Object.getOwnPropertySymbols;var ni=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable;var ii=(e,n,t)=>n in e?Lt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Mt=(e,n)=>{for(var t in n||(n={}))ni.call(n,t)&&ii(e,t,n[t]);if(ti)for(var t of ti(n))es.call(n,t)&&ii(e,t,n[t]);return e},Bt=(e,n)=>Ka(e,Ja(n)),ts=e=>Lt(e,"__esModule",{value:!0});var S=(e,n)=>()=>(e&&(n=e(e=0)),n);var oe=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),M=(e,n)=>{for(var t in n)Lt(e,t,{get:n[t],enumerable:!0})},ns=(e,n,t,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of Qa(n))!ni.call(e,r)&&(t||r!=="default")&&Lt(e,r,{get:()=>n[r],enumerable:!(i=Xa(n,r))||i.enumerable});return e};var Ft=(e=>(n,t)=>e&&e.get(n)||(t=ns(ts({}),n,1),e&&e.set(n,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var ri={};M(ri,{DecodeError:()=>q,DecodeWarning:()=>ae,assertChunkCompressionMethod:()=>ce,assertChunkDataLengthEquals:()=>F,assertChunkDataLengthGte:()=>X,assertChunkFollows:()=>Me,assertChunkMutualExclusion:()=>tt,assertChunkPrecedes:()=>D,assertChunkSinglular:()=>B,createChunkDecodeError:()=>ve,createChunkDecodeWarning:()=>C,handleWarning:()=>N});function B(e,n){e.parsedChunks.has(n.type)&&N(e,C(n,`Multiple ${n.type} chunks not allowed`,n.offset+4))}function F(e,n,t){if(n.dataLength!==t){let i=C(n,`Invalid data length: ${n.dataLength} !== ${t}`,n.offset);if(n.dataLength>t)N(e,i);else throw i}}function X(e,n,t){if(n.dataLength<t)throw ve(e,n,`Invalid data length: ${n.dataLength} < ${t}`,n.offset)}function D(e,n,t){e.parsedChunks.has(t)&&N(e,C(n,`Must precede ${t}`,n.offset+4))}function Me(e,n,t){if(!e.parsedChunks.has(t))throw ve(e,n,`Must follow ${t}`,n.offset+4)}function tt(e,n,t){e.parsedChunks.has(t)&&N(e,C(n,`Should not be present alongside ${t}`,n.offset+4))}function ce(e,n,t,i){t!==0&&N(e,C(n,`Unknown compression method "${t}"`,i))}function ve(e,n,t,i){return new q(e,`${n.type}: ${t}`,i)}function C(e,n,t){return new ae(`${e.type}: ${n}`,t)}function N(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var q,ae,z=S(()=>{q=class extends Error{constructor(n,t,i){super(t);this.offset=i,this.partiallyDecodedImage={details:"header"in n&&n.header?{width:n.header.width,height:n.header.height,bitDepth:n.header.bitDepth,colorType:n.header.colorType,interlaceMethod:n.header.interlaceMethod}:void 0,info:n.info,metadata:n.metadata,rawChunks:n.rawChunks,warnings:n.warnings}}};ae=class extends Error{constructor(n,t){super(n);this.offset=t}}});function oi(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var Be,nt,zt=S(()=>{Be=class extends Error{constructor(n,t){super(n);this.offset=t}},nt=class extends Error{constructor(n,t){super(n);this.offset=t}}});function ai(e){let n=new Uint8Array(e.buffer),t=new Uint8Array(e.length);for(let i=0;i<t.length;i++)t[i]=n[i*2+1];return t}var si=S(()=>{});function He(e){let n=e.length;for(;--n>=0;)e[n]=0}function gn(e,n,t,i,r){this.static_tree=e,this.extra_bits=n,this.extra_base=t,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function vn(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}function de(e,n,t,i,r){this.good_length=e,this.max_lazy=n,this.nice_length=t,this.max_chain=i,this.func=r}function dl(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ot,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(Qs*2),this.dyn_dtree=new Uint16Array((2*Xs+1)*2),this.bl_tree=new Uint16Array((2*Js+1)*2),ke(this.dyn_ltree),ke(this.dyn_dtree),ke(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(el+1),this.heap=new Uint16Array(2*Cn+1),ke(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Cn+1),ke(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Al(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function gt(e){this.options=Gt.assign({level:zl,method:Pl,chunkSize:16384,windowBits:15,memLevel:8,strategy:$l},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $i,this.strm.avail_out=0;let t=pt.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(t!==jt)throw new Error(ze[t]);if(n.header&&pt.deflateSetHeader(this.strm,n.header),n.dictionary){let i;if(typeof n.dictionary=="string"?i=wt.string2buf(n.dictionary):Pi.call(n.dictionary)==="[object ArrayBuffer]"?i=new Uint8Array(n.dictionary):i=n.dictionary,t=pt.deflateSetDictionary(this.strm,i),t!==jt)throw new Error(ze[t]);this._dict_set=!0}}function Sn(e,n){let t=new gt(n);if(t.push(e,!0),t.err)throw t.msg||ze[t.err];return t.result}function Nl(e,n){return n=n||{},n.raw=!0,Sn(e,n)}function Ol(e,n){return n=n||{},n.gzip=!0,Sn(e,n)}function hd(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Td(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}function mt(e){this.options=Gt.assign({chunkSize:1024*64,windowBits:15,to:""},e||{});let n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),n.windowBits>=0&&n.windowBits<16&&!(e&&e.windowBits)&&(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(n.windowBits&15)===0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $i,this.strm.avail_out=0;let t=_e.inflateInit2(this.strm,n.windowBits);if(t!==bt)throw new Error(ze[t]);if(this.header=new Id,_e.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=wt.string2buf(n.dictionary):xr.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(t=_e.inflateSetDictionary(this.strm,n.dictionary),t!==bt)))throw new Error(ze[t])}function Mn(e,n){let t=new mt(n);if(t.push(e),t.err)throw t.msg||ze[t.err];return t.result}function Md(e,n){return n=n||{},n.raw=!0,Mn(e,n)}var is,li,di,rs,os,fi,as,ss,ls,hn,it,rt,Ze,cn,hi,Fe,un,ds,pn,ci,ui,pi,_n,$t,fs,_i,hs,ue,ot,at,st,wn,Pt,wi,gi,vi,bi,lt,Y,se,mi,cs,us,yi,ps,Ci,ki,_s,Ei,bn,Si,mn,xi,Di,ws,gs,vs,Ti,bs,Ii,ms,ys,Cs,ks,Es,Ss,xs,Ds,Ts,Is,dt,Us,As,Rs,Z,ze,Ge,Ls,Ms,Bs,be,Fs,$e,zs,$s,me,Ui,le,Ai,J,Ps,yn,Ns,Os,Nt,Ws,qs,Hs,Zs,Ot,Gs,js,Vs,Ys,Ks,Cn,Xs,Js,Qs,el,A,ye,te,tl,Wt,kn,qt,Ht,Zt,Pe,ft,H,ht,Ne,je,nl,Ce,Ri,ke,il,Ee,Se,G,R,ct,rl,Li,Oe,ol,En,Ve,al,sl,ut,ll,Mi,Bi,fl,Fi,hl,cl,ul,pl,_l,wl,gl,vl,bl,ml,yl,Cl,kl,pt,El,Sl,xl,Gt,zi,_t,Dl,Tl,Il,Ul,wt,$i,Pi,Rl,Ll,Ml,Bl,jt,Fl,zl,$l,Pl,Wl,ql,Hl,Zl,Gl,jl,Vt,Vl,Yl,Ye,Ni,Oi,Wi,xn,qi,Kl,Xl,Jl,Ql,ed,vt,td,Hi,Zi,Gi,nd,Yt,We,id,rd,Q,ji,Vi,od,Yi,Ki,Xi,Ji,Qi,er,tr,nr,ir,rr,or,Kt,pe,Dn,ar,Tn,sr,lr,dr,fr,Xt,Jt,hr,cr,ur,pr,_r,In,wr,gr,P,vr,ad,sd,ld,dd,fd,br,mr,yr,Cr,kr,cd,Er,Un,An,ud,Sr,pd,_d,wd,gd,vd,bd,md,yd,Cd,kd,Ed,Sd,xd,Dd,_e,Id,xr,Ud,Ad,bt,Rn,Ln,Rd,Dr,Ld,Bd,Fd,zd,$d,Pd,Nd,Dh,Od,Th,Ih,Wd,Uh,Ah,Rh,Tr,Qt,en=S(()=>{is=4,li=0,di=1,rs=2;os=0,fi=1,as=2,ss=3,ls=258,hn=29,it=256,rt=it+1+hn,Ze=30,cn=19,hi=2*rt+1,Fe=15,un=16,ds=7,pn=256,ci=16,ui=17,pi=18,_n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),$t=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fs=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),_i=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hs=512,ue=new Array((rt+2)*2);He(ue);ot=new Array(Ze*2);He(ot);at=new Array(hs);He(at);st=new Array(ls-ss+1);He(st);wn=new Array(hn);He(wn);Pt=new Array(Ze);He(Pt);bi=e=>e<256?at[e]:at[256+(e>>>7)],lt=(e,n)=>{e.pending_buf[e.pending++]=n&255,e.pending_buf[e.pending++]=n>>>8&255},Y=(e,n,t)=>{e.bi_valid>un-t?(e.bi_buf|=n<<e.bi_valid&65535,lt(e,e.bi_buf),e.bi_buf=n>>un-e.bi_valid,e.bi_valid+=t-un):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=t)},se=(e,n,t)=>{Y(e,t[n*2],t[n*2+1])},mi=(e,n)=>{let t=0;do t|=e&1,e>>>=1,t<<=1;while(--n>0);return t>>>1},cs=e=>{e.bi_valid===16?(lt(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=e.bi_buf&255,e.bi_buf>>=8,e.bi_valid-=8)},us=(e,n)=>{let t=n.dyn_tree,i=n.max_code,r=n.stat_desc.static_tree,o=n.stat_desc.has_stree,a=n.stat_desc.extra_bits,s=n.stat_desc.extra_base,f=n.stat_desc.max_length,l,d,h,u,c,p,E=0;for(u=0;u<=Fe;u++)e.bl_count[u]=0;for(t[e.heap[e.heap_max]*2+1]=0,l=e.heap_max+1;l<hi;l++)d=e.heap[l],u=t[t[d*2+1]*2+1]+1,u>f&&(u=f,E++),t[d*2+1]=u,!(d>i)&&(e.bl_count[u]++,c=0,d>=s&&(c=a[d-s]),p=t[d*2],e.opt_len+=p*(u+c),o&&(e.static_len+=p*(r[d*2+1]+c)));if(E!==0){do{for(u=f-1;e.bl_count[u]===0;)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[f]--,E-=2}while(E>0);for(u=f;u!==0;u--)for(d=e.bl_count[u];d!==0;)h=e.heap[--l],!(h>i)&&(t[h*2+1]!==u&&(e.opt_len+=(u-t[h*2+1])*t[h*2],t[h*2+1]=u),d--)}},yi=(e,n,t)=>{let i=new Array(Fe+1),r=0,o,a;for(o=1;o<=Fe;o++)i[o]=r=r+t[o-1]<<1;for(a=0;a<=n;a++){let s=e[a*2+1];s!==0&&(e[a*2]=mi(i[s]++,s))}},ps=()=>{let e,n,t,i,r,o=new Array(Fe+1);for(t=0,i=0;i<hn-1;i++)for(wn[i]=t,e=0;e<1<<_n[i];e++)st[t++]=i;for(st[t-1]=i,r=0,i=0;i<16;i++)for(Pt[i]=r,e=0;e<1<<$t[i];e++)at[r++]=i;for(r>>=7;i<Ze;i++)for(Pt[i]=r<<7,e=0;e<1<<$t[i]-7;e++)at[256+r++]=i;for(n=0;n<=Fe;n++)o[n]=0;for(e=0;e<=143;)ue[e*2+1]=8,e++,o[8]++;for(;e<=255;)ue[e*2+1]=9,e++,o[9]++;for(;e<=279;)ue[e*2+1]=7,e++,o[7]++;for(;e<=287;)ue[e*2+1]=8,e++,o[8]++;for(yi(ue,rt+1,o),e=0;e<Ze;e++)ot[e*2+1]=5,ot[e*2]=mi(e,5);wi=new gn(ue,_n,it+1,rt,Fe),gi=new gn(ot,$t,0,Ze,Fe),vi=new gn(new Array(0),fs,0,cn,ds)},Ci=e=>{let n;for(n=0;n<rt;n++)e.dyn_ltree[n*2]=0;for(n=0;n<Ze;n++)e.dyn_dtree[n*2]=0;for(n=0;n<cn;n++)e.bl_tree[n*2]=0;e.dyn_ltree[pn*2]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ki=e=>{e.bi_valid>8?lt(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},_s=(e,n,t,i)=>{ki(e),i&&(lt(e,t),lt(e,~t)),e.pending_buf.set(e.window.subarray(n,n+t),e.pending),e.pending+=t},Ei=(e,n,t,i)=>{let r=n*2,o=t*2;return e[r]<e[o]||e[r]===e[o]&&i[n]<=i[t]},bn=(e,n,t)=>{let i=e.heap[t],r=t<<1;for(;r<=e.heap_len&&(r<e.heap_len&&Ei(n,e.heap[r+1],e.heap[r],e.depth)&&r++,!Ei(n,i,e.heap[r],e.depth));)e.heap[t]=e.heap[r],t=r,r<<=1;e.heap[t]=i},Si=(e,n,t)=>{let i,r,o=0,a,s;if(e.last_lit!==0)do i=e.pending_buf[e.d_buf+o*2]<<8|e.pending_buf[e.d_buf+o*2+1],r=e.pending_buf[e.l_buf+o],o++,i===0?se(e,r,n):(a=st[r],se(e,a+it+1,n),s=_n[a],s!==0&&(r-=wn[a],Y(e,r,s)),i--,a=bi(i),se(e,a,t),s=$t[a],s!==0&&(i-=Pt[a],Y(e,i,s)));while(o<e.last_lit);se(e,pn,n)},mn=(e,n)=>{let t=n.dyn_tree,i=n.stat_desc.static_tree,r=n.stat_desc.has_stree,o=n.stat_desc.elems,a,s,f=-1,l;for(e.heap_len=0,e.heap_max=hi,a=0;a<o;a++)t[a*2]!==0?(e.heap[++e.heap_len]=f=a,e.depth[a]=0):t[a*2+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=f<2?++f:0,t[l*2]=1,e.depth[l]=0,e.opt_len--,r&&(e.static_len-=i[l*2+1]);for(n.max_code=f,a=e.heap_len>>1;a>=1;a--)bn(e,t,a);l=o;do a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],bn(e,t,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,t[l*2]=t[a*2]+t[s*2],e.depth[l]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,t[a*2+1]=t[s*2+1]=l,e.heap[1]=l++,bn(e,t,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],us(e,n),yi(t,f,e.bl_count)},xi=(e,n,t)=>{let i,r=-1,o,a=n[0*2+1],s=0,f=7,l=4;for(a===0&&(f=138,l=3),n[(t+1)*2+1]=65535,i=0;i<=t;i++)o=a,a=n[(i+1)*2+1],!(++s<f&&o===a)&&(s<l?e.bl_tree[o*2]+=s:o!==0?(o!==r&&e.bl_tree[o*2]++,e.bl_tree[ci*2]++):s<=10?e.bl_tree[ui*2]++:e.bl_tree[pi*2]++,s=0,r=o,a===0?(f=138,l=3):o===a?(f=6,l=3):(f=7,l=4))},Di=(e,n,t)=>{let i,r=-1,o,a=n[0*2+1],s=0,f=7,l=4;for(a===0&&(f=138,l=3),i=0;i<=t;i++)if(o=a,a=n[(i+1)*2+1],!(++s<f&&o===a)){if(s<l)do se(e,o,e.bl_tree);while(--s!==0);else o!==0?(o!==r&&(se(e,o,e.bl_tree),s--),se(e,ci,e.bl_tree),Y(e,s-3,2)):s<=10?(se(e,ui,e.bl_tree),Y(e,s-3,3)):(se(e,pi,e.bl_tree),Y(e,s-11,7));s=0,r=o,a===0?(f=138,l=3):o===a?(f=6,l=3):(f=7,l=4)}},ws=e=>{let n;for(xi(e,e.dyn_ltree,e.l_desc.max_code),xi(e,e.dyn_dtree,e.d_desc.max_code),mn(e,e.bl_desc),n=cn-1;n>=3&&e.bl_tree[_i[n]*2+1]===0;n--);return e.opt_len+=3*(n+1)+5+5+4,n},gs=(e,n,t,i)=>{let r;for(Y(e,n-257,5),Y(e,t-1,5),Y(e,i-4,4),r=0;r<i;r++)Y(e,e.bl_tree[_i[r]*2+1],3);Di(e,e.dyn_ltree,n-1),Di(e,e.dyn_dtree,t-1)},vs=e=>{let n=4093624447,t;for(t=0;t<=31;t++,n>>>=1)if(n&1&&e.dyn_ltree[t*2]!==0)return li;if(e.dyn_ltree[9*2]!==0||e.dyn_ltree[10*2]!==0||e.dyn_ltree[13*2]!==0)return di;for(t=32;t<it;t++)if(e.dyn_ltree[t*2]!==0)return di;return li},Ti=!1,bs=e=>{Ti||(ps(),Ti=!0),e.l_desc=new vn(e.dyn_ltree,wi),e.d_desc=new vn(e.dyn_dtree,gi),e.bl_desc=new vn(e.bl_tree,vi),e.bi_buf=0,e.bi_valid=0,Ci(e)},Ii=(e,n,t,i)=>{Y(e,(os<<1)+(i?1:0),3),_s(e,n,t,!0)},ms=e=>{Y(e,fi<<1,3),se(e,pn,ue),cs(e)},ys=(e,n,t,i)=>{let r,o,a=0;e.level>0?(e.strm.data_type===rs&&(e.strm.data_type=vs(e)),mn(e,e.l_desc),mn(e,e.d_desc),a=ws(e),r=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=r&&(r=o)):r=o=t+5,t+4<=r&&n!==-1?Ii(e,n,t,i):e.strategy===is||o===r?(Y(e,(fi<<1)+(i?1:0),3),Si(e,ue,ot)):(Y(e,(as<<1)+(i?1:0),3),gs(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),Si(e,e.dyn_ltree,e.dyn_dtree)),Ci(e),i&&ki(e)},Cs=(e,n,t)=>(e.pending_buf[e.d_buf+e.last_lit*2]=n>>>8&255,e.pending_buf[e.d_buf+e.last_lit*2+1]=n&255,e.pending_buf[e.l_buf+e.last_lit]=t&255,e.last_lit++,n===0?e.dyn_ltree[t*2]++:(e.matches++,n--,e.dyn_ltree[(st[t]+it+1)*2]++,e.dyn_dtree[bi(n)*2]++),e.last_lit===e.lit_bufsize-1),ks=bs,Es=Ii,Ss=ys,xs=Cs,Ds=ms,Ts={_tr_init:ks,_tr_stored_block:Es,_tr_flush_block:Ss,_tr_tally:xs,_tr_align:Ds},Is=(e,n,t,i)=>{let r=e&65535|0,o=e>>>16&65535|0,a=0;for(;t!==0;){a=t>2e3?2e3:t,t-=a;do r=r+n[i++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0},dt=Is,Us=()=>{let e,n=[];for(var t=0;t<256;t++){e=t;for(var i=0;i<8;i++)e=e&1?3988292384^e>>>1:e>>>1;n[t]=e}return n},As=new Uint32Array(Us()),Rs=(e,n,t,i)=>{let r=As,o=i+t;e^=-1;for(let a=i;a<o;a++)e=e>>>8^r[(e^n[a])&255];return e^-1},Z=Rs,ze={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ge={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:Ls,_tr_stored_block:Ms,_tr_flush_block:Bs,_tr_tally:be,_tr_align:Fs}=Ts,{Z_NO_FLUSH:$e,Z_PARTIAL_FLUSH:zs,Z_FULL_FLUSH:$s,Z_FINISH:me,Z_BLOCK:Ui,Z_OK:le,Z_STREAM_END:Ai,Z_STREAM_ERROR:J,Z_DATA_ERROR:Ps,Z_BUF_ERROR:yn,Z_DEFAULT_COMPRESSION:Ns,Z_FILTERED:Os,Z_HUFFMAN_ONLY:Nt,Z_RLE:Ws,Z_FIXED:qs,Z_DEFAULT_STRATEGY:Hs,Z_UNKNOWN:Zs,Z_DEFLATED:Ot}=Ge,Gs=9,js=15,Vs=8,Ys=29,Ks=256,Cn=Ks+1+Ys,Xs=30,Js=19,Qs=2*Cn+1,el=15,A=3,ye=258,te=ye+A+1,tl=32,Wt=42,kn=69,qt=73,Ht=91,Zt=103,Pe=113,ft=666,H=1,ht=2,Ne=3,je=4,nl=3,Ce=(e,n)=>(e.msg=ze[n],n),Ri=e=>(e<<1)-(e>4?9:0),ke=e=>{let n=e.length;for(;--n>=0;)e[n]=0},il=(e,n,t)=>(n<<e.hash_shift^t)&e.hash_mask,Ee=il,Se=e=>{let n=e.state,t=n.pending;t>e.avail_out&&(t=e.avail_out),t!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+t),e.next_out),e.next_out+=t,n.pending_out+=t,e.total_out+=t,e.avail_out-=t,n.pending-=t,n.pending===0&&(n.pending_out=0))},G=(e,n)=>{Bs(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,Se(e.strm)},R=(e,n)=>{e.pending_buf[e.pending++]=n},ct=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=n&255},rl=(e,n,t,i)=>{let r=e.avail_in;return r>i&&(r=i),r===0?0:(e.avail_in-=r,n.set(e.input.subarray(e.next_in,e.next_in+r),t),e.state.wrap===1?e.adler=dt(e.adler,n,r,t):e.state.wrap===2&&(e.adler=Z(e.adler,n,r,t)),e.next_in+=r,e.total_in+=r,r)},Li=(e,n)=>{let t=e.max_chain_length,i=e.strstart,r,o,a=e.prev_length,s=e.nice_match,f=e.strstart>e.w_size-te?e.strstart-(e.w_size-te):0,l=e.window,d=e.w_mask,h=e.prev,u=e.strstart+ye,c=l[i+a-1],p=l[i+a];e.prev_length>=e.good_match&&(t>>=2),s>e.lookahead&&(s=e.lookahead);do if(r=n,!(l[r+a]!==p||l[r+a-1]!==c||l[r]!==l[i]||l[++r]!==l[i+1])){i+=2,r++;do;while(l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&l[++i]===l[++r]&&i<u);if(o=ye-(u-i),i=u-ye,o>a){if(e.match_start=n,a=o,o>=s)break;c=l[i+a-1],p=l[i+a]}}while((n=h[n&d])>f&&--t!==0);return a<=e.lookahead?a:e.lookahead},Oe=e=>{let n=e.w_size,t,i,r,o,a;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-te)){e.window.set(e.window.subarray(n,n+n),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,i=e.hash_size,t=i;do r=e.head[--t],e.head[t]=r>=n?r-n:0;while(--i);i=n,t=i;do r=e.prev[--t],e.prev[t]=r>=n?r-n:0;while(--i);o+=n}if(e.strm.avail_in===0)break;if(i=rl(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=A)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=Ee(e,e.ins_h,e.window[a+1]);e.insert&&(e.ins_h=Ee(e,e.ins_h,e.window[a+A-1]),e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<A)););}while(e.lookahead<te&&e.strm.avail_in!==0)},ol=(e,n)=>{let t=65535;for(t>e.pending_buf_size-5&&(t=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Oe(e),e.lookahead===0&&n===$e)return H;if(e.lookahead===0)break}e.strstart+=e.lookahead,e.lookahead=0;let i=e.block_start+t;if((e.strstart===0||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,G(e,!1),e.strm.avail_out===0)||e.strstart-e.block_start>=e.w_size-te&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=0,n===me?(G(e,!0),e.strm.avail_out===0?Ne:je):(e.strstart>e.block_start&&(G(e,!1),e.strm.avail_out===0),H)},En=(e,n)=>{let t,i;for(;;){if(e.lookahead<te){if(Oe(e),e.lookahead<te&&n===$e)return H;if(e.lookahead===0)break}if(t=0,e.lookahead>=A&&(e.ins_h=Ee(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),t!==0&&e.strstart-t<=e.w_size-te&&(e.match_length=Li(e,t)),e.match_length>=A)if(i=be(e,e.strstart-e.match_start,e.match_length-A),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=A){e.match_length--;do e.strstart++,e.ins_h=Ee(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!==0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ee(e,e.ins_h,e.window[e.strstart+1]);else i=be(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=e.strstart<A-1?e.strstart:A-1,n===me?(G(e,!0),e.strm.avail_out===0?Ne:je):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:ht},Ve=(e,n)=>{let t,i,r;for(;;){if(e.lookahead<te){if(Oe(e),e.lookahead<te&&n===$e)return H;if(e.lookahead===0)break}if(t=0,e.lookahead>=A&&(e.ins_h=Ee(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=A-1,t!==0&&e.prev_length<e.max_lazy_match&&e.strstart-t<=e.w_size-te&&(e.match_length=Li(e,t),e.match_length<=5&&(e.strategy===Os||e.match_length===A&&e.strstart-e.match_start>4096)&&(e.match_length=A-1)),e.prev_length>=A&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-A,i=be(e,e.strstart-1-e.prev_match,e.prev_length-A),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=r&&(e.ins_h=Ee(e,e.ins_h,e.window[e.strstart+A-1]),t=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!==0);if(e.match_available=0,e.match_length=A-1,e.strstart++,i&&(G(e,!1),e.strm.avail_out===0))return H}else if(e.match_available){if(i=be(e,0,e.window[e.strstart-1]),i&&G(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return H}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=be(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<A-1?e.strstart:A-1,n===me?(G(e,!0),e.strm.avail_out===0?Ne:je):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:ht},al=(e,n)=>{let t,i,r,o,a=e.window;for(;;){if(e.lookahead<=ye){if(Oe(e),e.lookahead<=ye&&n===$e)return H;if(e.lookahead===0)break}if(e.match_length=0,e.lookahead>=A&&e.strstart>0&&(r=e.strstart-1,i=a[r],i===a[++r]&&i===a[++r]&&i===a[++r])){o=e.strstart+ye;do;while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=ye-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=A?(t=be(e,1,e.match_length-A),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(t=be(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),t&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=0,n===me?(G(e,!0),e.strm.avail_out===0?Ne:je):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:ht},sl=(e,n)=>{let t;for(;;){if(e.lookahead===0&&(Oe(e),e.lookahead===0)){if(n===$e)return H;break}if(e.match_length=0,t=be(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,t&&(G(e,!1),e.strm.avail_out===0))return H}return e.insert=0,n===me?(G(e,!0),e.strm.avail_out===0?Ne:je):e.last_lit&&(G(e,!1),e.strm.avail_out===0)?H:ht};ut=[new de(0,0,0,0,ol),new de(4,4,8,4,En),new de(4,5,16,8,En),new de(4,6,32,32,En),new de(4,4,16,16,Ve),new de(8,16,32,32,Ve),new de(8,16,128,128,Ve),new de(8,32,128,256,Ve),new de(32,128,258,1024,Ve),new de(32,258,258,4096,Ve)],ll=e=>{e.window_size=2*e.w_size,ke(e.head),e.max_lazy_match=ut[e.level].max_lazy,e.good_match=ut[e.level].good_length,e.nice_match=ut[e.level].nice_length,e.max_chain_length=ut[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=A-1,e.match_available=0,e.ins_h=0};Mi=e=>{if(!e||!e.state)return Ce(e,J);e.total_in=e.total_out=0,e.data_type=Zs;let n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap?Wt:Pe,e.adler=n.wrap===2?0:1,n.last_flush=$e,Ls(n),le},Bi=e=>{let n=Mi(e);return n===le&&ll(e.state),n},fl=(e,n)=>!e||!e.state||e.state.wrap!==2?J:(e.state.gzhead=n,le),Fi=(e,n,t,i,r,o)=>{if(!e)return J;let a=1;if(n===Ns&&(n=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),r<1||r>Gs||t!==Ot||i<8||i>15||n<0||n>9||o<0||o>qs)return Ce(e,J);i===8&&(i=9);let s=new dl;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=i,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=r+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+A-1)/A),s.window=new Uint8Array(s.w_size*2),s.head=new Uint16Array(s.hash_size),s.prev=new Uint16Array(s.w_size),s.lit_bufsize=1<<r+6,s.pending_buf_size=s.lit_bufsize*4,s.pending_buf=new Uint8Array(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=(1+2)*s.lit_bufsize,s.level=n,s.strategy=o,s.method=t,Bi(e)},hl=(e,n)=>Fi(e,n,Ot,js,Vs,Hs),cl=(e,n)=>{let t,i;if(!e||!e.state||n>Ui||n<0)return e?Ce(e,J):J;let r=e.state;if(!e.output||!e.input&&e.avail_in!==0||r.status===ft&&n!==me)return Ce(e,e.avail_out===0?yn:J);r.strm=e;let o=r.last_flush;if(r.last_flush=n,r.status===Wt)if(r.wrap===2)e.adler=0,R(r,31),R(r,139),R(r,8),r.gzhead?(R(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),R(r,r.gzhead.time&255),R(r,r.gzhead.time>>8&255),R(r,r.gzhead.time>>16&255),R(r,r.gzhead.time>>24&255),R(r,r.level===9?2:r.strategy>=Nt||r.level<2?4:0),R(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(R(r,r.gzhead.extra.length&255),R(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Z(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=kn):(R(r,0),R(r,0),R(r,0),R(r,0),R(r,0),R(r,r.level===9?2:r.strategy>=Nt||r.level<2?4:0),R(r,nl),r.status=Pe);else{let a=Ot+(r.w_bits-8<<4)<<8,s=-1;r.strategy>=Nt||r.level<2?s=0:r.level<6?s=1:r.level===6?s=2:s=3,a|=s<<6,r.strstart!==0&&(a|=tl),a+=31-a%31,r.status=Pe,ct(r,a),r.strstart!==0&&(ct(r,e.adler>>>16),ct(r,e.adler&65535)),e.adler=1}if(r.status===kn)if(r.gzhead.extra){for(t=r.pending;r.gzindex<(r.gzhead.extra.length&65535)&&!(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),Se(e),t=r.pending,r.pending===r.pending_buf_size));)R(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++;r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=qt)}else r.status=qt;if(r.status===qt)if(r.gzhead.name){t=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),Se(e),t=r.pending,r.pending===r.pending_buf_size)){i=1;break}r.gzindex<r.gzhead.name.length?i=r.gzhead.name.charCodeAt(r.gzindex++)&255:i=0,R(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),i===0&&(r.gzindex=0,r.status=Ht)}else r.status=Ht;if(r.status===Ht)if(r.gzhead.comment){t=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),Se(e),t=r.pending,r.pending===r.pending_buf_size)){i=1;break}r.gzindex<r.gzhead.comment.length?i=r.gzhead.comment.charCodeAt(r.gzindex++)&255:i=0,R(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>t&&(e.adler=Z(e.adler,r.pending_buf,r.pending-t,t)),i===0&&(r.status=Zt)}else r.status=Zt;if(r.status===Zt&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Se(e),r.pending+2<=r.pending_buf_size&&(R(r,e.adler&255),R(r,e.adler>>8&255),e.adler=0,r.status=Pe)):r.status=Pe),r.pending!==0){if(Se(e),e.avail_out===0)return r.last_flush=-1,le}else if(e.avail_in===0&&Ri(n)<=Ri(o)&&n!==me)return Ce(e,yn);if(r.status===ft&&e.avail_in!==0)return Ce(e,yn);if(e.avail_in!==0||r.lookahead!==0||n!==$e&&r.status!==ft){let a=r.strategy===Nt?sl(r,n):r.strategy===Ws?al(r,n):ut[r.level].func(r,n);if((a===Ne||a===je)&&(r.status=ft),a===H||a===Ne)return e.avail_out===0&&(r.last_flush=-1),le;if(a===ht&&(n===zs?Fs(r):n!==Ui&&(Ms(r,0,0,!1),n===$s&&(ke(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),Se(e),e.avail_out===0))return r.last_flush=-1,le}return n!==me?le:r.wrap<=0?Ai:(r.wrap===2?(R(r,e.adler&255),R(r,e.adler>>8&255),R(r,e.adler>>16&255),R(r,e.adler>>24&255),R(r,e.total_in&255),R(r,e.total_in>>8&255),R(r,e.total_in>>16&255),R(r,e.total_in>>24&255)):(ct(r,e.adler>>>16),ct(r,e.adler&65535)),Se(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?le:Ai)},ul=e=>{if(!e||!e.state)return J;let n=e.state.status;return n!==Wt&&n!==kn&&n!==qt&&n!==Ht&&n!==Zt&&n!==Pe&&n!==ft?Ce(e,J):(e.state=null,n===Pe?Ce(e,Ps):le)},pl=(e,n)=>{let t=n.length;if(!e||!e.state)return J;let i=e.state,r=i.wrap;if(r===2||r===1&&i.status!==Wt||i.lookahead)return J;if(r===1&&(e.adler=dt(e.adler,n,t,0)),i.wrap=0,t>=i.w_size){r===0&&(ke(i.head),i.strstart=0,i.block_start=0,i.insert=0);let f=new Uint8Array(i.w_size);f.set(n.subarray(t-i.w_size,t),0),n=f,t=i.w_size}let o=e.avail_in,a=e.next_in,s=e.input;for(e.avail_in=t,e.next_in=0,e.input=n,Oe(i);i.lookahead>=A;){let f=i.strstart,l=i.lookahead-(A-1);do i.ins_h=Ee(i,i.ins_h,i.window[f+A-1]),i.prev[f&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=f,f++;while(--l);i.strstart=f,i.lookahead=A-1,Oe(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=A-1,i.match_available=0,e.next_in=a,e.input=s,e.avail_in=o,i.wrap=r,le},_l=hl,wl=Fi,gl=Bi,vl=Mi,bl=fl,ml=cl,yl=ul,Cl=pl,kl="pako deflate (from Nodeca project)",pt={deflateInit:_l,deflateInit2:wl,deflateReset:gl,deflateResetKeep:vl,deflateSetHeader:bl,deflate:ml,deflateEnd:yl,deflateSetDictionary:Cl,deflateInfo:kl},El=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),Sl=function(e){let n=Array.prototype.slice.call(arguments,1);for(;n.length;){let t=n.shift();if(!!t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let i in t)El(t,i)&&(e[i]=t[i])}}return e},xl=e=>{let n=0;for(let i=0,r=e.length;i<r;i++)n+=e[i].length;let t=new Uint8Array(n);for(let i=0,r=0,o=e.length;i<o;i++){let a=e[i];t.set(a,r),r+=a.length}return t},Gt={assign:Sl,flattenChunks:xl},zi=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{zi=!1}_t=new Uint8Array(256);for(let e=0;e<256;e++)_t[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_t[254]=_t[254]=1;Dl=e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,t,i,r,o,a=e.length,s=0;for(r=0;r<a;r++)t=e.charCodeAt(r),(t&64512)===55296&&r+1<a&&(i=e.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),s+=t<128?1:t<2048?2:t<65536?3:4;for(n=new Uint8Array(s),o=0,r=0;o<s;r++)t=e.charCodeAt(r),(t&64512)===55296&&r+1<a&&(i=e.charCodeAt(r+1),(i&64512)===56320&&(t=65536+(t-55296<<10)+(i-56320),r++)),t<128?n[o++]=t:t<2048?(n[o++]=192|t>>>6,n[o++]=128|t&63):t<65536?(n[o++]=224|t>>>12,n[o++]=128|t>>>6&63,n[o++]=128|t&63):(n[o++]=240|t>>>18,n[o++]=128|t>>>12&63,n[o++]=128|t>>>6&63,n[o++]=128|t&63);return n},Tl=(e,n)=>{if(n<65534&&e.subarray&&zi)return String.fromCharCode.apply(null,e.length===n?e:e.subarray(0,n));let t="";for(let i=0;i<n;i++)t+=String.fromCharCode(e[i]);return t},Il=(e,n)=>{let t=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let i,r,o=new Array(t*2);for(r=0,i=0;i<t;){let a=e[i++];if(a<128){o[r++]=a;continue}let s=_t[a];if(s>4){o[r++]=65533,i+=s-1;continue}for(a&=s===2?31:s===3?15:7;s>1&&i<t;)a=a<<6|e[i++]&63,s--;if(s>1){o[r++]=65533;continue}a<65536?o[r++]=a:(a-=65536,o[r++]=55296|a>>10&1023,o[r++]=56320|a&1023)}return Tl(o,r)},Ul=(e,n)=>{n=n||e.length,n>e.length&&(n=e.length);let t=n-1;for(;t>=0&&(e[t]&192)===128;)t--;return t<0||t===0?n:t+_t[e[t]]>n?t:n},wt={string2buf:Dl,buf2string:Il,utf8border:Ul};$i=Al,Pi=Object.prototype.toString,{Z_NO_FLUSH:Rl,Z_SYNC_FLUSH:Ll,Z_FULL_FLUSH:Ml,Z_FINISH:Bl,Z_OK:jt,Z_STREAM_END:Fl,Z_DEFAULT_COMPRESSION:zl,Z_DEFAULT_STRATEGY:$l,Z_DEFLATED:Pl}=Ge;gt.prototype.push=function(e,n){let t=this.strm,i=this.options.chunkSize,r,o;if(this.ended)return!1;for(n===~~n?o=n:o=n===!0?Bl:Rl,typeof e=="string"?t.input=wt.string2buf(e):Pi.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){if(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),(o===Ll||o===Ml)&&t.avail_out<=6){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(r=pt.deflate(t,o),r===Fl)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),r=pt.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===jt;if(t.avail_out===0){this.onData(t.output);continue}if(o>0&&t.next_out>0){this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;continue}if(t.avail_in===0)break}return!0};gt.prototype.onData=function(e){this.chunks.push(e)};gt.prototype.onEnd=function(e){e===jt&&(this.result=Gt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};Wl=gt,ql=Sn,Hl=Nl,Zl=Ol,Gl=Ge,jl={Deflate:Wl,deflate:ql,deflateRaw:Hl,gzip:Zl,constants:Gl},Vt=30,Vl=12,Yl=function(n,t){let i,r,o,a,s,f,l,d,h,u,c,p,E,v,w,m,g,_,I,$,b,U,T,y,x=n.state;i=n.next_in,T=n.input,r=i+(n.avail_in-5),o=n.next_out,y=n.output,a=o-(t-n.avail_out),s=o+(n.avail_out-257),f=x.dmax,l=x.wsize,d=x.whave,h=x.wnext,u=x.window,c=x.hold,p=x.bits,E=x.lencode,v=x.distcode,w=(1<<x.lenbits)-1,m=(1<<x.distbits)-1;e:do{p<15&&(c+=T[i++]<<p,p+=8,c+=T[i++]<<p,p+=8),g=E[c&w];t:for(;;){if(_=g>>>24,c>>>=_,p-=_,_=g>>>16&255,_===0)y[o++]=g&65535;else if(_&16){I=g&65535,_&=15,_&&(p<_&&(c+=T[i++]<<p,p+=8),I+=c&(1<<_)-1,c>>>=_,p-=_),p<15&&(c+=T[i++]<<p,p+=8,c+=T[i++]<<p,p+=8),g=v[c&m];n:for(;;){if(_=g>>>24,c>>>=_,p-=_,_=g>>>16&255,_&16){if($=g&65535,_&=15,p<_&&(c+=T[i++]<<p,p+=8,p<_&&(c+=T[i++]<<p,p+=8)),$+=c&(1<<_)-1,$>f){n.msg="invalid distance too far back",x.mode=Vt;break e}if(c>>>=_,p-=_,_=o-a,$>_){if(_=$-_,_>d&&x.sane){n.msg="invalid distance too far back",x.mode=Vt;break e}if(b=0,U=u,h===0){if(b+=l-_,_<I){I-=_;do y[o++]=u[b++];while(--_);b=o-$,U=y}}else if(h<_){if(b+=l+h-_,_-=h,_<I){I-=_;do y[o++]=u[b++];while(--_);if(b=0,h<I){_=h,I-=_;do y[o++]=u[b++];while(--_);b=o-$,U=y}}}else if(b+=h-_,_<I){I-=_;do y[o++]=u[b++];while(--_);b=o-$,U=y}for(;I>2;)y[o++]=U[b++],y[o++]=U[b++],y[o++]=U[b++],I-=3;I&&(y[o++]=U[b++],I>1&&(y[o++]=U[b++]))}else{b=o-$;do y[o++]=y[b++],y[o++]=y[b++],y[o++]=y[b++],I-=3;while(I>2);I&&(y[o++]=y[b++],I>1&&(y[o++]=y[b++]))}}else if((_&64)===0){g=v[(g&65535)+(c&(1<<_)-1)];continue n}else{n.msg="invalid distance code",x.mode=Vt;break e}break}}else if((_&64)===0){g=E[(g&65535)+(c&(1<<_)-1)];continue t}else if(_&32){x.mode=Vl;break e}else{n.msg="invalid literal/length code",x.mode=Vt;break e}break}}while(i<r&&o<s);I=p>>3,i-=I,p-=I<<3,c&=(1<<p)-1,n.next_in=i,n.next_out=o,n.avail_in=i<r?5+(r-i):5-(i-r),n.avail_out=o<s?257+(s-o):257-(o-s),x.hold=c,x.bits=p},Ye=15,Ni=852,Oi=592,Wi=0,xn=1,qi=2,Kl=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Xl=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Jl=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ql=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),ed=(e,n,t,i,r,o,a,s)=>{let f=s.bits,l=0,d=0,h=0,u=0,c=0,p=0,E=0,v=0,w=0,m=0,g,_,I,$,b,U=null,T=0,y,x=new Uint16Array(Ye+1),Le=new Uint16Array(Ye+1),Ut=null,Qn=0,ei,At,Rt;for(l=0;l<=Ye;l++)x[l]=0;for(d=0;d<i;d++)x[n[t+d]]++;for(c=f,u=Ye;u>=1&&x[u]===0;u--);if(c>u&&(c=u),u===0)return r[o++]=1<<24|64<<16|0,r[o++]=1<<24|64<<16|0,s.bits=1,0;for(h=1;h<u&&x[h]===0;h++);for(c<h&&(c=h),v=1,l=1;l<=Ye;l++)if(v<<=1,v-=x[l],v<0)return-1;if(v>0&&(e===Wi||u!==1))return-1;for(Le[1]=0,l=1;l<Ye;l++)Le[l+1]=Le[l]+x[l];for(d=0;d<i;d++)n[t+d]!==0&&(a[Le[n[t+d]]++]=d);if(e===Wi?(U=Ut=a,y=19):e===xn?(U=Kl,T-=257,Ut=Xl,Qn-=257,y=256):(U=Jl,Ut=Ql,y=-1),m=0,d=0,l=h,b=o,p=c,E=0,I=-1,w=1<<c,$=w-1,e===xn&&w>Ni||e===qi&&w>Oi)return 1;for(;;){ei=l-E,a[d]<y?(At=0,Rt=a[d]):a[d]>y?(At=Ut[Qn+a[d]],Rt=U[T+a[d]]):(At=32+64,Rt=0),g=1<<l-E,_=1<<p,h=_;do _-=g,r[b+(m>>E)+_]=ei<<24|At<<16|Rt|0;while(_!==0);for(g=1<<l-1;m&g;)g>>=1;if(g!==0?(m&=g-1,m+=g):m=0,d++,--x[l]===0){if(l===u)break;l=n[t+a[d]]}if(l>c&&(m&$)!==I){for(E===0&&(E=c),b+=h,p=l-E,v=1<<p;p+E<u&&(v-=x[p+E],!(v<=0));)p++,v<<=1;if(w+=1<<p,e===xn&&w>Ni||e===qi&&w>Oi)return 1;I=m&$,r[I]=c<<24|p<<16|b-o|0}}return m!==0&&(r[b+m]=l-E<<24|64<<16|0),s.bits=c,0},vt=ed,td=0,Hi=1,Zi=2,{Z_FINISH:Gi,Z_BLOCK:nd,Z_TREES:Yt,Z_OK:We,Z_STREAM_END:id,Z_NEED_DICT:rd,Z_STREAM_ERROR:Q,Z_DATA_ERROR:ji,Z_MEM_ERROR:Vi,Z_BUF_ERROR:od,Z_DEFLATED:Yi}=Ge,Ki=1,Xi=2,Ji=3,Qi=4,er=5,tr=6,nr=7,ir=8,rr=9,or=10,Kt=11,pe=12,Dn=13,ar=14,Tn=15,sr=16,lr=17,dr=18,fr=19,Xt=20,Jt=21,hr=22,cr=23,ur=24,pr=25,_r=26,In=27,wr=28,gr=29,P=30,vr=31,ad=32,sd=852,ld=592,dd=15,fd=dd,br=e=>(e>>>24&255)+(e>>>8&65280)+((e&65280)<<8)+((e&255)<<24);mr=e=>{if(!e||!e.state)return Q;let n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=n.wrap&1),n.mode=Ki,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(sd),n.distcode=n.distdyn=new Int32Array(ld),n.sane=1,n.back=-1,We},yr=e=>{if(!e||!e.state)return Q;let n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,mr(e)},Cr=(e,n)=>{let t;if(!e||!e.state)return Q;let i=e.state;return n<0?(t=0,n=-n):(t=(n>>4)+1,n<48&&(n&=15)),n&&(n<8||n>15)?Q:(i.window!==null&&i.wbits!==n&&(i.window=null),i.wrap=t,i.wbits=n,yr(e))},kr=(e,n)=>{if(!e)return Q;let t=new hd;e.state=t,t.window=null;let i=Cr(e,n);return i!==We&&(e.state=null),i},cd=e=>kr(e,fd),Er=!0,ud=e=>{if(Er){Un=new Int32Array(512),An=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(vt(Hi,e.lens,0,288,Un,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;vt(Zi,e.lens,0,32,An,0,e.work,{bits:5}),Er=!1}e.lencode=Un,e.lenbits=9,e.distcode=An,e.distbits=5},Sr=(e,n,t,i)=>{let r,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(n.subarray(t-o.wsize,t),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(n.subarray(t-i,t-i+r),o.wnext),i-=r,i?(o.window.set(n.subarray(t-i,t),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0},pd=(e,n)=>{let t,i,r,o,a,s,f,l,d,h,u,c,p,E,v=0,w,m,g,_,I,$,b,U,T=new Uint8Array(4),y,x,Le=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return Q;t=e.state,t.mode===pe&&(t.mode=Dn),a=e.next_out,r=e.output,f=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,l=t.hold,d=t.bits,h=s,u=f,U=We;e:for(;;)switch(t.mode){case Ki:if(t.wrap===0){t.mode=Dn;break}for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(t.wrap&2&&l===35615){t.check=0,T[0]=l&255,T[1]=l>>>8&255,t.check=Z(t.check,T,2,0),l=0,d=0,t.mode=Xi;break}if(t.flags=0,t.head&&(t.head.done=!1),!(t.wrap&1)||(((l&255)<<8)+(l>>8))%31){e.msg="incorrect header check",t.mode=P;break}if((l&15)!==Yi){e.msg="unknown compression method",t.mode=P;break}if(l>>>=4,d-=4,b=(l&15)+8,t.wbits===0)t.wbits=b;else if(b>t.wbits){e.msg="invalid window size",t.mode=P;break}t.dmax=1<<t.wbits,e.adler=t.check=1,t.mode=l&512?or:pe,l=0,d=0;break;case Xi:for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(t.flags=l,(t.flags&255)!==Yi){e.msg="unknown compression method",t.mode=P;break}if(t.flags&57344){e.msg="unknown header flags set",t.mode=P;break}t.head&&(t.head.text=l>>8&1),t.flags&512&&(T[0]=l&255,T[1]=l>>>8&255,t.check=Z(t.check,T,2,0)),l=0,d=0,t.mode=Ji;case Ji:for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.head&&(t.head.time=l),t.flags&512&&(T[0]=l&255,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,t.check=Z(t.check,T,4,0)),l=0,d=0,t.mode=Qi;case Qi:for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.head&&(t.head.xflags=l&255,t.head.os=l>>8),t.flags&512&&(T[0]=l&255,T[1]=l>>>8&255,t.check=Z(t.check,T,2,0)),l=0,d=0,t.mode=er;case er:if(t.flags&1024){for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.length=l,t.head&&(t.head.extra_len=l),t.flags&512&&(T[0]=l&255,T[1]=l>>>8&255,t.check=Z(t.check,T,2,0)),l=0,d=0}else t.head&&(t.head.extra=null);t.mode=tr;case tr:if(t.flags&1024&&(c=t.length,c>s&&(c=s),c&&(t.head&&(b=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(i.subarray(o,o+c),b)),t.flags&512&&(t.check=Z(t.check,i,c,o)),s-=c,o+=c,t.length-=c),t.length))break e;t.length=0,t.mode=nr;case nr:if(t.flags&2048){if(s===0)break e;c=0;do b=i[o+c++],t.head&&b&&t.length<65536&&(t.head.name+=String.fromCharCode(b));while(b&&c<s);if(t.flags&512&&(t.check=Z(t.check,i,c,o)),s-=c,o+=c,b)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=ir;case ir:if(t.flags&4096){if(s===0)break e;c=0;do b=i[o+c++],t.head&&b&&t.length<65536&&(t.head.comment+=String.fromCharCode(b));while(b&&c<s);if(t.flags&512&&(t.check=Z(t.check,i,c,o)),s-=c,o+=c,b)break e}else t.head&&(t.head.comment=null);t.mode=rr;case rr:if(t.flags&512){for(;d<16;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l!==(t.check&65535)){e.msg="header crc mismatch",t.mode=P;break}l=0,d=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),e.adler=t.check=0,t.mode=pe;break;case or:for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}e.adler=t.check=br(l),l=0,d=0,t.mode=Kt;case Kt:if(t.havedict===0)return e.next_out=a,e.avail_out=f,e.next_in=o,e.avail_in=s,t.hold=l,t.bits=d,rd;e.adler=t.check=1,t.mode=pe;case pe:if(n===nd||n===Yt)break e;case Dn:if(t.last){l>>>=d&7,d-=d&7,t.mode=In;break}for(;d<3;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}switch(t.last=l&1,l>>>=1,d-=1,l&3){case 0:t.mode=ar;break;case 1:if(ud(t),t.mode=Xt,n===Yt){l>>>=2,d-=2;break e}break;case 2:t.mode=lr;break;case 3:e.msg="invalid block type",t.mode=P}l>>>=2,d-=2;break;case ar:for(l>>>=d&7,d-=d&7;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if((l&65535)!==(l>>>16^65535)){e.msg="invalid stored block lengths",t.mode=P;break}if(t.length=l&65535,l=0,d=0,t.mode=Tn,n===Yt)break e;case Tn:t.mode=sr;case sr:if(c=t.length,c){if(c>s&&(c=s),c>f&&(c=f),c===0)break e;r.set(i.subarray(o,o+c),a),s-=c,o+=c,f-=c,a+=c,t.length-=c;break}t.mode=pe;break;case lr:for(;d<14;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(t.nlen=(l&31)+257,l>>>=5,d-=5,t.ndist=(l&31)+1,l>>>=5,d-=5,t.ncode=(l&15)+4,l>>>=4,d-=4,t.nlen>286||t.ndist>30){e.msg="too many length or distance symbols",t.mode=P;break}t.have=0,t.mode=dr;case dr:for(;t.have<t.ncode;){for(;d<3;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.lens[Le[t.have++]]=l&7,l>>>=3,d-=3}for(;t.have<19;)t.lens[Le[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,y={bits:t.lenbits},U=vt(td,t.lens,0,19,t.lencode,0,t.work,y),t.lenbits=y.bits,U){e.msg="invalid code lengths set",t.mode=P;break}t.have=0,t.mode=fr;case fr:for(;t.have<t.nlen+t.ndist;){for(;v=t.lencode[l&(1<<t.lenbits)-1],w=v>>>24,m=v>>>16&255,g=v&65535,!(w<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(g<16)l>>>=w,d-=w,t.lens[t.have++]=g;else{if(g===16){for(x=w+2;d<x;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l>>>=w,d-=w,t.have===0){e.msg="invalid bit length repeat",t.mode=P;break}b=t.lens[t.have-1],c=3+(l&3),l>>>=2,d-=2}else if(g===17){for(x=w+3;d<x;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=w,d-=w,b=0,c=3+(l&7),l>>>=3,d-=3}else{for(x=w+7;d<x;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=w,d-=w,b=0,c=11+(l&127),l>>>=7,d-=7}if(t.have+c>t.nlen+t.ndist){e.msg="invalid bit length repeat",t.mode=P;break}for(;c--;)t.lens[t.have++]=b}}if(t.mode===P)break;if(t.lens[256]===0){e.msg="invalid code -- missing end-of-block",t.mode=P;break}if(t.lenbits=9,y={bits:t.lenbits},U=vt(Hi,t.lens,0,t.nlen,t.lencode,0,t.work,y),t.lenbits=y.bits,U){e.msg="invalid literal/lengths set",t.mode=P;break}if(t.distbits=6,t.distcode=t.distdyn,y={bits:t.distbits},U=vt(Zi,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,y),t.distbits=y.bits,U){e.msg="invalid distances set",t.mode=P;break}if(t.mode=Xt,n===Yt)break e;case Xt:t.mode=Jt;case Jt:if(s>=6&&f>=258){e.next_out=a,e.avail_out=f,e.next_in=o,e.avail_in=s,t.hold=l,t.bits=d,Yl(e,u),a=e.next_out,r=e.output,f=e.avail_out,o=e.next_in,i=e.input,s=e.avail_in,l=t.hold,d=t.bits,t.mode===pe&&(t.back=-1);break}for(t.back=0;v=t.lencode[l&(1<<t.lenbits)-1],w=v>>>24,m=v>>>16&255,g=v&65535,!(w<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(m&&(m&240)===0){for(_=w,I=m,$=g;v=t.lencode[$+((l&(1<<_+I)-1)>>_)],w=v>>>24,m=v>>>16&255,g=v&65535,!(_+w<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=_,d-=_,t.back+=_}if(l>>>=w,d-=w,t.back+=w,t.length=g,m===0){t.mode=_r;break}if(m&32){t.back=-1,t.mode=pe;break}if(m&64){e.msg="invalid literal/length code",t.mode=P;break}t.extra=m&15,t.mode=hr;case hr:if(t.extra){for(x=t.extra;d<x;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.length+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=cr;case cr:for(;v=t.distcode[l&(1<<t.distbits)-1],w=v>>>24,m=v>>>16&255,g=v&65535,!(w<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if((m&240)===0){for(_=w,I=m,$=g;v=t.distcode[$+((l&(1<<_+I)-1)>>_)],w=v>>>24,m=v>>>16&255,g=v&65535,!(_+w<=d);){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}l>>>=_,d-=_,t.back+=_}if(l>>>=w,d-=w,t.back+=w,m&64){e.msg="invalid distance code",t.mode=P;break}t.offset=g,t.extra=m&15,t.mode=ur;case ur:if(t.extra){for(x=t.extra;d<x;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}t.offset+=l&(1<<t.extra)-1,l>>>=t.extra,d-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){e.msg="invalid distance too far back",t.mode=P;break}t.mode=pr;case pr:if(f===0)break e;if(c=u-f,t.offset>c){if(c=t.offset-c,c>t.whave&&t.sane){e.msg="invalid distance too far back",t.mode=P;break}c>t.wnext?(c-=t.wnext,p=t.wsize-c):p=t.wnext-c,c>t.length&&(c=t.length),E=t.window}else E=r,p=a-t.offset,c=t.length;c>f&&(c=f),f-=c,t.length-=c;do r[a++]=E[p++];while(--c);t.length===0&&(t.mode=Jt);break;case _r:if(f===0)break e;r[a++]=t.length,f--,t.mode=Jt;break;case In:if(t.wrap){for(;d<32;){if(s===0)break e;s--,l|=i[o++]<<d,d+=8}if(u-=f,e.total_out+=u,t.total+=u,u&&(e.adler=t.check=t.flags?Z(t.check,r,u,a-u):dt(t.check,r,u,a-u)),u=f,(t.flags?l:br(l))!==t.check){e.msg="incorrect data check",t.mode=P;break}l=0,d=0}t.mode=wr;case wr:if(t.wrap&&t.flags){for(;d<32;){if(s===0)break e;s--,l+=i[o++]<<d,d+=8}if(l!==(t.total&4294967295)){e.msg="incorrect length check",t.mode=P;break}l=0,d=0}t.mode=gr;case gr:U=id;break e;case P:U=ji;break e;case vr:return Vi;case ad:default:return Q}return e.next_out=a,e.avail_out=f,e.next_in=o,e.avail_in=s,t.hold=l,t.bits=d,(t.wsize||u!==e.avail_out&&t.mode<P&&(t.mode<In||n!==Gi))&&Sr(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,t.total+=u,t.wrap&&u&&(e.adler=t.check=t.flags?Z(t.check,r,u,e.next_out-u):dt(t.check,r,u,e.next_out-u)),e.data_type=t.bits+(t.last?64:0)+(t.mode===pe?128:0)+(t.mode===Xt||t.mode===Tn?256:0),(h===0&&u===0||n===Gi)&&U===We&&(U=od),U},_d=e=>{if(!e||!e.state)return Q;let n=e.state;return n.window&&(n.window=null),e.state=null,We},wd=(e,n)=>{if(!e||!e.state)return Q;let t=e.state;return(t.wrap&2)===0?Q:(t.head=n,n.done=!1,We)},gd=(e,n)=>{let t=n.length,i,r,o;return!e||!e.state||(i=e.state,i.wrap!==0&&i.mode!==Kt)?Q:i.mode===Kt&&(r=1,r=dt(r,n,t,0),r!==i.check)?ji:(o=Sr(e,n,t,t),o?(i.mode=vr,Vi):(i.havedict=1,We))},vd=yr,bd=Cr,md=mr,yd=cd,Cd=kr,kd=pd,Ed=_d,Sd=wd,xd=gd,Dd="pako inflate (from Nodeca project)",_e={inflateReset:vd,inflateReset2:bd,inflateResetKeep:md,inflateInit:yd,inflateInit2:Cd,inflate:kd,inflateEnd:Ed,inflateGetHeader:Sd,inflateSetDictionary:xd,inflateInfo:Dd};Id=Td,xr=Object.prototype.toString,{Z_NO_FLUSH:Ud,Z_FINISH:Ad,Z_OK:bt,Z_STREAM_END:Rn,Z_NEED_DICT:Ln,Z_STREAM_ERROR:Rd,Z_DATA_ERROR:Dr,Z_MEM_ERROR:Ld}=Ge;mt.prototype.push=function(e,n){let t=this.strm,i=this.options.chunkSize,r=this.options.dictionary,o,a,s;if(this.ended)return!1;for(n===~~n?a=n:a=n===!0?Ad:Ud,xr.call(e)==="[object ArrayBuffer]"?t.input=new Uint8Array(e):t.input=e,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(i),t.next_out=0,t.avail_out=i),o=_e.inflate(t,a),o===Ln&&r&&(o=_e.inflateSetDictionary(t,r),o===bt?o=_e.inflate(t,a):o===Dr&&(o=Ln));t.avail_in>0&&o===Rn&&t.state.wrap>0&&e[t.next_in]!==0;)_e.inflateReset(t),o=_e.inflate(t,a);switch(o){case Rd:case Dr:case Ln:case Ld:return this.onEnd(o),this.ended=!0,!1}if(s=t.avail_out,t.next_out&&(t.avail_out===0||o===Rn))if(this.options.to==="string"){let f=wt.utf8border(t.output,t.next_out),l=t.next_out-f,d=wt.buf2string(t.output,f);t.next_out=l,t.avail_out=i-l,l&&t.output.set(t.output.subarray(f,f+l),0),this.onData(d)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(!(o===bt&&s===0)){if(o===Rn)return o=_e.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(t.avail_in===0)break}}return!0};mt.prototype.onData=function(e){this.chunks.push(e)};mt.prototype.onEnd=function(e){e===bt&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Gt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};Bd=mt,Fd=Mn,zd=Md,$d=Mn,Pd=Ge,Nd={Inflate:Bd,inflate:Fd,inflateRaw:zd,ungzip:$d,constants:Pd},{Deflate:Dh,deflate:Od,deflateRaw:Th,gzip:Ih}=jl,{Inflate:Wd,inflate:Uh,inflateRaw:Ah,ungzip:Rh}=Nd,Tr=Od,Qt=Wd});function yt(e,n,t){let i=e+n-t,r=Math.abs(i-e),o=Math.abs(i-n),a=Math.abs(i-t);return r<=o&&r<=a?e:o<=a?n:t}var Fn=S(()=>{});function Ir(e,n,t){let i=qd(e,t),r;n.interlaceMethod===1?r=Gd(e,n,i):r=Ur(e,n,i);let o=e.metadata.find(s=>s.type==="tRNS"),a=jd(e,n,r,e.palette,o);return o&&(n.colorType===0||n.colorType===2)&&Vd(n,a,o),a}function qd(e,n){let t=new Qt,i=0;for(let r of n)i=r.offset+4+4,t.push(e.view.buffer.slice(e.view.byteOffset+i,e.view.byteOffset+i+r.dataLength));if(t.err)throw ve(e,n[0],`Inflate error: ${t.msg}`,n[0].offset);if(t.result===void 0)throw new q(e,"IDAT: Failed to decompress data chunks",0);return t.result}function Ur(e,n,t,i=0,r=n.width,o=n.height){let a=0,s=zn(n),f=tn(n),l=Ar(n,r),d=Math.ceil(r*f),h=new Uint8Array(o*d),u=new Map;for(let c=0;c<o;c++){let p=i+c*(l+1),E=t[p++];if(!Hd)throw new q(e,`IDAT: Invalid filter type ${E}`,0);let v=u.get(E);v||(v=Zd(f,l,r,E),u.set(E,v));let w=1,m=0;switch(E){case 0:case 1:{for(;m<s;m++)h[a]=t[p+m],a++;break}case 3:{let g=0;for(;m<s;m++)g=a-r*s,h[a]=t[p+m]+Math.floor(0+(g<0?0:h[g]))/2,a++;break}case 2:{w=0;break}case 4:{for(;m<s;m++){let g=Math.floor(a-l);h[a]=(t[p+m]+yt(0,g<0?0:h[g],0))%256,a++}break}}if(n.bitDepth>=8)for(;w<r;w++)for(let g=0;g<s;g++)h[a]=v(t,p+w*s+g,h,a),a++;else{for(w&&(a-=w),m=w;m<l;m++)h[a+m]=v(t,p+m,h,a+m);a+=l}}return h}function Hd(e){return e%1===0&&e>=0&&e<=4}function Zd(e,n,t,i){let r=0,o=0,a=0;switch(i){case 0:return(s,f)=>s[f];case 1:return(s,f,l,d)=>(s[f]+l[Math.floor(d-e)])%256;case 2:return(s,f,l,d)=>(o=Math.floor(d-t*e),o<0?s[f]:(s[f]+l[o])%256);case 3:return(s,f,l,d)=>(r=Math.floor(d-e),o=Math.floor(d-t*e),s[f]+Math.floor((r<0?0:l[r])+(o<0?0:l[o]))/2);case 4:return(s,f,l,d)=>(r=Math.floor(d-Math.ceil(e)),o=Math.floor(d-n),a=Math.floor(d-n-Math.ceil(e)),(s[f]+yt(r<0?0:l[r],o<0?0:l[o],a<0?0:l[a]))%256)}}function zn(e){return Math.ceil(tn(e))}function tn(e){return Rr(e.colorType)*e.bitDepth/8}function Ar(e,n){return Math.ceil(Rr(e.colorType)*e.bitDepth*n/8)}function Rr(e){switch(e){case 0:return 1;case 2:return 3;case 3:return 1;case 4:return 2;case 6:return 4}}function Gd(e,n,t){let i=tn(n),r=Math.ceil(n.width*i),o=new Uint8Array(r*n.height),a=zn(n),s=8/n.bitDepth,f=(1<<n.bitDepth)-1,l=[0,4,0,2,0,1,0],d=[0,0,4,0,2,0,1],h=[8,8,4,4,2,2,1],u=[8,8,8,4,4,2,2],c=0;for(let p=0;p<7;p++){let E=l[p],v=d[p],w=h[p],m=u[p],g=Math.ceil((n.width-E)/w),_=Math.ceil((n.height-v)/m),I=Math.ceil(i*g);if(g===0||_===0)continue;let $=Ur(e,n,t,c,g,_),b=0;for(let U=0;U<_;U++){b=(v+U*m)*r+E*i;for(let T=0;T<g;T++){if(n.bitDepth<8){let y=$[U*I+Math.floor(T*i)];y>>=(s-T%s-1)*n.bitDepth,y&=f,y<<=(s-1-b%1*s)*n.bitDepth,o[Math.floor(b)]|=y}else for(let y=0;y<a;y++)o[b+y]=$[(U*g+T)*a+y];b+=w*i}}c+=_*(1+Ar(n,g))}return o}function jd(e,n,t,i,r){let o=new(n.bitDepth===16?Uint16Array:Uint8Array)(n.width*n.height*4),a=0,s=zn(n),f=tn(n),l=Math.ceil(n.width*f);switch(n.colorType){case 0:{switch(n.bitDepth){case 1:case 2:case 4:{let d=8/n.bitDepth,h=(1<<n.bitDepth)-1,u=n.bitDepth/8;for(let c=0;c<n.height;c++)for(let p=0;p<n.width;p++)a=(c*n.width+p)*4,o[a]=t[c*l+Math.floor(p*u)],o[a]>>=(d-p%d-1)*n.bitDepth,o[a]&=h,o[a]*=255/h,o[a+1]=o[a],o[a+2]=o[a],o[a+3]=255;break}case 8:case 16:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1]:o[a]=t[(d*n.width+h)*s],o[a+1]=o[a],o[a+2]=o[a],o[a+3]=n.bitDepth===16?65535:255;break}}break}case 4:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1]:o[a]=t[(d*n.width+h)*s],o[a+1]=o[a],o[a+2]=o[a],n.bitDepth===16?o[a+3]=t[(d*n.width+h)*s+2]<<8|t[(d*n.width+h)*s+3]:o[a+3]=t[(d*n.width+h)*s+1];break}case 3:{if(!i)throw new q(e,"IDAT: Cannot decode indexed color type without a palette",0);switch(n.bitDepth){case 1:case 2:case 4:{let d=8/n.bitDepth,h=(1<<n.bitDepth)-1,u=n.bitDepth/8;for(let c=0;c<n.height;c++)for(let p=0;p<n.width;p++){a=(c*n.width+p)*4;let E=t[c*l+Math.floor(p*u)];E>>=(d-p%d-1)*n.bitDepth,E&=h,i.setRgba(o,a,E),r&&r.transparency.length>E&&(o[a+3]=r.transparency[E])}break}case 8:{let d=0;for(let h=0;h<n.height;h++)for(let u=0;u<n.width;u++)a=(h*n.width+u)*4,d=t[h*n.width+u],i.setRgba(o,a,d),r&&r.transparency.length>d&&(o[a+3]=r.transparency[d]);break}}break}case 2:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?(o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1],o[a+1]=t[(d*n.width+h)*s+2]<<8|t[(d*n.width+h)*s+3],o[a+2]=t[(d*n.width+h)*s+4]<<8|t[(d*n.width+h)*s+5]):(o[a]=t[(d*n.width+h)*s],o[a+1]=t[(d*n.width+h)*s+1],o[a+2]=t[(d*n.width+h)*s+2]),o[a+3]=n.bitDepth===16?65535:255;break}case 6:{for(let d=0;d<n.height;d++)for(let h=0;h<n.width;h++)a=(d*n.width+h)*4,n.bitDepth===16?(o[a]=t[(d*n.width+h)*s]<<8|t[(d*n.width+h)*s+1],o[a+1]=t[(d*n.width+h)*s+2]<<8|t[(d*n.width+h)*s+3],o[a+2]=t[(d*n.width+h)*s+4]<<8|t[(d*n.width+h)*s+5],o[a+3]=t[(d*n.width+h)*s+6]<<8|t[(d*n.width+h)*s+7]):(o[a]=t[(d*n.width+h)*s],o[a+1]=t[(d*n.width+h)*s+1],o[a+2]=t[(d*n.width+h)*s+2],o[a+3]=t[(d*n.width+h)*s+3]);break}}return o}function Vd(e,n,t){let i=(1<<e.bitDepth)-1,r=e.bitDepth===16?65535:255;if(e.colorType===0){let o=r/i*t.transparency;for(let a=0;a<n.length;a+=4)n[a]===o&&(n[a+3]=0);return}if(e.colorType===2){let o=[r/i*t.transparency[0],r/i*t.transparency[1],r/i*t.transparency[2]];for(let a=0;a<n.length;a+=4)n[a]===o[0]&&n[a+1]===o[1]&&n[a+2]===o[2]&&(n[a+3]=0);return}}var Lr=S(()=>{en();z();Fn()});function Mr(e,n,t){Me(e,t,"IDAT"),F(e,t,0)}var Br=S(()=>{z()});function Fr(e){return e===1||e===2||e===4||e===8||e===16}function zr(e,n){return e===0&&n>=1&&n<=16||e===2&&n>=8&&n<=16||e===3&&n>=1&&n<=8||e===4&&n>=8&&n<=16||e===6&&n>=8&&n<=16}function $r(e){return e===0}function Pr(e){return e===0||e===1}var Nr=S(()=>{});function Or(e,n){F(e,n,13);let t=n.offset+4+4,i=e.view.getUint32(t);t+=4;let r=e.view.getUint32(t);t+=4;let o=e.view.getUint8(t);if(!Fr(o))throw ve(e,n,`Bit depth "${o}" is not valid`,t);t++;let a=e.view.getUint8(t);if(!zr(a,o))throw ve(e,n,`Color type "${a}" is not valid with bit depth "${o}"`,t);t++;let s=e.view.getUint8(t);ce(e,n,s,t),t++;let f=e.view.getUint8(t);$r(f)||(N(e,C(n,`Filter method "${f}" is not valid`,t)),f=0),t++;let l=e.view.getUint8(t);return Pr(l)||(N(e,C(n,`Interlace method "${l}" is not valid`,t)),l=0),t++,{width:i,height:r,bitDepth:o,colorType:a,interlaceMethod:l}}var Wr=S(()=>{z();Nr()});function Yd(){if(Ct)return Ct;Ct=[];for(let e=0;e<256;e++){let n=e;for(let t=0;t<8;t++)n&1?n=3988292384^n>>>1:n=n>>>1;Ct[e]=n>>>0}return Ct}function Kd(e,n,t,i){let r=Yd(),o=e;for(let a=0;a<i;a++)o=r[(o^n.getUint8(t+a))&255]^o>>>8;return o}function kt(e,n,t){return(Kd(4294967295,e,n,t)^4294967295)>>>0}var Ct,$n=S(()=>{});var qr={};M(qr,{parseChunk:()=>Xd});function Xd(e,n,t){B(e,t),D(e,t,"IDAT");let i=t.offset+4+4,r,o;switch(n.colorType){case 0:case 4:{r=e.view.getUint16(i),o=2;break}case 2:case 6:{r=[e.view.getUint16(i),e.view.getUint16(i+2),e.view.getUint16(i+4)],o=6;break}case 3:{r=e.view.getUint8(i),o=1;break}default:throw C(t,`Unrecognized color type "${n.colorType}"`,i)}return F(e,t,o),{type:"bKGD",color:r}}var Hr=S(()=>{z()});var Zr={};M(Zr,{parseChunk:()=>Jd});function Jd(e,n,t){B(e,t),D(e,t,"PLTE"),D(e,t,"IDAT"),F(e,t,32);let i=t.offset+4+4,r={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(r.x>1||r.y>1)throw C(t,`Invalid white point (${r.x},${r.y})`,i);i+=8;let o={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(o.x>1||o.y>1)throw C(t,`Invalid red (${o.x},${o.y})`,i);i+=8;let a={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(a.x>1||a.y>1)throw C(t,`Invalid green (${a.x},${a.y})`,i);i+=8;let s={x:e.view.getUint32(i)/1e5,y:e.view.getUint32(i+4)/1e5};if(s.x>1||s.y>1)throw C(t,`Invalid blue (${s.x},${s.y})`,i);return{type:"cHRM",whitePoint:r,red:o,green:a,blue:s}}var Gr=S(()=>{z()});var jr={};M(jr,{parseChunk:()=>Qd});function Qd(e,n,t){let i=t.offset+4+4;return{type:"eXIf",value:e.view.buffer.slice(e.view.byteOffset+i,e.view.byteOffset+i+t.dataLength)}}var Vr=S(()=>{});var Yr={};M(Yr,{parseChunk:()=>ef});function ef(e,n,t){B(e,t),D(e,t,"PLTE"),D(e,t,"IDAT"),F(e,t,4);let i=t.offset+4+4,r=e.view.getUint32(i)/1e5;return r===0&&N(e,C(t,"A value of 0 is meaningless",i)),{type:"gAMA",value:r}}var Kr=S(()=>{z()});var Xr={};M(Xr,{parseChunk:()=>tf});function tf(e,n,t){B(e,t),Me(e,t,"PLTE"),D(e,t,"IDAT"),F(e,t,e.palette.size*2);let i=t.offset+4+4,r=[];for(let o=0;o<e.palette.size*2;o+=2)r.push(e.view.getUint16(i+o));return{type:"hIST",frequency:r}}var Jr=S(()=>{z()});function O(e,n,t,i,r,o,a,s){let f=[],l=0,d=0;for(;(i===void 0||d<i)&&!(!a&&r===o);d++){try{l=e.view.getUint8(r)}catch(u){throw u instanceof Error&&u.message==="Offset is outside the bounds of the DataView"?C(n,"EOF while reading text",r):u}if(!s&&l===0)break;r++,f.push(l)}if(a&&e.view.getUint8(r)!==0)throw C(n,"No null character after text",r);let h=new Uint8Array(f);if(s){let u=new Qt;if(u.push(h),u.err)throw C(n,`Inflate error: ${u.msg}`,r);h=u.result}return{text:t?t.decode(h):String.fromCharCode(...f),bytesRead:d+1}}var xe=S(()=>{en();z()});var Qr={};M(Qr,{parseChunk:()=>nf});function nf(e,n,t){B(e,t),tt(e,t,"sRGB"),D(e,t,"PLTE"),D(e,t,"IDAT"),X(e,t,3);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s=O(e,t,a,79,o,r,!0);o+=s.bytesRead;let f=s.text,l=e.view.getUint8(o);ce(e,t,l,o),o++;let d=new Uint8Array(e.view.buffer.slice(e.view.byteOffset+o,e.view.byteOffset+r));return{type:"iCCP",name:f,data:d}}var eo=S(()=>{z();xe()});var to={};M(to,{parseChunk:()=>rf});function rf(e,n,t){X(e,t,6);let i=t.offset+4+4,r=i+t.dataLength,o=new TextDecoder("utf8"),a;a=O(e,t,o,79,i,r,!0),i+=a.bytesRead;let s=a.text,f=e.view.getUint8(i++)===1,l=e.view.getUint8(i);f&&ce(e,t,l,i),i++,a=O(e,t,o,void 0,i,r,!0),i+=a.bytesRead;let d=a.text;a=O(e,t,o,void 0,i,r,!0),i+=a.bytesRead;let h=a.text;a=O(e,t,o,void 0,i,r,!1,f),i+=a.bytesRead;let u=a.text;return{type:"iTXt",keyword:s,languageTag:d,translatedKeyword:h,text:u}}var no=S(()=>{z();xe()});var io={};M(io,{parseChunk:()=>of});function of(e,n,t){B(e,t),F(e,t,7);let i=t.offset+4+4,r=e.view.getUint16(i);i+=2;let o=e.view.getUint8(i++),a=e.view.getUint8(i++),s=e.view.getUint8(i++),f=e.view.getUint8(i++),l=e.view.getUint8(i++);return{type:"tIME",value:new Date(r,o,a,s,f,l)}}var ro=S(()=>{z()});var oo={};M(oo,{parseChunk:()=>af});function af(e,n,t){B(e,t),D(e,t,"IDAT"),F(e,t,9);let i=t.offset+4+4,r=e.view.getInt32(i);i+=4;let o=e.view.getInt32(i);i+=4;let a=e.view.getUint8(i),s;switch(a){case 0:s="pixel";break;case 1:s="micrometer";break;default:throw C(t,`Invalid oFFs unit type ("${a}")`,i)}return{type:"oFFs",offset:{x:r,y:o},unitType:s}}var ao=S(()=>{z()});function Et(e,n,t,i,r,o){let a=O(e,n,t,void 0,i,r,o);i+=a.bytesRead,sf(a.text)||N(e,C(n,`Invalid character in floating point number ("${a.text}")`,i));let s=parseFloat(a.text);return{bytesRead:a.bytesRead,value:s}}function sf(e){return e.match(/^[+-]?[0-9]+\.[0-9]+([eE][+-]?[0-9]+)?$/)||e.match(/^[+-]?[0-9]+\.?([eE][+-]?[0-9]+)?$/)||e.match(/^[+-]?\.[0-9]+([eE][+-]?[0-9]+)?$/)}var Pn=S(()=>{z();xe()});var so={};M(so,{parseChunk:()=>lf});function lf(e,n,t){B(e,t),D(e,t,"IDAT"),X(e,t,4);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s;s=O(e,t,a,79,o,r,!0),o+=s.bytesRead;let f=s.text,l=e.view.getInt32(o);o+=4;let d=e.view.getInt32(o);o+=4;let h=e.view.getUint8(o++),u;switch(h){case 0:u="linear-mapping";break;case 1:u="base-e exponential mapping";break;case 2:u="arbitrary-base exponential mapping";break;case 3:u="hyperbolic mapping";break;default:throw C(t,`Invalid equation type "${h}"`,o)}let c=e.view.getUint8(o++);s=O(e,t,a,79,o,r,!0),o+=s.bytesRead;let p=s.text,E=[],v;for(let w=0;w<c;w++)v=Et(e,t,a,o,r,w<c-1),o+=v.bytesRead,E.push(v.value);return{type:"pCAL",calibrationName:f,x0:l,x1:d,equationType:u,unitName:p,params:E}}var lo=S(()=>{z();Pn();xe()});var fo={};M(fo,{parseChunk:()=>df});function df(e,n,t){B(e,t),D(e,t,"IDAT"),F(e,t,9);let i=t.offset+4+4,r=e.view.getUint32(i);i+=4;let o=e.view.getUint32(i);i+=4;let a=e.view.getUint8(i)===1?"meter":"unknown";return{type:"pHYs",pixelsPerUnit:{x:r,y:o},unitType:a}}var ho=S(()=>{z()});var co={};M(co,{parseChunk:()=>ff});function ff(e,n,t){B(e,t),D(e,t,"PLTE"),D(e,t,"IDAT");let i=t.offset+4+4,r,o;switch(n.colorType){case 0:{r=e.view.getUint8(i),o=1;break}case 2:case 3:{r=[e.view.getUint8(i),e.view.getUint8(i+1),e.view.getUint8(i+2)],o=3;break}case 4:{r=[e.view.getUint8(i),e.view.getUint8(i+1)],o=2;break}case 6:{r=[e.view.getUint8(i),e.view.getUint8(i+1),e.view.getUint8(i+2),e.view.getUint8(i+3)],o=4;break}default:throw C(t,`Unrecognized color type "${n.colorType}"`,i)}return F(e,t,o),{type:"sBIT",value:r}}var uo=S(()=>{z()});var po={};M(po,{parseChunk:()=>hf});function hf(e,n,t){B(e,t),D(e,t,"IDAT"),X(e,t,4);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s=e.view.getUint8(o),f;switch(s){case 0:f="meter";break;case 1:f="radian";break;default:throw C(t,`Invalid sCAL unit type ("${s}")`,o)}o++;let l;l=Et(e,t,a,o,r,!0),o+=l.bytesRead;let d=l.value;l=Et(e,t,a,o,r,!1),o+=l.bytesRead;let h=l.value;if(d<0||h<0)throw C(t,`Values cannot be negative (${d}, ${h})`,o);return{type:"sCAL",pixelsPerUnit:{x:d,y:h},unitType:f}}var _o=S(()=>{z();Pn()});var wo={};M(wo,{parseChunk:()=>cf});function cf(e,n,t){D(e,t,"IDAT");let i=t.offset+4+4,r=i,o=r+t.dataLength,a=new TextDecoder("latin1"),s=O(e,t,a,void 0,r,o,!0);r+=s.bytesRead;let f=s.text,l=e.view.getUint8(r++),d=l===16?2:1,h=d*4+2,u=t.dataLength-(r-i),c=u/h;if(c%1!==0)throw C(t,`Invalid data length: ${u} should be divisible by entry size ${h}`,r);let p=[];for(let E=0;E<c;E++){let v=[];for(let m=0;m<4;m++)v.push(d===2?e.view.getUint16(r):e.view.getUint8(r)),r+=d;let w=e.view.getUint16(r);r+=2,p.push({red:v[0],green:v[1],blue:v[2],alpha:v[3],frequency:w})}return{type:"sPLT",name:f,sampleDepth:l,entries:p}}var go=S(()=>{z();xe()});var vo={};M(vo,{parseChunk:()=>uf});function uf(e,n,t){B(e,t),tt(e,t,"iCCP"),D(e,t,"PLTE"),D(e,t,"IDAT"),F(e,t,1);let i=t.offset+4+4,r=e.view.getUint8(i),o;switch(r){case 0:case 1:case 2:case 3:o=r;break;default:throw C(t,`Invalid rendering intent "${r}"`,i)}return{type:"sRGB",renderingIntent:o}}var bo=S(()=>{z()});var mo={};M(mo,{parseChunk:()=>pf});function pf(e,n,t){B(e,t),D(e,t,"IDAT"),F(e,t,1);let i=t.offset+4+4,r=e.view.getUint8(i),o;switch(r){case 0:o="cross-fuse";break;case 1:o="diverging-fuse";break;default:throw C(t,`Invalid layout mode "${r}"`,i)}let a=15-(n.width-1)%16;if(a>7)throw C(t,`Invalid padding value "${a}" for image width ${n.width}`,i);let s=Math.floor((n.width-a)/2);return{type:"sTER",layoutMode:o,subimageWidth:s,padding:a}}var yo=S(()=>{z()});var Co={};M(Co,{parseChunk:()=>_f});function _f(e,n,t){X(e,t,6);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s;s=O(e,t,a,79,o,r,!0),o+=s.bytesRead;let f=s.text;s=O(e,t,a,void 0,o,r,!1),o+=s.bytesRead;let l=s.text;return{type:"tEXt",keyword:f,text:l}}var ko=S(()=>{z();xe()});var Eo={};M(Eo,{parseChunk:()=>wf});function wf(e,n,t){switch(D(e,t,"IDAT"),n.colorType){case 0:F(e,t,2);break;case 2:F(e,t,6);break;case 3:if(Me(e,t,"PLTE"),t.dataLength>e.palette.size)throw C(t,`Invalid data length for color type ${n.colorType}: ${t.dataLength} > ${e.palette.size}`,t.offset+4+4);break;case 4:case 6:throw C(t,`Chunk invalid when color type has alpha (${n.colorType})`,t.offset+4+4)}let i=t.offset+4+4,r;switch(n.colorType){case 0:r=e.view.getUint16(i);break;case 2:r=[e.view.getUint16(i),e.view.getUint16(i+2),e.view.getUint16(i+4)];break;case 3:r=[];for(let o=0;o<t.dataLength;o++)r.push(e.view.getUint8(i+o));break}return{type:"tRNS",transparency:r}}var So=S(()=>{z()});var xo={};M(xo,{parseChunk:()=>gf});function gf(e,n,t){X(e,t,6);let i=t.offset+4+4,r=i+t.dataLength,o=i,a=new TextDecoder("latin1"),s;s=O(e,t,a,79,o,r,!0),o+=s.bytesRead;let f=s.text,l=e.view.getUint8(o);ce(e,t,l,o),o++,s=O(e,t,a,void 0,o,r,!1,!0),o+=s.bytesRead;let d=s.text;return{type:"zTXt",keyword:f,text:d}}var Do=S(()=>{z();xe()});var To={};M(To,{Palette:()=>Nn,parseChunk:()=>vf});function vf(e,n,t){B(e,t),D(e,t,"bKGD"),D(e,t,"hIST"),D(e,t,"tRNS"),D(e,t,"IDAT");let i=t.offset+4;if(n.colorType===0||n.colorType===4)throw C(t,`Color type "${n.colorType}" cannot have a palette`,i);if(i+=4,t.dataLength===0)throw C(t,"Cannot have 0 entries",i);if(t.dataLength%3!==0)throw C(t,`Chunk length must be divisible by 3 (actual "${t.dataLength}")`,i);return t.dataLength/3>256&&N(e,C(t,`Too many entries (${t.dataLength/3} > 256)`,i)),t.dataLength/3>Math.pow(2,n.bitDepth)&&N(e,C(t,`Too many entries for bit depth (${t.dataLength/3} > 2^${n.bitDepth})`,i)),new Nn(e.view,t.offset+4+4,t.dataLength)}var Nn,Io=S(()=>{z();Nn=class{constructor(n,t,i){this._view=n,this._paletteOffset=t,this._length=i}get size(){return this._length/3}getRgb(n){return this._checkIndex(n),new Uint8Array(this._view.buffer.slice(this._view.byteOffset+this._paletteOffset+n*3,this._view.byteOffset+this._paletteOffset+n*3+3))}setRgba(n,t,i){this._checkIndex(i);let r=this._paletteOffset+i*3;n[t]=this._view.getUint8(r),n[t+1]=this._view.getUint8(r+1),n[t+2]=this._view.getUint8(r+2),n[t+3]=255}_checkIndex(n){if(n<0||n*3>this._length-3)throw new Error(`Palette does not contain color index "${n}"`)}}});var Fo={};M(Fo,{decodePng:()=>mf,readChunk:()=>Bo,readChunks:()=>Mo,verifyPngSignature:()=>Uo});function Uo(e){if(e.view.byteLength<7)throw new q(e,`Not enough bytes in file for png signature (${e.view.byteLength})`,0);if(!(e.view.getUint8(0)===137&&e.view.getUint8(1)===80&&e.view.getUint8(2)===78&&e.view.getUint8(3)===71&&e.view.getUint8(4)===13&&e.view.getUint8(5)===10&&e.view.getUint8(6)===26&&e.view.getUint8(7)===10)){let t=Ao(Array.from(new Uint8Array(e.view.buffer).slice(e.view.byteOffset,e.view.byteOffset+8))),i=Ao([137,80,78,71,13,10,26,10]);throw new q(e,`Png signature is not correct (${t} != ${i})`,0)}}function Ao(e){return`0x${e.map(n=>n.toString(16).padStart(2,"0")).join("")}`}function bf(e){switch(e){case"bKGD":return Promise.resolve().then(()=>(Hr(),qr));case"cHRM":return Promise.resolve().then(()=>(Gr(),Zr));case"eXIf":return Promise.resolve().then(()=>(Vr(),jr));case"gAMA":return Promise.resolve().then(()=>(Kr(),Yr));case"hIST":return Promise.resolve().then(()=>(Jr(),Xr));case"iCCP":return Promise.resolve().then(()=>(eo(),Qr));case"iTXt":return Promise.resolve().then(()=>(no(),to));case"tIME":return Promise.resolve().then(()=>(ro(),io));case"oFFs":return Promise.resolve().then(()=>(ao(),oo));case"pCAL":return Promise.resolve().then(()=>(lo(),so));case"pHYs":return Promise.resolve().then(()=>(ho(),fo));case"sBIT":return Promise.resolve().then(()=>(uo(),co));case"sCAL":return Promise.resolve().then(()=>(_o(),po));case"sPLT":return Promise.resolve().then(()=>(go(),wo));case"sRGB":return Promise.resolve().then(()=>(bo(),vo));case"sTER":return Promise.resolve().then(()=>(yo(),mo));case"tEXt":return Promise.resolve().then(()=>(ko(),Co));case"tRNS":return Promise.resolve().then(()=>(So(),Eo));case"zTXt":return Promise.resolve().then(()=>(Do(),xo));default:throw new Error(`Could not get decoder for chunk type "${e}"`)}}async function mf(e,n={}){let t={view:new DataView(e.buffer,e.byteOffset,e.byteLength),image:void 0,palette:void 0,metadata:[],parsedChunks:new Set,warnings:[],info:[],options:n};Uo(t);let i=Mo(t);t.rawChunks=i;let r=Or(t,i[0]),o=Bt(Mt({},t),{header:r}),a;n&&n.parseChunkTypes?n.parseChunkTypes==="*"?a=Lo:a=Ro.concat(n.parseChunkTypes):a=Ro;for(let s=1;s<i.length;s++){let f=i[s];switch(f.type){case"IHDR":N(o,C(f,"Multiple IHDR chunks not allowed",f.offset+4));break;case"IDAT":{let l=[f];for(;i.length>s+1&&i[s+1].type==="IDAT";)l.push(i[++s]);o.image={width:r.width,height:r.height,data:Ir(o,r,l)};break}case"PLTE":o.palette=(await Promise.resolve().then(()=>(Io(),To))).parseChunk(o,r,f);break;case"IEND":Mr(o,r,f);break;default:if(a.includes(f.type))try{o.metadata.push((await bf(f.type)).parseChunk(o,r,f))}catch(l){if(l instanceof ae)N(o,l);else throw l}else if(!Lo.includes(f.type))if(f.isAncillary)o.info.push(`Unrecognized chunk type "${f.type}"`);else throw new q(o,`Unrecognized critical chunk type "${f.type}"`,f.offset+4);break}o.parsedChunks.add(f.type)}if(!o.image)throw new q(o,"Failed to decode, no IDAT chunk",0);return n&&n.force32&&o.image.data.BYTES_PER_ELEMENT===2&&(o.image.data=ai(o.image.data)),{image:o.image,details:{width:r.width,height:r.height,bitDepth:r.bitDepth,colorType:r.colorType,interlaceMethod:r.interlaceMethod},palette:o.palette,metadata:o.metadata,rawChunks:i,warnings:o.warnings,info:o.info}}function Mo(e){let n=[],t=8,i=!1,r=!1,o;for(;t<e.view.byteLength;){try{o=Bo(e,t)}catch(a){if(!r||!(a instanceof Error))throw a;N(e,new ae("Could not parse chunk after IEND: "+a.message,t))}t+=4+4+o.dataLength+4,n.push(o),i||(i=o.type==="IDAT"),r||(r=o.type==="IEND")}if(n[0].type!=="IHDR")throw new q(e,"First chunk is not IHDR",n[0].offset+4);if(n[n.length-1].type!=="IEND"&&N(e,new ae("Last chunk is not IEND",n[n.length-1].offset+4)),!i)throw new q(e,"No IDAT chunk",0);return n}function Bo(e,n){if(e.view.byteLength<n+4)throw new q(e,"EOF while reading chunk length",n);let t=e.view.getUint32(n);if(e.view.byteLength<n+4+4)throw new q(e,"EOF while reading chunk type",n);let i=String.fromCharCode(e.view.getUint8(n+4),e.view.getUint8(n+5),e.view.getUint8(n+6),e.view.getUint8(n+7));if(e.view.byteLength<n+4+4+t+4)throw new q(e,`EOF while reading chunk "${i}"`,n);let r=e.view.getUint32(n+4+4+t)>>>0,o=kt(e.view,n+4,4+t);return r!==o&&N(e,new ae(`CRC for chunk "${i}" at offset 0x${n.toString(16)} doesn't match (0x${r.toString(16)} != 0x${o.toString(16)})`,n)),{offset:n,type:i,dataLength:t,isAncillary:On(i,0),isPrivate:On(i,1),isSafeToCopy:On(i,3)}}function On(e,n){return!!(e.charCodeAt(n)&32)}var Ro,Lo,zo=S(()=>{si();z();Lr();Br();Wr();$n();Ro=Object.freeze(["tRNS"]),Lo=Object.freeze(["bKGD","cHRM","eXIf","gAMA","hIST","iCCP","iTXt","tIME","oFFs","pCAL","pHYs","sBIT","sCAL","sPLT","sRGB","sTER","tEXt","tRNS","zTXt"])});var De,nn=S(()=>{De=class{constructor(n){this.offset=0,this.array=new Uint8Array(n),this.view=new DataView(this.array.buffer,this.array.byteOffset,this.array.byteLength)}writeUint8(n){this.view.setUint8(this.offset,n),this.offset+=1}writeUint16(n){this.view.setUint16(this.offset,n),this.offset+=2}writeUint32(n){this.view.setUint32(this.offset,n),this.offset+=4}writeArray(n){this.array.set(n,this.array.byteOffset+this.offset),this.offset+=n.length}assertAtEnd(){if(this.offset!==this.array.length)throw new Error("Writing finished before expected length of stream")}}});function $o(e,n){e.writeUint8(n.charCodeAt(0)),e.writeUint8(n.charCodeAt(1)),e.writeUint8(n.charCodeAt(2)),e.writeUint8(n.charCodeAt(3))}function rn(e,n){let t=new De(4+4+n.length+4);if(t.writeUint32(n.length),e.length!==4)throw new Error(`Cannot encode a chunk type of length ${e.length}`);return $o(t,e),t.writeArray(n),t.writeUint32(kt(t.view,4,4+n.length)),t.assertAtEnd(),t.array}function fe(e,n,t){let i=new De(4+4+n+4);if(i.writeUint32(n),e.length!==4)throw new Error(`Cannot encode a chunk type of length ${e.length}`);return $o(i,e),t(i),i.writeUint32(kt(i.view,4,4+n)),i.assertAtEnd(),i.array}var qe=S(()=>{nn();$n()});function Po(e,n){let t=yf(e,n),i=new De(t);Cf(e,n,i);let r=Tr(i.array);return rn("IDAT",r)}function yf(e,n){if(e.bitDepth<8)throw new Error("Only bit depth 8 and 16 is supported currently");if(n.data.BYTES_PER_ELEMENT===2&&e.bitDepth===8)throw new Error("16 to 8 bit conversion isn't supported yet");if(e.interlaceMethod!==0)throw new Error("Only interlace method 0 is supported currently");let t;switch(e.colorType){case 0:t=1;break;case 2:t=3;break;case 3:t=1;break;case 4:t=2;break;case 6:t=4;break}let i=e.bitDepth===16?2:1,r=t*i;return(1+r*n.width)*n.height}function Cf(e,n,t){let i=0,r=0,o=0;if(e.colorType===3){if(!e.palette)throw new Error("Cannot encode indexed file without palette");if(n.data.BYTES_PER_ELEMENT===2)throw new Error("Cannot encode indexed file from 16-bit image");for(;o<n.height;o++)for(t.writeUint8(0),r=0;r<n.width;r++)t.writeUint8(e.palette.get(n.data[i]<<24|n.data[i+1]<<16|n.data[i+2]<<8|n.data[i+3])),i+=4;return}let a;if(e.options.filterPattern){if(e.options.filterPattern.length===0)throw new Error("Filter pattern with 0 entries");a=e.options.filterPattern}let s=4*n.data.BYTES_PER_ELEMENT,f=[];for(let d of[0,1,2,3,4])f[d]=Ef(s,s*n.width,d);let l=No(e.colorType);for(;o<n.height;o++){let d=a?a[o%a.length]:kf(e.colorType,n,o*n.width*4,f),h=new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength);t.writeUint8(d);let u=0,c=0;for(r=0;r<n.width;r++){for(c of l)for(u=n.data.BYTES_PER_ELEMENT-1;u>=0;u--)t.writeUint8(f[d](h,(i+c)*n.data.BYTES_PER_ELEMENT+u,r===0));i+=4}}}function kf(e,n,t,i){let r=[],o=4*n.data.BYTES_PER_ELEMENT;for(let f of[0,1,2,3,4]){let l=0,d=No(e),h=new Uint8Array(n.data.buffer,n.data.byteOffset,n.data.byteLength),u=0,c=0;for(let p=t;p<t+n.width*4;p+=4)for(u of d)for(c=n.data.BYTES_PER_ELEMENT-1;c>=0;c--)l+=i[f](h,(p+u)*n.data.BYTES_PER_ELEMENT+c,p===t);r[f]=l}let a=0,s=r[0];for(let f of[1,2,3,4])r[f]<s&&(a=f,s=r[f]);return a}function Ef(e,n,t){let i=0,r=0,o=0;switch(t){case 0:return(a,s)=>a[s];case 1:return(a,s,f)=>(i=f?-1:s-e,(a[s]-(i<0?0:a[s-e])+256)%256);case 2:return(a,s)=>(r=s-n,(a[s]-(r<0?0:a[r])+256)%256);case 3:return(a,s,f)=>(i=f?-1:s-e,r=s-n,(a[s]-Math.floor(((i<0?0:a[i])+(r<0?0:a[r]))/2)+256)%256);case 4:return(a,s,f)=>(i=f?-1:s-e,r=s-n,o=f?-1:s-e-n,(a[s]-yt(i<0?0:a[i],r<0?0:a[r],o<0?0:a[o])+256)%256)}}function No(e){switch(e){case 0:return[0];case 2:return[0,1,2];case 4:return[0,3];case 6:return[0,1,2,3]}}var Oo=S(()=>{en();nn();Fn();qe()});function Wo(){return rn("IEND",new Uint8Array(0))}var qo=S(()=>{qe()});function Ho(e,n){if(n.width<=0||n.height<=0)throw new Error(`Invalid dimensions ${n.width}x${n.height}`);return fe("IHDR",13,t=>{t.writeUint32(n.width),t.writeUint32(n.height),t.writeUint8(e.bitDepth),t.writeUint8(e.colorType),t.writeUint8(0),t.writeUint8(0),t.writeUint8(e.interlaceMethod)})}var Zo=S(()=>{qe()});var Go={};M(Go,{encodeChunk:()=>Sf});function Sf(e,n){switch(e.colorType){case 0:{if(e.firstTransparentColor===void 0)throw new Error("Cannot write tRNS for grayscale without any transparent colors");let t=e.firstTransparentColor;return fe("tRNS",2,i=>{n.data.BYTES_PER_ELEMENT===2?i.writeUint16(t>>48&65535):i.writeUint16(t>>24&255)})}case 3:{if(!e.palette)throw new Error("Cannot encode tRNS chunk for indexed image without palette");return fe("tRNS",e.palette.size,t=>{for(let i of e.colorSet)t.writeUint8(i&255)})}case 2:{if(e.firstTransparentColor===void 0)throw new Error("Cannot write tRNS for True color without any transparent colors");let t=e.firstTransparentColor;return fe("tRNS",6,i=>{n.data.BYTES_PER_ELEMENT===2?(i.writeUint16(t>>48&65535),i.writeUint16(t>>32&65535),i.writeUint16(t>>16&65535)):(i.writeUint16(t>>24&255),i.writeUint16(t>>16&255),i.writeUint16(t>>8&255))})}default:throw new Error(`Cannot encode tRNS chunk for color type "${e.colorType}"`)}}var jo=S(()=>{qe()});var Vo={};M(Vo,{encodeChunk:()=>xf});function xf(e,n){if(e.bitDepth===16||n.data.BYTES_PER_ELEMENT===2)throw new Error("Cannot encode 16 bit images using indexed color type");if(e.colorSet.size>Math.pow(2,e.bitDepth))throw new Error(`Too many colors ${e.colorSet.size} to encode into indexed image (2^${e.bitDepth} = ${Math.pow(2,e.bitDepth)})`);let t=fe("PLTE",e.colorSet.size*3,r=>{for(let o of e.colorSet.values())r.writeUint8(o>>24&255),r.writeUint8(o>>16&255),r.writeUint8(o>>8&255)}),i=new Map;for(let r of e.colorSet.values())i.set(r,i.size);return{chunkData:t,palette:i}}var Yo=S(()=>{qe()});var Wn={};M(Wn,{encodeChunk:()=>Df});function Df(e,n,t,i){if(t.length===0||t.length>79)throw new Be(`tEXt: Invalid keyword length: 0 < ${t.length} < 80`,0);let r=t.length+1+i.length;return fe("tEXt",r,o=>{let a=0;for(;a<t.length;a++)o.writeUint8(t.charCodeAt(a));for(o.writeUint8(0),a=0;a<i.length;a++)o.writeUint8(i.charCodeAt(a))})}var qn=S(()=>{zt();qe()});var Ko={};M(Ko,{encodePng:()=>If});function Tf(e){switch(e){case"tRNS":return Promise.resolve().then(()=>(jo(),Go));default:throw new Error(`Could not get encoder for chunk type "${e}"`)}}async function If(e,n={}){if(e.data.length!==e.width*e.height*4)throw new Be(`Provided image data length (${e.data.length}) is not expected length (${e.width*e.height*4})`,Math.min(e.data.length,e.width*e.height*4)-1);let t=[];t.push(Uf());let i=Af(e,n);if(t.push(Ho(i,e)),i.colorType===3){let s=(await Promise.resolve().then(()=>(Yo(),Vo))).encodeChunk(i,e);i.palette=s.palette,t.push(s.chunkData)}if(i.useTransparencyChunk&&t.push((await Tf("tRNS")).encodeChunk(i,e)),t.push(Po(i,e)),(n==null?void 0:n.ancillaryChunks)===void 0)t.push((await Promise.resolve().then(()=>(qn(),Wn))).encodeChunk(i,e,"Software","@lunapaint/png-codec"));else for(let s of n.ancillaryChunks)switch(s.type){case"tEXt":t.push((await Promise.resolve().then(()=>(qn(),Wn))).encodeChunk(i,e,s.keyword,s.text));break;default:throw new Error(`Cannot encode chunk type "${s.type}"`)}t.push(Wo());let r=t.reduce((s,f)=>s+f.length,0),o=new Uint8Array(r),a=0;for(let s of t)o.set(s,a),a+=s.length;return{data:o,warnings:i.warnings,info:i.info}}function Uf(){let e=new De(8);return e.writeUint8(137),e.writeUint8(80),e.writeUint8(78),e.writeUint8(71),e.writeUint8(13),e.writeUint8(10),e.writeUint8(26),e.writeUint8(10),e.assertAtEnd(),e.array}function Af(e,n={}){let t=[],i=[],o=e.width*e.height*4,a=new Set,s=new Set,f=0;if(e.data.BYTES_PER_ELEMENT===2)for(let h=0;h<o;h+=4)f=e.data[h]<<48|e.data[h+1]<<32|e.data[h+2]<<16|e.data[h+3],e.data[h+3]<65535&&s.add(f),a.add(f);else for(let h=0;h<o;h+=4)f=e.data[h]<<24|e.data[h+1]<<16|e.data[h+2]<<8|e.data[h+3],e.data[h+3]<255&&s.add(f),a.add(f);let l=n.colorType;l===void 0&&(a.size>256||e.data.BYTES_PER_ELEMENT===2?l=2:l=3);let d;switch(l){case 0:case 2:d=s.size===1,!d&&s.size>1&&(l=l===2?6:4,n.colorType===2&&oi({options:n,warnings:t},new nt(`Cannot encode image as color type Truecolor as it contains ${s.size} transparent colors`,0)));break;case 3:d=s.size>0;break;default:d=!1}return n.colorType===void 0&&i.push(`Using color type ${l}`),{colorType:l,bitDepth:e.data.BYTES_PER_ELEMENT===2?16:8,interlaceMethod:0,colorSet:a,transparentColorCount:s.size,firstTransparentColor:s.size>0?s.values().next().value:void 0,useTransparencyChunk:d,options:n,warnings:t,info:i}}var Xo=S(()=>{nn();Oo();qo();Zo();zt()});var Jo={};M(Jo,{DecodeError:()=>q,DecodeWarning:()=>ae,EncodeError:()=>Be,EncodeWarning:()=>nt,decodePng:()=>Rf,encodePng:()=>Lf});async function Rf(e,n){return(await Promise.resolve().then(()=>(zo(),Fo))).decodePng(e,n)}async function Lf(e,n){return(await Promise.resolve().then(()=>(Xo(),Ko))).encodePng(e,n)}var Qo=S(()=>{z();zt()});var ea={};M(ea,{DecodeError:()=>Te,DecodeWarning:()=>K,handleWarning:()=>ne});function ne(e,n){if(e.options.strictMode)throw n;e.warnings.push(n)}var Te,K,St=S(()=>{Te=class extends Error{constructor(n,t,i){super(t);this.offset=i,this.partiallyDecodedImage={details:{header:n.header,footer:n.footer,imageId:n.identificationField,developerDirectory:n.developerDirectory,extensionArea:n.extensionArea},warnings:n.warnings}}},K=class extends Error{constructor(n,t){super(n);this.offset=t}}});var Hn,ta=S(()=>{Hn=class{constructor(n,t){this.data=n,this._le=t,this.offset=0,this.view=new DataView(n.buffer,n.byteOffset,n.byteLength)}readUint8(){return this.view.getUint8(this.offset++)}readUint16(){let n=this.view.getUint16(this.offset,this._le);return this.offset+=2,n}readUint32(){let n=this.view.getUint32(this.offset,this._le);return this.offset+=4,n}}});function Ie(e,n,t,i){let r=[],o=0,a=0,s=e.reader.offset;for(;a<t;a++){try{o=e.reader.view.getUint8(e.reader.offset)}catch(f){throw f instanceof Error&&f.message==="Offset is outside the bounds of the DataView"&&ne(e,new K("EOF while reading text",e.reader.offset)),f}if(!i&&o===0)break;e.reader.offset++,r.push(o)}return e.reader.offset=s+t,n?n.decode(new Uint8Array(r)):String.fromCharCode(...r)}var na=S(()=>{St()});function ia(e){return e===1||e===2||e===3||e===9||e===10||e===11}function ra(e){return e===15||e===16||e===24||e===32}function oa(e,n){return n===1||n===9?e===8:n===3||n===11?e===8||e===16:e===15||e===16||e===24||e===32}var aa=S(()=>{});var fa={};M(fa,{decodeTga:()=>Mf});async function Mf(e,n={}){var t,i;let r={reader:new Hn(e,!0),hasAlpha:!1,ambiguousAlpha:!1,options:n,warnings:[]},o=Bf(r),a=Bt(Mt({},r),{header:o});a.identificationField=Ie(a,void 0,a.header.idLength);let s=a.reader.offset;return a.footer=Gf(a),a.extensionArea=Wf(a),a.developerDirectory=qf(a),a.reader.offset=s,((t=a.header.colorMap)===null||t===void 0?void 0:t.type)===1&&(a.colorMap=Ff(a,a.header.colorMap)),a.hasAlpha=a.colorMap&&((i=a.header.colorMap)===null||i===void 0?void 0:i.depth)===32||(a.header.attributeBitsPerPixel>0||a.header.bitDepth===32)&&(a.extensionArea===void 0||a.extensionArea.attributesType>2),a.ambiguousAlpha=a.hasAlpha&&a.header.attributeBitsPerPixel===0,a.image=zf(a,a.reader.offset),{image:a.image,details:{header:a.header,imageId:a.identificationField,footer:a.footer,extensionArea:a.extensionArea,developerDirectory:a.developerDirectory},warnings:a.warnings}}function Bf(e){let n=e.reader.readUint8(),t=e.reader.readUint8(),i;t===0||t===1?i=t:(ne(e,new K("Color map type unrecognized",e.reader.offset-1)),i=2);let r=e.reader.readUint8();if(!ia(r))throw new Te(e,`Invalid image type "${r}"`,e.reader.offset-1);i===1&&r!==1&&r!==9&&ne(e,new K(`Image type "${r}" cannot have a color map`,e.reader.offset-2));let o=e.reader.readUint16(),a=e.reader.readUint16(),s=e.reader.readUint8();if(i===1&&(o>=a&&ne(e,new K(`Color map origin "${o}" is greater than color map length "${a}"`,e.reader.offset-5)),!ra(s)))throw new Te(e,`Unsupported color map bit depth "${s}"`,e.reader.offset-1);let f=e.reader.readUint16(),l=e.reader.readUint16(),d=e.reader.readUint16(),h=e.reader.readUint16(),u=e.reader.readUint8();if(!oa(u,r))throw new Te(e,`Unsupported TGA bit depth "${u}" with image type ${r}`,16);let c=e.reader.readUint8(),p=(c&15)>>0,E=(c&48)>>4;return{idLength:n,colorMap:i!==0?{type:i,depth:s,length:a,origin:o}:void 0,imageType:r,origin:{x:f,y:l},width:d,height:h,bitDepth:u,imageDescriptor:c,attributeBitsPerPixel:p,screenOrigin:E}}function Ff(e,n){let t=e.reader.offset,i=Math.ceil(n.depth/8);e.reader.offset+=n.length*i;let r;switch(n.depth){case 15:r=on;break;case 16:e.hasAlpha?r=sa:r=on;break;case 24:r=la;break;case 32:r=da;break}return(o,a,s,f)=>{let l=s.getUint8(f);return r(o,a,e.reader.view,t+l*i),1}}function zf(e,n){let t={width:e.header.width,height:e.header.height,data:new Uint8Array(e.header.width*e.header.height*4)},i;if(e.colorMap)i=e.colorMap;else switch(e.header.bitDepth){case 8:i=Pf;break;case 15:i=on;break;case 16:e.header.imageType===11||e.header.imageType===3?i=Nf:e.hasAlpha?i=sa:i=on;break;case 24:i=la;break;case 32:e.hasAlpha?i=da:i=Of;break}let r=e.reader.view;if(e.header.imageType&8){let o=$f(e);r=new DataView(o.buffer,o.byteOffset,o.length),n=0}if(e.header.screenOrigin===2){let o=0;for(let a=0;a<t.height;a++)for(let s=0;s<t.width;s++)n+=i(t.data,o,r,n),o+=4}else{let o=0;for(let a=t.height-1;a>=0;a--){o=e.header.width*a*4;for(let s=0;s<t.width;s++)n+=i(t.data,o,r,n),o+=4}}if(e.ambiguousAlpha&&!e.options.strictMode&&e.options.detectAmbiguousAlphaChannel){let o=!1;for(let a=3;a<t.width*t.height*4;a+=4)t.data[a]>0&&(o=!0);if(!o){ne(e,new K("Image has ambiguous alpha and is fully transparent, alpha has been disabled",-1));for(let a=3;a<t.width*t.height*4;a+=4)t.data[a]=255}}return t}function $f(e){let n=Math.ceil(e.header.bitDepth/8),t=new Uint8Array(e.header.width*e.header.height*n),i=0,r=0,o=0,a=0,s=0;for(;o<t.length-1;)if(i=e.reader.readUint8(),r=(i&127)+1,i&128){for(a=0;a<n;a++)for(i=e.reader.readUint8(),s=0;s<r;s++)t[o+s*n+a]=i;o+=r*n}else{r*=n;for(let f=0;f<r;f++)t[o++]=e.reader.readUint8()}return t}function Pf(e,n,t,i){return e[n]=t.getUint8(i),e[n+1]=e[n],e[n+2]=e[n],e[n+3]=255,1}function Nf(e,n,t,i){return e[n]=t.getUint8(i),e[n+1]=e[n],e[n+2]=e[n],e[n+3]=t.getUint8(i+1),2}function on(e,n,t,i){return we=t.getUint16(i,!0),e[n]=we>>10&31,e[n+1]=we>>5&31,e[n+2]=we&31,e[n]=e[n]<<3|e[n]>>2,e[n+1]=e[n+1]<<3|e[n+1]>>2,e[n+2]=e[n+2]<<3|e[n+2]>>2,e[n+3]=255,2}function sa(e,n,t,i){return we=t.getUint16(i,!0),e[n]=we>>10&31,e[n+1]=we>>5&31,e[n+2]=we&31,e[n]=e[n]<<3|e[n]>>2,e[n+1]=e[n+1]<<3|e[n+1]>>2,e[n+2]=e[n+2]<<3|e[n+2]>>2,e[n+3]=we&32768?0:255,2}function la(e,n,t,i){return e[n]=t.getUint8(i+2),e[n+1]=t.getUint8(i+1),e[n+2]=t.getUint8(i),e[n+3]=255,3}function da(e,n,t,i){return e[n]=t.getUint8(i+2),e[n+1]=t.getUint8(i+1),e[n+2]=t.getUint8(i),e[n+3]=t.getUint8(i+3),4}function Of(e,n,t,i){return e[n]=t.getUint8(i+2),e[n+1]=t.getUint8(i+1),e[n+2]=t.getUint8(i),e[n+3]=255,4}function Wf(e){var n;if(((n=e.footer)===null||n===void 0?void 0:n.extensionAreaOffset)===void 0||e.footer.extensionAreaOffset===0)return;e.reader.offset=e.footer.extensionAreaOffset;let t=e.reader.readUint16();t!==495&&ne(e,new K("TGA file is a version other than v2",e.reader.offset-2));let i=Ie(e,void 0,41).trim()||void 0,r=Ie(e,void 0,324).trim()||void 0,o=Hf(e),a=Ie(e,void 0,41).trim()||void 0,s=Zf(e),f=Ie(e,void 0,41).trim()||void 0,l=e.reader.readUint8()/100,d=Ie(e,void 0,2),h;l===0&&(d===" "||d.length===0)?h=void 0:h=`${l}${d}`;let u=e.reader.readUint8(),c=e.reader.readUint8(),p=e.reader.readUint8(),E=e.reader.readUint8(),v;u===0&&c===0&&p===0&&E===0?v=void 0:v=new Uint8Array([c,p,E,u]);let w=e.reader.readUint16(),m=e.reader.readUint16(),g;m===0?g=void 0:g=w/m;let _=e.reader.readUint16(),I=e.reader.readUint16(),$;I===0?$=void 0:$=_/I;let b=e.reader.readUint32(),U=e.reader.readUint32(),T=e.reader.readUint32(),y=e.reader.readUint8();return{extensionSize:t,authorName:i,authorComments:r,dateTimestamp:o,jobName:a,jobTime:s,softwareId:f,softwareVersion:h,keyColor:v,aspectRatio:g,gamma:$,colorCorrectionOffset:b,postageStampOffset:U,scanLineOffset:T,attributesType:y}}function qf(e){var n;if(((n=e.footer)===null||n===void 0?void 0:n.developerDirectoryOffset)===void 0||e.footer.developerDirectoryOffset===0)return[];e.reader.offset=e.footer.developerDirectoryOffset;let t=e.reader.readUint16(),i=[];for(let r=0;r<t;r++){let o=e.reader.readUint16(),a=e.reader.readUint32(),s=e.reader.readUint32();i.push({tag:o,offset:a,length:s})}return i}function Hf(e){let n=e.reader.readUint16(),t=e.reader.readUint16(),i=e.reader.readUint16(),r=e.reader.readUint16(),o=e.reader.readUint16(),a=e.reader.readUint16();if(!(n===0&&t===0&&i===0&&r===0&&o===0&&a===0))return new Date(i,n,t,r,o,a)}function Zf(e){let n=e.reader.readUint16(),t=e.reader.readUint16(),i=e.reader.readUint16();if(!(n===0&&t===0&&i===0))return{hours:n,minutes:t,seconds:i}}function Gf(e){if(e.reader.offset=e.reader.view.byteLength-26+8,Ie(e,void 0,17)!=="TRUEVISION-XFILE."||e.reader.readUint8()!==0)return{extensionAreaOffset:0,developerDirectoryOffset:0};e.reader.offset=e.reader.view.byteLength-26;let t=e.reader.readUint32();t>=e.reader.view.byteLength&&(ne(e,new K(`Extension area offset "${t}" is invalid`,e.reader.offset-4)),t=0);let i=e.reader.readUint32();return i>=e.reader.view.byteLength&&(ne(e,new K(`Developer directory offset "${i}" is invalid`,e.reader.offset-4)),i=0),{extensionAreaOffset:t,developerDirectoryOffset:i}}var we,ha=S(()=>{St();ta();na();aa();we=0});var ca={};M(ca,{DecodeError:()=>Te,DecodeWarning:()=>K,decodeTga:()=>jf});async function jf(e,n){return(await Promise.resolve().then(()=>(ha(),fa))).decodeTga(e,n)}var ua=S(()=>{St()});var ga=oe(Ke=>{"use strict";var Vf=Ke&&Ke.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.activateInspectImageFileContribution=void 0;var xt=require("path"),ge=require("vscode"),Yf=(Qo(),Ft(Jo)),Kf=(z(),Ft(ri)),Xf=(ua(),Ft(ca)),Jf=(St(),Ft(ea));function Qf(e){e.subscriptions.push(ge.commands.registerCommand("luna.file.inspectImageFile",n=>Vf(this,void 0,void 0,function*(){var t,i;if(!n){let o=(t=ge.window.tabGroups.activeTabGroup.activeTab)===null||t===void 0?void 0:t.input;if(o&&"uri"in o?n=o.uri:n=(i=ge.window.activeTextEditor)===null||i===void 0?void 0:i.document.uri,!n||(0,xt.extname)(n.fsPath)!==".png"&&(0,xt.extname)(n.fsPath)!==".tga")return}let r=(0,xt.extname)(n.fsPath);switch(r){case".png":{let o=yield ge.workspace.fs.readFile(n),a,s;try{a=yield(0,Yf.decodePng)(o,{parseChunkTypes:"*"})}catch(l){s=l}let f=yield ge.workspace.openTextDocument({content:eh(n,a,s),language:"markdown"});yield ge.window.showTextDocument(f);break}case".tga":case".tpic":{let o=yield ge.workspace.fs.readFile(n),a,s;try{a=yield(0,Xf.decodeTga)(o,{detectAmbiguousAlphaChannel:!0})}catch(l){s=l}let f=yield ge.workspace.openTextDocument({content:th(n,a,s),language:"markdown"});yield ge.window.showTextDocument(f);break}default:throw new Error(`Cannot inspect file type ${r}`)}})))}Ke.activateInspectImageFileContribution=Qf;function eh(e,n,t){let i=`# ${(0,xt.basename)(e.path)}`;i+=`

`;let r,o;if(n)r=n;else{if(!t)return i+="Could not decode png or get decode error",i;if(!(t instanceof Kf.DecodeError))return t instanceof Error?i+=`Could not be decoded due to an unexpected exception:

`:i+=`Unexpected error type:

`,i;o=t,r=t.partiallyDecodedImage}return r.details&&(i+=`## Details

`,i+=`- Width: ${r.details.width}
`,i+=`- Height: ${r.details.height}
`,i+=`- Bit depth: ${r.details.bitDepth}
`,i+=`- Color type: ${nh(r.details.colorType)} (${r.details.colorType})
`,i+=`- Interlace method: ${r.details.interlaceMethod===1?"Adam7":"None"}
`,i+=`
`),i+=_a(r.info||[],r.warnings||[],o),i+=`## Metadata

`,r.metadata&&r.metadata.length>0?(i+="```json\n",i+=pa(r.metadata),i+=`
`,i+="```"):i+="No recognized metadata",i+=`

`,r.rawChunks&&r.rawChunks.length>0&&(i+=`## Raw chunks

`,i+="```json\n",i+=pa(r.rawChunks),i+=`
`,i+="```",i+=`

`),r.image&&(i+=wa(r.image)),i}function th(e,n,t){let i=`# ${(0,xt.basename)(e.path)}`;i+=`

`;let r,o;if(n)r=n;else{if(!t)return i+="Could not decode tga or get decode error",i;if(!(t instanceof Jf.DecodeError))return t instanceof Error?i+=`Could not be decoded due to an unexpected exception:

`:i+=`Unexpected error type:

`,i;o=t,r=t.partiallyDecodedImage}return r.details&&(i+=`## Details

`,r.details.header&&(i+=`- Width: ${r.details.header.width}
`,i+=`- Height: ${r.details.header.height}
`),i+=`- Image identifier: ${r.details.imageId}
`,r.details.footer&&(i+=`- Extension area offset: ${r.details.footer.extensionAreaOffset}
`,i+=`- Developer directory offset: ${r.details.footer.developerDirectoryOffset}
`),i+=`
`),i+=_a([],r.warnings||[],o),r.image&&(i+=wa(r.image)),i}function pa(e){return JSON.stringify(e,(n,t)=>[Uint8Array,Uint16Array].some(i=>t instanceof i)?Array.from(t):t,2)}function nh(e){switch(e){case 0:return"Grayscale";case 2:return"Truecolor";case 3:return"Indexed";case 4:return"Grayacale and alpha";case 6:return"Truecolor and alpha"}return""}function _a(e,n,t){let i="";if(e.length||n.length>0||t){i+=`## Problems encountered

`;for(let r of e)i+=`- \`INFO\` ${r}
`;for(let r of n)i+=`- \`WARN\` ${r.message} (offset: 0x${r.offset.toString(16)})
`;t&&(i+=`- \`ERROR\` ${t.message} (offset: 0x${t.offset.toString(16)})
`),i+=`
`}return i}function wa(e){let n="";n+=`## Raw rgba data as json

`,n+=`[
`;let t=e.width*4,i=e.data.BYTES_PER_ELEMENT===2?5:3,r=0;for(let o=0;o<e.data.length;o++)n+=`${o!==0?",":""}`,o%t!==0&&o%4===0&&(n+=" "),r===t&&(n+=`
`,r=0),r++,n+=e.data[o].toString().padStart(i," ");return n+=`
]`,n+=`
`,n}});var Dt=oe(j=>{"use strict";var Zn;Object.defineProperty(j,"__esModule",{value:!0});j.isLinux=j.isWindows=j.isMac=j.isWeb=j.globals=void 0;j.globals=typeof self=="object"?self:typeof global=="object"?global:{};var he;typeof j.globals.vscode!="undefined"&&typeof j.globals.vscode.process!="undefined"?he=j.globals.vscode.process:typeof process!="undefined"&&(he=process);var ih=typeof((Zn=he==null?void 0:he.versions)===null||Zn===void 0?void 0:Zn.electron)=="string"&&he.type==="renderer",Gn=!1,jn=!1,Vn=!1,Yn=!1;typeof navigator=="object"&&!ih?(Gn=!0,Vn=navigator.userAgent.indexOf("Windows")>=0,jn=navigator.userAgent.indexOf("Macintosh")>=0,Yn=navigator.userAgent.indexOf("Linux")>=0):typeof he=="object"&&(Gn=!1,Vn=he.platform==="win32",jn=he.platform==="darwin",Yn=he.platform==="linux");j.isWeb=Gn;j.isMac=jn;j.isWindows=Vn;j.isLinux=Yn});var an=oe(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.mixinGlobalState=Ue.getWorkbenchState=Ue.getGlobalState=void 0;function va(e,n){let t=e.workspaceState.get("workbenchState"),i=t==null?void 0:t[n];return!i||i.version!==3?{version:3,entries:[]}:i}function ba(e){return va(e,"global")}Ue.getGlobalState=ba;function rh(e,n){let t=va(e,n.toString());return ma(e,t),t}Ue.getWorkbenchState=rh;function ma(e,n){let t=ba(e);for(let i of t.entries){let r=n.entries.findIndex(o=>o.id===i.id);n.entries.splice(r,1)}n.entries.push(...t.entries)}Ue.mixinGlobalState=ma});var Kn=oe(Ae=>{"use strict";var ya=Ae&&Ae.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(Ae,"__esModule",{value:!0});Ae.saveBackupData=Ae.getBackupData=void 0;var Ca=require("vscode"),ka=Dt(),oh=an();function ah(e,n){return ya(this,void 0,void 0,function*(){let t=yield Ca.workspace.fs.readFile(n);if(ka.isWeb){if(!self.TextDecoder)return console.warn("This browser doesn't support TextEncoder"),{};let f=new self.TextDecoder().decode(t),l=Ea(f==null?void 0:f.state),d=f==null?void 0:f.workbenchState;return{state:l,workbenchState:d}}let r=new(yield Promise.resolve().then(()=>require("v8"))).Deserializer(t).readValue(),o=Ea(r==null?void 0:r.state),a=r==null?void 0:r.workbenchState;return(0,oh.mixinGlobalState)(e,a),{state:o,workbenchState:a}})}Ae.getBackupData=ah;function sh(e,n){return ya(this,void 0,void 0,function*(){let t;if(ka.isWeb)if(self.TextEncoder)t=new self.TextEncoder().encode(JSON.stringify(n));else throw new Error("This browser doesn't support TextEncoder");else{let i=new(yield Promise.resolve().then(()=>require("v8"))).Serializer;i.writeValue(n),t=i.releaseBuffer()}yield Ca.workspace.fs.writeFile(e,t)})}Ae.saveBackupData=sh;function Ea(e){if(typeof e!="object"||e===null)return;let n=e;if(!(!("version"in n)||n.version!==8)&&("body"in n||typeof n.body!="object"))return{version:n.version,body:n.body}}});var xa=oe(Xe=>{"use strict";Object.defineProperty(Xe,"__esModule",{value:!0});Xe.deserializeFromJson=Xe.serializeToJson=void 0;function Sa(e){if(!e||typeof e!="object")return e;let n={};for(let t of Object.keys(e)){let i=e[t];typeof i=="object"?"readyPromise"in i?n[t]=lh(i):i instanceof Float32Array?n[t]=sn(i,"Float32Array"):i instanceof Uint8Array?n[t]=sn(i,"Uint8Array"):i instanceof Uint16Array?n[t]=sn(i,"Uint16Array"):i instanceof Uint32Array?n[t]=sn(i,"Uint32Array"):n[t]=i:n[t]=i}return n}Xe.serializeToJson=Sa;function Xn(e){if(!e||typeof e!="object")return e;let n={};for(let t of Object.keys(e)){let i=e[t];typeof i=="object"?"dataType"in i?i.dataType==="pending"?n[t]=dh(i):n[t]=fh(i):n[t]=Xn(i):n[t]=i}return n}Xe.deserializeFromJson=Xn;function lh(e){return{dataType:"pending",data:Sa(e.resource)}}function dh(e){let n=Xn(e.data);return{resource:n,readyPromise:Promise.resolve(n),isReady:!0}}function sn(e,n){return{dataType:n,data:Array.from(e)}}function fh(e){return new global[e.dataType](e.data)}});var Aa=oe(Je=>{"use strict";var Da=Je&&Je.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(Je,"__esModule",{value:!0});Je.WebviewIpcClient=void 0;var Ta=xa(),Ia=Dt(),Ua=class{constructor(n){this._webview=n,this._webviewRequestHandlers=new Map,this._activeRequests=new Map,this._webview.onDidReceiveMessage(t=>Da(this,void 0,void 0,function*(){if("extHostRequestId"in t){let i=t.extHostRequestId,r=this._activeRequests.get(i);if(!r)throw new Error(`Response received without request "${i}"`);this._activeRequests.delete(i),r(Ia.isWeb?(0,Ta.deserializeFromJson)(t.body):t.body);return}if("webviewRequestId"in t){let i=this._webviewRequestHandlers.get(t.type);if(!i)throw new Error(`No handler for webview request "${t.type}"`);let r=yield i(t.body),o={type:t.type,body:Ia.isWeb?(0,Ta.serializeToJson)(r):r,webviewRequestId:t.webviewRequestId};this._webview.postMessage(o);return}}))}registerRequestHandler(n,t){if(this._webviewRequestHandlers.has(n))throw new Error(`Duplicate webview request handler "${n}"`);this._webviewRequestHandlers.set(n,t)}request(n,t){return Da(this,void 0,void 0,function*(){let i=Math.round(Math.random()*1e6);return yield new Promise(o=>{this._activeRequests.set(i,o);let a={type:n,body:t,extHostRequestId:i};this._webview.postMessage(a)})})}};Je.WebviewIpcClient=Ua});var La=oe(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.disposeArray=Qe.Disposable=void 0;var Ra=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){if(this._isDisposed)throw new Error("Attempt to dispose a disposed entity");this._isDisposed=!0;for(let n of this._disposables)n.dispose();this._disposables.length=0}register(n){return this._disposables.push(n),n}unregister(n){let t=this._disposables.indexOf(n);t!==-1&&this._disposables.splice(t,1)}};Qe.Disposable=Ra;function hh(e){for(let n of e)n.dispose();e.length=0}Qe.disposeArray=hh});var Jn=oe(ln=>{"use strict";Object.defineProperty(ln,"__esModule",{value:!0});ln.perf=void 0;var ch=Dt();ln.perf=ch.isWeb?self.performance:require("perf_hooks").performance});var Wa=oe(ie=>{"use strict";var W=ie&&ie.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(ie,"__esModule",{value:!0});ie.setVscodeContext=ie.BuiltInCommands=ie.ImageDocument=void 0;var uh=require("path"),L=require("vscode"),Ma=Kn(),ph=Aa(),Ba=La(),ee=Jn(),Fa=an(),za=class extends Ba.Disposable{constructor(n,t,i,r){var o;super();if(this._context=n,this.uri=t,this._initData=i,this._isInitialized=!1,this._editIndex=0,this._savedEditIndex=0,this._hasContentChanged=!1,this._fileWatcherDisposables=[],this._isActive=!1,this._globalState=new Map,this._workbenchState=new Map,this._perfMetrics={startEvent:0,webviewReadyEvent:0,dataReadyEvent:0,finishEvent:0,totalDuration:0,parseDuration:0,dataTransportDuration:0},this._onDisposed=new L.EventEmitter,this.onDisposed=this._onDisposed.event,this._onDidChange=new L.EventEmitter,this.onDidChange=this._onDidChange.event,this._onDidUpdateGlobalState=new L.EventEmitter,this.onDidUpdateGlobalState=this._onDidUpdateGlobalState.event,this._onRequestReload=new L.EventEmitter,this.onRequestReload=this._onRequestReload.event,this._onMimeTypeChange=new L.EventEmitter,this.onMimeTypeChange=this._onMimeTypeChange.event,this._onDidEncounterDecodeProblem=new L.EventEmitter,this.onDidEncounterDecodeProblem=this._onDidEncounterDecodeProblem.event,((o=this._initData.workbenchState)===null||o===void 0?void 0:o.version)===3)for(let a of this._initData.workbenchState.entries)this._workbenchState.set(a.id,a.state);this._perfMetrics.startEvent=r!==void 0?r:ee.perf.now(),this._setupFileWatcher(t)}get ipcClient(){return this._ipcClient}get isActive(){return this._isActive}set isActive(n){this._isActive=n,this._isActive&&this._hasContentChanged&&this._showContentChangedWarning()}get _isDirty(){return this._editIndex!==this._savedEditIndex}dispose(){let n=this._context.workspaceState.get("workbenchState");n&&this.uri.toString()in n&&(delete n[this.uri.toString()],this._context.workspaceState.update("workbenchState",n)),this._onDisposed.fire(),super.dispose()}_setupFileWatcher(n){var t;if(((t=this._fileWatcherUri)===null||t===void 0?void 0:t.toString())===n.toString())return;this._fileWatcherUri=n,(0,Ba.disposeArray)(this._fileWatcherDisposables);let i=L.workspace.createFileSystemWatcher(new L.RelativePattern(n,"*"));this._fileWatcherDisposables.push(i),this._fileWatcherDisposables.push(i.onDidChange(()=>W(this,void 0,void 0,function*(){return this._handleFileChangeEvent(n)}))),this._fileWatcherDisposables.push(i.onDidCreate(()=>W(this,void 0,void 0,function*(){return this._handleFileChangeEvent(n)})))}_handleFileChangeEvent(n){return W(this,void 0,void 0,function*(){let t=yield L.workspace.fs.stat(n);if(!(this._lastSaveStat&&wh(t,yield this._lastSaveStat))){if(!this._isActive){this._hasContentChanged=!0;return}if(this._isDirty){yield this._showContentChangedWarning();return}this._onRequestReload.fire()}})}_showContentChangedWarning(){return W(this,void 0,void 0,function*(){(yield L.window.showWarningMessage("The image changed on disk, do you want to reload the file?","Reload"))==="Reload"&&(yield L.commands.executeCommand("workbench.action.files.revert"),this._onRequestReload.fire())})}getIpcClientOrThrow(){if(!this._ipcClient)throw new Error(`No IPC client for document ${this.uri.toString()}`);return this._ipcClient}save(n){return W(this,void 0,void 0,function*(){if(!this._isDirty){console.warn("Attempt to save when not dirty");return}yield this.saveAs(this.uri,n)})}saveAs(n,t){return W(this,void 0,void 0,function*(){let i=this.getIpcClientOrThrow(),r={startEvent:ee.perf.now(),writeStartEvent:0,writeFinishEvent:0,finishEvent:0,encodeDuration:0,dataTransportDuration:0,totalDuration:0},o=L.workspace.getConfiguration("files").get("autoSave")!=="off",a=yield i.request("save",{isAutoSaveEnabled:o});if(t.isCancellationRequested)return;r.encodeDuration=a.encodeDuration,r.writeStartEvent=ee.perf.now(),r.dataTransportDuration=r.writeStartEvent-r.startEvent-r.encodeDuration;let s=new Uint8Array(a.blobBuffer);yield L.workspace.fs.writeFile(n,s),r.writeFinishEvent=ee.perf.now(),this._lastSaveStat=L.workspace.fs.stat(n),yield this._lastSaveStat,this._setupFileWatcher(n),this._savedEditIndex=this._editIndex,this._latestBackupUri&&(yield L.workspace.fs.delete(this._latestBackupUri),this._latestBackupUri=void 0,this._latestBackupContent=void 0),r.finishEvent=ee.perf.now(),r.totalDuration=r.finishEvent-r.startEvent,Oa(`Save perf: ${this.uri.fsPath}`,r)})}revert(){this._latestBackupUri=void 0,this._lastSaveStat=void 0,this._editIndex=0,this._savedEditIndex=0,this._hasContentChanged=!1,this._isInitialized=!0}backup(n,t){return W(this,void 0,void 0,function*(){let i=this.getIpcClientOrThrow(),r=L.workspace.getConfiguration().get("luna.hotExitMaxPixels",0),o=yield i.request("backup",{hotExitMaxPixels:r});if(t.isCancellationRequested)throw new Error("Backup canceled");if(!o.success)throw new Error("Could not backup file as it's too large");return yield(0,Ma.saveBackupData)(n.destination,{state:o.state,workbenchState:o.workbenchState}),this._latestBackupUri=n.destination,this._latestBackupContent=void 0,{id:n.destination.toString(),delete:()=>W(this,void 0,void 0,function*(){this._latestBackupUri&&this._latestBackupUri.toString()===n.destination.toString()&&(this._latestBackupContent=o.state);try{yield L.workspace.fs.delete(n.destination)}catch{}})}})}setupIpc(n){let t=new ph.WebviewIpcClient(n);return t.registerRequestHandler("backupClipboardData",i=>{this._initData.type==="newFromClipboard"&&(this._initData.data=i)}),t.registerRequestHandler("historyNewEdit",i=>{this._editIndex++,this._onDidChange.fire({document:this,label:i.label,redo:()=>W(this,void 0,void 0,function*(){if(this._editIndex++,!(yield t.request("luna.executeCommand","edit.redo")).success)throw new Error(`Could not redo entry "${i.label}"`)}),undo:()=>W(this,void 0,void 0,function*(){if(this._editIndex--,!(yield t.request("luna.executeCommand","edit.undo")).success)throw new Error(`Could not undo entry "${i.label}"`)})})}),t.registerRequestHandler("inputBoxNumber",i=>W(this,void 0,void 0,function*(){let r=yield L.window.showInputBox({title:i.title,prompt:i.prompt,value:i.defaultValue.toString(),validateInput:o=>Na(o,i.defaultValue,i.minValue,i.maxValue)});return r===void 0?void 0:Tt(r,i.defaultValue)})),t.registerRequestHandler("inputBoxNumberOrDimensionsShorthand",i=>W(this,void 0,void 0,function*(){let r=yield L.window.showInputBox({prompt:i.prompt,title:i.title,value:i.widthDefaultValue.toString(),validateInput:o=>{if(!_h(o))return Na(o,i.widthDefaultValue,i.minValue,i.maxValue)}});if(r==null?void 0:r.includes("x")){let o=r.split("x");return{width:Tt(o[0],i.widthDefaultValue),height:Tt(o[1],i.heightDefaultValue)}}return r===void 0?void 0:Tt(r,i.widthDefaultValue)})),t.registerRequestHandler("inputBoxString",i=>W(this,void 0,void 0,function*(){return yield L.window.showInputBox({prompt:i.prompt,value:i.defaultValue})})),t.registerRequestHandler("quickPick",i=>W(this,void 0,void 0,function*(){var r;return(r=yield L.window.showQuickPick(i.items,i.options))===null||r===void 0?void 0:r.id})),t.registerRequestHandler("vscode.executeCommand",i=>W(this,void 0,void 0,function*(){return L.commands.executeCommand(i.command,i.args)})),t.registerRequestHandler("vscode.setContext",i=>W(this,void 0,void 0,function*(){yield Pa(i.key,i.value)})),t.registerRequestHandler("ready",()=>W(this,void 0,void 0,function*(){this._perfMetrics.webviewReadyEvent=ee.perf.now();let i;if(!i&&this._workbenchState.size>0){i={version:3,entries:[]};for(let[r,o]of this._workbenchState.entries())i.entries.push({id:r,state:o});(0,Fa.mixinGlobalState)(this._context,i)}if(i||(i=(0,Fa.getWorkbenchState)(this._context,this.uri)),this._latestBackupUri){let r;if(this._latestBackupContent)r=this._latestBackupContent;else{let o=yield(0,Ma.getBackupData)(this._context,this._latestBackupUri);r=o.state,i=o.workbenchState}if(!r||r.version<8)L.window.showWarningMessage("Extension was updated, could not restore image from backup");else return this._perfMetrics.dataReadyEvent=ee.perf.now(),{type:"restore",config:this._getLunaConfig(),state:r,workbenchState:i,editIndex:this._editIndex,restoreHistory:!0}}if(!this._isInitialized)return this._isInitialized=!0,this._initData.workbenchState=i,this._perfMetrics.dataReadyEvent=ee.perf.now(),this._initData;try{let r=yield L.workspace.fs.readFile(this.uri);if(this._lastSaveStat=L.workspace.fs.stat(this.uri),yield this._lastSaveStat,r.length===0){let o=L.workspace.getConfiguration("luna.defaultImageSize",this.uri);return this._perfMetrics.dataReadyEvent=ee.perf.now(),{type:"new",config:this._getLunaConfig(),workbenchState:i,dimensions:{width:o.get("width",800),height:o.get("height",600)}}}return this._perfMetrics.dataReadyEvent=ee.perf.now(),{type:"open",config:this._getLunaConfig(),workbenchState:i,data:r,extName:(0,uh.extname)(this.uri.path),isReadonly:this._initData.isReadonly}}catch{return L.window.showInformationMessage("This image could not be restored from hot exit, try saving the file and/or turning the luna.retainContextWhenHidden setting on"),this._initData.workbenchState=i,this._perfMetrics.dataReadyEvent=ee.perf.now(),this._initData}})),t.registerRequestHandler("parseFinished",i=>W(this,void 0,void 0,function*(){this._perfMetrics.parseDuration=i.duration,this._perfMetrics.finishEvent=ee.perf.now(),this._perfMetrics.dataTransportDuration=this._perfMetrics.finishEvent-this._perfMetrics.dataReadyEvent-this._perfMetrics.parseDuration,this._perfMetrics.totalDuration=this._perfMetrics.finishEvent-this._perfMetrics.startEvent,Oa(`Open perf: ${this.uri.fsPath}`,this._perfMetrics)})),t.registerRequestHandler("reportIssue",()=>W(this,void 0,void 0,function*(){L.commands.executeCommand("workbench.action.openIssueReporter",{extensionId:"tyriar.luna-paint"})})),t.registerRequestHandler("setMimeType",i=>{this._onMimeTypeChange.fire(i)}),t.registerRequestHandler("showDecodeProblemStatusBarEntry",i=>{this._onDidEncounterDecodeProblem.fire(i.level)}),t.registerRequestHandler("updateWorkbenchState",i=>{i.global?this._globalState.set(i.id,i.state):this._workbenchState.set(i.id,i.state);let r=this._context.workspaceState.get("workbenchState")||{},o={version:3,entries:[]};if(i.global){for(let[a,s]of this._globalState.entries())o.entries.push({id:a,state:s});r.global=o}else{for(let[a,s]of this._workbenchState.entries())o.entries.push({id:a,state:s});r[this.uri.toString()]=o}this._context.workspaceState.update("workbenchState",r),i.global&&this._onDidUpdateGlobalState.fire(o)}),this._ipcClient=t,t}syncGlobalState(n){var t;return W(this,void 0,void 0,function*(){yield(t=this._ipcClient)===null||t===void 0?void 0:t.request("syncGlobalState",n)})}_getLunaConfig(){var n,t,i,r;let o=L.workspace.getConfiguration();return{mouseWheelBehavior:(n=o.get("luna.mouseWheelBehavior"))!==null&&n!==void 0?n:"scroll",snapToPixelGrid:(t=o.get("luna.snapToPixelGrid"))!==null&&t!==void 0?t:!0,statusBarPointerColor:(i=o.get("luna.statusBar.pointerColor"))!==null&&i!==void 0?i:"currentLayer",defaultTool:(r=o.get("luna.defaultTool"))!==null&&r!==void 0?r:"selection"}}};ie.ImageDocument=za;var $a;(function(e){e.SetContext="setContext"})($a=ie.BuiltInCommands||(ie.BuiltInCommands={}));function Pa(e,n){return L.commands.executeCommand($a.SetContext,e,n)}ie.setVscodeContext=Pa;function _h(e,n,t){return!!e.match(/^\d+%?x\d+%?/)}function Na(e,n,t,i){if(!e.match(/^[0-9]+%?$/))return"Enter a valid number";let r=Tt(e,n);if(t!==void 0&&r<t)return`Enter a number greater than or equal to ${t}`;if(i!==void 0&&r>i)return`Enter a number less than or equal to ${i}`}function Tt(e,n){return e.endsWith("%")?Math.round(parseInt(e)/100*n):parseInt(e)}function wh(e,n){return n?e.ctime===n.ctime&&e.mtime===n.mtime&&e.size===n.size:!1}function Oa(e,n){if(L.workspace.getConfiguration().get("luna.developer.logPerfMetrics")){let i={},r={};for(let o of Object.keys(n)){let a=n[o];o.endsWith("Event")?i[o]={"Time (ms)":parseFloat((a-n.startEvent).toFixed(2)),"Percent (%)":Math.round((n[o]-n.startEvent)/n.totalDuration*100)}:r[o]={"Duration (ms)":parseFloat(a.toFixed(2))}}console.info(`
${e}`),console.table(r),console.table(i)}}});var ja=oe(re=>{"use strict";var V=re&&re.__awaiter||function(e,n,t,i){function r(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(d){try{l(i.next(d))}catch(h){a(h)}}function f(d){try{l(i.throw(d))}catch(h){a(h)}}function l(d){d.done?o(d.value):r(d.value).then(s,f)}l((i=i.apply(e,n||[])).next())})};Object.defineProperty(re,"__esModule",{value:!0});re.setVscodeContext=re.BuiltInCommands=re.PaintEditorProvider=void 0;var qa=require("os"),et=require("path"),k=require("vscode"),gh=Kn(),It=Wa(),vh=Jn(),dn=Dt(),fn=an(),bh=["adjustments.invert","color.swapColors","edit.copy","edit.cut","edit.paste","edit.redo","edit.undo","help.reportIssue","image.cropToSelection","image.expandCanvasToSelection","image.resize","image.resizeCanvas","image.flipHorizontal","image.flipVertical","image.rotate180","image.rotate90Clockwise","image.rotate90CounterClockwise","image.flattenLayers","image.finishActiveAction","image.customizePointerColorStatusBarItem","image.addNewImage","image.deleteImage","image.goToTopImage","image.goToImageAbove","image.goToImageBelow","image.goToBottomImage","image.moveImageToTop","image.moveImageUp","image.moveImageDown","image.moveImageToBottom","layer.addNewLayer","layer.deleteLayer","layer.duplicateLayer","layer.mergeLayerDown","layer.renameLayer","layer.flipHorizontal","layer.flipVertical","layer.rotate180","layer.goToTopLayer","layer.goToLayerAbove","layer.goToLayerBelow","layer.goToBottomLayer","layer.moveLayerToTop","layer.moveLayerUp","layer.moveLayerDown","layer.moveLayerToBottom","selection.deselect","selection.selectAll","selection.erase","selection.eraseKeepSelection","tool.colorPicker","tool.crop","tool.eraser","tool.fill","tool.hand","tool.handUntilRelease","tool.pencil","tool.selection","tool.zoom","tool.line","tool.rectangle","tool.shape","tool.text","tool.toggleShapeTool","tool.movePixels","tool.moveSelection","tool.toggleMoveTool","view.focusCanvas","view.zoomIn","view.zoomOut","view.actualSize","view.fitToWindow","view.fitLayerToWindow","color.toggleColorsWindow","history.toggleHistoryWindow","image.toggleImagesWindow","layer.toggleLayersWindow","minimap.toggleMinimapWindow","palette.togglePaletteWindow","tool.toggleToolsWindow"],Re=class{constructor(n){this._context=n,this._onDidChangeCustomDocument=new k.EventEmitter,this.onDidChangeCustomDocument=this._onDidChangeCustomDocument.event,this._documents=new Map,this._webviewPanels=new Map,this._newImageRequest=new Map;for(let t of bh)this._context.subscriptions.push(k.commands.registerCommand(`luna.${t}`,()=>{var i;if(!this._lastActiveResource)return;let r=(i=this._documents.get(this._lastActiveResource.toString()))===null||i===void 0?void 0:i.ipcClient;if(!!r)return r.request("luna.executeCommand",t)}));this._context.subscriptions.push(k.commands.registerCommand("luna.file.new",t=>V(this,void 0,void 0,function*(){let i=k.workspace.getConfiguration("luna.defaultImageSize",this._lastActiveResource),r={width:i.get("width",800),height:i.get("height",600)},o=yield this._requestNewImageDimensions(r,t);if(!o)return;let a=yield this._getNewImageUri();this._newImageRequest.set(a.path,{width:o.width,height:o.height}),k.commands.executeCommand("vscode.openWith",a,Re.viewType)}))),k.workspace.onDidChangeConfiguration(t=>{var i;if(t.affectsConfiguration("luna")){let r=this._getLunaConfig();for(let o of this._documents.values())(i=o.ipcClient)===null||i===void 0||i.request("updateConfig",r)}}),this._context.subscriptions.push(k.commands.registerCommand("luna.file.newIcon",t=>V(this,void 0,void 0,function*(){let i={width:256,height:256},r=yield this._requestNewImageDimensions(i,t);if(!r)return;let o=yield this._getNewImageUri("image/x-ico");this._newImageRequest.set(o.path,{width:r.width,height:r.height,extName:".ico"}),k.commands.executeCommand("vscode.openWith",o,Re.viewType)}))),this._context.subscriptions.push(k.commands.registerCommand("luna.file.importFromClipboard",()=>V(this,void 0,void 0,function*(){let t=yield this._getNewImageUri();this._newImageRequest.set(t.path,"clipboard"),k.commands.executeCommand("vscode.openWith",t,Re.viewType)}))),this._context.subscriptions.push(k.commands.registerCommand("luna.file.newDefaultSize",()=>V(this,void 0,void 0,function*(){let t=yield this._getNewImageUri();this._newImageRequest.set(t.path,this._getDefaultImageSize(t)),k.commands.executeCommand("vscode.openWith",t,Re.viewType)}))),this._context.subscriptions.push(k.commands.registerCommand("luna.help.openDocumentation",()=>V(this,void 0,void 0,function*(){k.commands.executeCommand("workbench.action.openWalkthrough","Tyriar.luna-paint#welcome",!0)}))),this._context.subscriptions.push(k.commands.registerCommand("luna.help.hideAutoSaveWarning",()=>V(this,void 0,void 0,function*(){var t;(t=this._autoSaveWarningStatusBarItem)===null||t===void 0||t.dispose(),this._autoSaveWarningStatusBarItem=void 0}))),this._context.subscriptions.push(k.window.onDidChangeWindowState(t=>{var i;if(!t.focused)for(let r of this._documents.values())(i=r.ipcClient)===null||i===void 0||i.request("pauseanimations",void 0)})),this._context.subscriptions.push(k.window.onDidChangeActiveTextEditor(()=>{var t,i;this._mimeTypeStatusBarItem.hide(),(t=this._autoSaveWarningStatusBarItem)===null||t===void 0||t.hide(),(i=this._decodeWarningStatusBarItem)===null||i===void 0||i.hide()})),this._mimeTypeStatusBarItem=k.window.createStatusBarItem("luna-paint.mimeType",k.StatusBarAlignment.Right),this._mimeTypeStatusBarItem.name="Luna Paint - Mime Type",this._autoSaveWarningStatusBarItem=k.window.createStatusBarItem("luna-paint.autoSaveWarning",k.StatusBarAlignment.Right,1),this._autoSaveWarningStatusBarItem.name="Luna Paint - Auto Save Warning",this._autoSaveWarningStatusBarItem.text="$(warning) Auto Save is On",this._autoSaveWarningStatusBarItem.backgroundColor=new k.ThemeColor("statusBarItem.warningBackground"),this._autoSaveWarningStatusBarItem.color=new k.ThemeColor("statusBarItem.warningForeground"),this._autoSaveWarningStatusBarItem.tooltip="Auto save after delay is enabled which may cause performance issues while editing the image. Left click to dismiss this warning for this session, right click to hide it permanently.",this._autoSaveWarningStatusBarItem.command="luna.help.hideAutoSaveWarning",this._decodeWarningStatusBarItem=k.window.createStatusBarItem("luna-paint.decodeWarning",k.StatusBarAlignment.Right,2),this._decodeWarningStatusBarItem.name="Luna Paint - Decode Warning",this._decodeWarningStatusBarItem.text="$(warning) Decode Warning",this._decodeWarningStatusBarItem.backgroundColor=new k.ThemeColor("statusBarItem.warningBackground"),this._decodeWarningStatusBarItem.color=new k.ThemeColor("statusBarItem.warningForeground"),this._decodeWarningStatusBarItem.tooltip="Warning(s) were encountered while decoding this image which could indicate corruption. Left click to inspect the image file, right click to hide this warning permanently.",this._decodeErrorStatusBarItem=k.window.createStatusBarItem("luna-paint.decodeError",k.StatusBarAlignment.Right,3),this._decodeErrorStatusBarItem.name="Luna Paint - Decode Error",this._decodeErrorStatusBarItem.text="$(error) Decode Error",this._decodeErrorStatusBarItem.backgroundColor=new k.ThemeColor("statusBarItem.errorBackground"),this._decodeErrorStatusBarItem.color=new k.ThemeColor("statusBarItem.errorForeground"),this._decodeErrorStatusBarItem.tooltip="A critical error was encountered while decoding this image. Left click to inspect the image file, right click to hide this warning permanently."}saveCustomDocument(n,t){return V(this,void 0,void 0,function*(){return n.save(t)})}saveCustomDocumentAs(n,t,i){return V(this,void 0,void 0,function*(){yield n.saveAs(t,i)})}revertCustomDocument(n,t){return V(this,void 0,void 0,function*(){let i=n.getIpcClientOrThrow(),r=yield k.workspace.fs.readFile(n.uri);n.revert(),yield i.request("open",{data:r,extName:(0,et.extname)(n.uri.path)})})}backupCustomDocument(n,t,i){return V(this,void 0,void 0,function*(){try{return yield n.backup(t,i)}catch(r){throw console.error("Backup failed",r),r}})}openCustomDocument(n,t,i){return V(this,void 0,void 0,function*(){let r;if(r=this._documents.get(n.toString()),r)return r;if(t.backupId){let a=k.Uri.parse(t.backupId);try{let{state:s,workbenchState:f}=yield(0,gh.getBackupData)(this._context,a);s?r=new It.ImageDocument(this._context,n,{type:"restore",config:this._getLunaConfig(),state:s,workbenchState:f,restoreHistory:!1}):(k.window.showWarningMessage("The extension was updated, could not restore the image from backup"),r=yield this._createOpenImageDocument(n))}catch{r=yield this._createOpenImageDocument(n)}}else{let a=this._newImageRequest.get(n.path);a?(a==="clipboard"?r=new It.ImageDocument(this._context,n,{type:"newFromClipboard",config:this._getLunaConfig(),workbenchState:(0,fn.getGlobalState)(this._context),fallbackDimensions:this._getDefaultImageSize(n)}):r=new It.ImageDocument(this._context,n,{type:"new",config:this._getLunaConfig(),workbenchState:(0,fn.getGlobalState)(this._context),dimensions:{width:a.width,height:a.height},extName:a.extName}),this._newImageRequest.delete(n.path)):r=yield this._createOpenImageDocument(n)}r.onDidChange(a=>this._onDidChangeCustomDocument.fire(a));let o=r;return r.onDidUpdateGlobalState(a=>this._syncGlobalState(a,o)),r.onMimeTypeChange(a=>{this._mimeTypeStatusBarItem.text=mh(a),this._mimeTypeStatusBarItem.tooltip=a,this._mimeTypeStatusBarItem.show()}),r.onDidEncounterDecodeProblem(a=>{let s=a==="warning"?this._decodeWarningStatusBarItem:this._decodeErrorStatusBarItem;s&&(s.command={command:"luna.file.inspectImageFile",title:"Inspect Image File",arguments:[r==null?void 0:r.uri]},s.show())}),this._documents.set(n.toString(),r),r.onDisposed(()=>this._documents.delete(n.toString())),r})}_syncGlobalState(n,t){if(this._documents.size!==1)for(let i of this._documents.values())i!==t&&i.syncGlobalState(n)}_getNewImageUri(n="image/png"){return V(this,void 0,void 0,function*(){let t=k.workspace.workspaceFolders,i;if(t&&t.length>0)i=t[0].uri;else{let o;if(dn.isWindows&&!dn.isWeb&&process.env.USERPROFILE?o=(0,et.join)(process.env.USERPROFILE,"Pictures"):(dn.isMac||dn.isLinux)&&(o=(0,et.join)((0,qa.homedir)(),"Pictures")),o){let a=k.Uri.from({scheme:this._context.extensionUri.scheme,path:o});try{yield k.workspace.fs.stat(a)}catch{o=void 0}}i=k.Uri.from({scheme:this._context.extensionUri.scheme,path:o||(0,qa.homedir)()})}let r=n==="image/x-ico"?"ico":"png";return k.Uri.joinPath(i,`NewImage-${this._getUnusedNewImageId()}.${r}`).with({scheme:"untitled"})})}_getUnusedNewImageId(){let t=Array.from(this._documents.values()).map(r=>r.uri).map(r=>(0,et.parse)(r.path).name).filter(r=>r.match(/^NewImage-\d+$/)).map(r=>parseInt(r.substring(9))),i=1;for(;t.includes(i);)i++;return i}_requestNewImageDimensions(n,t){return V(this,void 0,void 0,function*(){let i=(t==null?void 0:t.width)||(yield k.window.showInputBox({prompt:"Enter the width of the image",value:n.width.toString(),validateInput:Ga}));if(!i)return;let r=(t==null?void 0:t.height)||(yield k.window.showInputBox({prompt:"Enter the height of the image",value:n.height.toString(),validateInput:Ga}));if(!!r)return{width:typeof i=="number"?i:parseInt(i),height:typeof r=="number"?r:parseInt(r)}})}_createOpenImageDocument(n){return V(this,void 0,void 0,function*(){try{let t=vh.perf.now(),i=new Uint8Array(yield k.workspace.fs.readFile(n));return new It.ImageDocument(this._context,n,{type:"open",config:this._getLunaConfig(),workbenchState:(0,fn.getGlobalState)(this._context),data:i,extName:(0,et.extname)(n.path),isReadonly:!k.workspace.fs.isWritableFileSystem(n.scheme)},t)}catch{}return new It.ImageDocument(this._context,n,{type:"new",config:this._getLunaConfig(),workbenchState:(0,fn.getGlobalState)(this._context),dimensions:this._getDefaultImageSize(n)})})}_getDefaultImageSize(n){let t=k.workspace.getConfiguration("luna.defaultImageSize",n);return{width:t.get("width",800),height:t.get("height",600)}}resolveCustomEditor(n,t,i){let r=this._webviewPanels.get(n.uri.toString());r==null||r.dispose(),this._webviewPanels.set(n.uri.toString(),t);let o=t.webview;o.options={enableScripts:!0},o.html=this._getHtml(o);let a=n.setupIpc(o);n.onRequestReload(()=>V(this,void 0,void 0,function*(){let s=yield k.workspace.fs.readFile(n.uri);yield a.request("open",{data:s,extName:(0,et.extname)(n.uri.path)})})),t.onDidChangeViewState(()=>this._refreshActiveState(n,t)),t.onDidDispose(()=>this._handleWebviewBlur(n)),this._refreshActiveState(n,t)}_refreshActiveState(n,t){var i;t.active?(this._lastActiveResource=n.uri,this._mimeTypeStatusBarItem.show(),k.workspace.getConfiguration("files",this._lastActiveResource).get("autoSave")==="afterDelay"&&((i=this._autoSaveWarningStatusBarItem)===null||i===void 0||i.show())):this._handleWebviewBlur(n),n.isActive=t.active}_getLunaConfig(){var n,t,i,r;let o=k.workspace.getConfiguration(void 0,this._lastActiveResource);return{mouseWheelBehavior:(n=o.get("luna.mouseWheelBehavior"))!==null&&n!==void 0?n:"scroll",snapToPixelGrid:(t=o.get("luna.snapToPixelGrid"))!==null&&t!==void 0?t:!0,statusBarPointerColor:(i=o.get("luna.statusBar.pointerColor"))!==null&&i!==void 0?i:"currentLayer",defaultTool:(r=o.get("luna.defaultTool"))!==null&&r!==void 0?r:"selection"}}_handleWebviewBlur(n){var t,i,r;this._lastActiveResource===n.uri&&(this._mimeTypeStatusBarItem.hide(),(t=this._autoSaveWarningStatusBarItem)===null||t===void 0||t.hide(),(i=this._decodeWarningStatusBarItem)===null||i===void 0||i.hide(),(r=this._decodeErrorStatusBarItem)===null||r===void 0||r.hide(),Za("luna:focused",!1))}_getHtml(n){let t=n.asWebviewUri(k.Uri.joinPath(this._context.extensionUri,"luna/dist/vscode.main.js")),i=n.asWebviewUri(k.Uri.joinPath(this._context.extensionUri,"luna/dist/vscode.main.css")),r=n.cspSource;return`
<!doctype html>
<html lang="en-US">
  <head>
    <title>Luna Paint</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' ${r}; style-src-elem 'self' ${r}; worker-src ${r};">
    <link rel="stylesheet" href="${i}">
  </head>
  <body>
    <div id="top"></div>
    <div id="middle">
      <div id="canvas"></div>
      <div id="gui"></div>
    </div>
    <div id="bottom"></div>
    <script type="module" src="${t}" defer><\/script>
  </body>
</html>`}};re.PaintEditorProvider=Re;Re.viewType="luna.editor";var Ha;(function(e){e.SetContext="setContext"})(Ha=re.BuiltInCommands||(re.BuiltInCommands={}));function Za(e,n){return k.commands.executeCommand(Ha.SetContext,e,n)}re.setVscodeContext=Za;function Ga(e,n,t){if(!e.match(/^[0-9]+$/))return"Enter a valid number";if(n!==void 0&&parseInt(e)<n)return`Enter a number greater than or equal to ${n}`;if(t!==void 0&&parseInt(e)>t)return`Enter a number less than or equal to ${t}`}function mh(e){switch(e){case"image/bmp":return"BMP";case"image/x-ico":return"ICO";case"image/jpeg":return"JPEG";case"image/png":return"PNG";case"image/x-tga":return"TGA";case"image/webp":case"image/webplossless":return"WEBP"}}});Object.defineProperty(exports,"__esModule",{value:!0});exports.deactivate=exports.activate=void 0;var Va=require("vscode"),yh=ga(),Ya=ja();function Ch(e){let n=Va.workspace.getConfiguration("luna").get("retainContextWhenHidden");e.subscriptions.push(Va.window.registerCustomEditorProvider(Ya.PaintEditorProvider.viewType,new Ya.PaintEditorProvider(e),{webviewOptions:{retainContextWhenHidden:n}})),(0,yh.activateInspectImageFileContribution)(e)}exports.activate=Ch;function kh(){}exports.deactivate=kh;
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */
