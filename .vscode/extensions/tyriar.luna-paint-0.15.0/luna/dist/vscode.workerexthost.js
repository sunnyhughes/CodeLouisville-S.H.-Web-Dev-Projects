(()=>{var e=[,(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const n=i(2),o=i(3),r=i(10);t.activate=function(e){const t=n.workspace.getConfiguration("luna").get("retainContextWhenHidden");e.subscriptions.push(n.window.registerCustomEditorProvider(r.PaintEditorProvider.viewType,new r.PaintEditorProvider(e),{webviewOptions:{retainContextWhenHidden:t}})),(0,o.activateInspectImageFileContribution)(e)},t.deactivate=function(){}},e=>{"use strict";e.exports=require("vscode")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.activateInspectImageFileContribution=void 0;const o=i(4),r=i(2),a=i(5),s=i(6),c=i(8),d=i(9);function u(e,t,i){let n,r,a=`# ${(0,o.basename)(e.path)}`;if(a+="\n\n",t)n=t;else{if(!i)return a+="Could not decode png or get decode error",a;if(!(i instanceof s.DecodeError))return i instanceof Error?a+="Could not be decoded due to an unexpected exception:\n\n":a+="Unexpected error type:\n\n",a;r=i,n=i.partiallyDecodedImage}return n.details&&(a+="## Details\n\n",a+=`- Width: ${n.details.width}\n`,a+=`- Height: ${n.details.height}\n`,a+=`- Bit depth: ${n.details.bitDepth}\n`,a+=`- Color type: ${function(e){switch(e){case 0:return"Grayscale";case 2:return"Truecolor";case 3:return"Indexed";case 4:return"Grayacale and alpha";case 6:return"Truecolor and alpha"}return""}(n.details.colorType)} (${n.details.colorType})\n`,a+=`- Interlace method: ${1===n.details.interlaceMethod?"Adam7":"None"}\n`,a+="\n"),a+=f(n.info||[],n.warnings||[],r),a+="## Metadata\n\n",n.metadata&&n.metadata.length>0?(a+="```json\n",a+=h(n.metadata),a+="\n",a+="```"):a+="No recognized metadata",a+="\n\n",n.rawChunks&&n.rawChunks.length>0&&(a+="## Raw chunks\n\n",a+="```json\n",a+=h(n.rawChunks),a+="\n",a+="```",a+="\n\n"),n.image&&(a+=p(n.image)),a}function l(e,t,i){let n,r,a=`# ${(0,o.basename)(e.path)}`;if(a+="\n\n",t)n=t;else{if(!i)return a+="Could not decode tga or get decode error",a;if(!(i instanceof d.DecodeError))return i instanceof Error?a+="Could not be decoded due to an unexpected exception:\n\n":a+="Unexpected error type:\n\n",a;r=i,n=i.partiallyDecodedImage}return n.details&&(a+="## Details\n\n",n.details.header&&(a+=`- Width: ${n.details.header.width}\n`,a+=`- Height: ${n.details.header.height}\n`),a+=`- Image identifier: ${n.details.imageId}\n`,n.details.footer&&(a+=`- Extension area offset: ${n.details.footer.extensionAreaOffset}\n`,a+=`- Developer directory offset: ${n.details.footer.developerDirectoryOffset}\n`),a+="\n"),a+=f([],n.warnings||[],r),n.image&&(a+=p(n.image)),a}function h(e){return JSON.stringify(e,((e,t)=>[Uint8Array,Uint16Array].some((e=>t instanceof e))?Array.from(t):t),2)}function f(e,t,i){let n="";if(e.length||t.length>0||i){n+="## Problems encountered\n\n";for(const t of e)n+=`- \`INFO\` ${t}\n`;for(const e of t)n+=`- \`WARN\` ${e.message} (offset: 0x${e.offset.toString(16)})\n`;i&&(n+=`- \`ERROR\` ${i.message} (offset: 0x${i.offset.toString(16)})\n`),n+="\n"}return n}function p(e){let t="";t+="## Raw rgba data as json\n\n",t+="[\n";const i=4*e.width,n=2===e.data.BYTES_PER_ELEMENT?5:3;let o=0;for(let r=0;r<e.data.length;r++)t+=0!==r?",":"",r%i!=0&&r%4==0&&(t+=" "),o===i&&(t+="\n",o=0),o++,t+=e.data[r].toString().padStart(n," ");return t+="\n]",t+="\n",t}t.activateInspectImageFileContribution=function(e){e.subscriptions.push(r.commands.registerCommand("luna.file.inspectImageFile",(e=>n(this,void 0,void 0,(function*(){var t,i;if(!e){const n=null===(t=r.window.tabGroups.activeTabGroup.activeTab)||void 0===t?void 0:t.input;if(!(e=n&&"uri"in n?n.uri:null===(i=r.window.activeTextEditor)||void 0===i?void 0:i.document.uri)||".png"!==(0,o.extname)(e.fsPath)&&".tga"!==(0,o.extname)(e.fsPath))return}const n=(0,o.extname)(e.fsPath);switch(n){case".png":{const t=yield r.workspace.fs.readFile(e);let i,n;try{i=yield(0,a.decodePng)(t,{parseChunkTypes:"*"})}catch(e){n=e}const o=yield r.workspace.openTextDocument({content:u(e,i,n),language:"markdown"});yield r.window.showTextDocument(o);break}case".tga":case".tpic":{const t=yield r.workspace.fs.readFile(e);let i,n;try{i=yield(0,c.decodeTga)(t,{detectAmbiguousAlphaChannel:!0})}catch(e){n=e}const o=yield r.workspace.openTextDocument({content:l(e,i,n),language:"markdown"});yield r.window.showTextDocument(o);break}default:throw new Error(`Cannot inspect file type ${n}`)}})))))}},e=>{"use strict";function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function i(e,t){for(var i,n="",o=0,r=-1,a=0,s=0;s<=e.length;++s){if(s<e.length)i=e.charCodeAt(s);else{if(47===i)break;i=47}if(47===i){if(r===s-1||1===a);else if(r!==s-1&&2===a){if(n.length<2||2!==o||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var c=n.lastIndexOf("/");if(c!==n.length-1){-1===c?(n="",o=0):o=(n=n.slice(0,c)).length-1-n.lastIndexOf("/"),r=s,a=0;continue}}else if(2===n.length||1===n.length){n="",o=0,r=s,a=0;continue}t&&(n.length>0?n+="/..":n="..",o=2)}else n.length>0?n+="/"+e.slice(r+1,s):n=e.slice(r+1,s),o=s-r-1;r=s,a=0}else 46===i&&-1!==a?++a:a=-1}return n}var n={resolve:function(){for(var e,n="",o=!1,r=arguments.length-1;r>=-1&&!o;r--){var a;r>=0?a=arguments[r]:(void 0===e&&(e=process.cwd()),a=e),t(a),0!==a.length&&(n=a+"/"+n,o=47===a.charCodeAt(0))}return n=i(n,!o),o?n.length>0?"/"+n:"/":n.length>0?n:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),o=47===e.charCodeAt(e.length-1);return 0!==(e=i(e,!n)).length||n||(e="."),e.length>0&&o&&(e+="/"),n?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,i=0;i<arguments.length;++i){var o=arguments[i];t(o),o.length>0&&(void 0===e?e=o:e+="/"+o)}return void 0===e?".":n.normalize(e)},relative:function(e,i){if(t(e),t(i),e===i)return"";if((e=n.resolve(e))===(i=n.resolve(i)))return"";for(var o=1;o<e.length&&47===e.charCodeAt(o);++o);for(var r=e.length,a=r-o,s=1;s<i.length&&47===i.charCodeAt(s);++s);for(var c=i.length-s,d=a<c?a:c,u=-1,l=0;l<=d;++l){if(l===d){if(c>d){if(47===i.charCodeAt(s+l))return i.slice(s+l+1);if(0===l)return i.slice(s+l)}else a>d&&(47===e.charCodeAt(o+l)?u=l:0===l&&(u=0));break}var h=e.charCodeAt(o+l);if(h!==i.charCodeAt(s+l))break;47===h&&(u=l)}var f="";for(l=o+u+1;l<=r;++l)l!==r&&47!==e.charCodeAt(l)||(0===f.length?f+="..":f+="/..");return f.length>0?f+i.slice(s+u):(s+=u,47===i.charCodeAt(s)&&++s,i.slice(s))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var i=e.charCodeAt(0),n=47===i,o=-1,r=!0,a=e.length-1;a>=1;--a)if(47===(i=e.charCodeAt(a))){if(!r){o=a;break}}else r=!1;return-1===o?n?"/":".":n&&1===o?"//":e.slice(0,o)},basename:function(e,i){if(void 0!==i&&"string"!=typeof i)throw new TypeError('"ext" argument must be a string');t(e);var n,o=0,r=-1,a=!0;if(void 0!==i&&i.length>0&&i.length<=e.length){if(i.length===e.length&&i===e)return"";var s=i.length-1,c=-1;for(n=e.length-1;n>=0;--n){var d=e.charCodeAt(n);if(47===d){if(!a){o=n+1;break}}else-1===c&&(a=!1,c=n+1),s>=0&&(d===i.charCodeAt(s)?-1==--s&&(r=n):(s=-1,r=c))}return o===r?r=c:-1===r&&(r=e.length),e.slice(o,r)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!a){o=n+1;break}}else-1===r&&(a=!1,r=n+1);return-1===r?"":e.slice(o,r)},extname:function(e){t(e);for(var i=-1,n=0,o=-1,r=!0,a=0,s=e.length-1;s>=0;--s){var c=e.charCodeAt(s);if(47!==c)-1===o&&(r=!1,o=s+1),46===c?-1===i?i=s:1!==a&&(a=1):-1!==i&&(a=-1);else if(!r){n=s+1;break}}return-1===i||-1===o||0===a||1===a&&i===o-1&&i===n+1?"":e.slice(i,o)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var i=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return i?i===t.root?i+n:i+"/"+n:n}(0,e)},parse:function(e){t(e);var i={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return i;var n,o=e.charCodeAt(0),r=47===o;r?(i.root="/",n=1):n=0;for(var a=-1,s=0,c=-1,d=!0,u=e.length-1,l=0;u>=n;--u)if(47!==(o=e.charCodeAt(u)))-1===c&&(d=!1,c=u+1),46===o?-1===a?a=u:1!==l&&(l=1):-1!==a&&(l=-1);else if(!d){s=u+1;break}return-1===a||-1===c||0===l||1===l&&a===c-1&&a===s+1?-1!==c&&(i.base=i.name=0===s&&r?e.slice(1,c):e.slice(s,c)):(0===s&&r?(i.name=e.slice(1,a),i.base=e.slice(1,c)):(i.name=e.slice(s,a),i.base=e.slice(s,c)),i.ext=e.slice(a,c)),s>0?i.dir=e.slice(0,s-1):r&&(i.dir="/"),i},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DecodeError:()=>n.DecodeError,DecodeWarning:()=>n.DecodeWarning,EncodeError:()=>o.EncodeError,EncodeWarning:()=>o.EncodeWarning,decodePng:()=>r,encodePng:()=>a});var n=i(6),o=i(7);async function r(e,t){return(await Promise.all([i.e(2),i.e(1)]).then(i.bind(i,22))).decodePng(e,t)}async function a(e,t){return(await Promise.all([i.e(2),i.e(3)]).then(i.bind(i,31))).encodePng(e,t)}},(e,t,i)=>{"use strict";function n(e,t){e.parsedChunks.has(t.type)&&p(e,h(t,`Multiple ${t.type} chunks not allowed`,t.offset+4))}function o(e,t,i){if(t.dataLength!==i){const n=h(t,`Invalid data length: ${t.dataLength} !== ${i}`,t.offset);if(!(t.dataLength>i))throw n;p(e,n)}}function r(e,t,i){if(t.dataLength<i)throw u(e,t,`Invalid data length: ${t.dataLength} < ${i}`,t.offset)}function a(e,t,i){e.parsedChunks.has(i)&&p(e,h(t,`Must precede ${i}`,t.offset+4))}function s(e,t,i){if(!e.parsedChunks.has(i))throw u(e,t,`Must follow ${i}`,t.offset+4)}function c(e,t,i){e.parsedChunks.has(i)&&p(e,h(t,`Should not be present alongside ${i}`,t.offset+4))}function d(e,t,i,n){0!==i&&p(e,h(t,`Unknown compression method "${i}"`,n))}function u(e,t,i,n){return new l(e,`${t.type}: ${i}`,n)}i.r(t),i.d(t,{assertChunkSinglular:()=>n,assertChunkDataLengthEquals:()=>o,assertChunkDataLengthGte:()=>r,assertChunkPrecedes:()=>a,assertChunkFollows:()=>s,assertChunkMutualExclusion:()=>c,assertChunkCompressionMethod:()=>d,createChunkDecodeError:()=>u,DecodeError:()=>l,createChunkDecodeWarning:()=>h,DecodeWarning:()=>f,handleWarning:()=>p});class l extends Error{constructor(e,t,i){super(t),this.offset=i,this.partiallyDecodedImage={details:"header"in e&&e.header?{width:e.header.width,height:e.header.height,bitDepth:e.header.bitDepth,colorType:e.header.colorType,interlaceMethod:e.header.interlaceMethod}:void 0,info:e.info,metadata:e.metadata,rawChunks:e.rawChunks,warnings:e.warnings}}}function h(e,t,i){return new f(`${e.type}: ${t}`,i)}class f extends Error{constructor(e,t){super(e),this.offset=t}}function p(e,t){if(e.options.strictMode)throw t;e.warnings.push(t)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{EncodeError:()=>n,EncodeWarning:()=>o,handleWarning:()=>r});class n extends Error{constructor(e,t){super(e),this.offset=t}}class o extends Error{constructor(e,t){super(e),this.offset=t}}function r(e,t){if(e.options.strictMode)throw t;e.warnings.push(t)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DecodeError:()=>n.DecodeError,DecodeWarning:()=>n.DecodeWarning,decodeTga:()=>o});var n=i(9);async function o(e,t){return(await i.e(4).then(i.bind(i,37))).decodeTga(e,t)}},(e,t,i)=>{"use strict";i.r(t),i.d(t,{DecodeError:()=>n,DecodeWarning:()=>o,handleWarning:()=>r});class n extends Error{constructor(e,t,i){super(t),this.offset=i,this.partiallyDecodedImage={details:{header:e.header,footer:e.footer,imageId:e.identificationField,developerDirectory:e.developerDirectory,extensionArea:e.extensionArea},warnings:e.warnings}}}class o extends Error{constructor(e,t){super(e),this.offset=t}}function r(e,t){if(e.options.strictMode)throw t;e.warnings.push(t)}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setVscodeContext=t.BuiltInCommands=t.PaintEditorProvider=void 0;const o=i(11),r=i(4),a=i(2),s=i(12),c=i(16),d=i(20),u=i(13),l=i(14),h=["adjustments.invert","color.swapColors","edit.copy","edit.cut","edit.paste","edit.redo","edit.undo","help.reportIssue","image.cropToSelection","image.expandCanvasToSelection","image.resize","image.resizeCanvas","image.flipHorizontal","image.flipVertical","image.rotate180","image.rotate90Clockwise","image.rotate90CounterClockwise","image.flattenLayers","image.finishActiveAction","image.customizePointerColorStatusBarItem","image.addNewImage","image.deleteImage","image.goToTopImage","image.goToImageAbove","image.goToImageBelow","image.goToBottomImage","image.moveImageToTop","image.moveImageUp","image.moveImageDown","image.moveImageToBottom","layer.addNewLayer","layer.deleteLayer","layer.duplicateLayer","layer.mergeLayerDown","layer.renameLayer","layer.flipHorizontal","layer.flipVertical","layer.rotate180","layer.goToTopLayer","layer.goToLayerAbove","layer.goToLayerBelow","layer.goToBottomLayer","layer.moveLayerToTop","layer.moveLayerUp","layer.moveLayerDown","layer.moveLayerToBottom","selection.deselect","selection.selectAll","selection.erase","selection.eraseKeepSelection","tool.colorPicker","tool.crop","tool.eraser","tool.fill","tool.hand","tool.handUntilRelease","tool.pencil","tool.selection","tool.zoom","tool.line","tool.rectangle","tool.shape","tool.text","tool.toggleShapeTool","tool.movePixels","tool.moveSelection","tool.toggleMoveTool","view.focusCanvas","view.zoomIn","view.zoomOut","view.actualSize","view.fitToWindow","view.fitLayerToWindow","color.toggleColorsWindow","history.toggleHistoryWindow","image.toggleImagesWindow","layer.toggleLayersWindow","minimap.toggleMinimapWindow","palette.togglePaletteWindow","tool.toggleToolsWindow"];class f{constructor(e){this._context=e,this._onDidChangeCustomDocument=new a.EventEmitter,this.onDidChangeCustomDocument=this._onDidChangeCustomDocument.event,this._documents=new Map,this._webviewPanels=new Map,this._newImageRequest=new Map;for(const e of h)this._context.subscriptions.push(a.commands.registerCommand(`luna.${e}`,(()=>{var t;if(!this._lastActiveResource)return;const i=null===(t=this._documents.get(this._lastActiveResource.toString()))||void 0===t?void 0:t.ipcClient;return i?i.request("luna.executeCommand",e):void 0})));this._context.subscriptions.push(a.commands.registerCommand("luna.file.new",(e=>n(this,void 0,void 0,(function*(){const t=a.workspace.getConfiguration("luna.defaultImageSize",this._lastActiveResource),i={width:t.get("width",800),height:t.get("height",600)},n=yield this._requestNewImageDimensions(i,e);if(!n)return;const o=yield this._getNewImageUri();this._newImageRequest.set(o.path,{width:n.width,height:n.height}),a.commands.executeCommand("vscode.openWith",o,f.viewType)}))))),a.workspace.onDidChangeConfiguration((e=>{var t;if(e.affectsConfiguration("luna")){const e=this._getLunaConfig();for(const i of this._documents.values())null===(t=i.ipcClient)||void 0===t||t.request("updateConfig",e)}})),this._context.subscriptions.push(a.commands.registerCommand("luna.file.newIcon",(e=>n(this,void 0,void 0,(function*(){const t=yield this._requestNewImageDimensions({width:256,height:256},e);if(!t)return;const i=yield this._getNewImageUri("image/x-ico");this._newImageRequest.set(i.path,{width:t.width,height:t.height,extName:".ico"}),a.commands.executeCommand("vscode.openWith",i,f.viewType)}))))),this._context.subscriptions.push(a.commands.registerCommand("luna.file.importFromClipboard",(()=>n(this,void 0,void 0,(function*(){const e=yield this._getNewImageUri();this._newImageRequest.set(e.path,"clipboard"),a.commands.executeCommand("vscode.openWith",e,f.viewType)}))))),this._context.subscriptions.push(a.commands.registerCommand("luna.file.newDefaultSize",(()=>n(this,void 0,void 0,(function*(){const e=yield this._getNewImageUri();this._newImageRequest.set(e.path,this._getDefaultImageSize(e)),a.commands.executeCommand("vscode.openWith",e,f.viewType)}))))),this._context.subscriptions.push(a.commands.registerCommand("luna.help.openDocumentation",(()=>n(this,void 0,void 0,(function*(){a.commands.executeCommand("workbench.action.openWalkthrough","Tyriar.luna-paint#welcome",!0)}))))),this._context.subscriptions.push(a.commands.registerCommand("luna.help.hideAutoSaveWarning",(()=>n(this,void 0,void 0,(function*(){var e;null===(e=this._autoSaveWarningStatusBarItem)||void 0===e||e.dispose(),this._autoSaveWarningStatusBarItem=void 0}))))),this._context.subscriptions.push(a.window.onDidChangeWindowState((e=>{var t;if(!e.focused)for(const e of this._documents.values())null===(t=e.ipcClient)||void 0===t||t.request("pauseanimations",void 0)}))),this._context.subscriptions.push(a.window.onDidChangeActiveTextEditor((()=>{var e,t;this._mimeTypeStatusBarItem.hide(),null===(e=this._autoSaveWarningStatusBarItem)||void 0===e||e.hide(),null===(t=this._decodeWarningStatusBarItem)||void 0===t||t.hide()}))),this._mimeTypeStatusBarItem=a.window.createStatusBarItem("luna-paint.mimeType",a.StatusBarAlignment.Right),this._mimeTypeStatusBarItem.name="Luna Paint - Mime Type",this._autoSaveWarningStatusBarItem=a.window.createStatusBarItem("luna-paint.autoSaveWarning",a.StatusBarAlignment.Right,1),this._autoSaveWarningStatusBarItem.name="Luna Paint - Auto Save Warning",this._autoSaveWarningStatusBarItem.text="$(warning) Auto Save is On",this._autoSaveWarningStatusBarItem.backgroundColor=new a.ThemeColor("statusBarItem.warningBackground"),this._autoSaveWarningStatusBarItem.color=new a.ThemeColor("statusBarItem.warningForeground"),this._autoSaveWarningStatusBarItem.tooltip="Auto save after delay is enabled which may cause performance issues while editing the image. Left click to dismiss this warning for this session, right click to hide it permanently.",this._autoSaveWarningStatusBarItem.command="luna.help.hideAutoSaveWarning",this._decodeWarningStatusBarItem=a.window.createStatusBarItem("luna-paint.decodeWarning",a.StatusBarAlignment.Right,2),this._decodeWarningStatusBarItem.name="Luna Paint - Decode Warning",this._decodeWarningStatusBarItem.text="$(warning) Decode Warning",this._decodeWarningStatusBarItem.backgroundColor=new a.ThemeColor("statusBarItem.warningBackground"),this._decodeWarningStatusBarItem.color=new a.ThemeColor("statusBarItem.warningForeground"),this._decodeWarningStatusBarItem.tooltip="Warning(s) were encountered while decoding this image which could indicate corruption. Left click to inspect the image file, right click to hide this warning permanently.",this._decodeErrorStatusBarItem=a.window.createStatusBarItem("luna-paint.decodeError",a.StatusBarAlignment.Right,3),this._decodeErrorStatusBarItem.name="Luna Paint - Decode Error",this._decodeErrorStatusBarItem.text="$(error) Decode Error",this._decodeErrorStatusBarItem.backgroundColor=new a.ThemeColor("statusBarItem.errorBackground"),this._decodeErrorStatusBarItem.color=new a.ThemeColor("statusBarItem.errorForeground"),this._decodeErrorStatusBarItem.tooltip="A critical error was encountered while decoding this image. Left click to inspect the image file, right click to hide this warning permanently."}saveCustomDocument(e,t){return n(this,void 0,void 0,(function*(){return e.save(t)}))}saveCustomDocumentAs(e,t,i){return n(this,void 0,void 0,(function*(){yield e.saveAs(t,i)}))}revertCustomDocument(e,t){return n(this,void 0,void 0,(function*(){const t=e.getIpcClientOrThrow(),i=yield a.workspace.fs.readFile(e.uri);e.revert(),yield t.request("open",{data:i,extName:(0,r.extname)(e.uri.path)})}))}backupCustomDocument(e,t,i){return n(this,void 0,void 0,(function*(){try{return yield e.backup(t,i)}catch(e){throw console.error("Backup failed",e),e}}))}openCustomDocument(e,t,i){return n(this,void 0,void 0,(function*(){let i;if(i=this._documents.get(e.toString()),i)return i;if(t.backupId){const n=a.Uri.parse(t.backupId);try{const{state:t,workbenchState:o}=yield(0,s.getBackupData)(this._context,n);t?i=new c.ImageDocument(this._context,e,{type:"restore",config:this._getLunaConfig(),state:t,workbenchState:o,restoreHistory:!1}):(a.window.showWarningMessage("The extension was updated, could not restore the image from backup"),i=yield this._createOpenImageDocument(e))}catch(t){i=yield this._createOpenImageDocument(e)}}else{const t=this._newImageRequest.get(e.path);t?(i="clipboard"===t?new c.ImageDocument(this._context,e,{type:"newFromClipboard",config:this._getLunaConfig(),workbenchState:(0,l.getGlobalState)(this._context),fallbackDimensions:this._getDefaultImageSize(e)}):new c.ImageDocument(this._context,e,{type:"new",config:this._getLunaConfig(),workbenchState:(0,l.getGlobalState)(this._context),dimensions:{width:t.width,height:t.height},extName:t.extName}),this._newImageRequest.delete(e.path)):i=yield this._createOpenImageDocument(e)}i.onDidChange((e=>this._onDidChangeCustomDocument.fire(e)));const n=i;return i.onDidUpdateGlobalState((e=>this._syncGlobalState(e,n))),i.onMimeTypeChange((e=>{this._mimeTypeStatusBarItem.text=function(e){switch(e){case"image/bmp":return"BMP";case"image/x-ico":return"ICO";case"image/jpeg":return"JPEG";case"image/png":return"PNG";case"image/x-tga":return"TGA";case"image/webp":case"image/webplossless":return"WEBP"}}(e),this._mimeTypeStatusBarItem.tooltip=e,this._mimeTypeStatusBarItem.show()})),i.onDidEncounterDecodeProblem((e=>{const t="warning"===e?this._decodeWarningStatusBarItem:this._decodeErrorStatusBarItem;t&&(t.command={command:"luna.file.inspectImageFile",title:"Inspect Image File",arguments:[null==i?void 0:i.uri]},t.show())})),this._documents.set(e.toString(),i),i.onDisposed((()=>this._documents.delete(e.toString()))),i}))}_syncGlobalState(e,t){if(1!==this._documents.size)for(const i of this._documents.values())i!==t&&i.syncGlobalState(e)}_getNewImageUri(e="image/png"){return n(this,void 0,void 0,(function*(){const t=a.workspace.workspaceFolders;let i;if(t&&t.length>0)i=t[0].uri;else{let e;if(u.isWindows&&!u.isWeb&&process.env.USERPROFILE?e=(0,r.join)(process.env.USERPROFILE,"Pictures"):(u.isMac||u.isLinux)&&(e=(0,r.join)((0,o.homedir)(),"Pictures")),e){const t=a.Uri.from({scheme:this._context.extensionUri.scheme,path:e});try{yield a.workspace.fs.stat(t)}catch(t){e=void 0}}i=a.Uri.from({scheme:this._context.extensionUri.scheme,path:e||(0,o.homedir)()})}const n="image/x-ico"===e?"ico":"png";return a.Uri.joinPath(i,`NewImage-${this._getUnusedNewImageId()}.${n}`).with({scheme:"untitled"})}))}_getUnusedNewImageId(){const e=Array.from(this._documents.values()).map((e=>e.uri)).map((e=>(0,r.parse)(e.path).name)).filter((e=>e.match(/^NewImage-\d+$/))).map((e=>parseInt(e.substring(9))));let t=1;for(;e.includes(t);)t++;return t}_requestNewImageDimensions(e,t){return n(this,void 0,void 0,(function*(){const i=(null==t?void 0:t.width)||(yield a.window.showInputBox({prompt:"Enter the width of the image",value:e.width.toString(),validateInput:m}));if(!i)return;const n=(null==t?void 0:t.height)||(yield a.window.showInputBox({prompt:"Enter the height of the image",value:e.height.toString(),validateInput:m}));return n?{width:"number"==typeof i?i:parseInt(i),height:"number"==typeof n?n:parseInt(n)}:void 0}))}_createOpenImageDocument(e){return n(this,void 0,void 0,(function*(){try{const t=d.perf.now(),i=new Uint8Array(yield a.workspace.fs.readFile(e));return new c.ImageDocument(this._context,e,{type:"open",config:this._getLunaConfig(),workbenchState:(0,l.getGlobalState)(this._context),data:i,extName:(0,r.extname)(e.path),isReadonly:!a.workspace.fs.isWritableFileSystem(e.scheme)},t)}catch(e){}return new c.ImageDocument(this._context,e,{type:"new",config:this._getLunaConfig(),workbenchState:(0,l.getGlobalState)(this._context),dimensions:this._getDefaultImageSize(e)})}))}_getDefaultImageSize(e){const t=a.workspace.getConfiguration("luna.defaultImageSize",e);return{width:t.get("width",800),height:t.get("height",600)}}resolveCustomEditor(e,t,i){const o=this._webviewPanels.get(e.uri.toString());null==o||o.dispose(),this._webviewPanels.set(e.uri.toString(),t);const s=t.webview;s.options={enableScripts:!0},s.html=this._getHtml(s);const c=e.setupIpc(s);e.onRequestReload((()=>n(this,void 0,void 0,(function*(){const t=yield a.workspace.fs.readFile(e.uri);yield c.request("open",{data:t,extName:(0,r.extname)(e.uri.path)})})))),t.onDidChangeViewState((()=>this._refreshActiveState(e,t))),t.onDidDispose((()=>this._handleWebviewBlur(e))),this._refreshActiveState(e,t)}_refreshActiveState(e,t){var i;t.active?(this._lastActiveResource=e.uri,this._mimeTypeStatusBarItem.show(),"afterDelay"===a.workspace.getConfiguration("files",this._lastActiveResource).get("autoSave")&&(null===(i=this._autoSaveWarningStatusBarItem)||void 0===i||i.show())):this._handleWebviewBlur(e),e.isActive=t.active}_getLunaConfig(){var e,t,i,n;const o=a.workspace.getConfiguration(void 0,this._lastActiveResource);return{mouseWheelBehavior:null!==(e=o.get("luna.mouseWheelBehavior"))&&void 0!==e?e:"scroll",snapToPixelGrid:null===(t=o.get("luna.snapToPixelGrid"))||void 0===t||t,statusBarPointerColor:null!==(i=o.get("luna.statusBar.pointerColor"))&&void 0!==i?i:"currentLayer",defaultTool:null!==(n=o.get("luna.defaultTool"))&&void 0!==n?n:"selection"}}_handleWebviewBlur(e){var t,i,n;this._lastActiveResource===e.uri&&(this._mimeTypeStatusBarItem.hide(),null===(t=this._autoSaveWarningStatusBarItem)||void 0===t||t.hide(),null===(i=this._decodeWarningStatusBarItem)||void 0===i||i.hide(),null===(n=this._decodeErrorStatusBarItem)||void 0===n||n.hide(),g("luna:focused",!1))}_getHtml(e){const t=e.asWebviewUri(a.Uri.joinPath(this._context.extensionUri,"luna/dist/vscode.main.js")),i=e.asWebviewUri(a.Uri.joinPath(this._context.extensionUri,"luna/dist/vscode.main.css")),n=e.cspSource;return`\n<!doctype html>\n<html lang="en-US">\n  <head>\n    <title>Luna Paint</title>\n    <meta http-equiv="Content-Security-Policy" content="script-src 'self' ${n}; style-src-elem 'self' ${n}; worker-src ${n};">\n    <link rel="stylesheet" href="${i}">\n  </head>\n  <body>\n    <div id="top"></div>\n    <div id="middle">\n      <div id="canvas"></div>\n      <div id="gui"></div>\n    </div>\n    <div id="bottom"></div>\n    <script type="module" src="${t}" defer><\/script>\n  </body>\n</html>`}}var p;function g(e,t){return a.commands.executeCommand(p.SetContext,e,t)}function m(e,t,i){return e.match(/^[0-9]+$/)?void 0!==t&&parseInt(e)<t?`Enter a number greater than or equal to ${t}`:void 0!==i&&parseInt(e)>i?`Enter a number less than or equal to ${i}`:void 0:"Enter a valid number"}t.PaintEditorProvider=f,f.viewType="luna.editor",function(e){e.SetContext="setContext"}(p=t.BuiltInCommands||(t.BuiltInCommands={})),t.setVscodeContext=g},(e,t)=>{t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.saveBackupData=t.getBackupData=void 0;const o=i(2),r=i(13),a=i(14);function s(e){if("object"!=typeof e||null===e)return;const t=e;return"version"in t&&8===t.version&&("body"in t||"object"!=typeof t.body)?{version:t.version,body:t.body}:void 0}t.getBackupData=function(e,t){return n(this,void 0,void 0,(function*(){const n=yield o.workspace.fs.readFile(t);if(r.isWeb){if(!self.TextDecoder)return console.warn("This browser doesn't support TextEncoder"),{};const e=(new self.TextDecoder).decode(n);return{state:s(null==e?void 0:e.state),workbenchState:null==e?void 0:e.workbenchState}}const c=new((yield Promise.resolve().then((()=>i(15)))).Deserializer)(n).readValue(),d=s(null==c?void 0:c.state),u=null==c?void 0:c.workbenchState;return(0,a.mixinGlobalState)(e,u),{state:d,workbenchState:u}}))},t.saveBackupData=function(e,t){return n(this,void 0,void 0,(function*(){let n;if(r.isWeb){if(!self.TextEncoder)throw new Error("This browser doesn't support TextEncoder");n=(new self.TextEncoder).encode(JSON.stringify(t))}else{const e=new((yield Promise.resolve().then((()=>i(15)))).Serializer);e.writeValue(t),n=e.releaseBuffer()}yield o.workspace.fs.writeFile(e,n)}))}},(e,t,i)=>{"use strict";var n;let o;Object.defineProperty(t,"__esModule",{value:!0}),t.isLinux=t.isWindows=t.isMac=t.isWeb=t.globals=void 0,t.globals="object"==typeof self?self:"object"==typeof i.g?i.g:{},void 0!==t.globals.vscode&&void 0!==t.globals.vscode.process?o=t.globals.vscode.process:"undefined"!=typeof process&&(o=process);const r="string"==typeof(null===(n=null==o?void 0:o.versions)||void 0===n?void 0:n.electron)&&"renderer"===o.type;let a=!1,s=!1,c=!1,d=!1;"object"!=typeof navigator||r?"object"==typeof o&&(a=!1,c="win32"===o.platform,s="darwin"===o.platform,d="linux"===o.platform):(a=!0,c=navigator.userAgent.indexOf("Windows")>=0,s=navigator.userAgent.indexOf("Macintosh")>=0,d=navigator.userAgent.indexOf("Linux")>=0),t.isWeb=a,t.isMac=s,t.isWindows=c,t.isLinux=d},(e,t)=>{"use strict";function i(e,t){const i=e.workspaceState.get("workbenchState"),n=null==i?void 0:i[t];return n&&3===n.version?n:{version:3,entries:[]}}function n(e){return i(e,"global")}function o(e,t){const i=n(e);for(const e of i.entries){const i=t.entries.findIndex((t=>t.id===e.id));t.entries.splice(i,1)}t.entries.push(...i.entries)}Object.defineProperty(t,"__esModule",{value:!0}),t.mixinGlobalState=t.getWorkbenchState=t.getGlobalState=void 0,t.getGlobalState=n,t.getWorkbenchState=function(e,t){const n=i(e,t.toString());return o(e,n),n},t.mixinGlobalState=o},e=>{"use strict";e.exports=require("v8")},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.setVscodeContext=t.BuiltInCommands=t.ImageDocument=void 0;const o=i(4),r=i(2),a=i(12),s=i(17),c=i(19),d=i(20),u=i(14);class l extends c.Disposable{constructor(e,t,i,n){var o;if(super(),this._context=e,this.uri=t,this._initData=i,this._isInitialized=!1,this._editIndex=0,this._savedEditIndex=0,this._hasContentChanged=!1,this._fileWatcherDisposables=[],this._isActive=!1,this._globalState=new Map,this._workbenchState=new Map,this._perfMetrics={startEvent:0,webviewReadyEvent:0,dataReadyEvent:0,finishEvent:0,totalDuration:0,parseDuration:0,dataTransportDuration:0},this._onDisposed=new r.EventEmitter,this.onDisposed=this._onDisposed.event,this._onDidChange=new r.EventEmitter,this.onDidChange=this._onDidChange.event,this._onDidUpdateGlobalState=new r.EventEmitter,this.onDidUpdateGlobalState=this._onDidUpdateGlobalState.event,this._onRequestReload=new r.EventEmitter,this.onRequestReload=this._onRequestReload.event,this._onMimeTypeChange=new r.EventEmitter,this.onMimeTypeChange=this._onMimeTypeChange.event,this._onDidEncounterDecodeProblem=new r.EventEmitter,this.onDidEncounterDecodeProblem=this._onDidEncounterDecodeProblem.event,3===(null===(o=this._initData.workbenchState)||void 0===o?void 0:o.version))for(const e of this._initData.workbenchState.entries)this._workbenchState.set(e.id,e.state);this._perfMetrics.startEvent=void 0!==n?n:d.perf.now(),this._setupFileWatcher(t)}get ipcClient(){return this._ipcClient}get isActive(){return this._isActive}set isActive(e){this._isActive=e,this._isActive&&this._hasContentChanged&&this._showContentChangedWarning()}get _isDirty(){return this._editIndex!==this._savedEditIndex}dispose(){const e=this._context.workspaceState.get("workbenchState");e&&this.uri.toString()in e&&(delete e[this.uri.toString()],this._context.workspaceState.update("workbenchState",e)),this._onDisposed.fire(),super.dispose()}_setupFileWatcher(e){var t;if((null===(t=this._fileWatcherUri)||void 0===t?void 0:t.toString())===e.toString())return;this._fileWatcherUri=e,(0,c.disposeArray)(this._fileWatcherDisposables);const i=r.workspace.createFileSystemWatcher(new r.RelativePattern(e,"*"));this._fileWatcherDisposables.push(i),this._fileWatcherDisposables.push(i.onDidChange((()=>n(this,void 0,void 0,(function*(){return this._handleFileChangeEvent(e)}))))),this._fileWatcherDisposables.push(i.onDidCreate((()=>n(this,void 0,void 0,(function*(){return this._handleFileChangeEvent(e)})))))}_handleFileChangeEvent(e){return n(this,void 0,void 0,(function*(){const t=yield r.workspace.fs.stat(e);var i,n;this._lastSaveStat&&(i=t,(n=yield this._lastSaveStat)&&i.ctime===n.ctime&&i.mtime===n.mtime&&i.size===n.size)||(this._isActive?this._isDirty?yield this._showContentChangedWarning():this._onRequestReload.fire():this._hasContentChanged=!0)}))}_showContentChangedWarning(){return n(this,void 0,void 0,(function*(){"Reload"===(yield r.window.showWarningMessage("The image changed on disk, do you want to reload the file?","Reload"))&&(yield r.commands.executeCommand("workbench.action.files.revert"),this._onRequestReload.fire())}))}getIpcClientOrThrow(){if(!this._ipcClient)throw new Error(`No IPC client for document ${this.uri.toString()}`);return this._ipcClient}save(e){return n(this,void 0,void 0,(function*(){this._isDirty?yield this.saveAs(this.uri,e):console.warn("Attempt to save when not dirty")}))}saveAs(e,t){return n(this,void 0,void 0,(function*(){const i=this.getIpcClientOrThrow(),n={startEvent:d.perf.now(),writeStartEvent:0,writeFinishEvent:0,finishEvent:0,encodeDuration:0,dataTransportDuration:0,totalDuration:0},o="off"!==r.workspace.getConfiguration("files").get("autoSave"),a=yield i.request("save",{isAutoSaveEnabled:o});if(t.isCancellationRequested)return;n.encodeDuration=a.encodeDuration,n.writeStartEvent=d.perf.now(),n.dataTransportDuration=n.writeStartEvent-n.startEvent-n.encodeDuration;const s=new Uint8Array(a.blobBuffer);yield r.workspace.fs.writeFile(e,s),n.writeFinishEvent=d.perf.now(),this._lastSaveStat=r.workspace.fs.stat(e),yield this._lastSaveStat,this._setupFileWatcher(e),this._savedEditIndex=this._editIndex,this._latestBackupUri&&(yield r.workspace.fs.delete(this._latestBackupUri),this._latestBackupUri=void 0,this._latestBackupContent=void 0),n.finishEvent=d.perf.now(),n.totalDuration=n.finishEvent-n.startEvent,m(`Save perf: ${this.uri.fsPath}`,n)}))}revert(){this._latestBackupUri=void 0,this._lastSaveStat=void 0,this._editIndex=0,this._savedEditIndex=0,this._hasContentChanged=!1,this._isInitialized=!0}backup(e,t){return n(this,void 0,void 0,(function*(){const i=this.getIpcClientOrThrow(),o=r.workspace.getConfiguration().get("luna.hotExitMaxPixels",0),s=yield i.request("backup",{hotExitMaxPixels:o});if(t.isCancellationRequested)throw new Error("Backup canceled");if(!s.success)throw new Error("Could not backup file as it's too large");return yield(0,a.saveBackupData)(e.destination,{state:s.state,workbenchState:s.workbenchState}),this._latestBackupUri=e.destination,this._latestBackupContent=void 0,{id:e.destination.toString(),delete:()=>n(this,void 0,void 0,(function*(){this._latestBackupUri&&this._latestBackupUri.toString()===e.destination.toString()&&(this._latestBackupContent=s.state);try{yield r.workspace.fs.delete(e.destination)}catch(e){}}))}}))}setupIpc(e){const t=new s.WebviewIpcClient(e);return t.registerRequestHandler("backupClipboardData",(e=>{"newFromClipboard"===this._initData.type&&(this._initData.data=e)})),t.registerRequestHandler("historyNewEdit",(e=>{this._editIndex++,this._onDidChange.fire({document:this,label:e.label,redo:()=>n(this,void 0,void 0,(function*(){if(this._editIndex++,!(yield t.request("luna.executeCommand","edit.redo")).success)throw new Error(`Could not redo entry "${e.label}"`)})),undo:()=>n(this,void 0,void 0,(function*(){if(this._editIndex--,!(yield t.request("luna.executeCommand","edit.undo")).success)throw new Error(`Could not undo entry "${e.label}"`)}))})})),t.registerRequestHandler("inputBoxNumber",(e=>n(this,void 0,void 0,(function*(){const t=yield r.window.showInputBox({title:e.title,prompt:e.prompt,value:e.defaultValue.toString(),validateInput:t=>p(t,e.defaultValue,e.minValue,e.maxValue)});return void 0===t?void 0:g(t,e.defaultValue)})))),t.registerRequestHandler("inputBoxNumberOrDimensionsShorthand",(e=>n(this,void 0,void 0,(function*(){const t=yield r.window.showInputBox({prompt:e.prompt,title:e.title,value:e.widthDefaultValue.toString(),validateInput:t=>{if(!t.match(/^\d+%?x\d+%?/))return p(t,e.widthDefaultValue,e.minValue,e.maxValue)}});if(null==t?void 0:t.includes("x")){const i=t.split("x");return{width:g(i[0],e.widthDefaultValue),height:g(i[1],e.heightDefaultValue)}}return void 0===t?void 0:g(t,e.widthDefaultValue)})))),t.registerRequestHandler("inputBoxString",(e=>n(this,void 0,void 0,(function*(){return yield r.window.showInputBox({prompt:e.prompt,value:e.defaultValue})})))),t.registerRequestHandler("quickPick",(e=>n(this,void 0,void 0,(function*(){var t;return null===(t=yield r.window.showQuickPick(e.items,e.options))||void 0===t?void 0:t.id})))),t.registerRequestHandler("vscode.executeCommand",(e=>n(this,void 0,void 0,(function*(){return r.commands.executeCommand(e.command,e.args)})))),t.registerRequestHandler("vscode.setContext",(e=>n(this,void 0,void 0,(function*(){yield f(e.key,e.value)})))),t.registerRequestHandler("ready",(()=>n(this,void 0,void 0,(function*(){let e;if(this._perfMetrics.webviewReadyEvent=d.perf.now(),!e&&this._workbenchState.size>0){e={version:3,entries:[]};for(const[t,i]of this._workbenchState.entries())e.entries.push({id:t,state:i});(0,u.mixinGlobalState)(this._context,e)}if(e||(e=(0,u.getWorkbenchState)(this._context,this.uri)),this._latestBackupUri){let t;if(this._latestBackupContent)t=this._latestBackupContent;else{const i=yield(0,a.getBackupData)(this._context,this._latestBackupUri);t=i.state,e=i.workbenchState}if(t&&!(t.version<8))return this._perfMetrics.dataReadyEvent=d.perf.now(),{type:"restore",config:this._getLunaConfig(),state:t,workbenchState:e,editIndex:this._editIndex,restoreHistory:!0};r.window.showWarningMessage("Extension was updated, could not restore image from backup")}if(!this._isInitialized)return this._isInitialized=!0,this._initData.workbenchState=e,this._perfMetrics.dataReadyEvent=d.perf.now(),this._initData;try{const t=yield r.workspace.fs.readFile(this.uri);if(this._lastSaveStat=r.workspace.fs.stat(this.uri),yield this._lastSaveStat,0===t.length){const t=r.workspace.getConfiguration("luna.defaultImageSize",this.uri);return this._perfMetrics.dataReadyEvent=d.perf.now(),{type:"new",config:this._getLunaConfig(),workbenchState:e,dimensions:{width:t.get("width",800),height:t.get("height",600)}}}return this._perfMetrics.dataReadyEvent=d.perf.now(),{type:"open",config:this._getLunaConfig(),workbenchState:e,data:t,extName:(0,o.extname)(this.uri.path),isReadonly:this._initData.isReadonly}}catch(t){return r.window.showInformationMessage("This image could not be restored from hot exit, try saving the file and/or turning the luna.retainContextWhenHidden setting on"),this._initData.workbenchState=e,this._perfMetrics.dataReadyEvent=d.perf.now(),this._initData}})))),t.registerRequestHandler("parseFinished",(e=>n(this,void 0,void 0,(function*(){this._perfMetrics.parseDuration=e.duration,this._perfMetrics.finishEvent=d.perf.now(),this._perfMetrics.dataTransportDuration=this._perfMetrics.finishEvent-this._perfMetrics.dataReadyEvent-this._perfMetrics.parseDuration,this._perfMetrics.totalDuration=this._perfMetrics.finishEvent-this._perfMetrics.startEvent,m(`Open perf: ${this.uri.fsPath}`,this._perfMetrics)})))),t.registerRequestHandler("reportIssue",(()=>n(this,void 0,void 0,(function*(){r.commands.executeCommand("workbench.action.openIssueReporter",{extensionId:"tyriar.luna-paint"})})))),t.registerRequestHandler("setMimeType",(e=>{this._onMimeTypeChange.fire(e)})),t.registerRequestHandler("showDecodeProblemStatusBarEntry",(e=>{this._onDidEncounterDecodeProblem.fire(e.level)})),t.registerRequestHandler("updateWorkbenchState",(e=>{e.global?this._globalState.set(e.id,e.state):this._workbenchState.set(e.id,e.state);const t=this._context.workspaceState.get("workbenchState")||{},i={version:3,entries:[]};if(e.global){for(const[e,t]of this._globalState.entries())i.entries.push({id:e,state:t});t.global=i}else{for(const[e,t]of this._workbenchState.entries())i.entries.push({id:e,state:t});t[this.uri.toString()]=i}this._context.workspaceState.update("workbenchState",t),e.global&&this._onDidUpdateGlobalState.fire(i)})),this._ipcClient=t,t}syncGlobalState(e){var t;return n(this,void 0,void 0,(function*(){yield null===(t=this._ipcClient)||void 0===t?void 0:t.request("syncGlobalState",e)}))}_getLunaConfig(){var e,t,i,n;const o=r.workspace.getConfiguration();return{mouseWheelBehavior:null!==(e=o.get("luna.mouseWheelBehavior"))&&void 0!==e?e:"scroll",snapToPixelGrid:null===(t=o.get("luna.snapToPixelGrid"))||void 0===t||t,statusBarPointerColor:null!==(i=o.get("luna.statusBar.pointerColor"))&&void 0!==i?i:"currentLayer",defaultTool:null!==(n=o.get("luna.defaultTool"))&&void 0!==n?n:"selection"}}}var h;function f(e,t){return r.commands.executeCommand(h.SetContext,e,t)}function p(e,t,i,n){if(!e.match(/^[0-9]+%?$/))return"Enter a valid number";const o=g(e,t);return void 0!==i&&o<i?`Enter a number greater than or equal to ${i}`:void 0!==n&&o>n?`Enter a number less than or equal to ${n}`:void 0}function g(e,t){return e.endsWith("%")?Math.round(parseInt(e)/100*t):parseInt(e)}function m(e,t){if(r.workspace.getConfiguration().get("luna.developer.logPerfMetrics")){const i={},n={};for(const e of Object.keys(t)){const o=t[e];e.endsWith("Event")?i[e]={"Time (ms)":parseFloat((o-t.startEvent).toFixed(2)),"Percent (%)":Math.round((t[e]-t.startEvent)/t.totalDuration*100)}:n[e]={"Duration (ms)":parseFloat(o.toFixed(2))}}console.info(`\n${e}`),console.table(n),console.table(i)}}t.ImageDocument=l,function(e){e.SetContext="setContext"}(h=t.BuiltInCommands||(t.BuiltInCommands={})),t.setVscodeContext=f},function(e,t,i){"use strict";var n=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))((function(o,r){function a(e){try{c(n.next(e))}catch(e){r(e)}}function s(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,s)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.WebviewIpcClient=void 0;const o=i(18),r=i(13);t.WebviewIpcClient=class{constructor(e){this._webview=e,this._webviewRequestHandlers=new Map,this._activeRequests=new Map,this._webview.onDidReceiveMessage((e=>n(this,void 0,void 0,(function*(){if("extHostRequestId"in e){const t=e.extHostRequestId,i=this._activeRequests.get(t);if(!i)throw new Error(`Response received without request "${t}"`);return this._activeRequests.delete(t),void i(r.isWeb?(0,o.deserializeFromJson)(e.body):e.body)}if("webviewRequestId"in e){const t=this._webviewRequestHandlers.get(e.type);if(!t)throw new Error(`No handler for webview request "${e.type}"`);const i=yield t(e.body),n={type:e.type,body:r.isWeb?(0,o.serializeToJson)(i):i,webviewRequestId:e.webviewRequestId};this._webview.postMessage(n)}}))))}registerRequestHandler(e,t){if(this._webviewRequestHandlers.has(e))throw new Error(`Duplicate webview request handler "${e}"`);this._webviewRequestHandlers.set(e,t)}request(e,t){return n(this,void 0,void 0,(function*(){const i=Math.round(1e6*Math.random());return yield new Promise((n=>{this._activeRequests.set(i,n);const o={type:e,body:t,extHostRequestId:i};this._webview.postMessage(o)}))}))}}},(e,t,i)=>{"use strict";function n(e){if(!e||"object"!=typeof e)return e;const t={};for(const i of Object.keys(e)){const n=e[i];"object"==typeof n?"readyPromise"in n?t[i]=r(n):n instanceof Float32Array?t[i]=s(n,"Float32Array"):n instanceof Uint8Array?t[i]=s(n,"Uint8Array"):n instanceof Uint16Array?t[i]=s(n,"Uint16Array"):n instanceof Uint32Array?t[i]=s(n,"Uint32Array"):t[i]=n:t[i]=n}return t}function o(e){if(!e||"object"!=typeof e)return e;const t={};for(const r of Object.keys(e)){const s=e[r];"object"==typeof s?"dataType"in s?"pending"===s.dataType?t[r]=a(s):t[r]=(n=s,new i.g[n.dataType](n.data)):t[r]=o(s):t[r]=s}var n;return t}function r(e){return{dataType:"pending",data:n(e.resource)}}function a(e){const t=o(e.data);return{resource:t,readyPromise:Promise.resolve(t),isReady:!0}}function s(e,t){return{dataType:t,data:Array.from(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeFromJson=t.serializeToJson=void 0,t.serializeToJson=n,t.deserializeFromJson=o},(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disposeArray=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){if(this._isDisposed)throw new Error("Attempt to dispose a disposed entity");this._isDisposed=!0;for(const e of this._disposables)e.dispose();this._disposables.length=0}register(e){return this._disposables.push(e),e}unregister(e){const t=this._disposables.indexOf(e);-1!==t&&this._disposables.splice(t,1)}},t.disposeArray=function(e){for(const t of e)t.dispose();e.length=0}},(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.perf=void 0;const n=i(13);t.perf=n.isWeb?self.performance:i(21).performance},e=>{"use strict";e.exports=require("perf_hooks")}],t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n].call(r.exports,r,r.exports,i),r.exports}i.m=e,i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>e+".js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={0:1};i.f.i=(t,n)=>{e[t]||importScripts(i.p+i.u(t))};var t=self.webpackChunkluna=self.webpackChunkluna||[],n=t.push.bind(t);t.push=t=>{var[o,r,a]=t;for(var s in r)i.o(r,s)&&(i.m[s]=r[s]);for(a&&a(i);o.length;)e[o.pop()]=1;n(t)}})();var n={};(()=>{"use strict";var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=i(1);e.activate=function(e){(0,t.activate)(e)},e.deactivate=function(){}})();var o=exports;for(var r in n)o[r]=n[r];n.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();