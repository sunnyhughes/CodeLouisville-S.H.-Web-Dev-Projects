"use strict";const a16_0x5483=["moveStep","_movingLayerOrigin","1lUWBit","pointerDownMove","exclusion","moving","bottomleft","onBeforeRunLayerTask","register","Move Pixels","actions","1070624GUJGUq","_allowNewState","pointerUp","webpackChunkluna","fire","data","range","runTask","type","currentLayer","Expand Canvas to Selection","onLayerChange","edit","_cursorOrigin","_renderer","1169359TVCsuP","selectionService","createCompositeEntry","value","854617WsdTQP","Nearest Neighbor","left","getCoordsFromEvent","string-combo","35aYSDbj","_cursorCurrent","_isYFlipping","setVisible","flipY","difference","add","shiftKey","lighten","name","height","validate","ArrowLeft","setValueFromHistoryChange","keyDown","_setupActiveTemporaryLayer","bottomright","normal","setTopLeft","zoom","_getRange","ctrlKey","offsetY","createElement","onHistoryAction","viewportService","currentState","_directionalMoveZones","classList","_getQualityString","_refreshLayerSelectionRange","Quality","_originalSelection","moveToRange","div","_onUpdate","onHistoryUnset","_activeMovingLayer","right","_onOptionsChange","Bilinear","ArrowDown","bottom","591258TJCRkV","options","enabled","replace","setRange","192442secPHj","_onRequestRender","onStateChange","move","_startMove","_activeLayer","_isVisible","set","commit","onHistoryUpdateValue","linearBurn","string","onRequestRender","_elementContainer","_viewportService","max","round","metaKey","movePixels","isReady","registerTemporaryLayer","No moving layer","temporaryLayer","min","_onStateChange","floor","flipX","linearDodgeAdd","46450lzcOaV","move-handle","historyService","darken","number","devicePixelRatio","211477nTXMtv","_isFirstMove","onUpdate","state","new","softLight","triggerRequestRender","key","quality","bilinear","_expandCanvasToSelectionAction","optionStep","3noeyxl","Blend Mode","_clearMovingLayer","createDomRenderProgram","_directionalMoveElements","topleft","pointerDown","_qualityOption","createCompositeEntrySync","_finishSelection","Set Quality Sampling","removeChild","display","_sc","ArrowRight","pointerMove","appendChild","topright","boolean","offsetX","style","MoveImageRangeRenderer","onUpdateEmitter","_isXFlipping","_container","getPointerState","finishSelection","push","cutImage","imageService","_imageService","_onHistoryUpdateValue","dispose","ArrowUp","_value","clientHeight","_getQualityValue","width","taskWorkerService","resource","multiply","screen","get","taskService","top","Finish Selection","altKey","allowUnchecking","event","Move Selected Pixels","nearestneighbor","_enabled","_refreshActionEnabledState"],a16_0x54e3=function(t,i){return a16_0x5483[t-=145]},a16_0x3278b5=a16_0x54e3;!function(t,i){const s=a16_0x54e3;for(;;)try{if(897807===parseInt(s(154))+parseInt(s(297))+parseInt(s(302))*-parseInt(s(166))+parseInt(s(245))*-parseInt(s(221))+-parseInt(s(148))*-parseInt(s(254))+parseInt(s(230))+-parseInt(s(249)))break;t.push(t.shift())}catch(i){t.push(t.shift())}}(a16_0x5483),(self.webpackChunkluna=self[a16_0x3278b5(233)]||[])[a16_0x3278b5(193)]([[687,504],{6173:(t,i,s)=>{const e=a16_0x3278b5;s.d(i,{f:()=>o});var h=s(1815),n=s(5120);class o extends n.JT{constructor(t,i,s){const e=a16_0x54e3;super(),this[e(263)]=t,this.type=i,this[e(217)]=s,this[e(289)]=this[e(227)](new h.v),this.onUpdate=this[e(289)][e(214)]}get[e(299)](){return this[e(217)]}set enabled(t){const i=e;this[i(217)]!==t&&(this._enabled=t,this[i(289)][i(234)]())}}},9904:(t,i,s)=>{const e=a16_0x3278b5;s.d(i,{FV:()=>r,rP:()=>a,tv:()=>c,Jp:()=>l,X5:()=>p,qv:()=>u});var h=s(1815),n=s(5120),o=s(2939);class r extends n.JT{constructor(t,i,s,e=!0){const n=a16_0x54e3;super(),this.name=t,this.hasImage=i,this[n(200)]=s,this[n(213)]=e,this[n(238)]=n(184),this[n(197)]=this.register(new h.v),this.onHistoryUpdateValue=this[n(197)][n(214)],this._onUpdate=this[n(227)](new h.v),this[n(156)]=this[n(289)][n(214)]}get[e(248)](){return this[e(200)]}set[e(248)](t){const i=e;this[i(200)]=t,this[i(289)][i(234)](t)}[e(267)](t){const i=e;this[i(200)]=t,this[i(197)].fire(t)}}class a extends n.JT{constructor(t,i,s){const n=e;super(),this[n(263)]=t,this[n(298)]=i,this._value=s,this[n(238)]=n(313),this._onHistoryUpdateValue=this.register(new h.v),this[n(311)]=this[n(197)].event,this[n(289)]=this[n(227)](new h.v),this.onUpdate=this[n(289)].event}get[e(248)](){return this[e(200)]}set value(t){const i=e;this[i(200)]=t,this[i(289)][i(234)](t)}[e(267)](t){const i=e;this._value=t,this[i(197)][i(234)](t)}}class c extends n.JT{constructor(t,i,s){const n=e;super(),this.name=t,this[n(298)]=i,this[n(200)]=s,this[n(238)]=n(253),this[n(197)]=this[n(227)](new h.v),this[n(311)]=this[n(197)][n(214)],this[n(289)]=this[n(227)](new h.v),this[n(156)]=this._onUpdate[n(214)]}get[e(248)](){return this[e(200)]}set[e(248)](t){const i=e;this[i(200)]=t,this[i(289)][i(234)](t)}setValueFromHistoryChange(t){this[e(200)]=t,this._onHistoryUpdateValue.fire(t)}}class l extends a{constructor(){const t=e;super(t(167),[t(271),t(300),t(151),t(206),"linearBurn",t(262),"screen",t(147),"overlay",t(159),t(259),t(223)],t(271))}}class p extends n.JT{constructor(t,i,s,n){const o=e;super(),this.name=t,this[o(200)]=i,this[o(325)]=s,this[o(317)]=n,this.type=o(152),this[o(197)]=this[o(227)](new h.v),this.onHistoryUpdateValue=this[o(197)][o(214)],this._onUpdate=this[o(227)](new h.v),this[o(156)]=this[o(289)][o(214)]}get value(){const t=e;return(0,o.u)(this[t(200)],this[t(317)],this.min)}set[e(248)](t){const i=e;this[i(200)]=t,this[i(289)][i(234)](t)}[e(267)](t){const i=e;this[i(200)]=t,this[i(197)][i(234)](t)}}class u extends p{constructor(t,i,s,h){const n=e;super(t,i,s,h),this[n(238)]="number"}get[e(248)](){const t=e;return(0,o.u)(this[t(200)],this[t(317)],this.min)}set[e(248)](t){const i=e;this[i(200)]=Math[i(145)](t),this._onUpdate.fire(t)}}},504:(t,i,s)=>{const e=a16_0x3278b5;s.r(i),s.d(i,{MoveImageRangeRenderer:()=>o});var h=s(5120),n=s(1003);class o extends h.JT{constructor(t,i,s,e,h){const o=a16_0x54e3;super(),this[o(190)]=t,this[o(274)]=i,this[o(231)]=s,this[o(316)]=e,this[o(196)]=h,this.order=2,this[o(170)]=new Map,this[o(281)]=new Map,this[o(308)]=!0,this[o(315)]=document[o(277)](o(288));const r=["topleft",o(183),o(225),"bottomright",o(210),"bottom","left",o(292)];for(const t of r){const i=document[o(277)](o(288));i[o(282)][o(260)](o(149),t),this[o(315)][o(182)](i),this[o(170)][o(309)](t,i),this[o(281)][o(309)](t,(0,n.Pq)())}this[o(190)][o(182)](this[o(315)]),this[o(227)]({dispose:()=>{const t=o;this._container[t(177)](this[t(315)])}})}setVisible(t){const i=a16_0x54e3;t!==this[i(308)]&&(this[i(315)][i(186)][i(178)]=t?"":"none",this[i(308)]=t)}[e(301)](t){}render(){const t=e,i=this[t(274)]();if(!i)return;const s=this._imageService[t(239)];if(!s)return;const h=this[t(316)],n=Math.round(this[t(190)].clientWidth/2)-s.width/2*h.zoom,o=Math[t(318)](this[t(190)][t(201)]/2)-s[t(264)]/2*h[t(273)],r=n+(h.x+i[t(251)])*h[t(273)],a=o+(h.y+i[t(210)])*h[t(273)],c=n+(h.x+i[t(292)])*h[t(273)],l=o+(h.y+i[t(296)])*h.zoom,p=Math[t(318)]((r+c)/2),u=Math[t(318)]((a+l)/2),g=10*window[t(153)],v={left:Math[t(325)](r+g,Math[t(317)](r,p-g)),top:Math[t(325)](a+g,Math.max(a,u-g)),right:Math[t(317)](c-g,Math.min(c,p+g)),bottom:Math[t(317)](l-g,Math[t(325)](l,u+g))},_={left:r-g,top:a-g,right:c+g,bottom:l+g},d=this[t(281)][t(208)](t(171));d[t(251)]=_.left,d[t(292)]=v.left,d.top=_[t(210)],d[t(296)]=v.top;const y=this[t(170)][t(208)](t(171));y[t(186)][t(251)]=r+"px",y[t(186)].top=a+"px";const f=this[t(281)][t(208)]("topright");f[t(251)]=v[t(292)],f[t(292)]=_[t(292)],f.top=_[t(210)],f[t(296)]=v.top;const m=this[t(170)][t(208)](t(183));m[t(186)][t(251)]=c+"px",m[t(186)].top=a+"px";const w=this[t(281)][t(208)]("bottomleft");w[t(251)]=_[t(251)],w[t(292)]=v.left,w[t(210)]=v[t(296)],w[t(296)]=_[t(296)];const M=this[t(170)][t(208)]("bottomleft");M[t(186)][t(251)]=r+"px",M[t(186)][t(210)]=l+"px";const x=this[t(281)].get(t(270));x[t(251)]=v[t(292)],x[t(292)]=_[t(292)],x[t(210)]=v[t(296)],x[t(296)]=_[t(296)];const S=this[t(170)][t(208)](t(270));S[t(186)].left=c+"px",S[t(186)][t(210)]=l+"px";const b=this._directionalMoveZones.get("top");b.left=v.left,b[t(292)]=v[t(292)],b.top=_.top,b[t(296)]=v.top;const L=this[t(170)][t(208)](t(210));L[t(186)][t(251)]=p+"px",L[t(186)][t(210)]=a+"px";const R=this[t(281)][t(208)](t(296));R.left=v[t(251)],R[t(292)]=v[t(292)],R[t(210)]=v[t(296)],R[t(296)]=_.bottom;const k=this._directionalMoveElements[t(208)](t(296));k[t(186)][t(251)]=p+"px",k[t(186)][t(210)]=l+"px";const T=this[t(281)][t(208)]("left");T[t(251)]=_[t(251)],T[t(292)]=v[t(251)],T[t(210)]=v[t(210)],T[t(296)]=v[t(296)];const U=this[t(170)][t(208)](t(251));U.style[t(251)]=r+"px",U.style[t(210)]=u+"px";const C=this._directionalMoveZones[t(208)]("right");C.left=v.right,C[t(292)]=_[t(292)],C.top=v.top,C[t(296)]=v[t(296)];const A=this[t(170)][t(208)](t(292));A[t(186)][t(251)]=c+"px",A[t(186)][t(210)]=u+"px"}[e(191)](t){const i=e;if(!this[i(274)]())return this[i(231)]?i(158):i(305);for(const[s,e]of this[i(281)])if((0,n.RB)(e,t[i(185)],t[i(276)]))return s;const s=this[i(281)][i(208)]("topleft"),h=this[i(281)][i(208)](i(270)),o={left:s[i(251)],top:s[i(210)],right:h[i(292)],bottom:h[i(296)]};return(0,n.RB)(o,t.offsetX,t.offsetY)?i(305):this[i(231)]?"new":i(305)}}},687:(t,i,s)=>{const e=a16_0x3278b5;s.r(i),s.d(i,{default:()=>g});var h=s(1815),n=s(5120),o=s(7896),r=s(1003),a=s(270),c=s(6173),l=s(9904),p=s(504);class u extends n.JT{constructor(t){const i=a16_0x54e3;super(),this._sc=t,this.id=i(320),this[i(157)]=i(305),this[i(155)]=!0,this._expandCanvasToSelectionAction=new c.f(i(240),"expand-canvas-to-selection",!1),this[i(229)]=[this[i(164)]],this[i(173)]=new l.rP(i(285),["Bilinear",i(250)],"Bilinear"),this[i(298)]=[this._qualityOption],this[i(303)]=this[i(227)](new h.v),this[i(314)]=this[i(303)][i(214)],this[i(326)]=this[i(227)](new h.v),this[i(304)]=this._onStateChange[i(214)],this[i(227)](this[i(173)][i(156)]((()=>this._updateQuality()))),this.register(this[i(179)].imageService[i(241)]((()=>this[i(175)]()))),this.register(this[i(179)][i(209)][i(226)]((async t=>{const s=i;t[s(192)]&&await this[s(175)]()}))),this[i(227)](this[i(179)].selectionService[i(156)]((()=>{const t=i;this[t(284)](),this._refreshActionEnabledState(),this._onRequestRender[t(234)]()}))),this.register(this._sc[i(195)].onTemporaryLayerRegistered((t=>this[i(269)](t)))),this[i(179)][i(195)].currentLayer?.[i(324)]&&this[i(269)](this[i(179)].imageService[i(239)].temporaryLayer),this[i(218)]()}_setupActiveTemporaryLayer(t){const i=a16_0x54e3;t[i(238)]===i(224)&&(this[i(291)]=t,this.register(this._activeMovingLayer[i(278)]((()=>this[i(293)]()))),this[i(227)](this[i(291)][i(290)]((()=>this[i(168)]()))),this[i(244)]?.[i(257)](!0),this[i(284)](),this[i(218)](),this._onRequestRender[i(234)]())}[e(284)](){const t=e;if(!this[t(291)])return;const i=this[t(179)].selectionService[t(236)];i&&this[t(291)][t(287)](i)}[e(218)](){const t=e,i=this[t(179)][t(246)][t(236)],s=!(!i||(0,r.ur)((0,r.DI)(this[t(179)][t(195)].width,this._sc[t(195)][t(264)]),i));this[t(164)][t(299)]=s}[e(293)](){const t=e;this._activeMovingLayer&&this._qualityOption[t(267)](this[t(283)](this._activeMovingLayer[t(280)].quality))}[e(198)](){this[e(175)](),super.dispose()}async[e(172)](t){const i=e;if(this._activeLayer=this[i(179)][i(195)][i(239)],!this[i(307)])return;const s=this[i(179)][i(246)][i(236)]||this[i(179)][i(195)].selectAll();this._isFirstMove=!this._activeMovingLayer,this[i(243)]=this[i(179)][i(279)][i(252)](t),this[i(255)]=this._cursorOrigin.slice(),this._movingLayerOrigin=[s.left,s.top],await this[i(306)](this[i(307)],s),this[i(189)]=!1,this[i(256)]=!1,this._originalSelection=this[i(179)].selectionService.range,"new"!==this[i(157)]&&this._originalSelection&&((this[i(157)]===i(210)||this[i(157)]===i(171)||this.state===i(183))&&(this[i(243)][1]=this[i(286)].top),(this[i(157)]===i(296)||this[i(157)]===i(225)||this[i(157)]===i(270))&&(this[i(243)][1]=this[i(286)][i(296)]-1),(this[i(157)]===i(251)||this.state===i(171)||this[i(157)]===i(225))&&(this[i(243)][0]=this._originalSelection.left),(this[i(157)]===i(292)||"topright"===this[i(157)]||"bottomright"===this.state)&&(this[i(243)][0]=this[i(286)][i(292)]-1))}async[e(232)](t){const i=e;if(!this[i(307)])return;if(!this[i(291)])return;const s=this[i(291)],h=this[i(155)]?i(215):i(228);this[i(179)][i(150)][i(174)](h,(()=>{const t=i;s[t(219)](),this._sc[t(246)].commit(h)})),this._isFirstMove=!1,this[i(181)](t,!1)}[e(181)](t,i){const s=e;if(this[s(244)]&&!i){const i=this[s(244)][s(191)](t);this[s(157)]!==i&&(this[s(157)]=i,this._onStateChange[s(234)]())}}[e(222)](t){const i=e;if(!this[i(291)]||!this[i(243)]||!this[i(220)])return;if(this[i(255)]=this[i(179)][i(279)][i(252)](t),"move"===this[i(157)]){const t=this[i(220)][0]+this[i(255)][0]-this[i(243)][0],s=this[i(220)][1]+this[i(255)][1]-this[i(243)][1];return void this[i(179)].selectionService.setTopLeft(t,s)}if(!this[i(286)])return;const s=this[i(255)][0]-this[i(243)][0],h=this[i(255)][1]-this._cursorOrigin[1];let n;if(!t[i(261)]||this[i(157)]!==i(171)&&"topright"!==this[i(157)]&&this[i(157)]!==i(225)&&this[i(157)]!==i(270))n=(0,r.BN)(this[i(286)]),(this.state===i(210)||this[i(157)]===i(171)||this[i(157)]===i(183))&&(n[i(210)]+=h,n[i(296)]<=n[i(210)]&&n[i(210)]++,t[i(212)]&&(n[i(296)]-=h)),(this[i(157)]===i(296)||this[i(157)]===i(225)||"bottomright"===this[i(157)])&&(n[i(296)]+=h,n[i(296)]<=n[i(210)]&&n[i(296)]--,t[i(212)]&&(n[i(210)]-=h)),(this.state===i(251)||this[i(157)]===i(171)||this[i(157)]===i(225))&&(n.left+=s,n[i(292)]<=n[i(251)]&&n[i(251)]++,t.altKey&&(n[i(292)]-=s)),("right"===this[i(157)]||this[i(157)]===i(183)||this[i(157)]===i(270))&&(n[i(292)]+=s,n.right<=n[i(251)]&&n.right--,t[i(212)]&&(n[i(251)]-=s));else{const e=(0,r.n3)(this[i(286)]);let o;switch(n=(0,r.BN)(this[i(286)]),this[i(157)]){case"topleft":o=(1/e*-s-h)/2,n[i(251)]-=Math[i(318)](o*e),n[i(210)]-=Math[i(318)](o),t[i(212)]&&(n[i(292)]+=Math[i(318)](o*e),n[i(296)]+=Math.round(o));break;case i(183):o=(s*(1/e)-h)/2,n[i(292)]+=Math.round(o*e),n.top-=Math[i(318)](o),t[i(212)]&&(n[i(251)]-=Math[i(318)](o*e),n[i(296)]+=Math.round(o));break;case i(225):o=(1/e*-s+h)/2,n[i(251)]-=Math[i(318)](o*e),n[i(296)]+=Math[i(318)](o),t[i(212)]&&(n[i(292)]+=Math.round(o*e),n[i(210)]-=Math[i(318)](o));break;case i(270):o=(s*(1/e)+h)/2,n[i(292)]+=Math[i(318)](o*e),n[i(296)]+=Math[i(318)](o),t.altKey&&(n[i(251)]-=Math[i(318)](o*e),n.top-=Math[i(318)](o))}}const o=this._isXFlipping;this[i(189)]=n[i(292)]<n.left,this[i(189)]!==o&&(this[i(291)][i(280)][i(146)]=!this[i(291)][i(280)].flipX);const a=this._isYFlipping;this[i(256)]=n[i(296)]<n[i(210)],this[i(256)]!==a&&(this[i(291)][i(280)][i(258)]=!this[i(291)][i(280)][i(258)]),this[i(179)][i(246)][i(236)]=(0,r.FJ)(n)}async[e(268)](t){const i=e;if(!this[i(307)]&&(this[i(307)]=this[i(179)][i(195)][i(239)]),!this[i(307)])return;if(t[i(161)]!==i(199)&&t[i(161)]!==i(295)&&"ArrowLeft"!==t[i(161)]&&t[i(161)]!==i(180))return;const s=this[i(179)][i(246)][i(236)]||this[i(179)][i(195)].selectAll();if(this[i(155)]=!this._activeMovingLayer,this._isFirstMove&&await this[i(306)](this[i(307)],s),!this[i(291)])throw new Error(i(323));const h=(o.V5?t[i(319)]:t[i(275)])?10:1;switch(t[i(161)]){case i(199):this[i(179)][i(246)][i(272)](s.left,s[i(210)]-h);break;case"ArrowDown":this._sc[i(246)].setTopLeft(s.left,s[i(210)]+h);break;case i(266):this[i(179)].selectionService[i(272)](s.left-h,s[i(210)]);break;case i(180):this[i(179)][i(246)][i(272)](s.left+h,s[i(210)])}this[i(291)][i(219)]()}async _startMove(t,i){const s=e;if((!this[s(291)]||this[s(291)]!==t[s(324)])&&t.temporaryLayer?.[s(238)]===s(224)&&(this[s(291)]=t[s(324)]),this[s(291)]&&this[s(291)]===t[s(324)])return;t[s(324)]&&await t[s(324)][s(310)](),(0,r.l$)(i,(0,r.DI)(t[s(203)],t.height));const h=(0,r.Oq)(i),n=(0,r.rY)(i);let o;const c=new Promise((t=>o=t)),l={resource:{width:h,height:n,data:new Uint8Array(new SharedArrayBuffer(h*n*4))},readyPromise:c,isReady:!1},p={image:l,range:i};this._activeMovingLayer=new a.m(t,p,this[s(202)](),this[s(179)][s(150)],this[s(179)].selectionService,this[s(179)][s(204)]),await t[s(322)](this._activeMovingLayer),await t[s(242)]((async(t,e,h)=>{const n=s;return await this._sc.taskWorkerService[n(237)](n(194),{cutImage:{data:l[n(205)][n(235)],width:l.resource.width,height:l.resource[n(264)]},cutRange:i,targetImage:{data:t,width:e,height:h}}),i})),o(l[s(205)]),l[s(321)]=!0,t[s(188)][s(234)](i)}async[e(175)](){const t=e,i=this[t(307)]||this[t(179)][t(195)][t(239)];if(!i)return;if(!this[t(291)]&&i[t(324)]?.type===t(224)&&(this[t(291)]=i.temporaryLayer),!this._activeMovingLayer)return;const s=this._activeMovingLayer;await this[t(179)][t(150)][t(247)](t(211),(async()=>{const e=t;await s[e(310)](),this._sc[e(246)][e(265)](i[e(203)],i.height),this[e(179)].selectionService[e(310)](e(211))})),this._clearMovingLayer()}_clearMovingLayer(){const t=e;this[t(307)]=void 0,this[t(291)]=void 0,this[t(244)]?.[t(257)](!1),this._onRequestRender[t(234)]()}_updateQuality(){const t=e,i=this[t(202)]();this[t(291)]&&this[t(291)][t(280)][t(162)]!==i&&(this[t(291)][t(280)][t(162)]=i,this._activeMovingLayer[t(165)](t(176)),this[t(291)][t(160)]())}[e(202)](){const t=e;switch(this[t(173)][t(248)]){case t(294):return t(163);case t(250):return t(216)}}_getQualityString(t){const i=e;switch(t){case i(163):return i(294);case i(216):return i(250)}}[e(169)](t){const i=e,s=new(p[i(187)])(t,(()=>this._sc[i(246)].range),!1,this[i(179)][i(279)],this[i(179)][i(195)]);return this[i(179)][i(246)][i(156)]((()=>s[i(257)](void 0!==this[i(179)][i(246)][i(236)]))),s[i(257)](void 0!==this[i(179)][i(246)][i(236)]),this[i(244)]=s,this[i(244)]}}const g=u}}]);