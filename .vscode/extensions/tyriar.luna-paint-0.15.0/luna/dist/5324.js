"use strict";const a52_0x58f9=["shapeDefinition","ellipse","max","getImageData","rgba(","length",'Invalid dimensions for image "',"strokeWidth","lineWidth","imageData","subarray","update","allowOnePixelSmoothing","77876lonluc","98669bzVjnZ","then","height",'Unrecognized shape "',"data","selection","floor","1505101ltTXDm","1bmSdPA","bind"," x ","push","min","left","933840mghnVr",'" dimensions differ',"visibleRange","smoothing","style","type","replace",'": ',"right",'" and "','Images "','" dimensions are equal',"fillStyle","top","targetImage","default","width","imageSize","674434dSqldN","drawShape","primaryColor","dimensions","1546357GjOagW","webpackChunkluna","strokeStyle","shapeSize","4lOhyuU","includes","blendMode","bottom","secondaryColor","clearRect","Could not attain 2d context","722297DnAyyD","indexOf",'Range "'],a52_0x49d6=function(e,t){return a52_0x58f9[e-=314]},a52_0x463885=a52_0x49d6;!function(e,t){const a=a52_0x49d6;for(;;)try{if(820947===parseInt(a(372))+parseInt(a(357))+parseInt(a(325))*parseInt(a(365))+parseInt(a(361))+-parseInt(a(333))*parseInt(a(324))+-parseInt(a(332))+-parseInt(a(339)))break;e.push(e.shift())}catch(t){e.push(e.shift())}}(a52_0x58f9),(self[a52_0x463885(362)]=self[a52_0x463885(362)]||[])[a52_0x463885(336)]([[5324],{5324:(e,t,a)=>{a.r(t),a.d(t,{run:()=>s});var i=a(4371),n=a(7517),r=a(1003),o=a(7742);const s=async(e,t,s)=>{const f=a52_0x49d6;let x;switch((0,o.ap)(s,f(353)),s[f(344)]){case"diamond":x=new((await a.e(727).then(a[f(334)](a,727)))[f(354)]);break;case f(376):x=new((await a.e(8459).then(a[f(334)](a,8459)))[f(354)]);break;case"triangle":x=new((await a.e(4012)[f(326)](a[f(334)](a,4012)))[f(354)]);break;case"rightTriangle":x=new((await a.e(6243).then(a[f(334)](a,6243)))[f(354)]);break;default:throw new Error(f(328)+s[f(344)]+'"')}const g=(0,r.kq)((0,r.BN)(s[f(360)]));if(s.selection&&(s.selection.left>g[f(338)]&&(g[f(338)]=Math[f(337)](s[f(330)][f(338)],g[f(347)])),s.selection[f(347)]<g[f(347)]&&(g[f(347)]=Math.max(s[f(330)][f(347)],g[f(338)])),s[f(330)][f(352)]>g[f(352)]&&(g[f(352)]=Math.min(s[f(330)].top,g.bottom)),s[f(330)].bottom<g.bottom&&(g[f(368)]=Math.max(s[f(330)][f(368)],g[f(352)]))),g[f(338)]===g[f(347)]||g[f(352)]===g[f(368)])throw new Error("The line can not be drawn outside of the selection and viewport");const h={...s,job:e,progressReporter:t,imageSize:{x:s[f(353)][f(355)],y:s.targetImage[f(327)]},shapeDefinition:x,shapeSize:{x:(0,r.Oq)(s[f(360)]),y:(0,r.rY)(s[f(360)])},shapeOffset:{x:s[f(360)][f(338)]%1,y:s[f(360)].top%1},visibleRange:l(s.dimensions,g)};h[f(318)]=Math[f(337)](h[f(318)],Math.ceil(Math.max(h.shapeSize.x,h[f(364)].y)/2));const m=new OffscreenCanvas(h[f(356)].x,h[f(356)].y).getContext("2d");if(!m)throw new Error(f(371));m[f(363)]=f(315)+h[f(359)][0]+","+h[f(359)][1]+","+h[f(359)][2]+","+h[f(359)][3]/255+")";const u=2===h[f(343)]?h[f(359)]:h[f(369)];let y,b,p,w;m[f(351)]=f(315)+u[0]+","+u[1]+","+u[2]+","+u[3]/255+")",m[f(319)]=2!==h[f(343)]?h[f(318)]:1,h.smoothing||3!==h[f(343)]?h[f(342)]||1!==h[f(318)]&&2!==h[f(343)]?({indexList:b,coordList:p,imageData:w,indexListCount:y}=d(h,m)):({indexList:b,coordList:p,imageData:w,indexListCount:y}=c(h,m)):({indexList:b,coordList:p,imageData:w,indexListCount:y}=function(e,t){const a=a52_0x49d6,n={...e,style:2,primaryColor:e.secondaryColor},r={...e,style:1},o=d(n,t);t[a(370)](0,0,e[a(356)].x,e[a(356)].y);const s=c(r,t),l=(0,i.X$)(e[a(356)].x*e[a(356)].y,e[a(356)].x*e[a(356)].y*4,!0),f=(0,i.X$)(e[a(356)].x*e[a(356)].y*2,Math.max(e[a(356)].x,e.imageSize.y),!0);let x=0,g=0,h=0,m=0,u=!1;for(h=e.visibleRange[a(352)];h<e[a(341)].bottom;h++)for(g=e[a(341)][a(338)];g<e.visibleRange.right;g++)m=4*(h*e[a(356)].x+g),u=!1,o[a(320)][m+3]>e[a(369)][3]/2&&(o[a(320)][m+3]=e[a(369)][3],u=!0),s.imageData[m+3]>e[a(359)][3]/2&&((0,i.Yr)(o[a(320)],m,s[a(320)],m),u=!0),u&&(f[2*x]=g,f[2*x+1]=h,l[x++]=m);return{imageData:o[a(320)],indexListCount:x,indexList:l,coordList:f}}(h,m));const k=b[f(321)](0,y);t[f(322)](.25);const S=new Uint8Array(new SharedArrayBuffer(4*b[f(316)]));let L=0;for(L=0;L<b[f(316)];L++)(0,i.Yr)(S,4*L,h[f(353)][f(329)],b[L]);if(t[f(322)](.5),h[f(367)]===f(345))for(L=0;L<k[f(316)];L++)(0,i.Yr)(h[f(353)][f(329)],k[L],w,4*(p[2*L+1]*h.imageSize.x+p[2*L]));else for(L=0;L<k.length;L++)(0,n.B)(h[f(367)],h[f(353)][f(329)],k[L],w,4*(p[2*L+1]*h[f(356)].x+p[2*L]));t[f(322)](.75);const D=new Uint8Array(new SharedArrayBuffer(4*b.length));for(L=0;L<b[f(316)];L++)(0,i.Yr)(D,4*L,h.targetImage[f(329)],b[L]);return t[f(322)](1),{undoData:{indexList:k,colorData:S},redoData:{indexList:k,colorData:D},range:g}};function c(e,t){const a=a52_0x49d6;if(!e[a(375)][a(323)]||e[a(318)]>1)return d(e,t);if(1===e[a(343)])return function(e,t){const a=a52_0x49d6;return e[a(375)][a(358)](e,t),function(e,t){const a=a52_0x49d6,n=(0,i.X$)(t.imageSize.x*t.imageSize.y,t.imageSize.x*t[a(356)].y*4,!0),r=(0,i.X$)(t.imageSize.x*t[a(356)].y*2,Math[a(377)](t.imageSize.x,t[a(356)].y),!0);let o=0;const s=t[a(356)].x,c=t.imageSize.y,d=t[a(359)];let l=0,f=0,x=0;const g=new Array(c);for(x=0;x<c;x++)for(g[x]=[],f=0;f<s;f++)l=4*(x*s+f),e[l+3]>d[3]/3?g[x][f]=e[l+3]:(e[l+3]=0,g[x][f]=0);const h=[0,0,0,0,0,0,0,0],m=[0,0];for(x=0;x<c;x++)for(f=0;f<s;f++)if(g[x][f]>0){h[0]=0===f||0===x?0:e[4*((x-1)*s+(f-1))+3],h[1]=0===x?0:e[4*((x-1)*s+f)+3],h[2]=0===x||f===s-1?0:e[4*((x-1)*s+(f+1))+3],h[3]=0===f?0:e[4*(x*s+(f-1))+3],h[4]=f===s-1?0:e[4*(x*s+(f+1))+3],h[5]=0===f||x===c-1?0:e[4*((x+1)*s+(f-1))+3],h[6]=x===c-1?0:e[4*((x+1)*s+f)+3],h[7]=x===c-1||f===s-1?0:e[4*((x+1)*s+(f+1))+3],h[0]>h[1]?(m[0]=0,m[1]=1):(m[0]=1,m[1]=0);for(let e=2;e<8;e++)h[e]>h[m[0]]?(m[1]=m[0],m[0]=e):h[e]>h[m[1]]&&(m[1]=e);switch(m[0]){case 0:g[x-1][f-1]=e[4*((x-1)*s+(f-1))+3];break;case 1:g[x-1][f]=e[4*((x-1)*s+f)+3];break;case 2:g[x-1][f+1]=e[4*((x-1)*s+(f+1))+3];break;case 3:g[x][f-1]=e[4*(x*s+(f-1))+3];break;case 4:g[x][f+1]=e[4*(x*s+(f+1))+3];break;case 5:g[x+1][f-1]=e[4*((x+1)*s+(f-1))+3];break;case 6:g[x+1][f]=e[4*((x+1)*s+f)+3];break;case 7:g[x+1][f+1]=e[4*((x+1)*s+(f+1))+3]}switch(m[1]){case 0:g[x-1][f-1]=e[4*((x-1)*s+(f-1))+3];break;case 1:g[x-1][f]=e[4*((x-1)*s+f)+3];break;case 2:g[x-1][f+1]=e[4*((x-1)*s+(f+1))+3];break;case 3:g[x][f-1]=e[4*(x*s+(f-1))+3];break;case 4:g[x][f+1]=e[4*(x*s+(f+1))+3];break;case 5:g[x+1][f-1]=e[4*((x+1)*s+(f-1))+3];break;case 6:g[x+1][f]=e[4*((x+1)*s+f)+3];break;case 7:g[x+1][f+1]=e[4*((x+1)*s+(f+1))+3]}}const u=[];let y=0;for(x=0;x<c;x++)for(f=0;f<s;f++)if(g[x][f]>0){if(y=0,f>0&&x>0&&g[x-1][f-1]>0&&(u[y++]=0),x>0&&g[x-1][f]>0&&(u[y++]=1),f<s-1&&x>0&&g[x-1][f+1]>0&&(u[y++]=2),f>0&&g[x][f-1]>0&&(u[y++]=3),f<s-1&&g[x][f+1]>0&&(u[y++]=4),f>0&&x<c-1&&g[x+1][f-1]>0&&(u[y++]=5),x<c-1&&g[x+1][f]>0&&(u[y++]=6),f<s-1&&x<c-1&&g[x+1][f+1]>0&&(u[y++]=7),y>2){for(l=y;l<u[a(316)];l++)u[l]=-1;l=u[a(373)](1),-1!==l&&g[x][f]>=g[x-1][f]&&(u[a(366)](0)&&g[x-1][f]<g[x-1][f-1]||u[a(366)](2)&&g[x-1][f]<g[x-1][f+1])&&(g[x-1][f]=0,e[4*((x-1)*s+f)+3]=0,u[l]=-1),l=u[a(373)](6),-1!==l&&g[x][f]>=g[x+1][f]&&(u[a(366)](5)&&g[x+1][f]<g[x+1][f-1]||u[a(366)](7)&&g[x+1][f]<g[x+1][f+1])&&(g[x+1][f]=0,e[4*((x+1)*s+f)+3]=0,u[l]=-1),l=u.indexOf(3),-1!==l&&g[x][f]>=g[x][f-1]&&(u[a(366)](0)&&g[x][f-1]<g[x-1][f-1]||u[a(366)](5)&&g[x][f-1]<g[x+1][f-1])&&(g[x][f-1]=0,e[4*(x*s+(f-1))+3]=0,u[l]=-1),l=u[a(373)](4),-1!==l&&g[x][f]>=g[x][f+1]&&(u.includes(2)&&g[x][f+1]<g[x-1][f+1]||u.includes(7)&&g[x][f+1]<g[x+1][f+1])&&(g[x][f+1]=0,e[4*(x*s+(f+1))+3]=0,u[l]=-1),u[a(366)](1)&&u[a(366)](3)&&u[a(366)](4)&&(g[x-1][f]=0,e[4*((x-1)*s+f)+3]=0),u[a(366)](3)&&u.includes(1)&&u[a(366)](6)&&(g[x][f-1]=0,e[4*(x*s+(f-1))+3]=0),u[a(366)](4)&&u[a(366)](1)&&u.includes(6)&&(g[x][f+1]=0,e[4*(x*s+(f+1))+3]=0),u[a(366)](6)&&u[a(366)](3)&&u[a(366)](4)&&(g[x+1][f]=0,e[4*((x+1)*s+f)+3]=0)}}else e[4*(x*s+f)+3]=0;for(y=0,x=0;x<c;x++)for(f=0;f<s;f++)if(g[x][f]>0&&(y=0,f>0&&x>0&&g[x-1][f-1]>0&&(u[y++]=0),x>0&&g[x-1][f]>0&&(u[y++]=1),f<s-1&&x>0&&g[x-1][f+1]>0&&(u[y++]=2),f>0&&g[x][f-1]>0&&(u[y++]=3),f<s-1&&g[x][f+1]>0&&(u[y++]=4),f>0&&x<c-1&&g[x+1][f-1]>0&&(u[y++]=5),x<c-1&&g[x+1][f]>0&&(u[y++]=6),f<s-1&&x<c-1&&g[x+1][f+1]>0&&(u[y++]=7),y>=2)){for(l=y;l<u[a(316)];l++)u[l]=-1;u[a(366)](4)&&g[x][f]<g[x][f+1]&&(u[a(366)](2)&&g[x][f]<g[x-1][f+1]||u.includes(7)&&g[x][f]<g[x+1][f+1])&&(g[x][f]=0,e[l+3]=0),u[a(366)](3)&&g[x][f]<g[x][f-1]&&(u[a(366)](0)&&g[x][f]<g[x-1][f-1]||u[a(366)](5)&&g[x][f]<g[x+1][f-1])&&(g[x][f]=0,e[l+3]=0)}for(x=t.visibleRange[a(352)];x<t.visibleRange[a(368)];x++)for(f=t[a(341)][a(338)];f<t.visibleRange[a(347)];f++)g[x][f]>0&&(l=4*(x*s+f),e[l+3]=d[3],r[2*o]=f,r[2*o+1]=x,n[o++]=l);return{imageData:e,indexListCount:o,indexList:n,coordList:r}}(t[a(314)](0,0,e[a(356)].x,e[a(356)].y)[a(329)],e)}(e,t);2===e[a(343)]&&(e[a(369)]=e[a(359)],e[a(343)]=3,e.strokeWidth=1);const n={...e,style:2,primaryColor:e[a(369)]},r={...e,style:1},o=d(n,t);t.clearRect(0,0,e[a(356)].x,e[a(356)].y);const s=c(r,t),l=(0,i.X$)(e[a(356)].x*e[a(356)].y,e[a(356)].x*e[a(356)].y*4,!0),f=(0,i.X$)(e[a(356)].x*e[a(356)].y*2,Math[a(377)](e.imageSize.x,e[a(356)].y),!0);let x=0,g=0,h=0,m=0,u=!1;for(h=e[a(341)][a(352)];h<e.visibleRange[a(368)];h++)for(g=e[a(341)][a(338)];g<e[a(341)].right;g++)m=4*(h*e[a(356)].x+g),u=!1,o[a(320)][m+3]>e.secondaryColor[3]/2&&((0,i.Yr)(o[a(320)],m,e[a(369)],0),u=!0),s[a(320)][m+3]>e[a(359)][3]/2&&((0,i.Yr)(o[a(320)],m,s.imageData,m),u=!0),u&&(f[2*x]=g,f[2*x+1]=h,l[x++]=m);return{imageData:o[a(320)],indexListCount:x,indexList:l,coordList:f}}function d(e,t){const a=a52_0x49d6;e[a(375)][a(358)](e,t);const n=t[a(314)](0,0,e[a(356)].x,e[a(356)].y).data,r=(0,i.X$)(e.imageSize.x*e[a(356)].y,e[a(356)].x*e[a(356)].y*4,!0),o=(0,i.X$)(e[a(356)].x*e[a(356)].y*2,Math[a(377)](e[a(356)].x,e[a(356)].y),!0);let s=0,c=0,d=0,l=0;if(e[a(342)])for(d=e[a(341)][a(352)];d<e.visibleRange[a(368)];d++)for(c=e.visibleRange[a(338)];c<e.visibleRange[a(347)];c++)l=4*(d*e[a(356)].x+c),n[l+3]>0&&(o[2*s]=c,o[2*s+1]=d,r[s++]=4*(d*e.imageSize.x+c));else for(d=e[a(341)].top;d<e[a(341)][a(368)];d++)for(c=e[a(341)][a(338)];c<e[a(341)][a(347)];c++)l=4*(d*e[a(356)].x+c),n[l+3]>e[a(359)][3]/2&&(n[l+3]=e[a(359)][3],o[2*s]=c,o[2*s+1]=d,r[s++]=4*(d*e[a(356)].x+c));return{imageData:n,indexListCount:s,indexList:r,coordList:o}}function l(e,t){const a=a52_0x49d6,i=t[a(338)]-Math[a(331)](e[a(338)]),n=i+(0,r.Oq)(t),o=t.top-Math[a(331)](e[a(352)]);return{left:i,right:n,top:o,bottom:o+(0,r.rY)(t)}}},7742:(e,t,a)=>{a.d(t,{ap:()=>n,TO:()=>r,zg:()=>o});var i=a(1003);function n(e,t){const a=a52_0x49d6,i=e[t];if(i[a(355)]<1||i[a(327)]<1)throw new Error(a(317)+t+a(346)+i[a(355)]+a(335)+i[a(327)])}function r(e,t,a){const i=a52_0x49d6,n=e[t],r=e[a];if(n.width===r[i(355)]&&n[i(327)]===r[i(327)])throw new Error(i(349)+t+i(348)+a+i(350))}function o(e,t,a){const n=a52_0x49d6,r=e[t];if(!(0,i.ur)(a,r))throw new Error(n(374)+t+'" '+(0,i.PW)(r)+" must be contained within "+(0,i.PW)(a))}}}]);