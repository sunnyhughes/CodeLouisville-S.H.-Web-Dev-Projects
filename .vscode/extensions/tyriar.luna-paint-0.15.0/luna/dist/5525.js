"use strict";const a18_0x693f=["setValueFromHistoryChange","style","_onRequestRender","prepend","floor","softLight","string","none","l0 ","multiply","text","_getEdit","_svgPath","difference","darken","textContent","keyUp","linearBurn","viewportService","createElement","width","event","_value","forceSolid","Blend Mode","_cursorInfo","removeChild","_container","overlay","_lastDownCoord","getCoordsFromEvent","allowUnchecking","exclusion","_updateCursorInfo","_model","_onUpdate","_color","Could not create extended edit","join","isValid","activeEntry","pointerDownMove","register","clientWidth","createDomRenderProgram","pointerMove","_hideCursorInfo","linearDodgeAdd","length","round","66015ulfUOF","add","2KaWwsf","transparent","containsCoord","keyDown","type","stroke","screen","toString","createElementNS","replace","min","webpackChunkluna","Pencil","3EyByIH","atan2","shiftKey"," 0z","append","_lastUpCoords","_drawLine","normal","zoom","onUpdate","order","historyService","sin","_setPixel","path","operationName","fill","display","63751UCtaxC","_imageService","_sc","onRedo","hasImage","requestRender","options","641963huTJde","render","fire","160773yvMFJW","abs","push","44239bYhLlb","_edit","_getAngle","commit","_isShiftDown","clientHeight","cos","9301xFjZpK","sqrt","left","_element","_ignoreSetPixel","offsetY","offsetX","isVisible","_onHistoryUpdateValue","map","onHistoryUpdateValue","pointerDown","setPixel","lighten","block","currentLayer","number","imageService","strokeWidth","max","_cursorCoord","getColorFromPointerEvent","_outlineModel","value","div","height","_updateOutline","setAttribute","name","_blendModeOption","_svg","pow","32007nUvTPG","paletteService","boolean","31NXNdHR"],a18_0x4096=function(t,s){return a18_0x693f[t-=393]},a18_0x2d4b4e=a18_0x4096;!function(t,s){const i=a18_0x4096;for(;;)try{if(187156===-parseInt(i(432))+-parseInt(i(422))*parseInt(i(530))-parseInt(i(435))-parseInt(i(474))+parseInt(i(477))*-parseInt(i(442))+parseInt(i(528))*parseInt(i(404))+parseInt(i(429)))break;t.push(t.shift())}catch(s){t.push(t.shift())}}(a18_0x693f),(self.webpackChunkluna=self[a18_0x2d4b4e(402)]||[]).push([[5525],{7571:(t,s,i)=>{i.d(s,{P:()=>h});var e=i(5120);class h extends e.JT{constructor(t,s){const i=a18_0x4096;super(),this._container=t,this[i(512)]=s,this.order=2,this[i(445)]=document[i(497)](i(466)),this._element.classList[i(529)]("cursor-info"),this[i(505)].appendChild(this[i(445)]),this[i(520)]({dispose:()=>this[i(505)][i(504)](this[i(445)])})}render(){const t=a18_0x4096;this[t(445)][t(479)].display=this._model[t(449)]?t(456):t(485),this._element[t(479)][t(444)]=this[t(512)].x+"px",this._element[t(479)].top=this[t(512)].y+"px",this._element[t(493)]=this[t(512)].text}}},566:(t,s,i)=>{const e=a18_0x2d4b4e;i.d(s,{d:()=>r,I:()=>a});var h=i(1019),o=i(5120),n=i(1674);class r extends o.JT{constructor(t,s,i,e){const h=a18_0x4096;super(),this._container=t,this[h(423)]=s,this._viewportService=i,this[h(512)]=e,this[h(414)]=2,this._svg=document.createElementNS(n.q,"svg"),this._svgPath=document[h(399)](n.q,h(418)),this[h(490)][h(479)][h(396)]="var(--luna-focusColor)",this[h(490)][h(479)][h(420)]=h(531),this[h(490)][h(479)].strokeWidth="1",this._svg[h(408)](this[h(490)]),this[h(505)][h(481)](this[h(472)]),this[h(520)]({dispose:()=>this[h(505)].removeChild(this[h(472)])})}[e(430)](){const t=e,s=this._viewportService;if(!this[t(512)].isValid||!this[t(423)][t(457)])return void(this[t(472)][t(479)][t(421)]=t(485));if(this[t(472)][t(479)][t(421)]=t(456),!this[t(512)][t(501)]&&this._model.strokeWidth<=1&&s[t(412)]>=3){const i=[];(0,h.j)(void 0,this[t(512)].x1,this[t(512)].y1,this[t(512)].x2,this[t(512)].y2,((s,e)=>i[t(434)]([s,e])),!1,this[t(512)].strokeWidth);const e=[];let o=0;for(;o<i.length-1;o++){const s=i[o];let h=o;if(s[0]===i[h+1][0]){for(;h+1<i[t(526)]&&s[0]===i[h+1][0];)h++;e[t(434)]([s[0],s[1],1,h-o+1])}else if(s[1]===i[h+1][1]){for(;h+1<i[t(526)]&&s[1]===i[h+1][1];)h++;e[t(434)]([s[0],s[1],h-o+1,1])}else e[t(434)]([s[0],s[1],1,1]);o=h}o===i.length-1&&e.push([i[o][0],i[o][1],1,1]);const n=Math.round(this[t(505)][t(521)]/2)-this[t(423)][t(498)]/2*s[t(412)]+s.x*s[t(412)],r=Math.round(this[t(505)][t(440)]/2)-this[t(423)].height/2*s[t(412)]+s.y*s[t(412)];let a="";for(const i of e)a+="M"+(n+i[0]*s[t(412)])+" "+(r+i[1]*s[t(412)]),a+="l"+i[2]*s[t(412)]+" 0",a+=t(486)+i[3]*s.zoom,a+="l-"+i[2]*s[t(412)]+t(407);return this[t(472)][t(469)](t(498),this._container.clientWidth[t(398)]()),this[t(472)][t(469)](t(467),this[t(505)][t(440)][t(398)]()),void this[t(490)][t(469)]("d",a)}this._svg[t(479)].display="block";const i=Math[t(527)](this._container[t(521)]/2)-this[t(423)].width/2*s[t(412)]+s.x*s.zoom,o=Math[t(527)](this[t(505)].clientHeight/2)-this[t(423)][t(467)]/2*s[t(412)]+s.y*s[t(412)],n=i+(this[t(512)].x1+.5)*s[t(412)],r=o+(this[t(512)].y1+.5)*s[t(412)],a=i+(this._model.x2+.5)*s.zoom,c=o+(this[t(512)].y2+.5)*s[t(412)];if(this[t(472)][t(469)](t(498),this[t(505)][t(521)][t(398)]()),this[t(472)][t(469)]("height",this[t(505)][t(440)].toString()),s[t(412)]>=3){const i=(0,h.X)(n,r,a,c,this[t(512)][t(460)],s[t(412)]);this[t(490)][t(469)]("d","M"+i[t(451)]((t=>t.x+","+t.y))[t(516)](" L")+"z")}else this[t(490)][t(469)]("d","M"+n+","+r+" L"+a+","+c)}}class a{constructor(){const t=e;this[t(517)]=!1,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this[t(460)]=1,this[t(501)]=!1}}},9904:(t,s,i)=>{const e=a18_0x2d4b4e;i.d(s,{FV:()=>r,rP:()=>a,tv:()=>c,Jp:()=>l,X5:()=>d,qv:()=>u});var h=i(1815),o=i(5120),n=i(2939);class r extends o.JT{constructor(t,s,i,e=!0){const o=a18_0x4096;super(),this[o(470)]=t,this[o(426)]=s,this[o(500)]=i,this[o(509)]=e,this.type=o(476),this._onHistoryUpdateValue=this[o(520)](new h.v),this[o(452)]=this[o(450)][o(499)],this[o(513)]=this[o(520)](new h.v),this.onUpdate=this[o(513)][o(499)]}get[e(465)](){return this[e(500)]}set value(t){this[e(500)]=t,this._onUpdate.fire(t)}[e(478)](t){this[e(500)]=t,this._onHistoryUpdateValue.fire(t)}}class a extends o.JT{constructor(t,s,i){const o=e;super(),this[o(470)]=t,this[o(428)]=s,this[o(500)]=i,this.type=o(484),this._onHistoryUpdateValue=this.register(new h.v),this[o(452)]=this[o(450)][o(499)],this[o(513)]=this[o(520)](new h.v),this.onUpdate=this[o(513)][o(499)]}get[e(465)](){return this[e(500)]}set value(t){const s=e;this._value=t,this[s(513)][s(431)](t)}[e(478)](t){const s=e;this[s(500)]=t,this._onHistoryUpdateValue[s(431)](t)}}class c extends o.JT{constructor(t,s,i){const o=e;super(),this[o(470)]=t,this[o(428)]=s,this[o(500)]=i,this[o(395)]="string-combo",this[o(450)]=this[o(520)](new h.v),this[o(452)]=this[o(450)][o(499)],this[o(513)]=this[o(520)](new h.v),this[o(413)]=this[o(513)].event}get value(){return this[e(500)]}set[e(465)](t){const s=e;this[s(500)]=t,this[s(513)].fire(t)}[e(478)](t){const s=e;this[s(500)]=t,this[s(450)][s(431)](t)}}class l extends a{constructor(){const t=e;super(t(502),[t(411),"replace",t(492),t(487),t(495),t(455),t(397),"linearDodgeAdd",t(506),"softLight",t(491),t(510)],t(411))}}class d extends o.JT{constructor(t,s,i,o){const n=e;super(),this[n(470)]=t,this._value=s,this[n(401)]=i,this.max=o,this.type=n(458),this._onHistoryUpdateValue=this.register(new h.v),this.onHistoryUpdateValue=this[n(450)].event,this._onUpdate=this.register(new h.v),this[n(413)]=this[n(513)][n(499)]}get[e(465)](){const t=e;return(0,n.u)(this[t(500)],this.max,this[t(401)])}set value(t){const s=e;this[s(500)]=t,this[s(513)][s(431)](t)}[e(478)](t){const s=e;this[s(500)]=t,this[s(450)][s(431)](t)}}class u extends d{constructor(t,s,i,h){const o=e;super(t,s,i,h),this[o(395)]="number"}get[e(465)](){const t=e;return(0,n.u)(this._value,this[t(461)],this[t(401)])}set[e(465)](t){const s=e;this[s(500)]=Math[s(482)](t),this[s(513)][s(431)](t)}}},5525:(t,s,i)=>{const e=a18_0x2d4b4e;i.r(s),i.d(s,{default:()=>u});var h=i(1815),o=i(5120),n=i(9455),r=i(7571),a=i(566),c=i(9904),l=i(1019);class d extends o.JT{constructor(t){const s=a18_0x4096;super(),this[s(424)]=t,this.id="pencil",this._lastUpCoords=[],this[s(462)]=[0,0],this[s(439)]=!1,this._outlineModel=new a.I,this[s(471)]=new c.Jp,this[s(428)]=[this[s(471)]],this[s(480)]=this.register(new h.v),this.onRequestRender=this._onRequestRender.event,this[s(503)]={x:0,y:0,text:"",isVisible:!1},this.register(this[s(424)].historyService.onUndo((t=>{const i=s;t[i(419)]===i(403)&&"Pencil"===this[i(424)][i(415)][i(518)]?.[i(419)]?this._lastUpCoords?.pop():this[i(409)][i(526)]=0}))),this[s(520)](this[s(424)][s(415)][s(425)]((()=>this[s(409)][s(526)]=0))),this[s(424)][s(496)].onUpdate((()=>{const t=s;this[t(464)][t(517)]=!1,this[t(524)]()}))}[e(522)](t){const s=e;return[new r.P(t,this[s(503)]),new a.d(t,this[s(424)][s(459)],this[s(424)][s(496)],this[s(464)])]}[e(453)](t){const s=e,i=this[s(424)].imageService;if(!i[s(457)])return;if(this[s(514)]=this[s(424)][s(475)][s(463)](t),!this[s(514)])return;const h=this[s(424)][s(496)].getCoordsFromEvent(t);if(h){if(t.shiftKey&&this[s(409)][s(526)]>0){const t=this[s(409)][this[s(409)][s(526)]-1];this[s(446)]=t,this._drawLine(t,h,this[s(514)]),this[s(446)]=void 0}if(i[s(393)](h[0],h[1])){const t=this._getEdit();this[s(417)](this[s(489)](),h[0],h[1],this[s(514)]),t[s(427)]()}this[s(507)]=h}}[e(519)](t){const s=e;if(!this[s(507)]||!this[s(514)])return;const i=this[s(424)][s(459)];if(!i[s(457)])return;const h=this[s(424)][s(496)][s(508)](t);this._lastDownCoord[0]===h[0]&&this[s(507)][1]===h[1]||((i.containsCoord(h[0],h[1])||i.containsCoord(this[s(507)][0],this._lastDownCoord[1]))&&this[s(410)](this[s(507)],h,this[s(514)]),this[s(507)]=h)}async pointerUp(t){const s=e;this[s(424)][s(459)][s(457)]&&(this[s(436)]?.[s(438)](s(403)),this[s(436)]=void 0);const i=this[s(424)][s(496)][s(508)](t);this[s(409)][s(434)](i),this._updateOutline(t,!1,!0)}async[e(523)](t,s){const i=e;this._cursorInfo.x=t[i(448)],this._cursorInfo.y=t[i(447)],this[i(462)]=this[i(424)].viewportService[i(508)](t),this[i(468)](t,s),!s&&t[i(406)]?this[i(511)]():this[i(503)][i(449)]&&this[i(524)]()}[e(394)](t,s){const i=e;!this[i(439)]&&t[i(406)]&&(this._isShiftDown=!0,!s&&(this[i(511)](),this[i(468)](t,s,!0)))}[e(494)](t){const s=e;!t[s(406)]&&(this[s(464)][s(517)]=!1,this[s(480)][s(431)](),this[s(503)][s(449)]&&this._hideCursorInfo(),this[s(439)]=!1)}_updateOutline(t,s,i){const h=e;if(i||this[h(464)].x1!==this._cursorCoord[0]||this._outlineModel.y1!==this[h(462)][1]){if(this[h(464)].x1=this[h(462)][0],this[h(464)].y1=this._cursorCoord[1],!s&&t[h(406)]&&this._lastUpCoords[h(526)]>0){const t=this[h(409)][this[h(409)][h(526)]-1];this[h(464)].x2=t[0],this[h(464)].y2=t[1],this[h(464)][h(517)]=!0}else this[h(464)].x2=this[h(462)][0],this[h(464)].y2=this[h(462)][1],this._outlineModel[h(517)]=this[h(424)][h(459)][h(393)](this[h(464)].x1,this[h(464)].y1);this[h(480)].fire()}}[e(511)](){const t=e;if(0===this[t(409)][t(526)])return;if(!this[t(462)])return;const s=this[t(409)][this[t(409)].length-1];if(s[0]===this[t(462)][0]&&s[1]===this[t(462)][1])return;const i=this[t(437)](s,this[t(462)]);this._cursorInfo[t(488)]=i+"°",this[t(503)][t(449)]=!0,this[t(480)][t(431)]()}[e(437)](t,s){return Math[e(527)](10*(0,n.AM)(t[0],t[1],s[0],s[1]))/10}[e(524)](){const t=e;this[t(503)][t(449)]=!1,this._onRequestRender[t(431)]()}[e(410)](t,s,i){const h=e,o=this[h(489)]();(0,l.j)(i,t[0],t[1],s[0],s[1],((t,s,i)=>this[h(417)](o,t,s,i)),!1),o[h(427)]()}[e(489)](){const t=e;if(!this[t(436)]&&(this[t(436)]=this[t(424)].imageService[t(457)]?.createExtendedEdit(),!this._edit))throw new Error(t(515));return this[t(436)]}[e(417)](t,s,i,h){const o=e;this[o(446)]&&this[o(446)][0]===s&&this[o(446)][1]===i||this[o(424)].selectionService[o(393)](s,i)&&this[o(424)][o(459)][o(393)](s,i)&&t[o(454)](s,i,h,this[o(471)][o(465)]===o(400)?void 0:this[o(471)][o(465)])}}const u=d},1019:(t,s,i)=>{i.d(s,{X:()=>o,j:()=>n});var e=i(8752),h=i(9455);function o(t,s,i,e,o,n){const r=a18_0x4096,a=(0,h.zz)(t,s,i,e),c=.5*n*o*Math[r(416)](a),l=.5*n*o*Math[r(441)](a);return[{x:t-c,y:s-l},{x:t+c,y:s+l},{x:i+c,y:e+l},{x:i-c,y:e-l}]}function n(t,s,i,e,h,o,n,u=1){n?function(t,s,i,e,h,o,n){const r=a18_0x4096;n<1&&(t=d(t,n));const a=Math.abs(h-i)>Math.abs(e-s);let u=0;a&&(u=s,s=i,i=u,u=e,e=h,h=u),s>e&&(u=s,s=e,e=u,u=i,i=h,h=u);const _=e-s;let p=(h-i)/_;0===_&&(p=1);let f=Math[r(527)](s),v=i+p*(f-s),x=l(s+.5);const g=f,y=Math[r(482)](v);let M=c(v)*x;a?(o(y,g,d(t,l(v)*x)),M>0&&o(y+1,g,d(t,M))):(o(g,y,d(t,l(v)*x)),M>0&&o(g,y+1,d(t,M)));let m=v+p;f=Math[r(527)](e),v=h+p*(f-e),x=c(e+.5);const w=f,C=Math[r(482)](v);if(M=c(v)*x,a?(o(C,w,d(t,l(v)*x)),M>0&&o(C+1,w,d(t,c(v)*x))):(o(w,C,d(t,l(v)*x)),M>0&&o(w,C+1,d(t,c(v)*x))),a)for(let s=g+1;s<w;s++)o(Math.floor(m),s,d(t,l(m))),M=c(m),M>0&&o(Math.floor(m)+1,s,d(t,M)),m+=p;else for(let s=g+1;s<w;s++)o(s,Math.floor(m),d(t,l(m))),M=c(m),M>0&&o(s,Math.floor(m)+1,d(t,M)),m+=p}(t,s,i,e,h,o,u):function(t,s,i,e,h,o,n){const c=a18_0x4096;n<1&&(t=d(t,n)),Math.abs(h-i)<Math[c(433)](e-s)?s>e?r(t,e,h,s,i,o):r(t,s,i,e,h,o):i>h?a(t,e,h,s,i,o):a(t,s,i,e,h,o)}(t,s,i,e,h,o,u)}function r(t,s,i,e,h,o){const n=e-s;let r=h-i,a=1;r<0&&(a=-1,r=-r);let c=2*r-n,l=i;for(let i=s;i<=e;i++)o(i,l,t),c>0?(l+=a,c+=2*(r-n)):c+=2*r}function a(t,s,i,e,h,o){let n=e-s;const r=h-i;let a=1;n<0&&(a=-1,n=-n);let c=2*n-r,l=s;for(let s=i;s<=h;s++)o(l,s,t),c>0?(l+=a,c+=2*(n-r)):c+=2*n}function c(t){return t%1}function l(t){return 1-t%1}function d(t,s){const i=a18_0x4096;if(void 0!==t)return e.m4.createReadonlyRgbaColor(t[0],t[1],t[2],Math[i(527)](t[3]*s))}},1674:(t,s,i)=>{i.d(s,{q:()=>e});const e="http://www.w3.org/2000/svg"},9455:(t,s,i)=>{function e(t,s,i,e){return 180*h(t,s,i,e)/Math.PI}function h(t,s,i,e){let h=-Math[a18_0x4096(405)](e-s,i-t);return-180===h&&(h=180),h}function o(t){return t*Math.PI/180}function n(t,s,i,e,h,o){const n=a18_0x4096,r=Math[n(443)](Math[n(473)](t-i,2)+Math[n(473)](s-e,2)),a=Math.sqrt(Math.pow(i-h,2)+Math[n(473)](e-o,2)),c=Math.sqrt(Math[n(473)](h-t,2)+Math[n(473)](o-s,2)),l=(r+a+c)/2;return Math[n(443)](l*(l-r)*(l-a)*(l-c))}function r(t,s,i,e,h,o,r,a){return n(t,s,i,e,h,o)+n(i,e,h,o,r,a)+n(h,o,r,a,t,s)+n(r,a,t,s,i,e)}i.d(s,{AM:()=>e,zz:()=>h,Ht:()=>o,ku:()=>n,hu:()=>r})}}]);